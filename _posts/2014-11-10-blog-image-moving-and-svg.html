---
layout: post
title: ブログの画像の引っ越しとSVG化(Retina対応とも)
author: cat_in_136
tags:
- blogger
- jekyll
- svg
date: '2014-11-10T01:09:50+09:00'
modified_time: '2014-11-10T01:09:50+09:00'
---
<p>
<a href="{% post_url 2014-09-06-move-to-jekyll %}">Jekyll移行メモ</a>
に沿った引っ越しを Blogger からしてきたのだが、
この度画像も github page のレポジトリに移動してきた。
</p>
<p>
また、この際に合わせて一部の図絵を SVG に変換して、
それを直接参照させるようにすることとした。
理由としては以下がある。
</p>
<ul>
<li>現在のモダンなブラウザは、スマートデバイスも含めて SVG に対応している</li>
<li>Retina Display やスマートデバイスなどでの高DPI環境下での見栄え</li>
<li>例え容量が増えたとしてもインターネット回線は（特にモバイルで）スループットが上がっているので単純なものなら気にする必要はないのではなか</li>
<li>そもそも、レポジトリに入れるのならば準テキストな形式の方が気持ちいい</li>
</ul>

<h4>面倒くさいので、色々はしょってみた</h4>
<p>
なお、Android 2.x 以前や iOS 4.x 以下、そして IE8 以下といった非対応ブラウザを
通常考慮しなければならないが、面倒くさいという理由で、
これは<em>考えないこととした</em>。
また、一般のサイトで提供している<em>フォールバックも提供しない</em>。
</p>
<p>
というか、そもそもサムネイルとかも面倒とかいうふざけた理由で提供していないので、
縮小画像でも HTML &lt;img&gt; タグ的に縮小している。
これによって、高 DPI 環境下でキレイに表示されるので、
これまた結果オーライとみなしてあんま考えないこととした。
</p>

<h4>予想外のユーザビリティ向上</h4>

<p>
SVG 化したことで、図中のテキストが選択などができるようになったという、
予想外にユーザビリティが上がることとなった。
例えば、
<a href="{% post_url 2012-02-18-v-highisdb-tmmmmbinottv %}">メモ：V-high/モバキャス/ISDB-Tmm/mmbi/nottv の言葉が意味不明だったから調べてみた</a>
での<a href="{% asset_image_path mobacas-protocol-stack.svg %}">プロトコル・スタックの図</a>はかつてはPNGラスター画像であった。
今回、文献元のPDFファイルをもとにinkscapeでSVG化したものに差し替えた。
テキストがテキストデータとして扱えるので、
多くのブラウザでは図中のテキストが選択や検索対象にできるようになっている。
例えば、図中の"ARIB STD-B31/B29"を選択してコピペなどができるようになった。
</p>
<p>
ただ、テキスト部分が環境によって適用されるフォントが異なるので、
意図したとおりの表示がなされないという問題がある。
フォントデータを一部埋め込めばいいわけであるが、
わざわざそこまでは対策していない。
</p>

<h4>github側でgzip転送するので容量はそう増えない</h4>

<p>
github page は CDN のようなものが導入されていて、
<samp>Content-Encoding: "gzip"</samp>でレスポンスが帰ってくるので、
それの恩恵も得られる。
SVG化すると&lt;冗長な&gt;&lt;タグ&gt;&lt;/冗長な&gt;が付加されるため
ファイルはおおきくなっているケースも多い。
が、gzipで軽くなっている例も結構あるようだ（詳細未調査）。
</p>

<p>
最後に極端に転送量が減っている例として、
<a href="{% post_url 2012-02-18-v-highisdb-tmmmmbinottv %}">メモ：V-high/モバキャス/ISDB-Tmm/mmbi/nottv の言葉が意味不明だったから調べてみた</a>
での<a href="{% asset_image_path mobacas-protocol-stack.svg %}">プロトコル・スタックの図</a>で比較をあげる：
</p>
<figure style="display: block; text-align: center;">
<table>
<thead>
<tr>
<td>項目</td>
<td>容量(bytes)</td>
<td>削減率</td>
</tr>
</thead>
<tbody>
<tr>
<td>PNG画像 688x355</td>
<td>22801</td>
<td>100%</td>
</tr>
<tr>
<td>PNG画像サムネイル表示 400x206</td>
<td>40563</td>
<td>178%</td>
</tr>
<tr>
<td>SVG画像</td>
<td>12180</td>
<td>53.4%</td>
</tr>
<tr>
<td>SVG画像+gzip圧縮転送</td>
<td>2536</td>
<td>11.1%</td>
</tr>
</tbody>
</table>
</figure>
<p>
これは blogger/Gdrive の自動生成しているサムネイルがかえって容量が増えているというひどい事例となった。
この画像については実に 9割近くの転送量が削減されていることがわかる。
（実際にはこれにHTTPヘッダなどが付いてくるが省略計算）
</p>

