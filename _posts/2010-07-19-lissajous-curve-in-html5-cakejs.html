---
layout: post
title: Lissajous curve in HTML5 cakejs
date: '2010-07-19T01:50:00.001+09:00'
author: cat_in_136
tags:
- javascript
- web application
last_modified_at: '2017-06-10T19:06:25+09:00'
blogger_id: tag:blogger.com,1999:blog-5670234897870215734.post-147570924746950314
blogger_orig_url: http://cat-in-136.blogspot.com/2010/07/lissajous-curve-in-html5-cakejs.html
---
<p>
Here, I show you a Lissajous curve with HTML 5 canvas. (No flash use!)
</p>
<div>
<canvas id="lissajous_canvas" width="300" height="250"></canvas>
<!--script type="text/javascript" src="http://cakejs.googlecode.com/svn/trunk/src/cake.js"></script-->
<script type="text/javascript" src="data:text/javascript;base64,LyoKQ0FLRSAtIENhbnZhcyBBbmltYXRpb24gS2l0IEV4cGVyaW1lbnQKCkNvcHlyaWdodCAoQykg
MjAwNyAgSWxtYXJpIEhlaWtraW5lbgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJl
ZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24Kb2J0YWluaW5nIGEgY29weSBvZiB0aGlzIHNvZnR3
YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24KZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwg
dG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dApyZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdp
dGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwKY29weSwgbW9kaWZ5LCBtZXJnZSwg
cHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRo
ZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlClNvZnR3YXJlIGlz
IGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nCmNvbmRpdGlvbnM6
CgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBz
aGFsbCBiZQppbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9m
IHRoZSBTb2Z0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VU
IFdBUlJBTlRZIE9GIEFOWSBLSU5ELApFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQg
Tk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMKT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNT
IEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQKTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVO
VCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQKSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFO
WSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksCldIRVRIRVIgSU4gQU4gQUNUSU9O
IE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORwpGUk9NLCBPVVQgT0YgT1Ig
SU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SCk9USEVSIERFQUxJ
TkdTIElOIFRIRSBTT0ZUV0FSRS4KKi8KCndpbmRvdy5yZXF1ZXN0QW5pbUZyYW1lID0gKGZ1bmN0
aW9uKCl7CiAgICAgIHJldHVybiAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSAgICAgICB8
fCAKICAgICAgICAgICAgICB3aW5kb3cud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IAog
ICAgICAgICAgICAgIHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgICAgfHwgCiAgICAg
ICAgICAgICAgd2luZG93Lm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWUgICAgICB8fCAKICAgICAgICAg
ICAgICB3aW5kb3cubXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgICAgIHx8IAogICAgICAgICAgICAg
IGZ1bmN0aW9uKC8qIGZ1bmN0aW9uICovIGNhbGxiYWNrLCAvKiBET01FbGVtZW50ICovIGVsZW1l
bnQpewogICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoY2FsbGJhY2ssIDEwMDAgLyA2
MCk7CiAgICAgICAgICAgICAgfTsKICAgIH0pKCk7CiAKLyoqCiAgRGVsZXRlIHRoZSBmaXJzdCBp
bnN0YW5jZSBvZiBvYmogZnJvbSB0aGUgYXJyYXkuCgogIEBwYXJhbSBvYmogVGhlIG9iamVjdCB0
byBkZWxldGUKICBAcmV0dXJuIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYXJyYXkgY29udGFp
bnMgbm8gaW5zdGFuY2VzIG9mIG9iagogIEB0eXBlIGJvb2xlYW4KICBAYWRkb24KICAqLwpBcnJh
eS5wcm90b3R5cGUuZGVsZXRlRmlyc3QgPSBmdW5jdGlvbihvYmopIHsKICBmb3IgKHZhciBpPTA7
IGk8dGhpcy5sZW5ndGg7IGkrKykgewogICAgaWYgKHRoaXNbaV0gPT0gb2JqKSB7CiAgICAgIHRo
aXMuc3BsaWNlKGksMSkKICAgICAgcmV0dXJuIHRydWUKICAgIH0KICB9CiAgcmV0dXJuIGZhbHNl
Cn0KCkFycmF5LnByb3RvdHlwZS5zdGFibGVTb3J0ID0gZnVuY3Rpb24oY21wKSB7CiAgLy8gaGFj
ayB0byB3b3JrIGFyb3VuZCBDaHJvbWUncyBxc29ydAogIGZvcih2YXIgaT0wOyBpPHRoaXMubGVu
Z3RoOyBpKyspIHsKICAgIHRoaXNbaV0uX19hcnJheVBvcyA9IGk7CiAgfQogIHJldHVybiB0aGlz
LnNvcnQoQXJyYXkuX19zdGFibGVTb3J0ZXIoY21wKSk7Cn0KQXJyYXkuX19zdGFibGVTb3J0ZXIg
PSBmdW5jdGlvbihjbXApIHsKICByZXR1cm4gKGZ1bmN0aW9uKGMxLCBjMikgewogICAgdmFyIHIg
PSBjbXAoYzEsYzIpOwogICAgaWYgKCFyKSB7IC8vIGhhY2sgdG8gd29yayBhcm91bmQgQ2hyb21l
J3MgcXNvcnQKICAgICAgcmV0dXJuIGMxLl9fYXJyYXlQb3MgLSBjMi5fX2FycmF5UG9zCiAgICB9
CiAgICByZXR1cm4gcjsKICB9KTsKfQoKLyoqCiAgQ29tcGFyZXMgdHdvIGFycmF5cyBmb3IgZXF1
YWxpdHkuIFJldHVybnMgdHJ1ZSBpZiB0aGUgYXJyYXlzIGFyZSBlcXVhbC4KICAqLwpBcnJheS5w
cm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24oYXJyYXkpIHsKICBpZiAoIWFycmF5KSByZXR1cm4g
ZmFsc2UKICBpZiAodGhpcy5sZW5ndGggIT0gYXJyYXkubGVuZ3RoKSByZXR1cm4gZmFsc2UKICBm
b3IgKHZhciBpPTA7IGk8dGhpcy5sZW5ndGg7IGkrKykgewogICAgdmFyIGEgPSB0aGlzW2ldCiAg
ICB2YXIgYiA9IGFycmF5W2ldCiAgICBpZiAoYS5lcXVhbHMgJiYgdHlwZW9mKGEuZXF1YWxzKSA9
PSAnZnVuY3Rpb24nKSB7CiAgICAgIGlmICghYS5lcXVhbHMoYikpIHJldHVybiBmYWxzZQogICAg
fSBlbHNlIGlmIChhICE9IGIpIHsKICAgICAgcmV0dXJuIGZhbHNlCiAgICB9CiAgfQogIHJldHVy
biB0cnVlCn0KCi8qKgogIFJvdGF0ZXMgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYW4gYXJyYXkgdG8g
YmUgdGhlIGxhc3QgZWxlbWVudC4KICBSb3RhdGVzIGxhc3QgZWxlbWVudCB0byBiZSB0aGUgZmly
c3QgZWxlbWVudCB3aGVuIGJhY2tUb0Zyb250IGlzIHRydWUuCgogIEBwYXJhbSB7Ym9vbGVhbn0g
YmFja1RvRnJvbnQgV2hldGhlciB0byBtb3ZlIHRoZSBsYXN0IGVsZW1lbnQgdG8gdGhlIGZyb250
IG9yIG5vdAogIEByZXR1cm4gVGhlIGxhc3QgZWxlbWVudCB3aGVuIGJhY2tUb0Zyb250IGlzIGZh
bHNlLCB0aGUgZmlyc3QgZWxlbWVudCB3aGVuIGJhY2tUb0Zyb250IGlzIHRydWUKICBAYWRkb24K
ICAqLwpBcnJheS5wcm90b3R5cGUucm90YXRlID0gZnVuY3Rpb24oYmFja1RvRnJvbnQpIHsKICBp
ZiAoYmFja1RvRnJvbnQpIHsKICAgIHRoaXMudW5zaGlmdCh0aGlzLnBvcCgpKQogICAgcmV0dXJu
IHRoaXNbMF0KICB9IGVsc2UgewogICAgdGhpcy5wdXNoKHRoaXMuc2hpZnQoKSkKICAgIHJldHVy
biB0aGlzW3RoaXMubGVuZ3RoLTFdCiAgfQp9Ci8qKgogIFJldHVybnMgYSByYW5kb20gZWxlbWVu
dCBmcm9tIHRoZSBhcnJheS4KCiAgQHJldHVybiBBIHJhbmRvbSBlbGVtZW50CiAgQGFkZG9uCiAq
LwpBcnJheS5wcm90b3R5cGUucGljayA9IGZ1bmN0aW9uKCkgewogIHJldHVybiB0aGlzW01hdGgu
Zmxvb3IoTWF0aC5yYW5kb20oKSp0aGlzLmxlbmd0aCldCn0KCkFycmF5LnByb3RvdHlwZS5mbGF0
dGVuID0gZnVuY3Rpb24oKSB7CiAgdmFyIGEgPSBbXQogIGZvciAodmFyIGk9MDsgaTx0aGlzLmxl
bmd0aDsgaSsrKSB7CiAgICB2YXIgZSA9IHRoaXNbaV0KICAgIGlmIChlLmZsYXR0ZW4pIHsKICAg
ICAgdmFyIGVmID0gZS5mbGF0dGVuKCkKICAgICAgZm9yICh2YXIgaj0wOyBqPGVmLmxlbmd0aDsg
aisrKSB7CiAgICAgICAgYVthLmxlbmd0aF0gPSBlZltqXQogICAgICB9CiAgICB9IGVsc2Ugewog
ICAgICBhW2EubGVuZ3RoXSA9IGUKICAgIH0KICB9CiAgcmV0dXJuIGEKfQoKQXJyYXkucHJvdG90
eXBlLnRha2UgPSBmdW5jdGlvbigpIHsKICB2YXIgYSA9IFtdCiAgZm9yICh2YXIgaT0wOyBpPHRo
aXMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBlID0gW10KICAgIGZvciAodmFyIGo9MDsgajxhcmd1
bWVudHMubGVuZ3RoOyBqKyspIHsKICAgICAgZVtqXSA9IHRoaXNbaV1bYXJndW1lbnRzW2pdXQog
ICAgfQogICAgYVtpXSA9IGUKICB9CiAgcmV0dXJuIGEKfQoKaWYgKCFBcnJheS5wcm90b3R5cGUu
cGx1Y2spIHsKICBBcnJheS5wcm90b3R5cGUucGx1Y2sgPSBmdW5jdGlvbihrZXkpIHsKICAgIHZh
ciBhID0gW10KICAgIGZvciAodmFyIGk9MDsgaTx0aGlzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGFb
aV0gPSB0aGlzW2ldW2tleV0KICAgIH0KICAgIHJldHVybiBhCiAgfQp9CgpBcnJheS5wcm90b3R5
cGUuc2V0ID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogIGZvciAodmFyIGk9MDsgaTx0aGlzLmxl
bmd0aDsgaSsrKSB7CiAgICB0aGlzW2ldW2tleV0gPSB2YWx1ZQogIH0KfQoKQXJyYXkucHJvdG90
eXBlLmFsbFdpdGggPSBmdW5jdGlvbigpIHsKICB2YXIgYSA9IFtdCiAgdG9wTG9vcDoKICBmb3Ig
KHZhciBpPTA7IGk8dGhpcy5sZW5ndGg7IGkrKykgewogICAgdmFyIGUgPSB0aGlzW2ldCiAgICBm
b3IgKHZhciBqPTA7IGo8YXJndW1lbnRzLmxlbmd0aDsgaisrKSB7CiAgICAgIGlmICghdGhpc1tp
XVthcmd1bWVudHNbal1dKQogICAgICAgIGNvbnRpbnVlIHRvcExvb3AKICAgIH0KICAgIGFbYS5s
ZW5ndGhdID0gZQogIH0KICByZXR1cm4gYQp9CgovLyBzb21lIGNvbW1vbiBoZWxwZXIgbWV0aG9k
cwoKaWYgKCFGdW5jdGlvbi5wcm90b3R5cGUuYmluZCkgewogIC8qKgogICAgQ3JlYXRlcyBhIGZ1
bmN0aW9uIHRoYXQgY2FsbHMgdGhpcyBmdW5jdGlvbiBpbiB0aGUgc2NvcGUgb2YgdGhlIGdpdmVu
CiAgICBvYmplY3QuCgogICAgICB2YXIgb2JqID0geyB4OiAnb2JqJyB9CiAgICAgIHZhciBmID0g
ZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnggfQogICAgICB3aW5kb3cueCA9ICd3aW5kb3cnCiAg
ICAgIGYoKQogICAgICAvLyA9PiAnd2luZG93JwogICAgICB2YXIgZyA9IGYuYmluZChvYmopCiAg
ICAgIGcoKQogICAgICAvLyA9PiAnb2JqJwoKICAgIEBwYXJhbSBvYmplY3QgT2JqZWN0IHRvIGJp
bmQgdGhpcyBmdW5jdGlvbiB0bwogICAgQHJldHVybiBGdW5jdGlvbiBib3VuZCB0byBvYmplY3QK
ICAgIEBhZGRvbgogICAgKi8KICBGdW5jdGlvbi5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uKG9i
amVjdCkgewogICAgdmFyIHQgPSB0aGlzCiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHJl
dHVybiB0LmFwcGx5KG9iamVjdCwgYXJndW1lbnRzKQogICAgfQogIH0KfQoKaWYgKCFBcnJheS5w
cm90b3R5cGUubGFzdCkgewogIC8qKgogICAgUmV0dXJucyB0aGUgbGFzdCBlbGVtZW50IG9mIHRo
ZSBhcnJheS4KCiAgICBAcmV0dXJuIFRoZSBsYXN0IGVsZW1lbnQgb2YgdGhlIGFycmF5CiAgICBA
YWRkb24KICAgICovCiAgQXJyYXkucHJvdG90eXBlLmxhc3QgPSBmdW5jdGlvbigpIHsKICAgIHJl
dHVybiB0aGlzW3RoaXMubGVuZ3RoLTFdCiAgfQp9CmlmICghQXJyYXkucHJvdG90eXBlLmluZGV4
T2YpIHsKICAvKioKICAgIFJldHVybnMgdGhlIGluZGV4IG9mIG9iaiBpZiBpdCBpcyBpbiB0aGUg
YXJyYXkuCiAgICBSZXR1cm5zIC0xIG90aGVyd2lzZS4KCiAgICBAcGFyYW0gb2JqIFRoZSBvYmpl
Y3QgdG8gZmluZCBmcm9tIHRoZSBhcnJheS4KICAgIEByZXR1cm4gVGhlIGluZGV4IG9mIG9iaiBv
ciAtMSBpZiBvYmogaXNuJ3QgaW4gdGhlIGFycmF5LgogICAgQGFkZG9uCiAgICAqLwogIEFycmF5
LnByb3RvdHlwZS5pbmRleE9mID0gZnVuY3Rpb24ob2JqKSB7CiAgICBmb3IgKHZhciBpPTA7IGk8
dGhpcy5sZW5ndGg7IGkrKykKICAgICAgaWYgKG9iaiA9PSB0aGlzW2ldKSByZXR1cm4gaQogICAg
cmV0dXJuIC0xCiAgfQp9CmlmICghQXJyYXkucHJvdG90eXBlLmluY2x1ZGVzKSB7CiAgLyoqCiAg
ICBSZXR1cm5zIHRydWUgaWYgb2JqIGlzIGluIHRoZSBhcnJheS4KICAgIFJldHVybnMgZmFsc2Ug
aWYgaXQgaXNuJ3QuCgogICAgQHBhcmFtIG9iaiBUaGUgb2JqZWN0IHRvIGZpbmQgZnJvbSB0aGUg
YXJyYXkuCiAgICBAcmV0dXJuIFRydWUgaWYgb2JqIGlzIGluIHRoZSBhcnJheSwgZmFsc2UgaWYg
aXQgaXNuJ3QKICAgIEBhZGRvbgogICAgKi8KICBBcnJheS5wcm90b3R5cGUuaW5jbHVkZXMgPSBm
dW5jdGlvbihvYmopIHsKICAgIHJldHVybiAodGhpcy5pbmRleE9mKG9iaikgPj0gMCk7CiAgfQp9
Ci8qKgogIEl0ZXJhdGUgZnVuY3Rpb24gZiBvdmVyIGVhY2ggZWxlbWVudCBvZiB0aGUgYXJyYXkg
YW5kIHJldHVybiBhbiBhcnJheQogIG9mIHRoZSByZXR1cm4gdmFsdWVzLgoKICBAcGFyYW0gZiBG
dW5jdGlvbiB0byBhcHBseSB0byBlYWNoIGVsZW1lbnQKICBAcmV0dXJuIEFuIGFycmF5IG9mIHJl
dHVybiB2YWx1ZXMgZnJvbSBhcHBseWluZyBmIG9uIGVhY2ggZWxlbWVudCBvZiB0aGUgYXJyYXkK
ICBAdHlwZSBBcnJheQogIEBhZGRvbgogICovCkFycmF5LnByb3RvdHlwZS5tYXAgPSBmdW5jdGlv
bihmKSB7CiAgdmFyIG5hID0gbmV3IEFycmF5KHRoaXMubGVuZ3RoKQogIGlmIChmKQogICAgZm9y
ICh2YXIgaT0wOyBpPHRoaXMubGVuZ3RoOyBpKyspIG5hW2ldID0gZih0aGlzW2ldLCBpLCB0aGlz
KQogIGVsc2UKICAgIGZvciAodmFyIGk9MDsgaTx0aGlzLmxlbmd0aDsgaSsrKSBuYVtpXSA9IHRo
aXNbaV0KICByZXR1cm4gbmEKfQpBcnJheS5wcm90b3R5cGUuZm9yRWFjaCA9IGZ1bmN0aW9uKGYp
IHsKICBmb3IgKHZhciBpPTA7IGk8dGhpcy5sZW5ndGg7IGkrKykgZih0aGlzW2ldLCBpLCB0aGlz
KQp9CmlmICghQXJyYXkucHJvdG90eXBlLnJlZHVjZSkgewogIEFycmF5LnByb3RvdHlwZS5yZWR1
Y2UgPSBmdW5jdGlvbihmLCBzKSB7CiAgICB2YXIgaSA9IDAKICAgIGlmIChhcmd1bWVudHMubGVu
Z3RoID09IDEpIHsKICAgICAgcyA9IHRoaXNbMF0KICAgICAgaSsrCiAgICB9CiAgICBmb3IoOyBp
PHRoaXMubGVuZ3RoOyBpKyspIHsKICAgICAgcyA9IGYocywgdGhpc1tpXSwgaSwgdGhpcykKICAg
IH0KICAgIHJldHVybiBzCiAgfQp9CmlmICghQXJyYXkucHJvdG90eXBlLmZpbmQpIHsKICBBcnJh
eS5wcm90b3R5cGUuZmluZCA9IGZ1bmN0aW9uKGYpIHsKICAgIGZvcih2YXIgaT0wOyBpPHRoaXMu
bGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKGYodGhpc1tpXSwgaSwgdGhpcykpIHJldHVybiB0aGlz
W2ldCiAgICB9CiAgfQp9CgppZiAoIVN0cmluZy5wcm90b3R5cGUuY2FwaXRhbGl6ZSkgewogIC8q
KgogICAgUmV0dXJucyBhIGNvcHkgb2YgdGhpcyBzdHJpbmcgd2l0aCB0aGUgZmlyc3QgY2hhcmFj
dGVyIHVwcGVyY2FzZWQuCgogICAgQHJldHVybiBDYXBpdGFsaXplZCB2ZXJzaW9uIG9mIHRoZSBz
dHJpbmcKICAgIEB0eXBlIFN0cmluZwogICAgQGFkZG9uCiAgICAqLwogIFN0cmluZy5wcm90b3R5
cGUuY2FwaXRhbGl6ZSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMucmVwbGFjZSgvXi4v
LCB0aGlzLnNsaWNlKDAsMSkudG9VcHBlckNhc2UoKSkKICB9Cn0KCmlmICghU3RyaW5nLnByb3Rv
dHlwZS5lc2NhcGUpIHsKICAvKioKICAgIFJldHVybnMgYSB2ZXJzaW9uIG9mIHRoZSBzdHJpbmcg
dGhhdCBjYW4gYmUgdXNlZCBhcyBhIHN0cmluZyBsaXRlcmFsLgoKICAgIEByZXR1cm4gQ29weSBv
ZiBzdHJpbmcgZW5jbG9zZWQgaW4gZG91YmxlLXF1b3Rlcywgd2l0aCBkb3VibGUtcXVvdGVzCiAg
ICAgICAgICAgIGluc2lkZSBzdHJpbmcgZXNjYXBlZC4KICAgIEB0eXBlIFN0cmluZwogICAgQGFk
ZG9uCiAgICAqLwogIFN0cmluZy5wcm90b3R5cGUuZXNjYXBlID0gZnVuY3Rpb24oKSB7CiAgICBy
ZXR1cm4gJyInICsgdGhpcy5yZXBsYWNlKC8iL2csICdcXCInKSArICciJwogIH0KfQppZiAoIVN0
cmluZy5wcm90b3R5cGUuc3BsaWNlKSB7CiAgU3RyaW5nLnByb3RvdHlwZS5zcGxpY2UgPSBmdW5j
dGlvbihzdGFydCwgY291bnQsIHJlcGxhY2VtZW50KSB7CiAgICByZXR1cm4gdGhpcy5zbGljZSgw
LHN0YXJ0KSArIHJlcGxhY2VtZW50ICsgdGhpcy5zbGljZShzdGFydCtjb3VudCkKICB9Cn0KaWYg
KCFTdHJpbmcucHJvdG90eXBlLnN0cmlwKSB7CiAgLyoqCiAgICBSZXR1cm5zIGEgY29weSBvZiB0
aGUgc3RyaW5nIHdpdGggcHJlY2VkaW5nIGFuZCB0cmFpbGluZyB3aGl0ZXNwYWNlCiAgICByZW1v
dmVkLgoKICAgIEByZXR1cm4gQ29weSBvZiBzdHJpbmcgc2FucyBzdXJyb3VuZGluZyB3aGl0ZXNw
YWNlLgogICAgQHR5cGUgU3RyaW5nCiAgICBAYWRkb24KICAgICovCiAgU3RyaW5nLnByb3RvdHlw
ZS5zdHJpcCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMucmVwbGFjZSgvXlxzK3xccysk
L2csICcnKQogIH0KfQoKaWYgKCF3aW5kb3dbJyRBJ10pIHsKICAvKioKICAgIENyZWF0ZXMgYSBu
ZXcgYXJyYXkgZnJvbSBhbiBvYmplY3Qgd2l0aCAjbGVuZ3RoLgogICAgKi8KICAkQSA9IGZ1bmN0
aW9uKG9iaikgewogICAgdmFyIGEgPSBuZXcgQXJyYXkob2JqLmxlbmd0aCkKICAgIGZvciAodmFy
IGk9MDsgaTxvYmoubGVuZ3RoOyBpKyspCiAgICAgIGFbaV0gPSBvYmpbaV0KICAgIHJldHVybiBh
CiAgfQp9CgppZiAoIXdpbmRvd1snJCddKSB7CiAgJCA9IGZ1bmN0aW9uKGlkKSB7CiAgICByZXR1
cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpCiAgfQp9CgppZiAoIU1hdGguc2luaCkgewog
IC8qKgogICAgUmV0dXJucyB0aGUgaHlwZXJib2xpYyBzaW5lIG9mIHguCgogICAgQHBhcmFtIHgg
VGhlIHZhbHVlIGZvciB4CiAgICBAcmV0dXJuIFRoZSBoeXBlcmJvbGljIHNpbmUgb2YgeAogICAg
QGFkZG9uCiAgICAqLwogIE1hdGguc2luaCA9IGZ1bmN0aW9uKHgpIHsKICAgIHJldHVybiAwLjUg
KiAoTWF0aC5leHAoeCkgLSBNYXRoLmV4cCgteCkpCiAgfQogIC8qKgogICAgUmV0dXJucyB0aGUg
aW52ZXJzZSBoeXBlcmJvbGljIHNpbmUgb2YgeC4KCiAgICBAcGFyYW0geCBUaGUgdmFsdWUgZm9y
IHgKICAgIEByZXR1cm4gVGhlIGludmVyc2UgaHlwZXJib2xpYyBzaW5lIG9mIHgKICAgIEBhZGRv
bgogICAgKi8KICBNYXRoLmFzaW5oID0gZnVuY3Rpb24oeCkgewogICAgcmV0dXJuIE1hdGgubG9n
KHggKyBNYXRoLnNxcnQoeCp4ICsgMSkpCiAgfQp9CmlmICghTWF0aC5jb3NoKSB7CiAgLyoqCiAg
ICBSZXR1cm5zIHRoZSBoeXBlcmJvbGljIGNvc2luZSBvZiB4LgoKICAgIEBwYXJhbSB4IFRoZSB2
YWx1ZSBmb3IgeAogICAgQHJldHVybiBUaGUgaHlwZXJib2xpYyBjb3NpbmUgb2YgeAogICAgQGFk
ZG9uCiAgICAqLwogIE1hdGguY29zaCA9IGZ1bmN0aW9uKHgpIHsKICAgIHJldHVybiAwLjUgKiAo
TWF0aC5leHAoeCkgKyBNYXRoLmV4cCgteCkpCiAgfQogIC8qKgogICAgUmV0dXJucyB0aGUgaW52
ZXJzZSBoeXBlcmJvbGljIGNvc2luZSBvZiB4LgoKICAgIEBwYXJhbSB4IFRoZSB2YWx1ZSBmb3Ig
eAogICAgQHJldHVybiBUaGUgaW52ZXJzZSBoeXBlcmJvbGljIGNvc2luZSBvZiB4CiAgICBAYWRk
b24KICAgICovCiAgTWF0aC5hY29zaCA9IGZ1bmN0aW9uKHgpIHsKICAgIHJldHVybiBNYXRoLmxv
Zyh4ICsgTWF0aC5zcXJ0KHgqeCAtIDEpKQogIH0KfQoKLyoqCiAgQ3JlYXRlcyBhbmQgY29uZmln
dXJlcyBhIERPTSBlbGVtZW50LgoKICBUaGUgdGFnIG9mIHRoZSBlbGVtZW50IGlzIGdpdmVuIGJ5
IG5hbWUuCgogIElmIHBhcmFtcyBpcyBhIHN0cmluZywgaXQgaXMgdXNlZCBhcyB0aGUgaW5uZXJI
VE1MIG9mIHRoZSBjcmVhdGVkIGVsZW1lbnQuCiAgSWYgcGFyYW1zIGlzIGEgRE9NIGVsZW1lbnQs
IGl0IGlzIGFwcGVuZGVkIHRvIHRoZSBjcmVhdGVkIGVsZW1lbnQuCiAgSWYgcGFyYW1zIGlzIGFu
IG9iamVjdCwgaXQgaXMgdHJlYXRlZCBhcyBhIGNvbmZpZyBvYmplY3QgYW5kIG1lcmdlZAogIHdp
dGggdGhlIGNyZWF0ZWQgZWxlbWVudC4KCiAgSWYgcGFyYW1zIGlzIGEgc3RyaW5nIG9yIERPTSBl
bGVtZW50LCB0aGUgdGhpcmQgYXJndW1lbnQgaXMgdHJlYXRlZAogIGFzIHRoZSBjb25maWcgb2Jq
ZWN0LgoKICBTcGVjaWFsIGF0dHJpYnV0ZXMgb2YgdGhlIGNvbmZpZyBvYmplY3Q6CiAgICAqIGNv
bnRlbnQKICAgICAgLSBpZiBjb250ZW50IGlzIGEgc3RyaW5nLCBpdCBpcyB1c2VkIGFzIHRoZSBp
bm5lckhUTUwgb2YgdGhlCiAgICAgICAgY3JlYXRlZCBlbGVtZW50CiAgICAgIC0gaWYgY29udGVu
dCBpcyBhbiBlbGVtZW50LCBpdCBpcyBhcHBlbmRlZCB0byB0aGUgY3JlYXRlZCBlbGVtZW50CiAg
ICAqIHN0eWxlCiAgICAgIC0gdGhlIHN0eWxlIG9iamVjdCBpcyBtZXJnZWQgd2l0aCB0aGUgY3Jl
YXRlZCBlbGVtZW50J3Mgc3R5bGUKCiAgQHBhcmFtIHtTdHJpbmd9IG5hbWUgVGhlIHRhZyBmb3Ig
dGhlIGNyZWF0ZWQgZWxlbWVudAogIEBwYXJhbSBwYXJhbXMgVGhlIGNvbnRlbnQgb3IgY29uZmln
IGZvciB0aGUgY3JlYXRlZCBlbGVtZW50CiAgQHBhcmFtIGNvbmZpZyBUaGUgY29uZmlnIGZvciB0
aGUgY3JlYXRlZCBlbGVtZW50IGlmIHBhcmFtcyBpcyBjb250ZW50CiAgQHJldHVybiBUaGUgY3Jl
YXRlZCBET00gZWxlbWVudAogICovCkUgPSBmdW5jdGlvbihuYW1lLCBwYXJhbXMsIGNvbmZpZykg
ewogIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQobmFtZSkKICBpZiAocGFyYW1zKSB7
CiAgICBpZiAodHlwZW9mKHBhcmFtcykgPT0gJ3N0cmluZycpIHsKICAgICAgZWwuaW5uZXJIVE1M
ID0gcGFyYW1zCiAgICAgIHBhcmFtcyA9IGNvbmZpZwogICAgfSBlbHNlIGlmIChwYXJhbXMuRE9D
VU1FTlRfTk9ERSkgewogICAgICBlbC5hcHBlbmRDaGlsZChwYXJhbXMpCiAgICAgIHBhcmFtcyA9
IGNvbmZpZwogICAgfQogICAgaWYgKHBhcmFtcykgewogICAgICBpZiAocGFyYW1zLnN0eWxlKSB7
CiAgICAgICAgdmFyIHN0eWxlID0gcGFyYW1zLnN0eWxlCiAgICAgICAgcGFyYW1zID0gT2JqZWN0
LmNsb25lKHBhcmFtcykKICAgICAgICBkZWxldGUgcGFyYW1zLnN0eWxlCiAgICAgICAgT2JqZWN0
LmZvcmNlRXh0ZW5kKGVsLnN0eWxlLCBzdHlsZSkKICAgICAgfQogICAgICBpZiAocGFyYW1zLmNv
bnRlbnQpIHsKICAgICAgICBpZiAodHlwZW9mKHBhcmFtcy5jb250ZW50KSA9PSAnc3RyaW5nJykg
ewogICAgICAgICAgZWwuYXBwZW5kQ2hpbGQoVChwYXJhbXMuY29udGVudCkpCiAgICAgICAgfSBl
bHNlIHsKICAgICAgICAgIGVsLmFwcGVuZENoaWxkKHBhcmFtcy5jb250ZW50KQogICAgICAgIH0K
ICAgICAgICBwYXJhbXMgPSBPYmplY3QuY2xvbmUocGFyYW1zKQogICAgICAgIGRlbGV0ZSBwYXJh
bXMuY29udGVudAogICAgICB9CiAgICAgIE9iamVjdC5mb3JjZUV4dGVuZChlbCwgcGFyYW1zKQog
ICAgfQogIH0KICByZXR1cm4gZWwKfQpFLmFwcGVuZCA9IGZ1bmN0aW9uKG5vZGUpIHsKICBmb3Io
dmFyIGk9MTsgaTxhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgIGlmICh0eXBlb2YoYXJndW1l
bnRzW2ldKSA9PSAnc3RyaW5nJykgewogICAgICBub2RlLmFwcGVuZENoaWxkKFQoYXJndW1lbnRz
W2ldKSkKICAgIH0gZWxzZSB7CiAgICAgIG5vZGUuYXBwZW5kQ2hpbGQoYXJndW1lbnRzW2ldKQog
ICAgfQogIH0KfQovLyBTYWZhcmkgcmVxdWlyZXMgZWFjaCBjYW52YXMgdG8gaGF2ZSBhIHVuaXF1
ZSBpZC4KRS5sYXN0Q2FudmFzSWQgPSAwCi8qKgogIENyZWF0ZXMgYW5kIHJldHVybnMgYSBjYW52
YXMgZWxlbWVudCB3aXRoIHdpZHRoIHcgYW5kIGhlaWdodCBoLgoKICBAcGFyYW0ge2ludH0gdyBU
aGUgd2lkdGggZm9yIHRoZSBjYW52YXMKICBAcGFyYW0ge2ludH0gaCBUaGUgaGVpZ2h0IGZvciB0
aGUgY2FudmFzCiAgQHBhcmFtIGNvbmZpZyBPcHRpb25hbCBjb25maWcgb2JqZWN0IHRvIHBhc3Mg
dG8gRSgpCiAgQHJldHVybiBUaGUgY3JlYXRlZCBjYW52YXMgZWxlbWVudAogICovCkUuY2FudmFz
ID0gZnVuY3Rpb24odyxoLGNvbmZpZykgewogIHZhciBpZCA9ICdjYW52YXMtdXVpZC0nICsgRS5s
YXN0Q2FudmFzSWQKICBFLmxhc3RDYW52YXNJZCsrCiAgaWYgKCFjb25maWcpIGNvbmZpZyA9IHt9
CiAgcmV0dXJuIEUoJ2NhbnZhcycsIE9iamVjdC5leHRlbmQoY29uZmlnLCB7aWQ6IGlkLCB3aWR0
aDogdywgaGVpZ2h0OiBofSkpCn0KCi8qKgogIFNob3J0Y3V0IGZvciBkb2N1bWVudC5jcmVhdGVU
ZXh0Tm9kZS4KCiAgQHBhcmFtIHtTdHJpbmd9IHRleHQgVGhlIHRleHQgZm9yIHRoZSB0ZXh0IG5v
ZGUKICBAcmV0dXJuIFRoZSBjcmVhdGVkIHRleHQgbm9kZQogICovClQgPSBmdW5jdGlvbih0ZXh0
KSB7CiAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQpCn0KCi8qKgogIE1lcmdl
cyB0aGUgc3JjIG9iamVjdCdzIGF0dHJpYnV0ZXMgd2l0aCB0aGUgZHN0IG9iamVjdCwgaWdub3Jp
bmcgZXJyb3JzLgoKICBAcGFyYW0gZHN0IFRoZSBkZXN0aW5hdGlvbiBvYmplY3QKICBAcGFyYW0g
c3JjIFRoZSBzb3VyY2Ugb2JqZWN0CiAgQHJldHVybiBUaGUgZHN0IG9iamVjdAogIEBhZGRvbgog
ICovCk9iamVjdC5mb3JjZUV4dGVuZCA9IGZ1bmN0aW9uKGRzdCwgc3JjKSB7CiAgZm9yICh2YXIg
aSBpbiBzcmMpIHsKICAgIHRyeXsgZHN0W2ldID0gc3JjW2ldIH0gY2F0Y2goZSkge30KICB9CiAg
cmV0dXJuIGRzdAp9Ci8vIEluIGNhc2UgT2JqZWN0LmV4dGVuZCBpc24ndCBkZWZpbmVkIGFscmVh
ZHksIHNldCBpdCB0byBPYmplY3QuZm9yY2VFeHRlbmQuCmlmICghT2JqZWN0LmV4dGVuZCkKICBP
YmplY3QuZXh0ZW5kID0gT2JqZWN0LmZvcmNlRXh0ZW5kCgovKioKICBNZXJnZXMgdGhlIHNyYyBv
YmplY3QncyBhdHRyaWJ1dGVzIHdpdGggdGhlIGRzdCBvYmplY3QsIHByZXNlcnZpbmcgYWxsIGRz
dAogIG9iamVjdCdzIGN1cnJlbnQgYXR0cmlidXRlcy4KCiAgQHBhcmFtIGRzdCBUaGUgZGVzdGlu
YXRpb24gb2JqZWN0CiAgQHBhcmFtIHNyYyBUaGUgc291cmNlIG9iamVjdAogIEByZXR1cm4gVGhl
IGRzdCBvYmplY3QKICBAYWRkb24KICAqLwpPYmplY3QuY29uZGl0aW9uYWxFeHRlbmQgPSBmdW5j
dGlvbihkc3QsIHNyYykgewogIGZvciAodmFyIGkgaW4gc3JjKSB7CiAgICBpZiAoZHN0W2ldID09
IG51bGwpCiAgICAgIGRzdFtpXSA9IHNyY1tpXQogIH0KICByZXR1cm4gZHN0Cn0KCi8qKgogIENy
ZWF0ZXMgYW5kIHJldHVybnMgYSBzaGFsbG93IGNvcHkgb2YgdGhlIHNyYyBvYmplY3QuCgogIEBw
YXJhbSBzcmMgVGhlIHNvdXJjZSBvYmplY3QKICBAcmV0dXJuIEEgY2xvbmUgb2YgdGhlIHNyYyBv
YmplY3QKICBAYWRkb24KICAqLwpPYmplY3QuY2xvbmUgPSBmdW5jdGlvbihzcmMpIHsKICBpZiAo
IXNyYyB8fCBzcmMgPT0gdHJ1ZSkKICAgIHJldHVybiBzcmMKICBzd2l0Y2ggKHR5cGVvZihzcmMp
KSB7CiAgICBjYXNlICdzdHJpbmcnOgogICAgICByZXR1cm4gT2JqZWN0LmV4dGVuZChzcmMrJycs
IHNyYykKICAgICAgYnJlYWsKICAgIGNhc2UgJ251bWJlcic6CiAgICAgIHJldHVybiBzcmMKICAg
ICAgYnJlYWsKICAgIGNhc2UgJ2Z1bmN0aW9uJzoKICAgICAgb2JqID0gZXZhbChzcmMudG9Tb3Vy
Y2UoKSkKICAgICAgcmV0dXJuIE9iamVjdC5leHRlbmQob2JqLCBzcmMpCiAgICAgIGJyZWFrCiAg
ICBjYXNlICdvYmplY3QnOgogICAgICBpZiAoc3JjIGluc3RhbmNlb2YgQXJyYXkpIHsKICAgICAg
ICByZXR1cm4gT2JqZWN0LmV4dGVuZChbXSwgc3JjKQogICAgICB9IGVsc2UgewogICAgICAgIHJl
dHVybiBPYmplY3QuZXh0ZW5kKHt9LCBzcmMpCiAgICAgIH0KICAgICAgYnJlYWsKICB9Cn0KCi8q
KgogIENyZWF0ZXMgYW5kIHJldHVybnMgYW4gSW1hZ2Ugb2JqZWN0LCB3aXRoIHNvdXJjZSBVUkwg
c2V0IHRvIHNyYyBhbmQKICBvbmxvYWQgaGFuZGxlciBzZXQgdG8gb25sb2FkLgoKICBAcGFyYW0g
e1N0cmluZ30gc3JjIFRoZSBzb3VyY2UgVVJMIGZvciB0aGUgaW1hZ2UKICBAcGFyYW0ge0Z1bmN0
aW9ufSBvbmxvYWQgVGhlIG9ubG9hZCBoYW5kbGVyIGZvciB0aGUgaW1hZ2UKICBAcmV0dXJuIFRo
ZSBjcmVhdGVkIEltYWdlIG9iamVjdAogIEB0eXBlIHtJbWFnZX0KICAqLwpPYmplY3QubG9hZElt
YWdlID0gZnVuY3Rpb24oc3JjLCBvbmxvYWQpIHsKICB2YXIgaW1nID0gbmV3IEltYWdlKCkKICBp
ZiAob25sb2FkKQogICAgaW1nLm9ubG9hZCA9IG9ubG9hZAogIGltZy5zcmMgPSBzcmMKICByZXR1
cm4gaW1nCn0KCi8qKgogIFJldHVybnMgdHJ1ZSBpZiBpbWFnZSBpcyBmdWxseSBsb2FkZWQgYW5k
IHJlYWR5IGZvciB1c2UuCgogIEBwYXJhbSBpbWFnZSBUaGUgaW1hZ2UgdG8gY2hlY2sKICBAcmV0
dXJuIFdoZXRoZXIgdGhlIGltYWdlIGlzIGxvYWRlZCBvciBub3QKICBAdHlwZSB7Ym9vbGVhbn0K
ICBAYWRkb24KICAqLwpPYmplY3QuaXNJbWFnZUxvYWRlZCA9IGZ1bmN0aW9uKGltYWdlKSB7CiAg
aWYgKGltYWdlLnRhZ05hbWUgPT0gJ0NBTlZBUycpIHJldHVybiB0cnVlCiAgaWYgKCFpbWFnZS5j
b21wbGV0ZSkgcmV0dXJuIGZhbHNlCiAgaWYgKGltYWdlLm5hdHVyYWxXaWR0aCA9PSBudWxsKSBy
ZXR1cm4gdHJ1ZQogIHJldHVybiAhIWltYWdlLm5hdHVyYWxXaWR0aAp9CgovKioKICBTdW1zIHR3
byBvYmplY3RzLgogICovCk9iamVjdC5zdW0gPSBmdW5jdGlvbihhLGIpIHsKICBpZiAoYSBpbnN0
YW5jZW9mIEFycmF5KSB7CiAgICBpZiAoYiBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICAgIHZhciBh
YiA9IFtdCiAgICAgIGZvciAodmFyIGk9MDsgaTxhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgYWJb
aV0gPSBhW2ldICsgYltpXQogICAgICB9CiAgICAgIHJldHVybiBhYgogICAgfSBlbHNlIHsKICAg
ICAgcmV0dXJuIGEubWFwKGZ1bmN0aW9uKHYpeyByZXR1cm4gdiArIGIgfSkKICAgIH0KICB9IGVs
c2UgaWYgKGIgaW5zdGFuY2VvZiBBcnJheSkgewogICAgcmV0dXJuIGIubWFwKGZ1bmN0aW9uKHYp
eyByZXR1cm4gdiArIGEgfSkKICB9IGVsc2UgewogICAgcmV0dXJuIGEgKyBiCiAgfQp9CgovKioK
ICBTdWJzdHJhY3RzIGIgZnJvbSBhLgogICovCk9iamVjdC5zdWIgPSBmdW5jdGlvbihhLGIpIHsK
ICBpZiAoYSBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICBpZiAoYiBpbnN0YW5jZW9mIEFycmF5KSB7
CiAgICAgIHZhciBhYiA9IFtdCiAgICAgIGZvciAodmFyIGk9MDsgaTxhLmxlbmd0aDsgaSsrKSB7
CiAgICAgICAgYWJbaV0gPSBhW2ldIC0gYltpXQogICAgICB9CiAgICAgIHJldHVybiBhYgogICAg
fSBlbHNlIHsKICAgICAgcmV0dXJuIGEubWFwKGZ1bmN0aW9uKHYpeyByZXR1cm4gdiAtIGIgfSkK
ICAgIH0KICB9IGVsc2UgaWYgKGIgaW5zdGFuY2VvZiBBcnJheSkgewogICAgcmV0dXJuIGIubWFw
KGZ1bmN0aW9uKHYpeyByZXR1cm4gYSAtIHYgfSkKICB9IGVsc2UgewogICAgcmV0dXJuIGEgLSBi
CiAgfQp9CgppZiAoIXdpbmRvdy5Nb3VzZSkgTW91c2UgPSB7fQovKioKICBSZXR1cm5zIHRoZSBj
b29yZGluYXRlcyBmb3IgYSBtb3VzZSBldmVudCByZWxhdGl2ZSB0byBlbGVtZW50LgogIEVsZW1l
bnQgbXVzdCBiZSB0aGUgdGFyZ2V0IGZvciB0aGUgZXZlbnQuCgogIEBwYXJhbSBlbGVtZW50IFRo
ZSBlbGVtZW50IHRvIGNvbXBhcmUgYWdhaW5zdAogIEBwYXJhbSBldmVudCBUaGUgbW91c2UgZXZl
bnQKICBAcmV0dXJuIEFuIG9iamVjdCBvZiBmb3JtIHt4OiByZWxhdGl2ZV94LCB5OiByZWxhdGl2
ZV95fQogICovCk1vdXNlLmdldFJlbGF0aXZlQ29vcmRzID0gZnVuY3Rpb24oZWxlbWVudCwgZXZl
bnQpIHsKICB2YXIgeHkgPSB7eDowLCB5OjB9CiAgdmFyIG9zbCA9IDAKICB2YXIgb3N0ID0gMAog
IHZhciBlbCA9IGVsZW1lbnQKICB3aGlsZSAoZWwpIHsKICAgIG9zbCArPSBlbC5vZmZzZXRMZWZ0
CiAgICBvc3QgKz0gZWwub2Zmc2V0VG9wCiAgICBlbCA9IGVsLm9mZnNldFBhcmVudAogIH0KICB4
eS54ID0gZXZlbnQucGFnZVggLSBvc2wKICB4eS55ID0gZXZlbnQucGFnZVkgLSBvc3QKICByZXR1
cm4geHkKfQoKQnJvd3NlciA9IChmdW5jdGlvbigpewogIHZhciB1YSA9IHdpbmRvdy5uYXZpZ2F0
b3IudXNlckFnZW50CiAgdmFyIGtodG1sID0gdWEubWF0Y2goL0tIVE1MLykKICB2YXIgZ2Vja28g
PSB1YS5tYXRjaCgvR2Vja28vKQogIHZhciB3ZWJraXQgPSB1YS5tYXRjaCgvV2ViS2l0XC9cZCsv
KQogIHZhciBpZSA9IHVhLm1hdGNoKC9FeHBsb3Jlci8pCiAgaWYgKGtodG1sKSByZXR1cm4gJ0tI
VE1MJwogIGlmIChnZWNrbykgcmV0dXJuICdHZWNrbycKICBpZiAod2Via2l0KSByZXR1cm4gJ1dl
YmtpdCcKICBpZiAoaWUpIHJldHVybiAnSUUnCiAgcmV0dXJuICdVTktOT1dOJwp9KSgpCgoKTW91
c2UuTEVGVCA9IDAKTW91c2UuTUlERExFID0gMQpNb3VzZS5SSUdIVCA9IDIKCmlmIChCcm93c2Vy
ID09ICdJRScpIHsKICBNb3VzZS5MRUZUID0gMQogIE1vdXNlLk1JRERMRSA9IDQKfQoKCi8qKgog
IEtsYXNzIGlzIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgY29uc3RydWN0b3IgZnVuY3Rpb24u
CgogIFRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbiBjYWxscyAjaW5pdGlhbGl6ZSB3aXRoIGl0cyBh
cmd1bWVudHMuCgogIFRoZSBwYXJhbWV0ZXJzIHRvIEtsYXNzIGhhdmUgdGhlaXIgcHJvdG90eXBl
cyBvciB0aGVtc2VsdmVzIG1lcmdlZCB3aXRoIHRoZQogIGNvbnN0cnVjdG9yIGZ1bmN0aW9uJ3Mg
cHJvdG90eXBlLgoKICBGaW5hbGx5LCB0aGUgY29uc3RydWN0b3IgZnVuY3Rpb24ncyBwcm90b3R5
cGUgaXMgbWVyZ2VkIHdpdGggdGhlIGNvbnN0cnVjdG9yCiAgZnVuY3Rpb24uIFNvIHlvdSBjYW4g
d3JpdGUgU2hhcGUuZ2V0QXJlYS5jYWxsKHRoaXMpIGluc3RlYWQgb2YKICBTaGFwZS5wcm90b3R5
cGUuZ2V0QXJlYS5jYWxsKHRoaXMpLgoKICBTaGFwZSA9IEtsYXNzKHsKICAgIGdldEFyZWEgOiBm
dW5jdGlvbigpIHsKICAgICAgcmFpc2UoJ05vIGFyZWEgZGVmaW5lZCEnKQogICAgfQogIH0pCgog
IFJlY3RhbmdsZSA9IEtsYXNzKFNoYXBlLCB7CiAgICBpbml0aWFsaXplIDogZnVuY3Rpb24oeCwg
eSkgewogICAgICB0aGlzLnggPSB4CiAgICAgIHRoaXMueSA9IHkKICAgIH0sCgogICAgZ2V0QXJl
YSA6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy54ICogdGhpcy55CiAgICB9CiAgfSkK
CiAgU3F1YXJlID0gS2xhc3MoUmVjdGFuZ2xlLCB7CiAgICBpbml0aWFsaXplIDogZnVuY3Rpb24o
cykgewogICAgICBSZWN0YW5nbGUuaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIHMsIHMpCiAgICB9CiAg
fSkKCiAgbmV3IFNxdWFyZSg1KS5nZXRBcmVhKCkKICAvLz0+IDI1CgogIEByZXR1cm4gQ29uc3Ry
dWN0b3Igb2JqZWN0IGZvciB0aGUgY2xhc3MKICAqLwpLbGFzcyA9IGZ1bmN0aW9uKCkgewogIHZh
ciBjID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1l
bnRzKQogIH0KICBjLmFuY2VzdG9ycyA9ICRBKGFyZ3VtZW50cykKICBjLnByb3RvdHlwZSA9IHt9
CiAgZm9yKHZhciBpID0gMDsgaTxhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBhID0g
YXJndW1lbnRzW2ldCiAgICBpZiAoYS5wcm90b3R5cGUpIHsKICAgICAgT2JqZWN0LmV4dGVuZChj
LnByb3RvdHlwZSwgYS5wcm90b3R5cGUpCiAgICB9IGVsc2UgewogICAgICBPYmplY3QuZXh0ZW5k
KGMucHJvdG90eXBlLCBhKQogICAgfQogIH0KICBPYmplY3QuZXh0ZW5kKGMsIGMucHJvdG90eXBl
KQogIHJldHVybiBjCn0KCgoKQ3VydmVzID0gewoKICBhbmd1bGFyRGlzdGFuY2UgOiBmdW5jdGlv
bihhLCBiKSB7CiAgICB2YXIgcGkyID0gTWF0aC5QSSoyCiAgICB2YXIgZCA9IChiIC0gYSkgJSBw
aTIKICAgIGlmIChkID4gTWF0aC5QSSkgZCAtPSBwaTIKICAgIGlmIChkIDwgLU1hdGguUEkpIGQg
Kz0gcGkyCiAgICByZXR1cm4gZAogIH0sCgogIGxpbmVQb2ludCA6IGZ1bmN0aW9uKGEsIGIsIHQp
IHsKICAgIHJldHVybiBbYVswXSsoYlswXS1hWzBdKSp0LCBhWzFdKyhiWzFdLWFbMV0pKnRdCiAg
fSwKCiAgcXVhZHJhdGljUG9pbnQgOiBmdW5jdGlvbihhLCBiLCBjLCB0KSB7CiAgICAvLyB2YXIg
ZCA9IHRoaXMubGluZVBvaW50KGEsYix0KQogICAgLy8gdmFyIGUgPSB0aGlzLmxpbmVQb2ludChi
LGMsdCkKICAgIC8vIHJldHVybiB0aGlzLmxpbmVQb2ludChkLGUsdCkKICAgIHZhciBkeCA9IGFb
MF0rKGJbMF0tYVswXSkqdAogICAgdmFyIGV4ID0gYlswXSsoY1swXS1iWzBdKSp0CiAgICB2YXIg
eCA9IGR4KyhleC1keCkqdAogICAgdmFyIGR5ID0gYVsxXSsoYlsxXS1hWzFdKSp0CiAgICB2YXIg
ZXkgPSBiWzFdKyhjWzFdLWJbMV0pKnQKICAgIHZhciB5ID0gZHkrKGV5LWR5KSp0CiAgICByZXR1
cm4gW3gseV0KICB9LAoKICBjdWJpY1BvaW50IDogZnVuY3Rpb24oYSwgYiwgYywgZCwgdCkgewog
ICAgdmFyIGF4MyA9IGFbMF0qMwogICAgdmFyIGJ4MyA9IGJbMF0qMwogICAgdmFyIGN4MyA9IGNb
MF0qMwogICAgdmFyIGF5MyA9IGFbMV0qMwogICAgdmFyIGJ5MyA9IGJbMV0qMwogICAgdmFyIGN5
MyA9IGNbMV0qMwogICAgcmV0dXJuIFsKICAgICAgYVswXSArIHQqKGJ4MyAtIGF4MyArIHQqKGF4
My0yKmJ4MytjeDMgKyB0KihieDMtYVswXS1jeDMrZFswXSkpKSwKICAgICAgYVsxXSArIHQqKGJ5
MyAtIGF5MyArIHQqKGF5My0yKmJ5MytjeTMgKyB0KihieTMtYVsxXS1jeTMrZFsxXSkpKQogICAg
XQogIH0sCgogIGxpbmVhclZhbHVlIDogZnVuY3Rpb24oYSxiLHQpIHsKICAgIHJldHVybiBhICsg
KGItYSkqdAogIH0sCgogIHF1YWRyYXRpY1ZhbHVlIDogZnVuY3Rpb24oYSxiLGMsdCkgewogICAg
dmFyIGQgPSBhICsgKGItYSkqdAogICAgdmFyIGUgPSBiICsgKGMtYikqdAogICAgcmV0dXJuIGQg
KyAoZS1kKSp0CiAgfSwKCiAgY3ViaWNWYWx1ZSA6IGZ1bmN0aW9uKGEsYixjLGQsdCkgewogICAg
dmFyIGEzID0gYSozLCBiMyA9IGIqMywgYzMgPSBjKjMKICAgIHJldHVybiBhICsgdCooYjMgLSBh
MyArIHQqKGEzLTIqYjMrYzMgKyB0KihiMy1hLWMzK2QpKSkKICB9LAoKICBjYXRtdWxsUm9tUG9p
bnQgOiBmdW5jdGlvbiAoYSxiLGMsZCwgdCkgewogICAgdmFyIGFmID0gKCgtdCsyKSp0LTEpKnQq
MC41CiAgICB2YXIgYmYgPSAoKCgzKnQtNSkqdCkqdCsyKSowLjUKICAgIHZhciBjZiA9ICgoLTMq
dCs0KSp0KzEpKnQqMC41CiAgICB2YXIgZGYgPSAoKHQtMSkqdCp0KSowLjUKICAgIHJldHVybiBb
CiAgICAgIGFbMF0qYWYgKyBiWzBdKmJmICsgY1swXSpjZiArIGRbMF0qZGYsCiAgICAgIGFbMV0q
YWYgKyBiWzFdKmJmICsgY1sxXSpjZiArIGRbMV0qZGYKICAgIF0KICB9LAoKICBjYXRtdWxsUm9t
QW5nbGUgOiBmdW5jdGlvbiAoYSxiLGMsZCwgdCkgewogICAgdmFyIGR4ID0gMC41ICogKGNbMF0g
LSBhWzBdICsgMip0KigyKmFbMF0gLSA1KmJbMF0gKyA0KmNbMF0gLSBkWzBdKSArCiAgICAgICAg
ICAgICAzKnQqdCooMypiWzBdICsgZFswXSAtIGFbMF0gLSAzKmNbMF0pKQogICAgdmFyIGR5ID0g
MC41ICogKGNbMV0gLSBhWzFdICsgMip0KigyKmFbMV0gLSA1KmJbMV0gKyA0KmNbMV0gLSBkWzFd
KSArCiAgICAgICAgICAgICAzKnQqdCooMypiWzFdICsgZFsxXSAtIGFbMV0gLSAzKmNbMV0pKQog
ICAgcmV0dXJuIE1hdGguYXRhbjIoZHksIGR4KQogIH0sCgogIGNhdG11bGxSb21Qb2ludEFuZ2xl
IDogZnVuY3Rpb24gKGEsYixjLGQsIHQpIHsKICAgIHZhciBwID0gdGhpcy5jYXRtdWxsUm9tUG9p
bnQoYSxiLGMsZCx0KQogICAgdmFyIGEgPSB0aGlzLmNhdG11bGxSb21BbmdsZShhLGIsYyxkLHQp
CiAgICByZXR1cm4ge3BvaW50OnAsIGFuZ2xlOmF9CiAgfSwKCiAgbGluZUFuZ2xlIDogZnVuY3Rp
b24oYSxiKSB7CiAgICByZXR1cm4gTWF0aC5hdGFuMihiWzFdLWFbMV0sIGJbMF0tYVswXSkKICB9
LAoKICBxdWFkcmF0aWNBbmdsZSA6IGZ1bmN0aW9uKGEsYixjLHQpIHsKICAgIHZhciBkID0gdGhp
cy5saW5lUG9pbnQoYSxiLHQpCiAgICB2YXIgZSA9IHRoaXMubGluZVBvaW50KGIsYyx0KQogICAg
cmV0dXJuIHRoaXMubGluZUFuZ2xlKGQsZSkKICB9LAoKICBjdWJpY0FuZ2xlIDogZnVuY3Rpb24o
YSwgYiwgYywgZCwgdCkgewogICAgdmFyIGUgPSB0aGlzLnF1YWRyYXRpY1BvaW50KGEsYixjLHQp
CiAgICB2YXIgZiA9IHRoaXMucXVhZHJhdGljUG9pbnQoYixjLGQsdCkKICAgIHJldHVybiB0aGlz
LmxpbmVBbmdsZShlLGYpCiAgfSwKCiAgbGluZUxlbmd0aCA6IGZ1bmN0aW9uKGEsYikgewogICAg
dmFyIHggPSAoYlswXS1hWzBdKQogICAgdmFyIHkgPSAoYlsxXS1hWzFdKQogICAgcmV0dXJuIE1h
dGguc3FydCh4KnggKyB5KnkpCiAgfSwKCiAgc3F1YXJlTGluZUxlbmd0aCA6IGZ1bmN0aW9uKGEs
YikgewogICAgdmFyIHggPSAoYlswXS1hWzBdKQogICAgdmFyIHkgPSAoYlsxXS1hWzFdKQogICAg
cmV0dXJuIHgqeCArIHkqeQogIH0sCgogIHF1YWRyYXRpY0xlbmd0aCA6IGZ1bmN0aW9uKGEsYixj
LCBlcnJvcikgewogICAgdmFyIHAxID0gdGhpcy5saW5lUG9pbnQoYSxiLDIvMykKICAgIHZhciBw
MiA9IHRoaXMubGluZVBvaW50KGIsYywxLzMpCiAgICByZXR1cm4gdGhpcy5jdWJpY0xlbmd0aChh
LHAxLHAyLGMsIGVycm9yKQogIH0sCgogIGN1YmljTGVuZ3RoIDogKGZ1bmN0aW9uKCkgewogICAg
dmFyIGJlenNwbGl0ID0gZnVuY3Rpb24odikgewogICAgICB2YXIgdnRlbXAgPSBbdi5zbGljZSgw
KV0KCiAgICAgIGZvciAodmFyIGk9MTsgaSA8IDQ7IGkrKykgewogICAgICAgIHZ0ZW1wW2ldID0g
W1tdLFtdLFtdLFtdXQogICAgICAgIGZvciAodmFyIGo9MDsgaiA8IDQtaTsgaisrKSB7CiAgICAg
ICAgICB2dGVtcFtpXVtqXVswXSA9IDAuNSAqICh2dGVtcFtpLTFdW2pdWzBdICsgdnRlbXBbaS0x
XVtqKzFdWzBdKQogICAgICAgICAgdnRlbXBbaV1bal1bMV0gPSAwLjUgKiAodnRlbXBbaS0xXVtq
XVsxXSArIHZ0ZW1wW2ktMV1baisxXVsxXSkKICAgICAgICB9CiAgICAgIH0KICAgICAgdmFyIGxl
ZnQgPSBbXQogICAgICB2YXIgcmlnaHQgPSBbXQogICAgICBmb3IgKHZhciBqPTA7IGo8NDsgaisr
KSB7CiAgICAgICAgbGVmdFtqXSA9IHZ0ZW1wW2pdWzBdCiAgICAgICAgcmlnaHRbal0gPSB2dGVt
cFszLWpdW2pdCiAgICAgIH0KICAgICAgcmV0dXJuIFtsZWZ0LCByaWdodF0KICAgIH0KCiAgICB2
YXIgYWRkaWZjbG9zZSA9IGZ1bmN0aW9uKHYsIGVycm9yKSB7CiAgICAgIHZhciBsZW4gPSAwCiAg
ICAgIGZvciAodmFyIGk9MDsgaSA8IDM7IGkrKykgewogICAgICAgIGxlbiArPSBDdXJ2ZXMubGlu
ZUxlbmd0aCh2W2ldLCB2W2krMV0pCiAgICAgIH0KICAgICAgdmFyIGNob3JkID0gQ3VydmVzLmxp
bmVMZW5ndGgodlswXSwgdlszXSkKICAgICAgaWYgKChsZW4gLSBjaG9yZCkgPiBlcnJvcikgewog
ICAgICAgIHZhciBsciA9IGJlenNwbGl0KHYpCiAgICAgICAgbGVuID0gYWRkaWZjbG9zZShsclsw
XSwgZXJyb3IpICsgYWRkaWZjbG9zZShsclsxXSwgZXJyb3IpCiAgICAgIH0KICAgICAgcmV0dXJu
IGxlbgogICAgfQoKICAgIHJldHVybiBmdW5jdGlvbihhLGIsYyxkLCBlcnJvcikgewogICAgICBp
ZiAoIWVycm9yKSBlcnJvciA9IDEKICAgICAgcmV0dXJuIGFkZGlmY2xvc2UoW2EsYixjLGRdLCBl
cnJvcikKICAgIH0KICB9KSgpLAoKICBxdWFkcmF0aWNMZW5ndGhQb2ludEFuZ2xlIDogZnVuY3Rp
b24oYSxiLGMsbHQsZXJyb3IpIHsKICAgIHZhciBwMSA9IHRoaXMubGluZVBvaW50KGEsYiwyLzMp
CiAgICB2YXIgcDIgPSB0aGlzLmxpbmVQb2ludChiLGMsMS8zKQogICAgcmV0dXJuIHRoaXMuY3Vi
aWNMZW5ndGhQb2ludEFuZ2xlKGEscDEscDIsYywgZXJyb3IpCiAgfSwKCiAgY3ViaWNMZW5ndGhQ
b2ludEFuZ2xlIDogZnVuY3Rpb24oYSxiLGMsZCxsdCxlcnJvcikgewogICAgLy8gdGhpcyB0aGlu
ZyBvdXRyaWdodCByYXBlcyB0aGUgR0MuCiAgICAvLyBob3cgYWJvdXQgbm90IGNyZWF0aW5nIGEg
YmlsbGlvbiBhcnJheXMsIGhtbT8KICAgIHZhciBsZW4gPSB0aGlzLmN1YmljTGVuZ3RoKGEsYixj
LGQsZXJyb3IpCiAgICB2YXIgcG9pbnQgPSBhCiAgICB2YXIgcHJldnBvaW50ID0gYQogICAgdmFy
IGxlbmd0aHMgPSBbXQogICAgdmFyIHByZXZsZW5zdW0gPSAwCiAgICB2YXIgbGVuc3VtID0gMAog
ICAgdmFyIHRsID0gbHQqbGVuCiAgICB2YXIgc2VncyA9IDIwCiAgICB2YXIgZmFjID0gMS9zZWdz
CiAgICBmb3IgKHZhciBpPTE7IGk8PXNlZ3M7IGkrKykgeyAvLyBGSVhNRSBnZXQgc21hcnRlcgog
ICAgICBwcmV2cG9pbnQgPSBwb2ludAogICAgICBwb2ludCA9IHRoaXMuY3ViaWNQb2ludChhLGIs
YyxkLCBmYWMqaSkKICAgICAgcHJldmxlbnN1bSA9IGxlbnN1bQogICAgICBsZW5zdW0gKz0gdGhp
cy5saW5lTGVuZ3RoKHByZXZwb2ludCwgcG9pbnQpCiAgICAgIGlmIChsZW5zdW0gPj0gdGwpIHsK
ICAgICAgICBpZiAobGVuc3VtID09IHByZXZsZW5zdW0pCiAgICAgICAgICByZXR1cm4ge3BvaW50
OiBwb2ludCwgYW5nbGU6IHRoaXMubGluZUFuZ2xlKGEsYil9CiAgICAgICAgdmFyIGRsID0gbGVu
c3VtIC0gdGwKICAgICAgICB2YXIgZHQgPSBkbCAvIChsZW5zdW0tcHJldmxlbnN1bSkKICAgICAg
ICByZXR1cm4ge3BvaW50OiB0aGlzLmxpbmVQb2ludChwcmV2cG9pbnQsIHBvaW50LCAxLWR0KSwK
ICAgICAgICAgICAgICAgIGFuZ2xlOiB0aGlzLmN1YmljQW5nbGUoYSxiLGMsZCwgZmFjKihpLWR0
KSkgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4ge3BvaW50OiBkLnNsaWNlKDApLCBhbmdsZTog
dGhpcy5saW5lQW5nbGUoYyxkKX0KICB9Cgp9CgoKCi8qKgogIENvbG9yIGhlbHBlciBmdW5jdGlv
bnMuCiAgKi8KQ29sb3JzID0gewoKICAvKioKICAgIENvbnZlcnRzIGFuIEhTTCBjb2xvciB0byBp
dHMgY29ycmVzcG9uZGluZyBSR0IgY29sb3IuCgogICAgQHBhcmFtIGggSHVlIGluIGRlZ3JlZXMg
KDAgLi4gMzU5KQogICAgQHBhcmFtIHMgU2F0dXJhdGlvbiAoMC4wIC4uIDEuMCkKICAgIEBwYXJh
bSBsIExpZ2h0bmVzcyAoMCAuLiAyNTUpCiAgICBAcmV0dXJuIFRoZSBjb3JyZXNwb25kaW5nIFJH
QiBjb2xvciBhcyBbcixnLGJdCiAgICBAdHlwZSBBcnJheQogICAgKi8KICBoc2wycmdiIDogZnVu
Y3Rpb24oaCxzLGwpIHsKICAgIHZhciByLGcsYgogICAgaWYgKHMgPT0gMCkgewogICAgICByPWc9
Yj12CiAgICB9IGVsc2UgewogICAgICB2YXIgcSA9IChsIDwgMC41ID8gbCAqICgxK3MpIDogbCtz
LShsKnMpKQogICAgICB2YXIgcCA9IDIgKiBsIC0gcQogICAgICB2YXIgaGsgPSAoaCAlIDM2MCkg
LyAzNjAKICAgICAgdmFyIHRyID0gaGsgKyAxLzMKICAgICAgdmFyIHRnID0gaGsKICAgICAgdmFy
IHRiID0gaGsgLSAxLzMKICAgICAgaWYgKHRyIDwgMCkgdHIrKwogICAgICBpZiAodHIgPiAxKSB0
ci0tCiAgICAgIGlmICh0ZyA8IDApIHRnKysKICAgICAgaWYgKHRnID4gMSkgdGctLQogICAgICBp
ZiAodGIgPCAwKSB0YisrCiAgICAgIGlmICh0YiA+IDEpIHRiLS0KICAgICAgaWYgKHRyIDwgMS82
KQogICAgICAgIHIgPSBwICsgKChxLXApKjYqdHIpCiAgICAgIGVsc2UgaWYgKHRyIDwgMS8yKQog
ICAgICAgIHIgPSBxCiAgICAgIGVsc2UgaWYgKHRyIDwgMi8zKQogICAgICAgIHIgPSBwICsgKChx
LXApKjYqKDIvMyAtIHRyKSkKICAgICAgZWxzZQogICAgICAgIHIgPSBwCgogICAgICBpZiAodGcg
PCAxLzYpCiAgICAgICAgZyA9IHAgKyAoKHEtcCkqNip0ZykKICAgICAgZWxzZSBpZiAodGcgPCAx
LzIpCiAgICAgICAgZyA9IHEKICAgICAgZWxzZSBpZiAodGcgPCAyLzMpCiAgICAgICAgZyA9IHAg
KyAoKHEtcCkqNiooMi8zIC0gdGcpKQogICAgICBlbHNlCiAgICAgICAgZyA9IHAKCiAgICAgIGlm
ICh0YiA8IDEvNikKICAgICAgICBiID0gcCArICgocS1wKSo2KnRiKQogICAgICBlbHNlIGlmICh0
YiA8IDEvMikKICAgICAgICBiID0gcQogICAgICBlbHNlIGlmICh0YiA8IDIvMykKICAgICAgICBi
ID0gcCArICgocS1wKSo2KigyLzMgLSB0YikpCiAgICAgIGVsc2UKICAgICAgICBiID0gcAogICAg
fQoKICAgIHJldHVybiBbcixnLGJdCiAgfSwKCiAgLyoqCiAgICBDb252ZXJ0cyBhbiBIU1YgY29s
b3IgdG8gaXRzIGNvcnJlc3BvbmRpbmcgUkdCIGNvbG9yLgoKICAgIEBwYXJhbSBoIEh1ZSBpbiBk
ZWdyZWVzICgwIC4uIDM1OSkKICAgIEBwYXJhbSBzIFNhdHVyYXRpb24gKDAuMCAuLiAxLjApCiAg
ICBAcGFyYW0gdiBWYWx1ZSAoMCAuLiAyNTUpCiAgICBAcmV0dXJuIFRoZSBjb3JyZXNwb25kaW5n
IFJHQiBjb2xvciBhcyBbcixnLGJdCiAgICBAdHlwZSBBcnJheQogICAgKi8KICBoc3YycmdiIDog
ZnVuY3Rpb24oaCxzLHYpIHsKICAgIHZhciByLGcsYgogICAgaWYgKHMgPT0gMCkgewogICAgICBy
PWc9Yj12CiAgICB9IGVsc2UgewogICAgICBoID0gKGggJSAzNjApLzYwLjAKICAgICAgdmFyIGkg
PSBNYXRoLmZsb29yKGgpCiAgICAgIHZhciBmID0gaC1pCiAgICAgIHZhciBwID0gdiAqICgxLXMp
CiAgICAgIHZhciBxID0gdiAqICgxLXMqZikKICAgICAgdmFyIHQgPSB2ICogKDEtcyooMS1mKSkK
ICAgICAgc3dpdGNoIChpKSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgciA9IHYKICAgICAg
ICAgIGcgPSB0CiAgICAgICAgICBiID0gcAogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlIDE6
CiAgICAgICAgICByID0gcQogICAgICAgICAgZyA9IHYKICAgICAgICAgIGIgPSBwCiAgICAgICAg
ICBicmVhawogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHIgPSBwCiAgICAgICAgICBnID0gdgog
ICAgICAgICAgYiA9IHQKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAzOgogICAgICAgICAg
ciA9IHAKICAgICAgICAgIGcgPSBxCiAgICAgICAgICBiID0gdgogICAgICAgICAgYnJlYWsKICAg
ICAgICBjYXNlIDQ6CiAgICAgICAgICByID0gdAogICAgICAgICAgZyA9IHAKICAgICAgICAgIGIg
PSB2CiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgNToKICAgICAgICAgIHIgPSB2CiAgICAg
ICAgICBnID0gcAogICAgICAgICAgYiA9IHEKICAgICAgICAgIGJyZWFrCiAgICAgIH0KICAgIH0K
ICAgIHJldHVybiBbcixnLGJdCiAgfSwKCiAgLyoqCiAgICBQYXJzZXMgYSBjb2xvciBzdHlsZSBv
YmplY3QgaW50byBvbmUgdGhhdCBjYW4gYmUgdXNlZCB3aXRoIHRoZSBnaXZlbgogICAgY2FudmFz
IGNvbnRleHQuCgogICAgQWNjZXB0ZWQgZm9ybWF0czoKICAgICAgJ3doaXRlJwogICAgICAnI2Zm
ZicKICAgICAgJyNmZmZmZmYnCiAgICAgICdyZ2JhKDI1NSwyNTUsMjU1LCAxLjApJwogICAgICBb
MjU1LCAyNTUsIDI1NV0KICAgICAgWzI1NSwgMjU1LCAyNTUsIDEuMF0KICAgICAgbmV3IEdyYWRp
ZW50KC4uLikKICAgICAgbmV3IFBhdHRlcm4oLi4uKQoKICAgIEBwYXJhbSBzdHlsZSBUaGUgY29s
b3Igc3R5bGUgdG8gcGFyc2UKICAgIEBwYXJhbSBjdHggQ2FudmFzIDJEIGNvbnRleHQgb24gd2hp
Y2ggdGhlIHN0eWxlIGlzIHRvIGJlIHVzZWQKICAgIEByZXR1cm4gQSBwYXJzZWQgc3R5bGUsIHJl
YWR5IHRvIGJlIHVzZWQgYXMgY3R4LmZpbGxTdHlsZSAvIHN0cm9rZVN0eWxlCiAgICAqLwogIHBh
cnNlQ29sb3JTdHlsZSA6IGZ1bmN0aW9uKHN0eWxlLCBjdHgpIHsKICAgIGlmICh0eXBlb2Ygc3R5
bGUgPT0gJ3N0cmluZycpIHsKICAgICAgcmV0dXJuIHN0eWxlCiAgICB9IGVsc2UgaWYgKHN0eWxl
LmNvbXBpbGVkKSB7CiAgICAgIHJldHVybiBzdHlsZS5jb21waWxlZAogICAgfSBlbHNlIGlmIChz
dHlsZS5pc1BhdHRlcm4pIHsKICAgICAgcmV0dXJuIHN0eWxlLmNvbXBpbGUoY3R4KQogICAgfSBl
bHNlIGlmIChzdHlsZS5sZW5ndGggPT0gMykgewogICAgICByZXR1cm4gJ3JnYmEoJytzdHlsZS5t
YXAoTWF0aC5yb3VuZCkuam9pbigiLCIpKycsIDEpJwogICAgfSBlbHNlIGlmIChzdHlsZS5sZW5n
dGggPT0gNCkgewogICAgICByZXR1cm4gJ3JnYmEoJysKICAgICAgICAgICAgICBNYXRoLnJvdW5k
KHN0eWxlWzBdKSsnLCcrCiAgICAgICAgICAgICAgTWF0aC5yb3VuZChzdHlsZVsxXSkrJywnKwog
ICAgICAgICAgICAgIE1hdGgucm91bmQoc3R5bGVbMl0pKycsJysKICAgICAgICAgICAgICBzdHls
ZVszXSsKICAgICAgICAgICAgICcpJwogICAgfSBlbHNlIHsgLy8gd3RmCiAgICAgIHRocm93KCAi
QmFkIHN0eWxlOiAiICsgc3R5bGUgKQogICAgfQogIH0KfQoKCgovKioKICBOYXZpZ2F0aW5nIGFy
b3VuZCBkaWZmZXJpbmcgaW1wbGVtZW50YXRpb25zIG9mIGNhbnZhcyBmZWF0dXJlcy4KCiAgQ3Vy
cmVudCBpc3N1ZXM6CgogIGlzUG9pbnRJblBhdGgoeCx5KToKCiAgICBPcGVyYSBzdXBwb3J0cyBp
c1BvaW50SW5QYXRoLgoKICAgIFNhZmFyaSBkb2Vzbid0IGhhdmUgaXNQb2ludEluUGF0aC4gU28g
eW91IG5lZWQgdG8ga2VlcCB0cmFjayBvZiB0aGUgQ1RNIGFuZAogICAgZG8geW91ciBvd24gaW4t
ZmlsbC1jaGVja2luZy4gV2hpY2ggaXMgZG9uZSBmb3IgY2lyY2xlcyBhbmQgcmVjdGFuZ2xlcwog
ICAgaW4gQ2lyY2xlI2lzUG9pbnRJblBhdGggYW5kIFJlY3RhbmdsZSNpc1BvaW50SW5QYXRoLgog
ICAgUGF0aHMgdXNlIGFuIGluYWNjdXJhdGUgYm91bmRpbmcgYm94IHRlc3QsIGltcGxlbWVudGVk
IGluCiAgICBQYXRoI2lzUG9pbnRJblBhdGguCgogICAgRmlyZWZveCAzIGhhcyBpc1BvaW50SW5Q
YXRoLiBCdXQgaXQgdXNlcyB1c2VyLXNwYWNlIGNvb3JkaW5hdGVzLgogICAgV2hpY2ggY2FuIGJl
IGVhc2lseSBuYXZpZ2F0ZWQgYXJvdW5kIGJlY2F1c2UgaXQgaGFzIHNldFRyYW5zZm9ybS4KCiAg
ICBGaXJlZm94IDIgaGFzIGlzUG9pbnRJblBhdGguIEJ1dCBpdCB1c2VzIHVzZXItc3BhY2UgY29v
cmRpbmF0ZXMuCiAgICBBbmQgdGhlcmUncyBubyBzZXRUcmFuc2Zvcm0sIHNvIHlvdSBuZWVkIHRv
IGtlZXAgdHJhY2sgb2YgdGhlIENUTSBhbmQKICAgIG11bHRpcGx5IHRoZSBtb3VzZSB2ZWN0b3Ig
d2l0aCB0aGUgQ1RNJ3MgaW52ZXJzZS4KCiAgRHJhd2luZyB0ZXh0OgoKICAgIFJoaW5vIGhhcyBj
dHguZHJhd1N0cmluZyh4LHksIHRleHQpCgogICAgRmlyZWZveCBoYXMgY3R4Lm1vekRyYXdUZXh0
KHRleHQpCgogICAgVGhlIFdoYXRXRyBzcGVjLCBTYWZhcmkgYW5kIE9wZXJhIGhhdmUgbm90aGlu
Zy4KCiovCkNhbnZhc1N1cHBvcnQgPSB7CiAgREVWSUNFX1NQQUNFIDogMCwgLy8gT3BlcmEKICBV
U0VSX1NQQUNFIDogMSwgICAvLyBGeDIsIEZ4MwogIGlzUG9pbnRJblBhdGhNb2RlIDogbnVsbCwK
ICBzdXBwb3J0c0lzUG9pbnRJblBhdGggOiBudWxsLAogIHN1cHBvcnRzQ1NTVHJhbnNmb3JtIDog
bnVsbCwKICBzdXBwb3J0c0NhbnZhcyA6IG51bGwsCgogIGlzQ2FudmFzU3VwcG9ydGVkIDogZnVu
Y3Rpb24oKSB7CiAgICBpZiAodGhpcy5zdXBwb3J0c0NhbnZhcyA9PSBudWxsKSB7CiAgICAgIHZh
ciBlID0ge307CiAgICAgIHRyeSB7IGUgPSBFKCdjYW52YXMnKTsgfSBjYXRjaCh4KSB7fQogICAg
ICB0aGlzLnN1cHBvcnRzQ2FudmFzID0gKGUuZ2V0Q29udGV4dCAhPSBudWxsKTsKICAgIH0KICAg
IHJldHVybiB0aGlzLnN1cHBvcnRzQ2FudmFzOwogIH0sCgogIGlzQ1NTVHJhbnNmb3JtU3VwcG9y
dGVkIDogZnVuY3Rpb24oKSB7CiAgICBpZiAodGhpcy5zdXBwb3J0c0NTU1RyYW5zZm9ybSA9PSBu
dWxsKSB7CiAgICAgIHZhciBlID0gRSgnZGl2JykKICAgICAgdmFyIGRicyA9IGUuc3R5bGUKICAg
ICAgdmFyIHMgPSAoZGJzLndlYmtpdFRyYW5zZm9ybSAhPSBudWxsIHx8IGRicy5Nb3pUcmFuc2Zv
cm0gIT0gbnVsbCkKICAgICAgdGhpcy5zdXBwb3J0c0NTU1RyYW5zZm9ybSA9IChzICE9IG51bGwp
CiAgICB9CiAgICByZXR1cm4gdGhpcy5zdXBwb3J0c0NTU1RyYW5zZm9ybQogIH0sCgogIGdldFRl
c3RDb250ZXh0IDogZnVuY3Rpb24oKSB7CiAgICBpZiAoIXRoaXMudGVzdENvbnRleHQpIHsKICAg
ICAgdmFyIGMgPSBFLmNhbnZhcygxLDEpCiAgICAgIHRoaXMudGVzdENvbnRleHQgPSBjLmdldENv
bnRleHQoJzJkJykKICAgIH0KICAgIHJldHVybiB0aGlzLnRlc3RDb250ZXh0CiAgfSwKCiAgZ2V0
U3VwcG9ydHNBdWRpb1RhZyA6IGZ1bmN0aW9uKCkgewogICAgdmFyIGUgPSBFKCdhdWRpbycpCiAg
ICByZXR1cm4gISFlLnBsYXkKICB9LAoKICBnZXRTdXBwb3J0c1NvdW5kTWFuYWdlciA6IGZ1bmN0
aW9uKCkgewogICAgcmV0dXJuICh3aW5kb3cuc291bmRNYW5hZ2VyICYmIHNvdW5kTWFuYWdlci5l
bmFibGVkKQogIH0sCgogIHNvdW5kSWQgOiAwLAoKICBnZXRTb3VuZE9iamVjdCA6IGZ1bmN0aW9u
KCkgewogICAgdmFyIGUgPSBudWxsCi8vICAgICBpZiAodGhpcy5nZXRTdXBwb3J0c0F1ZGlvVGFn
KCkpIHsKLy8gICAgICAgZSA9IHRoaXMuZ2V0QXVkaW9UYWdTb3VuZE9iamVjdCgpCi8vICAgICB9
IGVsc2UKICAgIGlmICh0aGlzLmdldFN1cHBvcnRzU291bmRNYW5hZ2VyKCkpIHsKICAgICAgZSA9
IHRoaXMuZ2V0U291bmRNYW5hZ2VyU291bmRPYmplY3QoKQogICAgfQogICAgcmV0dXJuIGUKICB9
LAoKICBnZXRBdWRpb1RhZ1NvdW5kT2JqZWN0IDogZnVuY3Rpb24oKSB7CiAgICB2YXIgc2lkID0g
J3NvdW5kLScgKyB0aGlzLnNvdW5kSWQrKwogICAgdmFyIGUgPSBFKCdhdWRpbycsIHtpZDogc2lk
fSkKICAgIGUubG9hZCA9IGZ1bmN0aW9uKHNyYykgewogICAgICB0aGlzLnNyYyA9IHNyYwogICAg
fQogICAgZS5hZGRFdmVudExpc3RlbmVyKCdjYW5wbGF5dGhyb3VnaCcsIGZ1bmN0aW9uKCkgewog
ICAgICBpZiAodGhpcy5vbnJlYWR5KSB0aGlzLm9ucmVhZHkoKQogICAgfSwgZmFsc2UpCiAgICBl
LnNldFZvbHVtZSA9IGZ1bmN0aW9uKHYpeyB0aGlzLnZvbHVtZSA9IHYgfQogICAgZS5zZXRQYW4g
PSBmdW5jdGlvbih2KXsgdGhpcy5wYW4gPSB2IH0KICAgIHJldHVybiBlCiAgfSwKCiAgZ2V0U291
bmRNYW5hZ2VyU291bmRPYmplY3QgOiBmdW5jdGlvbigpIHsKICAgIHZhciBzaWQgPSAnc291bmQt
JyArIHRoaXMuc291bmRJZCsrCiAgICB2YXIgZSA9IHsKICAgICAgdm9sdW1lOiAxMDAsCiAgICAg
IHBhbjogMCwKICAgICAgc2lkIDogc2lkLAogICAgICBsb2FkIDogZnVuY3Rpb24oc3JjKSB7CiAg
ICAgICAgcmV0dXJuIHNvdW5kTWFuYWdlci5sb2FkKHRoaXMuc2lkLCB7CiAgICAgICAgICB1cmw6
IHNyYywKICAgICAgICAgIGF1dG9QbGF5OiBmYWxzZSwKICAgICAgICAgIHZvbHVtZTogdGhpcy52
b2x1bWUsCiAgICAgICAgICBwYW46IHRoaXMucGFuCiAgICAgICAgfSkKICAgICAgfSwKICAgICAg
X29ubG9hZCA6IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICh0aGlzLm9ubG9hZCkgdGhpcy5vbmxv
YWQoKQogICAgICAgIGlmICh0aGlzLm9ucmVhZHkpIHRoaXMub25yZWFkeSgpCiAgICAgIH0sCiAg
ICAgIF9vbmVycm9yIDogZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHRoaXMub25lcnJvcikgdGhp
cy5vbmVycm9yKCkKICAgICAgfSwKICAgICAgX29uZmluaXNoIDogZnVuY3Rpb24oKSB7CiAgICAg
ICAgaWYgKHRoaXMub25maW5pc2gpIHRoaXMub25maW5pc2goKQogICAgICB9LAogICAgICBwbGF5
IDogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHNvdW5kTWFuYWdlci5wbGF5KHRoaXMuc2lk
KQogICAgICB9LAogICAgICBzdG9wIDogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHNvdW5k
TWFuYWdlci5zdG9wKHRoaXMuc2lkKQogICAgICB9LAogICAgICBwYXVzZSA6IGZ1bmN0aW9uKCkg
ewogICAgICAgIHJldHVybiBzb3VuZE1hbmFnZXIudG9nZ2xlUGF1c2UodGhpcy5zaWQpCiAgICAg
IH0sCiAgICAgIHNldFZvbHVtZSA6IGZ1bmN0aW9uKHYpIHsKICAgICAgICB0aGlzLnZvbHVtZSA9
IHYqMTAwCiAgICAgICAgcmV0dXJuIHNvdW5kTWFuYWdlci5zZXRWb2x1bWUodGhpcy5zaWQsIHYq
MTAwKQogICAgICB9LAogICAgICBzZXRQYW4gOiBmdW5jdGlvbih2KSB7CiAgICAgICAgdGhpcy5w
YW4gPSB2KjEwMAogICAgICAgIHJldHVybiBzb3VuZE1hbmFnZXIuc2V0UGFuKHRoaXMuc2lkLCB2
KjEwMCkKICAgICAgfQogICAgfQogICAgc291bmRNYW5hZ2VyLmNyZWF0ZVNvdW5kKHNpZCwgJ251
bGwubXAzJykKICAgIGUuc291bmQgPSBzb3VuZE1hbmFnZXIuZ2V0U291bmRCeUlkKHNpZCkKICAg
IGUuc291bmQub3B0aW9ucy5vbmZpbmlzaCA9IGUuX29uZmluaXNoLmJpbmQoZSkKICAgIGUuc291
bmQub3B0aW9ucy5vbmxvYWQgPSBlLl9vbmxvYWQuYmluZChlKQogICAgZS5zb3VuZC5vcHRpb25z
Lm9uZXJyb3IgPSBlLl9vbmVycm9yLmJpbmQoZSkKICAgIHJldHVybiBlCiAgfSwKCiAgLyoqCiAg
ICBDYW52YXMgY29udGV4dCBhdWdtZW50IG1vZHVsZSB0aGF0IGFkZHMgc2V0dGVycy4KICAgICov
CiAgQ29udGV4dFNldHRlckF1Z21lbnQgOiB7CiAgICBzZXRGaWxsU3R5bGUgOiBmdW5jdGlvbihm
cykgeyB0aGlzLmZpbGxTdHlsZSA9IGZzIH0sCiAgICBzZXRTdHJva2VTdHlsZSA6IGZ1bmN0aW9u
KHNzKSB7IHRoaXMuc3Ryb2tlU3R5bGUgPSBzcyB9LAogICAgc2V0R2xvYmFsQWxwaGEgOiBmdW5j
dGlvbihnYSkgeyB0aGlzLmdsb2JhbEFscGhhID0gZ2EgfSwKICAgIHNldExpbmVXaWR0aCA6IGZ1
bmN0aW9uKGx3KSB7IHRoaXMubGluZVdpZHRoID0gbHcgfSwKICAgIHNldExpbmVDYXAgOiBmdW5j
dGlvbihsdykgeyB0aGlzLmxpbmVDYXAgPSBsdyB9LAogICAgc2V0TGluZUpvaW4gOiBmdW5jdGlv
bihsdykgeyB0aGlzLmxpbmVKb2luID0gbHcgfSwKICAgIHNldE1pdGVyTGltaXQgOiBmdW5jdGlv
bihsdykgeyB0aGlzLm1pdGVyTGltaXQgPSBsdyB9LAogICAgc2V0R2xvYmFsQ29tcG9zaXRlT3Bl
cmF0aW9uIDogZnVuY3Rpb24obHcpIHsKICAgICAgdGhpcy5nbG9iYWxDb21wb3NpdGVPcGVyYXRp
b24gPSBsdwogICAgfSwKICAgIHNldFNoYWRvd0NvbG9yIDogZnVuY3Rpb24oeCkgeyB0aGlzLnNo
YWRvd0NvbG9yID0geCB9LAogICAgc2V0U2hhZG93Qmx1ciA6IGZ1bmN0aW9uKHgpIHsgdGhpcy5z
aGFkb3dCbHVyID0geCB9LAogICAgc2V0U2hhZG93T2Zmc2V0WCA6IGZ1bmN0aW9uKHgpIHsgdGhp
cy5zaGFkb3dPZmZzZXRYID0geCB9LAogICAgc2V0U2hhZG93T2Zmc2V0WSA6IGZ1bmN0aW9uKHgp
IHsgdGhpcy5zaGFkb3dPZmZzZXRZID0geCB9LAogICAgc2V0TW96VGV4dFN0eWxlIDogZnVuY3Rp
b24oeCkgeyB0aGlzLm1velRleHRTdHlsZSA9IHggfSwKICAgIHNldEZvbnQgOiBmdW5jdGlvbih4
KSB7IHRoaXMuZm9udCA9IHggfSwKICAgIHNldFRleHRBbGlnbiA6IGZ1bmN0aW9uKHgpIHsgdGhp
cy50ZXh0QWxpZ24gPSB4IH0sCiAgICBzZXRUZXh0QmFzZWxpbmUgOiBmdW5jdGlvbih4KSB7IHRo
aXMudGV4dEJhc2VsaW5lID0geCB9CiAgfSwKCiAgQ29udGV4dEpTSW1wbEF1Z21lbnQgOiB7CiAg
ICBpZGVudGl0eSA6IGZ1bmN0aW9uKCkgewogICAgICBDYW52YXNTdXBwb3J0LnNldFRyYW5zZm9y
bSh0aGlzLCBbMSwwLDAsMSwwLDBdKQogICAgfQogIH0sCgogIC8qKgogICAgQXVnbWVudHMgYSBj
YW52YXMgY29udGV4dCB3aXRoIHNldHRlcnMuCiAgICAqLwogIGF1Z21lbnQgOiBmdW5jdGlvbihj
dHgpIHsKICAgIE9iamVjdC5jb25kaXRpb25hbEV4dGVuZChjdHgsIHRoaXMuQ29udGV4dFNldHRl
ckF1Z21lbnQpCiAgICBPYmplY3QuY29uZGl0aW9uYWxFeHRlbmQoY3R4LCB0aGlzLkNvbnRleHRK
U0ltcGxBdWdtZW50KQogICAgcmV0dXJuIGN0eAogIH0sCgogIC8qKgogICAgR2V0cyB0aGUgYXVn
bWVudGVkIGNvbnRleHQgZm9yIGNhbnZhcy4KICAgICovCiAgZ2V0Q29udGV4dCA6IGZ1bmN0aW9u
KGNhbnZhcywgdHlwZSkgewogICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KHR5cGUgfHwg
JzJkJykKICAgIHRoaXMuYXVnbWVudChjdHgpCiAgICByZXR1cm4gY3R4CiAgfSwKCgogIC8qKgog
ICAgTXVsdGlwbGllcyB0d28gM3gyIGFmZmluZSAyRCBjb2x1bW4tbWFqb3IgdHJhbnNmb3JtYXRp
b24gbWF0cmljZXMgd2l0aAogICAgZWFjaCBvdGhlciBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4g
dGhlIGZpcnN0IG1hdHJpeC4KCiAgICBSZXR1cm5zIHRoZSBtdWx0aXBsaWVkIG1hdHJpeCBtMS4K
ICAgICovCiAgdE1hdHJpeE11bHRpcGx5IDogZnVuY3Rpb24obTEsIG0yKSB7CiAgICB2YXIgbTEx
ID0gbTFbMF0qbTJbMF0gKyBtMVsyXSptMlsxXQogICAgdmFyIG0xMiA9IG0xWzFdKm0yWzBdICsg
bTFbM10qbTJbMV0KCiAgICB2YXIgbTIxID0gbTFbMF0qbTJbMl0gKyBtMVsyXSptMlszXQogICAg
dmFyIG0yMiA9IG0xWzFdKm0yWzJdICsgbTFbM10qbTJbM10KCiAgICB2YXIgZHggPSBtMVswXSpt
Mls0XSArIG0xWzJdKm0yWzVdICsgbTFbNF0KICAgIHZhciBkeSA9IG0xWzFdKm0yWzRdICsgbTFb
M10qbTJbNV0gKyBtMVs1XQoKICAgIG0xWzBdID0gbTExCiAgICBtMVsxXSA9IG0xMgogICAgbTFb
Ml0gPSBtMjEKICAgIG0xWzNdID0gbTIyCiAgICBtMVs0XSA9IGR4CiAgICBtMVs1XSA9IGR5Cgog
ICAgcmV0dXJuIG0xCiAgfSwKCiAgLyoqCiAgICBNdWx0aXBsaWVzIHRoZSB2ZWN0b3IgW3gsIHks
IDFdIHdpdGggdGhlIDN4MiB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggbS4KICAgICovCiAgdE1hdHJp
eE11bHRpcGx5UG9pbnQgOiBmdW5jdGlvbihtLCB4LCB5KSB7CiAgICByZXR1cm4gWwogICAgICB4
Km1bMF0gKyB5Km1bMl0gKyBtWzRdLAogICAgICB4Km1bMV0gKyB5Km1bM10gKyBtWzVdCiAgICBd
CiAgfSwKCiAgLyoqCiAgICBJbnZlcnRzIGEgM3gyIGFmZmluZSAyRCBjb2x1bW4tbWFqb3IgdHJh
bnNmb3JtYXRpb24gbWF0cml4LgoKICAgIFJldHVybnMgYW4gaW52ZXJ0ZWQgY29weSBvZiB0aGUg
bWF0cml4LgogICAgKi8KICB0SW52ZXJ0TWF0cml4IDogZnVuY3Rpb24obSkgewogICAgdmFyIGQg
PSAxIC8gKG1bMF0qbVszXS1tWzFdKm1bMl0pCiAgICByZXR1cm4gWwogICAgICBtWzNdKmQsIC1t
WzFdKmQsCiAgICAgIC1tWzJdKmQsIG1bMF0qZCwKICAgICAgZCoobVsyXSptWzVdLW1bM10qbVs0
XSksIGQqKG1bMV0qbVs0XS1tWzBdKm1bNV0pCiAgICBdCiAgfSwKCiAgLyoqCiAgICBBcHBsaWVz
IGEgdHJhbnNmb3JtYXRpb24gbWF0cml4IG0gb24gdGhlIGNhbnZhcyBjb250ZXh0IGN0eC4KICAg
ICovCiAgdHJhbnNmb3JtIDogZnVuY3Rpb24oY3R4LCBtKSB7CiAgICBpZiAoY3R4LnRyYW5zZm9y
bSkKICAgICAgcmV0dXJuIGN0eC50cmFuc2Zvcm0uYXBwbHkoY3R4LCBtKQogICAgY3R4LnRyYW5z
bGF0ZShtWzRdLCBtWzVdKQogICAgLy8gc2NhbGUKICAgIGlmIChNYXRoLmFicyhtWzFdKSA8IDFl
LTYgJiYgTWF0aC5hYnMobVsyXSkgPCAxZS02KSB7CiAgICAgIGN0eC5zY2FsZShtWzBdLCBtWzNd
KQogICAgICByZXR1cm4KICAgIH0KICAgIHZhciByZXMgPSB0aGlzLnN2ZFRyYW5zZm9ybSh7eHg6
bVswXSwgeHk6bVsyXSwgeXg6bVsxXSwgeXk6bVszXSwgZHg6bVs0XSwgZHk6bVs1XX0pCiAgICBj
dHgucm90YXRlKHJlcy5hbmdsZTIpCiAgICBjdHguc2NhbGUocmVzLnN4LCByZXMuc3kpCiAgICBj
dHgucm90YXRlKHJlcy5hbmdsZTEpCiAgICByZXR1cm4KICB9LAoKICAvLyBicm9rZW4gc3ZkLi4u
CiAgYnJva2VuU3ZkIDogZnVuY3Rpb24obSkgewogICAgdmFyIG10ID0gW21bMF0sIG1bMl0sIG1b
MV0sIG1bM10sIDAsMF0KICAgIHZhciBtdG0gPSBbCiAgICAgIG10WzBdKm1bMF0rbXRbMl0qbVsx
XSwKICAgICAgbXRbMV0qbVswXSttdFszXSptWzFdLAogICAgICBtdFswXSptWzJdK210WzJdKm1b
M10sCiAgICAgIG10WzFdKm1bMl0rbXRbM10qbVszXSwKICAgICAgMCwwCiAgICBdCiAgICAvLyAo
bXRtWzBdLXgpICogKG10bVszXS14KSAtIChtdG1bMV0qbXRtWzJdKSA9IDAKICAgIC8vIHgqeCAt
IChtdG1bMF0rbXRtWzNdKSp4IC0gKG10bVsxXSptdG1bMl0pKyhtdG1bMF0qbXRtWzNdKSA9IDAK
ICAgIHZhciBhID0gMQogICAgdmFyIGIgPSAtKG10bVswXSttdG1bM10pCiAgICB2YXIgYyA9IC0o
bXRtWzFdKm10bVsyXSkrKG10bVswXSptdG1bM10pCiAgICB2YXIgZCA9IE1hdGguc3FydChiKmIg
LSA0KmEqYykKICAgIHZhciBjMSA9ICgtYiArIGQpIC8gKDIqYSkKICAgIHZhciBjMiA9ICgtYiAt
IGQpIC8gKDIqYSkKICAgIGlmIChjMSA8IGMyKQogICAgICB2YXIgdG1wID0gYzEsIGMxID0gYzIs
IGMyID0gdG1wCiAgICB2YXIgczEgPSBNYXRoLnNxcnQoYzEpCiAgICB2YXIgczIgPSBNYXRoLnNx
cnQoYzIpCiAgICB2YXIgaV9zID0gWzEvczEsIDAsIDAsIDEvczIsIDAsMF0KICAgIC8vIChtdG1b
MF0tYzEpKngxICsgbXRtWzJdKngyID0gMAogICAgLy8gbXRtWzFdKngxICsgKG10bVszXS1jMSkq
eDIgPSAwCiAgICAvLyB4MiA9IC0obXRtWzBdLWMxKSp4MSAvIG10bVsyXQogICAgdmFyIGUgPSAo
KG10bVswXS1jMSkvbXRtWzJdKQogICAgdmFyIGwgPSBNYXRoLnNxcnQoMSArIGUqZSkKICAgIHZh
ciB2MDAgPSAxIC8gbAogICAgdmFyIHYxMCA9IGUgLyBsCiAgICB2YXIgdjExID0gdjAwCiAgICB2
YXIgdjAxID0gLXYxMAogICAgdmFyIHYgPSBbdjAwLCB2MDEsIHYxMCwgdjExLCAwLDBdCiAgICB2
YXIgdSA9IG0uc2xpY2UoMCkKICAgIHRoaXMudE1hdHJpeE11bHRpcGx5KHUsdikKICAgIHRoaXMu
dE1hdHJpeE11bHRpcGx5KHUsaV9zKQogICAgcmV0dXJuIFt1LCBbczEsMCwwLHMyLDAsMF0sIFt2
MDAsIHYxMCwgdjAxLCB2MTEsIDAsIDBdXQogIH0sCgoKICBzdmRUcmFuc2Zvcm0gOiAoZnVuY3Rp
b24oKXsKICAgIC8vICAgQ29weXJpZ2h0IChjKSAyMDA0LTIwMDUsIFRoZSBEb2pvIEZvdW5kYXRp
b24KICAgIC8vICAgQWxsIFJpZ2h0cyBSZXNlcnZlZAogICAgdmFyIG0gPSB7fQogICAgbS5NYXRy
aXgyRCA9IGZ1bmN0aW9uKGFyZyl7CiAgICAgIC8vIHN1bW1hcnk6IGEgMkQgbWF0cml4IG9iamVj
dAogICAgICAvLyBkZXNjcmlwdGlvbjogTm9ybWFsaXplcyBhIDJEIG1hdHJpeC1saWtlIG9iamVj
dC4gSWYgYXJyYXlzIGlzIHBhc3NlZCwKICAgICAgLy8gICAgYWxsIG9iamVjdHMgb2YgdGhlIGFy
cmF5IGFyZSBub3JtYWxpemVkIGFuZCBtdWx0aXBsaWVkIHNlcXVlbnRpYWxseS4KICAgICAgLy8g
YXJnOiBPYmplY3QKICAgICAgLy8gICAgYSAyRCBtYXRyaXgtbGlrZSBvYmplY3QsIGEgbnVtYmVy
LCBvciBhbiBhcnJheSBvZiBzdWNoIG9iamVjdHMKICAgICAgaWYoYXJnKXsKICAgICAgICBpZih0
eXBlb2YgYXJnID09ICJudW1iZXIiKXsKICAgICAgICAgIHRoaXMueHggPSB0aGlzLnl5ID0gYXJn
OwogICAgICAgIH1lbHNlIGlmKGFyZyBpbnN0YW5jZW9mIEFycmF5KXsKICAgICAgICAgIGlmKGFy
Zy5sZW5ndGggPiAwKXsKICAgICAgICAgICAgdmFyIG1hdHJpeCA9IG0ubm9ybWFsaXplKGFyZ1sw
XSk7CiAgICAgICAgICAgIC8vIGNvbWJpbmUgbWF0cmljZXMKICAgICAgICAgICAgZm9yKHZhciBp
ID0gMTsgaSA8IGFyZy5sZW5ndGg7ICsraSl7CiAgICAgICAgICAgICAgdmFyIGwgPSBtYXRyaXgs
IHIgPSBtLm5vcm1hbGl6ZShhcmdbaV0pOwogICAgICAgICAgICAgIG1hdHJpeCA9IG5ldyBtLk1h
dHJpeDJEKCk7CiAgICAgICAgICAgICAgbWF0cml4Lnh4ID0gbC54eCAqIHIueHggKyBsLnh5ICog
ci55eDsKICAgICAgICAgICAgICBtYXRyaXgueHkgPSBsLnh4ICogci54eSArIGwueHkgKiByLnl5
OwogICAgICAgICAgICAgIG1hdHJpeC55eCA9IGwueXggKiByLnh4ICsgbC55eSAqIHIueXg7CiAg
ICAgICAgICAgICAgbWF0cml4Lnl5ID0gbC55eCAqIHIueHkgKyBsLnl5ICogci55eTsKICAgICAg
ICAgICAgICBtYXRyaXguZHggPSBsLnh4ICogci5keCArIGwueHkgKiByLmR5ICsgbC5keDsKICAg
ICAgICAgICAgICBtYXRyaXguZHkgPSBsLnl4ICogci5keCArIGwueXkgKiByLmR5ICsgbC5keTsK
ICAgICAgICAgICAgfQogICAgICAgICAgICBPYmplY3QuZXh0ZW5kKHRoaXMsIG1hdHJpeCk7CiAg
ICAgICAgICB9CiAgICAgICAgfWVsc2V7CiAgICAgICAgICBPYmplY3QuZXh0ZW5kKHRoaXMsIGFy
Zyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvLyBlbnN1cmUgbWF0cml4IDJEIGNvbmZv
cm1hbmNlCiAgICBtLm5vcm1hbGl6ZSA9IGZ1bmN0aW9uKG1hdHJpeCl7CiAgICAgICAgLy8gc3Vt
bWFyeTogY29udmVydHMgYW4gb2JqZWN0IHRvIGEgbWF0cml4LCBpZiBuZWNlc3NhcnkKICAgICAg
ICAvLyBkZXNjcmlwdGlvbjogQ29udmVydHMgYW55IDJEIG1hdHJpeC1saWtlIG9iamVjdCBvciBh
biBhcnJheSBvZgogICAgICAgIC8vICAgIHN1Y2ggb2JqZWN0cyB0byBhIHZhbGlkIGRvam94Lmdm
eC5tYXRyaXguTWF0cml4MkQgb2JqZWN0LgogICAgICAgIC8vIG1hdHJpeDogT2JqZWN0OiBhbiBv
YmplY3QsIHdoaWNoIGlzIGNvbnZlcnRlZCB0byBhIG1hdHJpeCwgaWYgbmVjZXNzYXJ5CiAgICAg
ICAgcmV0dXJuIChtYXRyaXggaW5zdGFuY2VvZiBtLk1hdHJpeDJEKSA/IG1hdHJpeCA6IG5ldyBt
Lk1hdHJpeDJEKG1hdHJpeCk7IC8vIGRvam94LmdmeC5tYXRyaXguTWF0cml4MkQKICAgIH0KICAg
IG0ubXVsdGlwbHkgPSBmdW5jdGlvbihtYXRyaXgpewogICAgICAvLyBzdW1tYXJ5OiBjb21iaW5l
cyBtYXRyaWNlcyBieSBtdWx0aXBseWluZyB0aGVtIHNlcXVlbnRpYWxseSBpbiB0aGUgZ2l2ZW4g
b3JkZXIKICAgICAgLy8gbWF0cml4OiBkb2pveC5nZngubWF0cml4Lk1hdHJpeDJELi4uOiBhIDJE
IG1hdHJpeC1saWtlIG9iamVjdCwKICAgICAgLy8gICAgYWxsIHN1YnNlcXVlbnQgYXJndW1lbnRz
IGFyZSBtYXRyaXgtbGlrZSBvYmplY3RzIHRvbwogICAgICB2YXIgTSA9IG0ubm9ybWFsaXplKG1h
dHJpeCk7CiAgICAgIC8vIGNvbWJpbmUgbWF0cmljZXMKICAgICAgZm9yKHZhciBpID0gMTsgaSA8
IGFyZ3VtZW50cy5sZW5ndGg7ICsraSl7CiAgICAgICAgdmFyIGwgPSBNLCByID0gbS5ub3JtYWxp
emUoYXJndW1lbnRzW2ldKTsKICAgICAgICBNID0gbmV3IG0uTWF0cml4MkQoKTsKICAgICAgICBN
Lnh4ID0gbC54eCAqIHIueHggKyBsLnh5ICogci55eDsKICAgICAgICBNLnh5ID0gbC54eCAqIHIu
eHkgKyBsLnh5ICogci55eTsKICAgICAgICBNLnl4ID0gbC55eCAqIHIueHggKyBsLnl5ICogci55
eDsKICAgICAgICBNLnl5ID0gbC55eCAqIHIueHkgKyBsLnl5ICogci55eTsKICAgICAgICBNLmR4
ID0gbC54eCAqIHIuZHggKyBsLnh5ICogci5keSArIGwuZHg7CiAgICAgICAgTS5keSA9IGwueXgg
KiByLmR4ICsgbC55eSAqIHIuZHkgKyBsLmR5OwogICAgICB9CiAgICAgIHJldHVybiBNOyAvLyBk
b2pveC5nZngubWF0cml4Lk1hdHJpeDJECiAgICB9CiAgICBtLmludmVydCA9IGZ1bmN0aW9uKG1h
dHJpeCkgewogICAgICB2YXIgTSA9IG0ubm9ybWFsaXplKG1hdHJpeCksCiAgICAgICAgRCA9IE0u
eHggKiBNLnl5IC0gTS54eSAqIE0ueXgsCiAgICAgICAgTSA9IG5ldyBtLk1hdHJpeDJEKHsKICAg
ICAgICAgIHh4OiBNLnl5L0QsIHh5OiAtTS54eS9ELAogICAgICAgICAgeXg6IC1NLnl4L0QsIHl5
OiBNLnh4L0QsCiAgICAgICAgICBkeDogKE0ueHkgKiBNLmR5IC0gTS55eSAqIE0uZHgpIC8gRCwK
ICAgICAgICAgIGR5OiAoTS55eCAqIE0uZHggLSBNLnh4ICogTS5keSkgLyBECiAgICAgICAgfSk7
CiAgICAgIHJldHVybiBNOyAvLyBkb2pveC5nZngubWF0cml4Lk1hdHJpeDJECiAgICB9CiAgICAv
LyB0aGUgZGVmYXVsdCAoaWRlbnRpdHkpIG1hdHJpeCwgd2hpY2ggaXMgdXNlZCB0byBmaWxsIGlu
IG1pc3NpbmcgdmFsdWVzCiAgICBPYmplY3QuZXh0ZW5kKG0uTWF0cml4MkQsIHt4eDogMSwgeHk6
IDAsIHl4OiAwLCB5eTogMSwgZHg6IDAsIGR5OiAwfSk7CgogICAgdmFyIGVxID0gZnVuY3Rpb24o
LyogTnVtYmVyICovIGEsIC8qIE51bWJlciAqLyBiKXsKICAgICAgLy8gc3VtbWFyeTogY29tcGFy
ZSB0d28gRlAgbnVtYmVycyBmb3IgZXF1YWxpdHkKICAgICAgcmV0dXJuIE1hdGguYWJzKGEgLSBi
KSA8PSAxZS02ICogKE1hdGguYWJzKGEpICsgTWF0aC5hYnMoYikpOyAvLyBCb29sZWFuCiAgICB9
OwoKICAgIHZhciBjYWxjRnJvbVZhbHVlcyA9IGZ1bmN0aW9uKC8qIE51bWJlciAqLyBzMSwgLyog
TnVtYmVyICovIHMyKXsKICAgICAgLy8gc3VtbWFyeTogdXNlcyB0d28gY2xvc2UgRlAgdmFsdWVz
IHRvIGFwcHJveGltYXRlIHRoZSByZXN1bHQKICAgICAgaWYoIWlzRmluaXRlKHMxKSl7CiAgICAg
ICAgcmV0dXJuIHMyOyAgLy8gTnVtYmVyCiAgICAgIH1lbHNlIGlmKCFpc0Zpbml0ZShzMikpewog
ICAgICAgIHJldHVybiBzMTsgIC8vIE51bWJlcgogICAgICB9CiAgICAgIHJldHVybiAoczEgKyBz
MikgLyAyOyAvLyBOdW1iZXIKICAgIH07CgogICAgdmFyIHRyYW5zcG9zZSA9IGZ1bmN0aW9uKC8q
IGRvam94LmdmeC5tYXRyaXguTWF0cml4MkQgKi8gbWF0cml4KXsKICAgICAgLy8gbWF0cml4OiBk
b2pveC5nZngubWF0cml4Lk1hdHJpeDJEOiBhIDJEIG1hdHJpeC1saWtlIG9iamVjdAogICAgICB2
YXIgTSA9IG5ldyBtLk1hdHJpeDJEKG1hdHJpeCk7CiAgICAgIHJldHVybiBPYmplY3QuZXh0ZW5k
KE0sIHtkeDogMCwgZHk6IDAsIHh5OiBNLnl4LCB5eDogTS54eX0pOyAvLyBkb2pveC5nZngubWF0
cml4Lk1hdHJpeDJECiAgICB9OwoKICAgIHZhciBzY2FsZVNpZ24gPSBmdW5jdGlvbigvKiBkb2pv
eC5nZngubWF0cml4Lk1hdHJpeDJEICovIG1hdHJpeCl7CiAgICAgIHJldHVybiAobWF0cml4Lnh4
ICogbWF0cml4Lnl5IDwgMCB8fCBtYXRyaXgueHkgKiBtYXRyaXgueXggPiAwKSA/IC0xIDogMTsg
Ly8gTnVtYmVyCiAgICB9OwoKICAgIHZhciBlaWdlbnZhbHVlRGVjb21wb3NpdGlvbiA9IGZ1bmN0
aW9uKC8qIGRvam94LmdmeC5tYXRyaXguTWF0cml4MkQgKi8gbWF0cml4KXsKICAgICAgLy8gbWF0
cml4OiBkb2pveC5nZngubWF0cml4Lk1hdHJpeDJEOiBhIDJEIG1hdHJpeC1saWtlIG9iamVjdAog
ICAgICB2YXIgTSA9IG0ubm9ybWFsaXplKG1hdHJpeCksCiAgICAgICAgYiA9IC1NLnh4IC0gTS55
eSwKICAgICAgICBjID0gTS54eCAqIE0ueXkgLSBNLnh5ICogTS55eCwKICAgICAgICBkID0gTWF0
aC5zcXJ0KGIgKiBiIC0gNCAqIGMpLAogICAgICAgIGwxID0gLShiICsgKGIgPCAwID8gLWQgOiBk
KSkgLyAyLAogICAgICAgIGwyID0gYyAvIGwxLAogICAgICAgIHZ4MSA9IE0ueHkgLyAobDEgLSBN
Lnh4KSwgdnkxID0gMSwKICAgICAgICB2eDIgPSBNLnh5IC8gKGwyIC0gTS54eCksIHZ5MiA9IDE7
CiAgICAgIGlmKGVxKGwxLCBsMikpewogICAgICAgIHZ4MSA9IDEsIHZ5MSA9IDAsIHZ4MiA9IDAs
IHZ5MiA9IDE7CiAgICAgIH0KICAgICAgaWYoIWlzRmluaXRlKHZ4MSkpewogICAgICAgIHZ4MSA9
IDEsIHZ5MSA9IChsMSAtIE0ueHgpIC8gTS54eTsKICAgICAgICBpZighaXNGaW5pdGUodnkxKSl7
CiAgICAgICAgICB2eDEgPSAobDEgLSBNLnl5KSAvIE0ueXgsIHZ5MSA9IDE7CiAgICAgICAgICBp
ZighaXNGaW5pdGUodngxKSl7CiAgICAgICAgICAgIHZ4MSA9IDEsIHZ5MSA9IE0ueXggLyAobDEg
LSBNLnl5KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYoIWlzRmluaXRl
KHZ4MikpewogICAgICAgIHZ4MiA9IDEsIHZ5MiA9IChsMiAtIE0ueHgpIC8gTS54eTsKICAgICAg
ICBpZighaXNGaW5pdGUodnkyKSl7CiAgICAgICAgICB2eDIgPSAobDIgLSBNLnl5KSAvIE0ueXgs
IHZ5MiA9IDE7CiAgICAgICAgICBpZighaXNGaW5pdGUodngyKSl7CiAgICAgICAgICAgIHZ4MiA9
IDEsIHZ5MiA9IE0ueXggLyAobDIgLSBNLnl5KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAg
IH0KICAgICAgdmFyIGQxID0gTWF0aC5zcXJ0KHZ4MSAqIHZ4MSArIHZ5MSAqIHZ5MSksCiAgICAg
ICAgZDIgPSBNYXRoLnNxcnQodngyICogdngyICsgdnkyICogdnkyKTsKICAgICAgaWYoaXNOYU4o
dngxIC89IGQxKSl7IHZ4MSA9IDA7IH0KICAgICAgaWYoaXNOYU4odnkxIC89IGQxKSl7IHZ5MSA9
IDA7IH0KICAgICAgaWYoaXNOYU4odngyIC89IGQyKSl7IHZ4MiA9IDA7IH0KICAgICAgaWYoaXNO
YU4odnkyIC89IGQyKSl7IHZ5MiA9IDA7IH0KICAgICAgcmV0dXJuIHsgIC8vIE9iamVjdAogICAg
ICAgIHZhbHVlMTogbDEsCiAgICAgICAgdmFsdWUyOiBsMiwKICAgICAgICB2ZWN0b3IxOiB7eDog
dngxLCB5OiB2eTF9LAogICAgICAgIHZlY3RvcjI6IHt4OiB2eDIsIHk6IHZ5Mn0KICAgICAgfTsK
ICAgIH07CgogICAgdmFyIGRlY29tcG9zZVNSID0gZnVuY3Rpb24oLyogZG9qb3guZ2Z4Lm1hdHJp
eC5NYXRyaXgyRCAqLyBNLCAvKiBPYmplY3QgKi8gcmVzdWx0KXsKICAgICAgLy8gc3VtbWFyeTog
ZGVjb21wb3NlcyBhIG1hdHJpeCBpbnRvIFtzY2FsZSwgcm90YXRlXTsgbm8gY2hlY2tzIGFyZSBk
b25lLgogICAgICB2YXIgc2lnbiA9IHNjYWxlU2lnbihNKSwKICAgICAgICBhID0gcmVzdWx0LmFu
Z2xlMSA9IChNYXRoLmF0YW4yKE0ueXgsIE0ueXkpICsgTWF0aC5hdGFuMigtc2lnbiAqIE0ueHks
IHNpZ24gKiBNLnh4KSkgLyAyLAogICAgICAgIGNvcyA9IE1hdGguY29zKGEpLCBzaW4gPSBNYXRo
LnNpbihhKTsKICAgICAgcmVzdWx0LnN4ID0gY2FsY0Zyb21WYWx1ZXMoTS54eCAvIGNvcywgLU0u
eHkgLyBzaW4pOwogICAgICByZXN1bHQuc3kgPSBjYWxjRnJvbVZhbHVlcyhNLnl5IC8gY29zLCBN
Lnl4IC8gc2luKTsKICAgICAgcmV0dXJuIHJlc3VsdDsgIC8vIE9iamVjdAogICAgfTsKCiAgICB2
YXIgZGVjb21wb3NlUlMgPSBmdW5jdGlvbigvKiBkb2pveC5nZngubWF0cml4Lk1hdHJpeDJEICov
IE0sIC8qIE9iamVjdCAqLyByZXN1bHQpewogICAgICAvLyBzdW1tYXJ5OiBkZWNvbXBvc2VzIGEg
bWF0cml4IGludG8gW3JvdGF0ZSwgc2NhbGVdOyBubyBjaGVja3MgYXJlIGRvbmUKICAgICAgdmFy
IHNpZ24gPSBzY2FsZVNpZ24oTSksCiAgICAgICAgYSA9IHJlc3VsdC5hbmdsZTIgPSAoTWF0aC5h
dGFuMihzaWduICogTS55eCwgc2lnbiAqIE0ueHgpICsgTWF0aC5hdGFuMigtTS54eSwgTS55eSkp
IC8gMiwKICAgICAgICBjb3MgPSBNYXRoLmNvcyhhKSwgc2luID0gTWF0aC5zaW4oYSk7CiAgICAg
IHJlc3VsdC5zeCA9IGNhbGNGcm9tVmFsdWVzKE0ueHggLyBjb3MsIE0ueXggLyBzaW4pOwogICAg
ICByZXN1bHQuc3kgPSBjYWxjRnJvbVZhbHVlcyhNLnl5IC8gY29zLCAtTS54eSAvIHNpbik7CiAg
ICAgIHJldHVybiByZXN1bHQ7ICAvLyBPYmplY3QKICAgIH07CgogICAgcmV0dXJuIGZ1bmN0aW9u
KG1hdHJpeCl7CiAgICAgIC8vIHN1bW1hcnk6IGRlY29tcG9zZSBhIDJEIG1hdHJpeCBpbnRvIHRy
YW5zbGF0aW9uLCBzY2FsaW5nLCBhbmQgcm90YXRpb24gY29tcG9uZW50cwogICAgICAvLyBkZXNj
cmlwdGlvbjogdGhpcyBmdW5jdGlvbiBkZWNvbXBvc2UgYSBtYXRyaXggaW50byBmb3VyIGxvZ2lj
YWwgY29tcG9uZW50czoKICAgICAgLy8gIHRyYW5zbGF0aW9uLCByb3RhdGlvbiwgc2NhbGluZywg
YW5kIG9uZSBtb3JlIHJvdGF0aW9uIHVzaW5nIFNWRC4KICAgICAgLy8gIFRoZSBjb21wb25lbnRz
IHNob3VsZCBiZSBhcHBsaWVkIGluIGZvbGxvd2luZyBvcmRlcjoKICAgICAgLy8gIHwgW3RyYW5z
bGF0ZSwgcm90YXRlKGFuZ2xlMiksIHNjYWxlLCByb3RhdGUoYW5nbGUxKV0KICAgICAgLy8gbWF0
cml4OiBkb2pveC5nZngubWF0cml4Lk1hdHJpeDJEOiBhIDJEIG1hdHJpeC1saWtlIG9iamVjdAog
ICAgICB2YXIgTSA9IG0ubm9ybWFsaXplKG1hdHJpeCksCiAgICAgICAgcmVzdWx0ID0ge2R4OiBN
LmR4LCBkeTogTS5keSwgc3g6IDEsIHN5OiAxLCBhbmdsZTE6IDAsIGFuZ2xlMjogMH07CiAgICAg
IC8vIGRldGVjdCBjYXNlOiBbc2NhbGVdCiAgICAgIGlmKGVxKE0ueHksIDApICYmIGVxKE0ueXgs
IDApKXsKICAgICAgICByZXR1cm4gT2JqZWN0LmV4dGVuZChyZXN1bHQsIHtzeDogTS54eCwgc3k6
IE0ueXl9KTsgIC8vIE9iamVjdAogICAgICB9CiAgICAgIC8vIGRldGVjdCBjYXNlOiBbc2NhbGUs
IHJvdGF0ZV0KICAgICAgaWYoZXEoTS54eCAqIE0ueXgsIC1NLnh5ICogTS55eSkpewogICAgICAg
IHJldHVybiBkZWNvbXBvc2VTUihNLCByZXN1bHQpOyAgLy8gT2JqZWN0CiAgICAgIH0KICAgICAg
Ly8gZGV0ZWN0IGNhc2U6IFtyb3RhdGUsIHNjYWxlXQogICAgICBpZihlcShNLnh4ICogTS54eSwg
LU0ueXggKiBNLnl5KSl7CiAgICAgICAgcmV0dXJuIGRlY29tcG9zZVJTKE0sIHJlc3VsdCk7ICAv
LyBPYmplY3QKICAgICAgfQogICAgICAvLyBkbyBTVkQKICAgICAgdmFyIE1UID0gdHJhbnNwb3Nl
KE0pLAogICAgICAgIHUgID0gZWlnZW52YWx1ZURlY29tcG9zaXRpb24oW00sIE1UXSksCiAgICAg
ICAgdiAgPSBlaWdlbnZhbHVlRGVjb21wb3NpdGlvbihbTVQsIE1dKSwKICAgICAgICBVICA9IG5l
dyBtLk1hdHJpeDJEKHt4eDogdS52ZWN0b3IxLngsIHh5OiB1LnZlY3RvcjIueCwgeXg6IHUudmVj
dG9yMS55LCB5eTogdS52ZWN0b3IyLnl9KSwKICAgICAgICBWVCA9IG5ldyBtLk1hdHJpeDJEKHt4
eDogdi52ZWN0b3IxLngsIHh5OiB2LnZlY3RvcjEueSwgeXg6IHYudmVjdG9yMi54LCB5eTogdi52
ZWN0b3IyLnl9KSwKICAgICAgICBTID0gbmV3IG0uTWF0cml4MkQoW20uaW52ZXJ0KFUpLCBNLCBt
LmludmVydChWVCldKTsKICAgICAgZGVjb21wb3NlU1IoVlQsIHJlc3VsdCk7CiAgICAgIFMueHgg
Kj0gcmVzdWx0LnN4OwogICAgICBTLnl5ICo9IHJlc3VsdC5zeTsKICAgICAgZGVjb21wb3NlUlMo
VSwgcmVzdWx0KTsKICAgICAgUy54eCAqPSByZXN1bHQuc3g7CiAgICAgIFMueXkgKj0gcmVzdWx0
LnN5OwogICAgICByZXR1cm4gT2JqZWN0LmV4dGVuZChyZXN1bHQsIHtzeDogUy54eCwgc3k6IFMu
eXl9KTsgIC8vIE9iamVjdAogICAgfTsKICB9KSgpLAoKCiAgLyoqCiAgICBTZXRzIHRoZSBjYW52
YXMgY29udGV4dCBjdHgncyB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggdG8gbSwgd2l0aCBjdG0gYmVp
bmcKICAgIHRoZSBjdXJyZW50IHRyYW5zZm9ybWF0aW9uIG1hdHJpeC4KICAgICovCiAgc2V0VHJh
bnNmb3JtIDogZnVuY3Rpb24oY3R4LCBtLCBjdG0pIHsKICAgIGlmIChjdHguc2V0VHJhbnNmb3Jt
KQogICAgICByZXR1cm4gY3R4LnNldFRyYW5zZm9ybS5hcHBseShjdHgsIG0pCiAgICB0aGlzLnRy
YW5zZm9ybShjdHgsIHRoaXMudEludmVydE1hdHJpeChjdG0pKQogICAgdGhpcy50cmFuc2Zvcm0o
Y3R4LCBtKQogIH0sCgogIC8qKgogICAgU2tld3MgdGhlIGNhbnZhcyBjb250ZXh0IGJ5IGFuZ2xl
IG9uIHRoZSB4LWF4aXMuCiAgICAqLwogIHNrZXdYIDogZnVuY3Rpb24oY3R4LCBhbmdsZSkgewog
ICAgcmV0dXJuIHRoaXMudHJhbnNmb3JtKGN0eCwgdGhpcy50U2tld1hNYXRyaXgoYW5nbGUpKQog
IH0sCgogIC8qKgogICAgU2tld3MgdGhlIGNhbnZhcyBjb250ZXh0IGJ5IGFuZ2xlIG9uIHRoZSB5
LWF4aXMuCiAgICAqLwogIHNrZXdZIDogZnVuY3Rpb24oY3R4LCBhbmdsZSkgewogICAgcmV0dXJu
IHRoaXMudHJhbnNmb3JtKGN0eCwgdGhpcy50U2tld1lNYXRyaXgoYW5nbGUpKQogIH0sCgogIC8q
KgogICAgUm90YXRlcyBhIHRyYW5zZm9ybWF0aW9uIG1hdHJpeCBieSBhbmdsZS4KICAgICovCiAg
dFJvdGF0ZSA6IGZ1bmN0aW9uKG0xLCBhbmdsZSkgewogICAgLy8gcmV0dXJuIHRoaXMudE1hdHJp
eE11bHRpcGx5KG1hdHJpeCwgdGhpcy50Um90YXRpb25NYXRyaXgoYW5nbGUpKQogICAgdmFyIGMg
PSBNYXRoLmNvcyhhbmdsZSkKICAgIHZhciBzID0gTWF0aC5zaW4oYW5nbGUpCiAgICB2YXIgbTEx
ID0gbTFbMF0qYyArIG0xWzJdKnMKICAgIHZhciBtMTIgPSBtMVsxXSpjICsgbTFbM10qcwogICAg
dmFyIG0yMSA9IG0xWzBdKi1zICsgbTFbMl0qYwogICAgdmFyIG0yMiA9IG0xWzFdKi1zICsgbTFb
M10qYwogICAgbTFbMF0gPSBtMTEKICAgIG0xWzFdID0gbTEyCiAgICBtMVsyXSA9IG0yMQogICAg
bTFbM10gPSBtMjIKICAgIHJldHVybiBtMQogIH0sCgogIC8qKgogICAgVHJhbnNsYXRlcyBhIHRy
YW5zZm9ybWF0aW9uIG1hdHJpeCBieSB4IGFuZCB5LgogICAgKi8KICB0VHJhbnNsYXRlIDogZnVu
Y3Rpb24obTEsIHgsIHkpIHsKICAgIC8vIHJldHVybiB0aGlzLnRNYXRyaXhNdWx0aXBseShtYXRy
aXgsIHRoaXMudFRyYW5zbGF0aW9uTWF0cml4KHgseSkpCiAgICBtMVs0XSArPSBtMVswXSp4ICsg
bTFbMl0qeQogICAgbTFbNV0gKz0gbTFbMV0qeCArIG0xWzNdKnkKICAgIHJldHVybiBtMQogIH0s
CgogIC8qKgogICAgU2NhbGVzIGEgdHJhbnNmb3JtYXRpb24gbWF0cml4IGJ5IHN4IGFuZCBzeS4K
ICAgICovCiAgdFNjYWxlIDogZnVuY3Rpb24obTEsIHN4LCBzeSkgewogICAgLy8gcmV0dXJuIHRo
aXMudE1hdHJpeE11bHRpcGx5KG1hdHJpeCwgdGhpcy50U2NhbGluZ01hdHJpeChzeCxzeSkpCiAg
ICBtMVswXSAqPSBzeAogICAgbTFbMV0gKj0gc3gKICAgIG0xWzJdICo9IHN5CiAgICBtMVszXSAq
PSBzeQogICAgcmV0dXJuIG0xCiAgfSwKCiAgLyoqCiAgICBTa2V3cyBhIHRyYW5zZm9ybWF0aW9u
IG1hdHJpeCBieSBhbmdsZSBvbiB0aGUgeC1heGlzLgogICAgKi8KICB0U2tld1ggOiBmdW5jdGlv
bihtMSwgYW5nbGUpIHsKICAgIHJldHVybiB0aGlzLnRNYXRyaXhNdWx0aXBseShtMSwgdGhpcy50
U2tld1hNYXRyaXgoYW5nbGUpKQogIH0sCgogIC8qKgogICAgU2tld3MgYSB0cmFuc2Zvcm1hdGlv
biBtYXRyaXggYnkgYW5nbGUgb24gdGhlIHktYXhpcy4KICAgICovCiAgdFNrZXdZIDogZnVuY3Rp
b24obTEsIGFuZ2xlKSB7CiAgICByZXR1cm4gdGhpcy50TWF0cml4TXVsdGlwbHkobTEsIHRoaXMu
dFNrZXdZTWF0cml4KGFuZ2xlKSkKICB9LAoKICAvKioKICAgIFJldHVybnMgYSAzeDIgMkQgY29s
dW1uLW1ham9yIHktc2tldyBtYXRyaXggZm9yIHRoZSBhbmdsZS4KICAgICovCiAgdFNrZXdYTWF0
cml4IDogZnVuY3Rpb24oYW5nbGUpIHsKICAgIHJldHVybiBbIDEsIDAsIE1hdGgudGFuKGFuZ2xl
KSwgMSwgMCwgMCBdCiAgfSwKCiAgLyoqCiAgICBSZXR1cm5zIGEgM3gyIDJEIGNvbHVtbi1tYWpv
ciB5LXNrZXcgbWF0cml4IGZvciB0aGUgYW5nbGUuCiAgICAqLwogIHRTa2V3WU1hdHJpeCA6IGZ1
bmN0aW9uKGFuZ2xlKSB7CiAgICByZXR1cm4gWyAxLCBNYXRoLnRhbihhbmdsZSksIDAsIDEsIDAs
IDAgXQogIH0sCgogIC8qKgogICAgUmV0dXJucyBhIDN4MiAyRCBjb2x1bW4tbWFqb3Igcm90YXRp
b24gbWF0cml4IGZvciB0aGUgYW5nbGUuCiAgICAqLwogIHRSb3RhdGlvbk1hdHJpeCA6IGZ1bmN0
aW9uKGFuZ2xlKSB7CiAgICB2YXIgYyA9IE1hdGguY29zKGFuZ2xlKQogICAgdmFyIHMgPSBNYXRo
LnNpbihhbmdsZSkKICAgIHJldHVybiBbIGMsIHMsIC1zLCBjLCAwLCAwIF0KICB9LAoKICAvKioK
ICAgIFJldHVybnMgYSAzeDIgMkQgY29sdW1uLW1ham9yIHRyYW5zbGF0aW9uIG1hdHJpeCBmb3Ig
eCBhbmQgeS4KICAgICovCiAgdFRyYW5zbGF0aW9uTWF0cml4IDogZnVuY3Rpb24oeCwgeSkgewog
ICAgcmV0dXJuIFsgMSwgMCwgMCwgMSwgeCwgeSBdCiAgfSwKCiAgLyoqCiAgICBSZXR1cm5zIGEg
M3gyIDJEIGNvbHVtbi1tYWpvciBzY2FsaW5nIG1hdHJpeCBmb3Igc3ggYW5kIHN5LgogICAgKi8K
ICB0U2NhbGluZ01hdHJpeCA6IGZ1bmN0aW9uKHN4LCBzeSkgewogICAgcmV0dXJuIFsgc3gsIDAs
IDAsIHN5LCAwLCAwIF0KICB9LAoKICAvKioKICAgIFJldHVybnMgdGhlIG5hbWUgb2YgdGhlIHRl
eHQgYmFja2VuZCB0byB1c2UuCgogICAgUG9zc2libGUgdmFsdWVzIGFyZToKICAgICAgKiAnTW96
VGV4dCcgZm9yIEZpcmVmb3gKICAgICAgKiAnRHJhd1N0cmluZycgZm9yIFJoaW5vCiAgICAgICog
J05PTkUnIG5vIHRleHQgZHJhd2luZwoKICAgIEByZXR1cm4gVGhlIHRleHQgYmFja2VuZCBuYW1l
CiAgICBAdHlwZSBTdHJpbmcKICAgICovCiAgZ2V0VGV4dEJhY2tlbmQgOiBmdW5jdGlvbigpIHsK
ICAgIGlmICh0aGlzLnRleHRCYWNrZW5kID09IG51bGwpCiAgICAgIHRoaXMudGV4dEJhY2tlbmQg
PSB0aGlzLmRldGVjdFRleHRCYWNrZW5kKCkKICAgIHJldHVybiB0aGlzLnRleHRCYWNrZW5kCiAg
fSwKCiAgLyoqCiAgICBEZXRlY3RzIHRoZSBuYW1lIG9mIHRoZSB0ZXh0IGJhY2tlbmQgdG8gdXNl
LgoKICAgIFBvc3NpYmxlIHZhbHVlcyBhcmU6CiAgICAgICogJ01velRleHQnIGZvciBGaXJlZm94
CiAgICAgICogJ0RyYXdTdHJpbmcnIGZvciBSaGlubwogICAgICAqICdOT05FJyBubyB0ZXh0IGRy
YXdpbmcKCiAgICBAcmV0dXJuIFRoZSB0ZXh0IGJhY2tlbmQgbmFtZQogICAgQHR5cGUgU3RyaW5n
CiAgICAqLwogIGRldGVjdFRleHRCYWNrZW5kIDogZnVuY3Rpb24oKSB7CiAgICB2YXIgY3R4ID0g
dGhpcy5nZXRUZXN0Q29udGV4dCgpCiAgICBpZiAoY3R4LmZpbGxUZXh0KSB7CiAgICAgIHJldHVy
biAnSFRNTDUnCiAgICB9IGVsc2UgaWYgKGN0eC5tb3pEcmF3VGV4dCkgewogICAgICByZXR1cm4g
J01velRleHQnCiAgICB9IGVsc2UgaWYgKGN0eC5kcmF3U3RyaW5nKSB7CiAgICAgIHJldHVybiAn
RHJhd1N0cmluZycKICAgIH0KICAgIHJldHVybiAnTk9ORScKICB9LAoKICBnZXRTdXBwb3J0c1B1
dEltYWdlRGF0YSA6IGZ1bmN0aW9uKCkgewogICAgaWYgKHRoaXMuc3VwcG9ydHNQdXRJbWFnZURh
dGEgPT0gbnVsbCkgewogICAgICB2YXIgY3R4ID0gdGhpcy5nZXRUZXN0Q29udGV4dCgpCiAgICAg
IHZhciBzdXBwb3J0ID0gY3R4LnB1dEltYWdlRGF0YQogICAgICBpZiAoc3VwcG9ydCkgewogICAg
ICAgIHRyeSB7CiAgICAgICAgICB2YXIgaWRhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsMCwxLDEp
CiAgICAgICAgICBpZGF0YVswXSA9IDI1NQogICAgICAgICAgaWRhdGFbMV0gPSAwCiAgICAgICAg
ICBpZGF0YVsyXSA9IDI1NQogICAgICAgICAgaWRhdGFbM10gPSAyNTUKICAgICAgICAgIGN0eC5w
dXRJbWFnZURhdGEoe3dpZHRoOiAxLCBoZWlnaHQ6IDEsIGRhdGE6IGlkYXRhfSwgMCwgMCkKICAg
ICAgICAgIHZhciBpZGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoMCwwLDEsMSkKICAgICAgICAgIHN1
cHBvcnQgPSBbMjU1LCAwLCAyNTUsIDI1NV0uZXF1YWxzKGlkYXRhLmRhdGEpCiAgICAgICAgfSBj
YXRjaChlKSB7CiAgICAgICAgICBzdXBwb3J0ID0gZmFsc2UKICAgICAgICB9CiAgICAgIH0KICAg
ICAgdGhpcy5zdXBwb3J0c1B1dEltYWdlRGF0YSA9IHN1cHBvcnQKICAgIH0KICAgIHJldHVybiBz
dXBwb3J0CiAgfSwKCiAgLyoqCiAgICBSZXR1cm5zIHRydWUgaWYgdGhlIGJyb3dzZXIgY2FuIGJl
IGNvYXhlZCB0byB3b3JrIHdpdGgKICAgIHtAbGluayBDYW52YXNTdXBwb3J0LmlzUG9pbnRJblBh
dGh9LgoKICAgIEByZXR1cm4gV2hldGhlciB0aGUgYnJvd3NlciBzdXBwb3J0cyBpc1BvaW50SW5Q
YXRoIG9yIG5vdAogICAgQHR5cGUgYm9vbGVhbgogICAgKi8KICBnZXRTdXBwb3J0c0lzUG9pbnRJ
blBhdGggOiBmdW5jdGlvbigpIHsKICAgIGlmICh0aGlzLnN1cHBvcnRzSXNQb2ludEluUGF0aCA9
PSBudWxsKQogICAgICB0aGlzLnN1cHBvcnRzSXNQb2ludEluUGF0aCA9ICEhdGhpcy5nZXRUZXN0
Q29udGV4dCgpLmlzUG9pbnRJblBhdGgKICAgIHJldHVybiB0aGlzLnN1cHBvcnRzSXNQb2ludElu
UGF0aAogIH0sCgogIC8qKgogICAgUmV0dXJucyB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gaW4gd2hp
Y2ggdGhlIGlzUG9pbnRJblBhdGggb2YgdGhlCiAgICBicm93c2VyIG9wZXJhdGVzLiBQb3NzaWJs
ZSBjb29yZGluYXRlIHN5c3RlbXMgYXJlCiAgICBDYW52YXNTdXBwb3J0LkRFVklDRV9TUEFDRSBh
bmQgQ2FudmFzU3VwcG9ydC5VU0VSX1NQQUNFLgoKICAgIEByZXR1cm4gVGhlIGNvb3JkaW5hdGUg
c3lzdGVtIGZvciB0aGUgYnJvd3NlcidzIGlzUG9pbnRJblBhdGgKICAgICovCiAgZ2V0SXNQb2lu
dEluUGF0aE1vZGUgOiBmdW5jdGlvbigpIHsKICAgIGlmICh0aGlzLmlzUG9pbnRJblBhdGhNb2Rl
ID09IG51bGwpCiAgICAgIHRoaXMuaXNQb2ludEluUGF0aE1vZGUgPSB0aGlzLmRldGVjdElzUG9p
bnRJblBhdGhNb2RlKCkKICAgIHJldHVybiB0aGlzLmlzUG9pbnRJblBhdGhNb2RlCiAgfSwKCiAg
LyoqCiAgICBEZXRlY3RzIHRoZSBjb29yZGluYXRlIHN5c3RlbSBpbiB3aGljaCB0aGUgaXNQb2lu
dEluUGF0aCBvZiB0aGUKICAgIGJyb3dzZXIgb3BlcmF0ZXMuIFBvc3NpYmxlIGNvb3JkaW5hdGUg
c3lzdGVtcyBhcmUKICAgIENhbnZhc1N1cHBvcnQuREVWSUNFX1NQQUNFIGFuZCBDYW52YXNTdXBw
b3J0LlVTRVJfU1BBQ0UuCgogICAgQHJldHVybiBUaGUgY29vcmRpbmF0ZSBzeXN0ZW0gZm9yIHRo
ZSBicm93c2VyJ3MgaXNQb2ludEluUGF0aAogICAgQHByaXZhdGUKICAgICovCiAgZGV0ZWN0SXNQ
b2ludEluUGF0aE1vZGUgOiBmdW5jdGlvbigpIHsKICAgIHZhciBjdHggPSB0aGlzLmdldFRlc3RD
b250ZXh0KCkKICAgIHZhciBydgogICAgaWYgKCFjdHguaXNQb2ludEluUGF0aCkKICAgICAgcmV0
dXJuIHRoaXMuVVNFUl9TUEFDRQogICAgY3R4LnNhdmUoKQogICAgY3R4LnRyYW5zbGF0ZSgxLDAp
CiAgICBjdHguYmVnaW5QYXRoKCkKICAgIGN0eC5yZWN0KDAsMCwxLDEpCiAgICBpZiAoY3R4Lmlz
UG9pbnRJblBhdGgoMC4zLDAuMykpIHsKICAgICAgcnYgPSB0aGlzLlVTRVJfU1BBQ0UKICAgIH0g
ZWxzZSB7CiAgICAgIHJ2ID0gdGhpcy5ERVZJQ0VfU1BBQ0UKICAgIH0KICAgIGN0eC5yZXN0b3Jl
KCkKICAgIHJldHVybiBydgogIH0sCgogIC8qKgogICAgUmV0dXJucyB0cnVlIGlmIHRoZSBkZXZp
Y2Utc3BhY2UgcG9pbnQgKHgseSkgaXMgaW5zaWRlIHRoZSBmaWxsIG9mCiAgICBjdHgncyBjdXJy
ZW50IHBhdGguCgogICAgQHBhcmFtIGN0eCBDYW52YXMgMkQgY29udGV4dCB0byBxdWVyeQogICAg
QHBhcmFtIHggVGhlIGRpc3RhbmNlIGluIHBpeGVscyBmcm9tIHRoZSBsZWZ0IHNpZGUgb2YgdGhl
IGNhbnZhcyBlbGVtZW50CiAgICBAcGFyYW0geSBUaGUgZGlzdGFuY2UgaW4gcGl4ZWxzIGZyb20g
dGhlIHRvcCBzaWRlIG9mIHRoZSBjYW52YXMgZWxlbWVudAogICAgQHBhcmFtIG1hdHJpeCBUaGUg
Y3VycmVudCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguIE5lZWRlZCBpZiB0aGUgYnJvd3NlciBoYXMK
ICAgICAgICAgICAgICAgICAgbm8gaXNQb2ludEluUGF0aCBvciB0aGUgYnJvd3NlcidzIGlzUG9p
bnRJblBhdGggd29ya3MgaW4KICAgICAgICAgICAgICAgICAgdXNlci1zcGFjZSBjb29yZGluYXRl
cyBhbmQgdGhlIGJyb3dzZXIgZG9lc24ndCBzdXBwb3J0CiAgICAgICAgICAgICAgICAgIHNldFRy
YW5zZm9ybS4KICAgIEBwYXJhbSBjYWxsYmFja09iaiBJZiB0aGUgYnJvd3NlciBkb2Vzbid0IHN1
cHBvcnQgaXNQb2ludEluUGF0aCwKICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja09iai5p
c1BvaW50SW5QYXRoIHdpbGwgYmUgY2FsbGVkIHdpdGggdGhlCiAgICAgICAgICAgICAgICAgICAg
ICAgeCx5LWNvb3JkaW5hdGVzIHRyYW5zZm9ybWVkIHRvIHVzZXItc3BhY2UuCiAgICBAcGFyYW0K
ICAgIEByZXR1cm4gV2hldGhlciAoeCx5KSBpcyBpbnNpZGUgY3R4J3MgY3VycmVudCBwYXRoIG9y
IG5vdAogICAgQHR5cGUgYm9vbGVhbgogICAgKi8KICBpc1BvaW50SW5QYXRoIDogZnVuY3Rpb24o
Y3R4LCB4LCB5LCBtYXRyaXgsIGNhbGxiYWNrT2JqKSB7CiAgICB2YXIgcnYKICAgIGlmICghY3R4
LmlzUG9pbnRJblBhdGgpIHsKICAgICAgaWYgKGNhbGxiYWNrT2JqICYmIGNhbGxiYWNrT2JqLmlz
UG9pbnRJblBhdGgpIHsKICAgICAgICB2YXIgeHkgPSB0aGlzLnRNYXRyaXhNdWx0aXBseVBvaW50
KHRoaXMudEludmVydE1hdHJpeChtYXRyaXgpLCB4LCB5KQogICAgICAgIHJldHVybiBjYWxsYmFj
a09iai5pc1BvaW50SW5QYXRoKHh5WzBdLCB4eVsxXSkKICAgICAgfSBlbHNlIHsKICAgICAgICBy
ZXR1cm4gZmFsc2UKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaWYgKHRoaXMuZ2V0SXNQb2lu
dEluUGF0aE1vZGUoKSA9PSB0aGlzLlVTRVJfU1BBQ0UpIHsKICAgICAgICBpZiAoIWN0eC5zZXRU
cmFuc2Zvcm0pIHsKICAgICAgICAgIHZhciB4eSA9IHRoaXMudE1hdHJpeE11bHRpcGx5UG9pbnQo
dGhpcy50SW52ZXJ0TWF0cml4KG1hdHJpeCksIHgsIHkpCiAgICAgICAgICBydiA9IGN0eC5pc1Bv
aW50SW5QYXRoKHh5WzBdLCB4eVsxXSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY3R4LnNh
dmUoKQogICAgICAgICAgY3R4LnNldFRyYW5zZm9ybSgxLDAsMCwxLDAsMCkKICAgICAgICAgIHJ2
ID0gY3R4LmlzUG9pbnRJblBhdGgoeCx5KQogICAgICAgICAgY3R4LnJlc3RvcmUoKQogICAgICAg
IH0KICAgICAgfSBlbHNlIHsKICAgICAgICBydiA9IGN0eC5pc1BvaW50SW5QYXRoKHgseSkKICAg
ICAgfQogICAgICByZXR1cm4gcnYKICAgIH0KICB9Cn0KCgpSZWNvcmRpbmdDb250ZXh0ID0gS2xh
c3MoewogIG9iamVjdElkIDogMCwKICBjb21tYW5kcyA6IFtdLAogIGlzTW9ja09iamVjdCA6IHRy
dWUsCgogIGluaXRpYWxpemUgOiBmdW5jdGlvbihjb21tYW5kcykgewogICAgdGhpcy5jb21tYW5k
cyA9IGNvbW1hbmRzIHx8IFtdCiAgICBPYmplY3QuY29uZGl0aW9uYWxFeHRlbmQodGhpcywgdGhp
cy5nZXRNb2NrQ29udGV4dCgpKQogIH0sCgogIGdldE1vY2tDb250ZXh0IDogZnVuY3Rpb24oKSB7
CiAgICBpZiAoIVJlY29yZGluZ0NvbnRleHQuTW9ja0NvbnRleHQpIHsKICAgICAgdmFyIGMgPSBF
LmNhbnZhcygxLDEpCiAgICAgIHZhciBjdHggPSBDYW52YXNTdXBwb3J0LmdldENvbnRleHQoYywg
JzJkJykKICAgICAgdmFyIG9iaiA9IHt9CiAgICAgIGZvciAodmFyIGkgaW4gY3R4KSB7CiAgICAg
ICAgaWYgKHR5cGVvZihjdHhbaV0pID09ICdmdW5jdGlvbicpCiAgICAgICAgICBvYmpbaV0gPSB0
aGlzLmNyZWF0ZVJlY29yZGluZ0Z1bmN0aW9uKGkpCiAgICAgICAgZWxzZQogICAgICAgICAgb2Jq
W2ldID0gY3R4W2ldCiAgICAgIH0KICAgICAgb2JqLmlzUG9pbnRJblBhdGggPSBudWxsCiAgICAg
IG9iai50cmFuc2Zvcm0gPSBudWxsCiAgICAgIG9iai5zZXRUcmFuc2Zvcm0gPSBudWxsCiAgICAg
IFJlY29yZGluZ0NvbnRleHQuTW9ja0NvbnRleHQgPSBvYmoKICAgIH0KICAgIHJldHVybiBSZWNv
cmRpbmdDb250ZXh0Lk1vY2tDb250ZXh0CiAgfSwKCiAgY3JlYXRlUmVjb3JkaW5nRnVuY3Rpb24g
OiBmdW5jdGlvbihuYW1lKXsKICAgIGlmIChuYW1lLnNlYXJjaCgvXnNldFtBLVpdLykgIT0gLTEg
JiYgbmFtZSAhPSAnc2V0VHJhbnNmb3JtJykgewogICAgICB2YXIgdmFyTmFtZSA9IG5hbWUuY2hh
ckF0KDMpLnRvTG93ZXJDYXNlKCkgKyBuYW1lLnNsaWNlKDQpCiAgICAgIHJldHVybiBmdW5jdGlv
bigpewogICAgICAgIHRoaXNbdmFyTmFtZV0gPSBhcmd1bWVudHNbMF0KICAgICAgICB0aGlzLmNv
bW1hbmRzLnB1c2goW25hbWUsICRBKGFyZ3VtZW50cyldKQogICAgICB9CiAgICB9IGVsc2Ugewog
ICAgICByZXR1cm4gZnVuY3Rpb24oKXsKICAgICAgICB0aGlzLmNvbW1hbmRzLnB1c2goW25hbWUs
ICRBKGFyZ3VtZW50cyldKQogICAgICB9CiAgICB9CiAgfSwKCiAgY2xlYXIgOiBmdW5jdGlvbigp
ewogICAgdGhpcy5jb21tYW5kcyA9IFtdCiAgfSwKCiAgZ2V0UmVjb3JkaW5nIDogZnVuY3Rpb24o
KSB7CiAgICByZXR1cm4gdGhpcy5jb21tYW5kcwogIH0sCgogIHNlcmlhbGl6ZSA6IGZ1bmN0aW9u
KHdpZHRoLCBoZWlnaHQpIHsKICAgIHJldHVybiAnKCcgKyB7CiAgICAgIHdpZHRoOiB3aWR0aCwg
aGVpZ2h0OiBoZWlnaHQsCiAgICAgIGNvbW1hbmRzOiB0aGlzLmdldFJlY29yZGluZygpCiAgICB9
LnRvU291cmNlKCkgKyAnKScKICB9LAoKICBwbGF5IDogZnVuY3Rpb24oY3R4KSB7CiAgICBSZWNv
cmRpbmdDb250ZXh0LnBsYXkoY3R4LCB0aGlzLmdldFJlY29yZGluZygpKQogIH0sCgogIGNyZWF0
ZUxpbmVhckdyYWRpZW50IDogZnVuY3Rpb24oKSB7CiAgICB2YXIgaWQgPSB0aGlzLm9iamVjdElk
KysKICAgIHRoaXMuY29tbWFuZHMucHVzaChbaWQsICc9JywgJ2NyZWF0ZUxpbmVhckdyYWRpZW50
JywgJEEoYXJndW1lbnRzKV0pCiAgICByZXR1cm4gbmV3IE1vY2tHcmFkaWVudCh0aGlzLCBpZCkK
ICB9LAoKICBjcmVhdGVSYWRpYWxHcmFkaWVudCA6IGZ1bmN0aW9uKCkgewogICAgdmFyIGlkID0g
dGhpcy5vYmplY3RJZCsrCiAgICB0aGlzLmNvbW1hbmRzLnB1c2goW2lkLCAnPScsICdjcmVhdGVS
YWRpYWxHcmFkaWVudCcsICRBKGFyZ3VtZW50cyldKQogICAgcmV0dXJuIG5ldyB0aGlzLk1vY2tH
cmFkaWVudCh0aGlzLCBpZCkKICB9LAoKICBjcmVhdGVQYXR0ZXJuIDogZnVuY3Rpb24oKSB7CiAg
ICB2YXIgaWQgPSB0aGlzLm9iamVjdElkKysKICAgIHRoaXMuY29tbWFuZHMucHVzaChbaWQsICc9
JywgJ2NyZWF0ZVBhdHRlcm4nLCAkQShhcmd1bWVudHMpXSkKICAgIHJldHVybiBuZXcgdGhpcy5N
b2NrR3JhZGllbnQodGhpcywgaWQpCiAgfSwKCiAgTW9ja0dyYWRpZW50IDogS2xhc3MoewogICAg
aXNNb2NrT2JqZWN0IDogdHJ1ZSwKCiAgICBpbml0aWFsaXplIDogZnVuY3Rpb24ocmVjb3JkZXIs
IGlkKSB7CiAgICAgIHRoaXMucmVjb3JkZXIgPSByZWNvcmRlcgogICAgICB0aGlzLmlkID0gaWQK
ICAgIH0sCgogICAgYWRkQ29sb3JTdG9wIDogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMucmVjb3Jk
ZXIuY29tbWFuZHMucHVzaChbdGhpcy5pZCwgJ2FkZENvbG9yU3RvcCcsICRBKGFyZ3VtZW50cyld
KQogICAgfSwKCiAgICB0b1NvdXJjZSA6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4ge2lkIDog
dGhpcy5pZCwgaXNNb2NrT2JqZWN0IDogdHJ1ZX0udG9Tb3VyY2UoKQogICAgfQogIH0pCn0pClJl
Y29yZGluZ0NvbnRleHQucGxheSA9IGZ1bmN0aW9uKGN0eCwgY29tbWFuZHMpIHsKICB2YXIgZGlj
dGlvbmFyeSA9IFtdCiAgZm9yICh2YXIgaT0wOyBpPGNvbW1hbmRzLmxlbmd0aDsgaSsrKSB7CiAg
ICB2YXIgY21kID0gY29tbWFuZHNbaV0KICAgIGlmIChjbWQubGVuZ3RoID09IDIpIHsKICAgICAg
dmFyIGFyZ3MgPSBjbWRbMV0KICAgICAgaWYgKGFyZ3NbMF0gJiYgYXJnc1swXS5pc01vY2tPYmpl
Y3QpIHsKICAgICAgICBjdHhbY21kWzBdXShkaWN0aW9uYXJ5W2FyZ3NbMF0uaWRdKQogICAgICB9
IGVsc2UgewogICAgICAgIGN0eFtjbWRbMF1dLmFwcGx5KGN0eCwgY21kWzFdKQogICAgICB9CiAg
ICB9IGVsc2UgaWYgKGNtZC5sZW5ndGggPT0gMykgewogICAgICB2YXIgb2JqID0gZGljdGlvbmFy
eVtjbWRbMF1dCiAgICAgIG9ialtjbWRbMV1dLmFwcGx5KG9iaiwgY21kWzJdKQogICAgfSBlbHNl
IGlmIChjbWQubGVuZ3RoID09IDQpIHsKICAgICAgZGljdGlvbmFyeVtjbWRbMF1dID0gY3R4W2Nt
ZFsyXV0uYXBwbHkoY3R4LCBjbWRbM10pCiAgICB9IGVsc2UgewogICAgICB0aHJvdyAiTWFsZm9y
bWVkIGNvbW1hbmQ6ICIrY21kLnRvU3RyaW5nKCkKICAgIH0KICB9Cn0KCgoKClRyYW5zZm9ybWFi
bGUgPSBLbGFzcyh7CiAgbmVlZE1hdHJpeFVwZGF0ZSA6IHRydWUsCgogIC8qKgogICAgVHJhbnNm
b3JtcyB0aGUgY29udGV4dCBzdGF0ZSBhY2NvcmRpbmcgdG8gdGhpcyBub2RlJ3MgYXR0cmlidXRl
cy4KCiAgICBAcGFyYW0gY3R4IENhbnZhcyAyRCBjb250ZXh0CiAgICAqLwogIHRyYW5zZm9ybSA6
IGZ1bmN0aW9uKGN0eCkgewogICAgdmFyIGF0bSA9IHRoaXMuYWJzb2x1dGVNYXRyaXgKICAgIHZh
ciB4eSA9IHRoaXMueCB8fCB0aGlzLnkKICAgIHZhciByb3QgPSB0aGlzLnJvdGF0aW9uCiAgICB2
YXIgc2NhID0gdGhpcy5zY2FsZSAhPSBudWxsCiAgICB2YXIgc2tYID0gdGhpcy5za2V3WAogICAg
dmFyIHNrWSA9IHRoaXMuc2tld1kKICAgIHZhciB0bSA9IHRoaXMubWF0cml4CiAgICB2YXIgdGwg
PSB0aGlzLnRyYW5zZm9ybUxpc3QKCiAgICAvLyB1cGRhdGUgdGhlIG5vZGUncyB0cmFuc2Zvcm1h
dGlvbiBtYXRyaXgKICAgIGlmICh0aGlzLm5lZWRNYXRyaXhVcGRhdGUgfHwgIXRoaXMuY3VycmVu
dE1hdHJpeCkgewogICAgICBpZiAoIXRoaXMuY3VycmVudE1hdHJpeCkgdGhpcy5jdXJyZW50TWF0
cml4ID0gWzEsMCwwLDEsMCwwXQogICAgICBpZiAodGhpcy5wYXJlbnQpCiAgICAgICAgdGhpcy5f
X2NvcHlNYXRyaXgodGhpcy5wYXJlbnQuY3VycmVudE1hdHJpeCkKICAgICAgZWxzZQogICAgICAg
IHRoaXMuX19pZGVudGl0eU1hdHJpeCgpCiAgICAgIGlmIChhdG0pIHRoaXMuX19zZXRNYXRyaXhN
YXRyaXgodGhpcy5hYnNvbHV0ZU1hdHJpeCkKICAgICAgaWYgKHh5KSB0aGlzLl9fdHJhbnNsYXRl
TWF0cml4KHRoaXMueCwgdGhpcy55KQogICAgICBpZiAocm90KSB0aGlzLl9fcm90YXRlTWF0cml4
KHRoaXMucm90YXRpb24pCiAgICAgIGlmIChza1gpIHRoaXMuX19za2V3WE1hdHJpeCh0aGlzLnNr
ZXdYKQogICAgICBpZiAoc2tZKSB0aGlzLl9fc2tld1lNYXRyaXgodGhpcy5za2V3WSkKICAgICAg
aWYgKHNjYSkgdGhpcy5fX3NjYWxlTWF0cml4KHRoaXMuc2NhbGUpCiAgICAgIGlmICh0bSkgdGhp
cy5fX21hdHJpeE1hdHJpeCh0aGlzLm1hdHJpeCkKICAgICAgaWYgKHRsKSB7CiAgICAgICAgZm9y
ICh2YXIgaT0wOyBpPHRoaXMudHJhbnNmb3JtTGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAg
dmFyIHRsID0gdGhpcy50cmFuc2Zvcm1MaXN0W2ldCiAgICAgICAgICB0aGlzWydfXycrdGxbMF0r
J01hdHJpeCddKHRsWzFdKQogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLm5lZWRNYXRyaXhV
cGRhdGUgPSBmYWxzZQogICAgfQoKICAgIGlmICghY3R4KSByZXR1cm4KCiAgICAvLyB0cmFuc2Zv
cm0gbWF0cml4IG1vZGlmaWVycwogICAgdGhpcy5fX3NldE1hdHJpeChjdHgsIHRoaXMuY3VycmVu
dE1hdHJpeCkKICB9LAoKICBkaXN0YW5jZVRvIDogZnVuY3Rpb24obm9kZSkgewogICAgcmV0dXJu
IEN1cnZlcy5saW5lTGVuZ3RoKFt0aGlzLngsIHRoaXMueV0sIFtub2RlLngsIG5vZGUueV0pCiAg
fSwKCiAgYW5nbGVUbyA6IGZ1bmN0aW9uKG5vZGUpIHsKICAgIHJldHVybiBDdXJ2ZXMubGluZUFu
Z2xlKFt0aGlzLngsIHRoaXMueV0sIFtub2RlLngsIG5vZGUueV0pCiAgfSwKCgoKICBfX3NldE1h
dHJpeE1hdHJpeCA6IGZ1bmN0aW9uKG1hdHJpeCkgewogICAgaWYgKCF0aGlzLnByZXZpb3VzTWF0
cml4KSB0aGlzLnByZXZpb3VzTWF0cml4ID0gW10KICAgIHZhciBwID0gdGhpcy5wcmV2aW91c01h
dHJpeAogICAgdmFyIGMgPSB0aGlzLmN1cnJlbnRNYXRyaXgKICAgIHBbMF0gPSBjWzBdCiAgICBw
WzFdID0gY1sxXQogICAgcFsyXSA9IGNbMl0KICAgIHBbM10gPSBjWzNdCiAgICBwWzRdID0gY1s0
XQogICAgcFs1XSA9IGNbNV0KICAgIHAgPSB0aGlzLmN1cnJlbnRNYXRyaXgKICAgIGMgPSBtYXRy
aXgKICAgIHBbMF0gPSBjWzBdCiAgICBwWzFdID0gY1sxXQogICAgcFsyXSA9IGNbMl0KICAgIHBb
M10gPSBjWzNdCiAgICBwWzRdID0gY1s0XQogICAgcFs1XSA9IGNbNV0KICB9LAoKICBfX2NvcHlN
YXRyaXggOiBmdW5jdGlvbihtYXRyaXgpIHsKICAgIHZhciBwID0gdGhpcy5jdXJyZW50TWF0cml4
CiAgICB2YXIgYyA9IG1hdHJpeAogICAgcFswXSA9IGNbMF0KICAgIHBbMV0gPSBjWzFdCiAgICBw
WzJdID0gY1syXQogICAgcFszXSA9IGNbM10KICAgIHBbNF0gPSBjWzRdCiAgICBwWzVdID0gY1s1
XQogIH0sCgogIF9faWRlbnRpdHlNYXRyaXggOiBmdW5jdGlvbigpIHsKICAgIHZhciBwID0gdGhp
cy5jdXJyZW50TWF0cml4CiAgICBwWzBdID0gMQogICAgcFsxXSA9IDAKICAgIHBbMl0gPSAwCiAg
ICBwWzNdID0gMQogICAgcFs0XSA9IDAKICAgIHBbNV0gPSAwCiAgfSwKCiAgX190cmFuc2xhdGVN
YXRyaXggOiBmdW5jdGlvbih4LCB5KSB7CiAgICBpZiAoeC5sZW5ndGgpIHsKICAgICAgQ2FudmFz
U3VwcG9ydC50VHJhbnNsYXRlKCB0aGlzLmN1cnJlbnRNYXRyaXgsIHhbMF0sIHhbMV0gKQogICAg
fSBlbHNlIHsKICAgICAgQ2FudmFzU3VwcG9ydC50VHJhbnNsYXRlKCB0aGlzLmN1cnJlbnRNYXRy
aXgsIHgsIHkgKQogICAgfQogIH0sCgogIF9fcm90YXRlTWF0cml4IDogZnVuY3Rpb24ocm90YXRp
b24pIHsKICAgIGlmIChyb3RhdGlvbi5sZW5ndGgpIHsKICAgICAgaWYgKHJvdGF0aW9uWzBdICUg
TWF0aC5QSSoyID09IDApIHJldHVybgogICAgICBpZiAocm90YXRpb25bMV0gfHwgcm90YXRpb25b
Ml0pIHsKICAgICAgICBDYW52YXNTdXBwb3J0LnRUcmFuc2xhdGUoIHRoaXMuY3VycmVudE1hdHJp
eCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdGF0aW9uWzFdLCByb3RhdGlv
blsyXSApCiAgICAgICAgQ2FudmFzU3VwcG9ydC50Um90YXRlKCB0aGlzLmN1cnJlbnRNYXRyaXgs
IHJvdGF0aW9uWzBdICkKICAgICAgICBDYW52YXNTdXBwb3J0LnRUcmFuc2xhdGUoIHRoaXMuY3Vy
cmVudE1hdHJpeCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1yb3RhdGlvblsx
XSwgLXJvdGF0aW9uWzJdICkKICAgICAgfSBlbHNlIHsKICAgICAgICBDYW52YXNTdXBwb3J0LnRS
b3RhdGUoIHRoaXMuY3VycmVudE1hdHJpeCwgcm90YXRpb25bMF0gKQogICAgICB9CiAgICB9IGVs
c2UgewogICAgICBpZiAocm90YXRpb24gJSBNYXRoLlBJKjIgPT0gMCkgcmV0dXJuCiAgICAgIENh
bnZhc1N1cHBvcnQudFJvdGF0ZSggdGhpcy5jdXJyZW50TWF0cml4LCByb3RhdGlvbiApCiAgICB9
CiAgfSwKCiAgX19za2V3WE1hdHJpeCA6IGZ1bmN0aW9uKHNrZXdYKSB7CiAgICBpZiAoc2tld1gu
bGVuZ3RoICYmIHNrZXdYWzBdKQogICAgICBDYW52YXNTdXBwb3J0LnRTa2V3WCh0aGlzLmN1cnJl
bnRNYXRyaXgsIHNrZXdYWzBdKQogICAgZWxzZQogICAgICBDYW52YXNTdXBwb3J0LnRTa2V3WCh0
aGlzLmN1cnJlbnRNYXRyaXgsIHNrZXdYKQogIH0sCgogIF9fc2tld1lNYXRyaXggOiBmdW5jdGlv
bihza2V3WSkgewogICAgaWYgKHNrZXdZLmxlbmd0aCAmJiBza2V3WVswXSkKICAgICAgQ2FudmFz
U3VwcG9ydC50U2tld1kodGhpcy5jdXJyZW50TWF0cml4LCBza2V3WVswXSkKICAgIGVsc2UKICAg
ICAgQ2FudmFzU3VwcG9ydC50U2tld1kodGhpcy5jdXJyZW50TWF0cml4LCBza2V3WSkKICB9LAoK
ICBfX3NjYWxlTWF0cml4IDogZnVuY3Rpb24oc2NhbGUpIHsKICAgIGlmIChzY2FsZS5sZW5ndGgg
PT0gMikgewogICAgICBpZiAoc2NhbGVbMF0gPT0gMSAmJiBzY2FsZVsxXSA9PSAxKSByZXR1cm4K
ICAgICAgQ2FudmFzU3VwcG9ydC50U2NhbGUodGhpcy5jdXJyZW50TWF0cml4LAogICAgICAgICAg
ICAgICAgICAgICAgICAgICBzY2FsZVswXSwgc2NhbGVbMV0pCiAgICB9IGVsc2UgaWYgKHNjYWxl
Lmxlbmd0aCA9PSAzKSB7CiAgICAgIGlmIChzY2FsZVswXSA9PSAxIHx8IChzY2FsZVswXS5sZW5n
dGggJiYgKHNjYWxlWzBdWzBdID09IDEgJiYgc2NhbGVbMF1bMV0gPT0gMSkpKQogICAgICAgIHJl
dHVybgogICAgICBDYW52YXNTdXBwb3J0LnRUcmFuc2xhdGUodGhpcy5jdXJyZW50TWF0cml4LAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGVbMV0sIHNjYWxlWzJdKQogICAgICBp
ZiAoc2NhbGVbMF0ubGVuZ3RoKSB7CiAgICAgICAgQ2FudmFzU3VwcG9ydC50U2NhbGUodGhpcy5j
dXJyZW50TWF0cml4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZVswXVswXSwg
c2NhbGVbMF1bMV0pCiAgICAgIH0gZWxzZSB7CiAgICAgICAgQ2FudmFzU3VwcG9ydC50U2NhbGUo
IHRoaXMuY3VycmVudE1hdHJpeCwgc2NhbGVbMF0sIHNjYWxlWzBdICkKICAgICAgfQogICAgICBD
YW52YXNTdXBwb3J0LnRUcmFuc2xhdGUodGhpcy5jdXJyZW50TWF0cml4LAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgLXNjYWxlWzFdLCAtc2NhbGVbMl0pCiAgICB9IGVsc2UgaWYgKHNj
YWxlICE9IDEpIHsKICAgICAgQ2FudmFzU3VwcG9ydC50U2NhbGUoIHRoaXMuY3VycmVudE1hdHJp
eCwgc2NhbGUsIHNjYWxlICkKICAgIH0KICB9LAoKICBfX21hdHJpeE1hdHJpeCA6IGZ1bmN0aW9u
KG1hdHJpeCkgewogICAgQ2FudmFzU3VwcG9ydC50TWF0cml4TXVsdGlwbHkodGhpcy5jdXJyZW50
TWF0cml4LCBtYXRyaXgpCiAgfSwKCiAgX19zZXRNYXRyaXggOiBmdW5jdGlvbihjdHgsIG1hdHJp
eCkgewogICAgQ2FudmFzU3VwcG9ydC5zZXRUcmFuc2Zvcm0oY3R4LCBtYXRyaXgsIHRoaXMucHJl
dmlvdXNNYXRyaXgpCiAgfSwKCiAgX190cmFuc2xhdGUgOiBmdW5jdGlvbihjdHgsIHgseSkgewog
ICAgaWYgKHgubGVuZ3RoICE9IG51bGwpCiAgICAgIGN0eC50cmFuc2xhdGUoeFswXSwgeFsxXSkK
ICAgIGVsc2UKICAgICAgY3R4LnRyYW5zbGF0ZSh4LCB5KQogIH0sCgogIF9fcm90YXRlIDogZnVu
Y3Rpb24oY3R4LCByb3RhdGlvbikgewogICAgaWYgKHJvdGF0aW9uLmxlbmd0aCkgewogICAgICBp
ZiAocm90YXRpb25bMV0gfHwgcm90YXRpb25bMl0pIHsKICAgICAgICBpZiAocm90YXRpb25bMF0g
JSBNYXRoLlBJKjIgPT0gMCkgcmV0dXJuCiAgICAgICAgY3R4LnRyYW5zbGF0ZSggcm90YXRpb25b
MV0sIHJvdGF0aW9uWzJdICkKICAgICAgICBjdHgucm90YXRlKCByb3RhdGlvblswXSApCiAgICAg
ICAgY3R4LnRyYW5zbGF0ZSggLXJvdGF0aW9uWzFdLCAtcm90YXRpb25bMl0gKQogICAgICB9IGVs
c2UgewogICAgICAgIGN0eC5yb3RhdGUoIHJvdGF0aW9uWzBdICkKICAgICAgfQogICAgfSBlbHNl
IHsKICAgICAgY3R4LnJvdGF0ZSggcm90YXRpb24gKQogICAgfQogIH0sCgogIF9fc2tld1ggOiBm
dW5jdGlvbihjdHgsIHNrZXdYKSB7CiAgICBpZiAoc2tld1gubGVuZ3RoICYmIHNrZXdYWzBdKQog
ICAgICBDYW52YXNTdXBwb3J0LnNrZXdYKGN0eCwgc2tld1hbMF0pCiAgICBlbHNlCiAgICAgIENh
bnZhc1N1cHBvcnQuc2tld1goY3R4LCBza2V3WCkKICB9LAoKICBfX3NrZXdZIDogZnVuY3Rpb24o
Y3R4LCBza2V3WSkgewogICAgaWYgKHNrZXdZLmxlbmd0aCAmJiBza2V3WVswXSkKICAgICAgQ2Fu
dmFzU3VwcG9ydC5za2V3WShjdHgsIHNrZXdZWzBdKQogICAgZWxzZQogICAgICBDYW52YXNTdXBw
b3J0LnNrZXdZKGN0eCwgc2tld1kpCiAgfSwKCiAgX19zY2FsZSA6IGZ1bmN0aW9uKGN0eCwgc2Nh
bGUpIHsKICAgIGlmIChzY2FsZS5sZW5ndGggPT0gMikgewogICAgICBjdHguc2NhbGUoc2NhbGVb
MF0sIHNjYWxlWzFdKQogICAgfSBlbHNlIGlmIChzY2FsZS5sZW5ndGggPT0gMykgewogICAgICBj
dHgudHJhbnNsYXRlKCBzY2FsZVsxXSwgc2NhbGVbMl0gKQogICAgICBpZiAoc2NhbGVbMF0ubGVu
Z3RoKSB7CiAgICAgICAgY3R4LnNjYWxlKHNjYWxlWzBdWzBdLCBzY2FsZVswXVsxXSkKICAgICAg
fSBlbHNlIHsKICAgICAgICBjdHguc2NhbGUoc2NhbGVbMF0sIHNjYWxlWzBdKQogICAgICB9CiAg
ICAgIGN0eC50cmFuc2xhdGUoIC1zY2FsZVsxXSwgLXNjYWxlWzJdICkKICAgIH0gZWxzZSB7CiAg
ICAgIGN0eC5zY2FsZShzY2FsZSwgc2NhbGUpCiAgICB9CiAgfSwKCiAgX19tYXRyaXggOiBmdW5j
dGlvbihjdHgsIG1hdHJpeCkgewogICAgQ2FudmFzU3VwcG9ydC50cmFuc2Zvcm0oY3R4LCBtYXRy
aXgpCiAgfQoKfSkKCgovKioKICBUaW1lbGluZSBpcyBhbiBhbmltYXRvciB0aGF0IHR3ZWVucyBi
ZXR3ZWVuIGl0cyBmcmFtZXMuCgogIFdoZW4gb2JqZWN0LnRpbWUgPSBrLnRpbWU6CiAgICAgICBv
YmplY3Quc3RhdGUgPSBrLnN0YXRlCiAgV2hlbiBvYmplY3QudGltZSA+IGtbaS0xXS50aW1lIGFu
ZCBvYmplY3QudGltZSA8IGtbaV0udGltZToKICAgICAgIG9iamVjdC5zdGF0ZSA9IGtbaV0udHdl
ZW4ocG9zaXRpb24sIGtbaS0xXS5zdGF0ZSwga1tpXS5zdGF0ZSkKICAgICAgIHdoZXJlIHBvc2l0
aW9uID0gZWxhcHNlZCAvIGR1cmF0aW9uLAogICAgICAgICAgICAgZWxhcHNlZCA9IG9iamVjdC50
aW1lIC0ga1tpLTFdLnRpbWUsCiAgICAgICAgICAgICBkdXJhdGlvbiA9IGtbaV0udGltZSAtIGtb
aS0xXS50aW1lCiAgKi8KVGltZWxpbmUgPSBLbGFzcyh7CiAgc3RhcnRUaW1lIDogbnVsbCwKICBy
ZXBlYXQgOiBmYWxzZSwKICBsYXN0QWN0aW9uIDogMCwKCiAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9u
KHJlcGVhdCwgcGluZ3BvbmcpIHsKICAgIHRoaXMucmVwZWF0ID0gcmVwZWF0CiAgICB0aGlzLmtl
eWZyYW1lcyA9IFtdCiAgfSwKCiAgYWRkS2V5ZnJhbWUgOiBmdW5jdGlvbih0aW1lLCB0YXJnZXQs
IHR3ZWVuKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSB0aGlzLmtleWZyYW1lcy5w
dXNoKHRpbWUpCiAgICBlbHNlICB0aGlzLmtleWZyYW1lcy5wdXNoKHsKICAgICAgICAgICAgdGlt
ZSA6IHRpbWUsCiAgICAgICAgICAgIHRhcmdldCA6IHRhcmdldCwKICAgICAgICAgICAgdHdlZW4g
OiB0d2VlbgogICAgICAgICAgfSkKICB9LAoKICBhcHBlbmRLZXlmcmFtZSA6IGZ1bmN0aW9uKHRp
bWVEZWx0YSwgdGFyZ2V0LCB0d2VlbikgewogICAgdGhpcy5sYXN0QWN0aW9uICs9IHRpbWVEZWx0
YQogICAgcmV0dXJuIHRoaXMuYWRkS2V5ZnJhbWUodGhpcy5sYXN0QWN0aW9uLCB0YXJnZXQsIHR3
ZWVuKQogIH0sCgogIGV2YWx1YXRlIDogZnVuY3Rpb24ob2JqZWN0LCBvdCwgZHQpIHsKICAgIGlm
ICh0aGlzLnN0YXJ0VGltZSA9PSBudWxsKSB0aGlzLnN0YXJ0VGltZSA9IG90CiAgICB2YXIgdCA9
IG90IC0gdGhpcy5zdGFydFRpbWUKICAgIGlmICh0aGlzLmtleWZyYW1lcy5sZW5ndGggPiAwKSB7
CiAgICAgIC8vIGZpbmQgY3VycmVudCBrZXlmcmFtZQogICAgICB2YXIgY3VycmVudEluZGV4LCBw
cmV2aW91c0ZyYW1lLCBjdXJyZW50RnJhbWUKICAgICAgZm9yICh2YXIgaT0wOyBpPHRoaXMua2V5
ZnJhbWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMua2V5ZnJhbWVzW2ldLnRpbWUg
PiB0KSB7CiAgICAgICAgICBjdXJyZW50SW5kZXggPSBpCiAgICAgICAgICBicmVhawogICAgICAg
IH0KICAgICAgfQogICAgICBpZiAoY3VycmVudEluZGV4ICE9IG51bGwpIHsKICAgICAgICBwcmV2
aW91c0ZyYW1lID0gdGhpcy5rZXlmcmFtZXNbY3VycmVudEluZGV4LTFdCiAgICAgICAgY3VycmVu
dEZyYW1lID0gdGhpcy5rZXlmcmFtZXNbY3VycmVudEluZGV4XQogICAgICB9CiAgICAgIGlmICgh
Y3VycmVudEZyYW1lKSB7CiAgICAgICAgaWYgKCF0aGlzLmtleWZyYW1lcy5hdEVuZCkgewogICAg
ICAgICAgdGhpcy5rZXlmcmFtZXMuYXRFbmQgPSB0cnVlCiAgICAgICAgICBwcmV2aW91c0ZyYW1l
ID0gdGhpcy5rZXlmcmFtZXNbdGhpcy5rZXlmcmFtZXMubGVuZ3RoIC0gMV0KICAgICAgICAgIE9i
amVjdC5leHRlbmQob2JqZWN0LCBPYmplY3QuY2xvbmUocHJldmlvdXNGcmFtZS50YXJnZXQpKQog
ICAgICAgICAgaWYgKHRoaXMucmVwZWF0KSB0aGlzLnN0YXJ0VGltZSA9IG90CiAgICAgICAgICBv
YmplY3QuY2hhbmdlZCA9IHRydWUKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAocHJldmlvdXNG
cmFtZSkgewogICAgICAgIHRoaXMua2V5ZnJhbWVzLmF0RW5kID0gZmFsc2UKICAgICAgICAvLyBh
bmltYXRlIHRvd2FyZHMgY3VycmVudCBrZXlmcmFtZQogICAgICAgIHZhciBlbGFwc2VkID0gdCAt
IHByZXZpb3VzRnJhbWUudGltZQogICAgICAgIHZhciBkdXJhdGlvbiA9IGN1cnJlbnRGcmFtZS50
aW1lIC0gcHJldmlvdXNGcmFtZS50aW1lCiAgICAgICAgdmFyIHBvcyA9IGVsYXBzZWQgLyBkdXJh
dGlvbgogICAgICAgIGZvciAodmFyIGsgaW4gY3VycmVudEZyYW1lLnRhcmdldCkgewogICAgICAg
ICAgaWYgKHByZXZpb3VzRnJhbWUudGFyZ2V0W2tdICE9IG51bGwpIHsKICAgICAgICAgICAgb2Jq
ZWN0LnR3ZWVuVmFyaWFibGUoaywKICAgICAgICAgICAgICBwcmV2aW91c0ZyYW1lLnRhcmdldFtr
XSwgY3VycmVudEZyYW1lLnRhcmdldFtrXSwKICAgICAgICAgICAgICBwb3MsIGN1cnJlbnRGcmFt
ZS50d2VlbikKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9Cgp9KQoKCkFu
aW1hdGFibGUgPSBLbGFzcyh7CiAgdHdlZW5GdW5jdGlvbnMgOiB7CiAgICBsaW5lYXIgOiBmdW5j
dGlvbih2KSB7IHJldHVybiB2IH0sCgogICAgc2V0IDogZnVuY3Rpb24odikgeyByZXR1cm4gTWF0
aC5mbG9vcih2KSB9LAogICAgZGlzY3JldGUgOiBmdW5jdGlvbih2KSB7IHJldHVybiBNYXRoLmZs
b29yKHYpIH0sCgogICAgc2luZSA6IGZ1bmN0aW9uKHYpIHsgcmV0dXJuIDAuNS0wLjUqTWF0aC5j
b3ModipNYXRoLlBJKSB9LAoKICAgIHNwcm9pbmcgOiBmdW5jdGlvbih2KSB7CiAgICAgIHJldHVy
biAoMC41LTAuNSpNYXRoLmNvcyh2KjMuNTkyNjE5NDY1Mzg2MDYpKSAqIDEuMDUyNjMxNTc4OTQ3
MzcKICAgICAgLy8gcGkgKyBwaS1hY29zKDAuOSkKICAgIH0sCgogICAgc3F1YXJlIDogZnVuY3Rp
b24odikgewogICAgICByZXR1cm4gdip2CiAgICB9LAoKICAgIGN1YmUgOiBmdW5jdGlvbih2KSB7
CiAgICAgIHJldHVybiB2KnYqdgogICAgfSwKCiAgICBzcXJ0IDogZnVuY3Rpb24odikgewogICAg
ICByZXR1cm4gTWF0aC5zcXJ0KHYpCiAgICB9LAoKICAgIGN1cnQgOiBmdW5jdGlvbih2KSB7CiAg
ICAgIHJldHVybiBNYXRoLnBvdyh2LCAtMC4zMzMzMzMzMzMzMzMpCiAgICB9CiAgfSwKCiAgaW5p
dGlhbGl6ZSA6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5sYXN0QWN0aW9uID0gMAogICAgdGhpcy50
aW1lbGluZSA9IFtdCiAgICB0aGlzLmtleWZyYW1lcyA9IFtdCiAgICB0aGlzLnBlbmRpbmdLZXlm
cmFtZXMgPSBbXQogICAgdGhpcy5wZW5kaW5nVGltZWxpbmVFdmVudHMgPSBbXQogICAgdGhpcy50
aW1lbGluZXMgPSBbXQogICAgdGhpcy5hbmltYXRvcnMgPSBbXQogICAgdGhpcy5hZGRGcmFtZUxp
c3RlbmVyKHRoaXMudXBkYXRlVGltZWxpbmVzKQogICAgdGhpcy5hZGRGcmFtZUxpc3RlbmVyKHRo
aXMudXBkYXRlS2V5ZnJhbWVzKQogICAgdGhpcy5hZGRGcmFtZUxpc3RlbmVyKHRoaXMudXBkYXRl
VGltZWxpbmUpCiAgICB0aGlzLmFkZEZyYW1lTGlzdGVuZXIodGhpcy51cGRhdGVBbmltYXRvcnMp
CiAgfSwKCiAgdXBkYXRlVGltZWxpbmVzIDogZnVuY3Rpb24odCwgZHQpIHsKICAgIGZvciAodmFy
IGk9MDsgaTx0aGlzLnRpbWVsaW5lcy5sZW5ndGg7IGkrKykKICAgICAgdGhpcy50aW1lbGluZXNb
aV0uZXZhbHVhdGUodGhpcywgdCwgZHQpCiAgfSwKCiAgYWRkVGltZWxpbmUgOiBmdW5jdGlvbih0
bCkgewogICAgdGhpcy50aW1lbGluZXMucHVzaCh0bCkKICB9LAoKICByZW1vdmVUaW1lbGluZSA6
IGZ1bmN0aW9uKHRsKSB7CiAgICB0aGlzLnRpbWVsaW5lcy5kZWxldGVGaXJzdCh0bCkKICB9LAoK
ICAvKioKICAgIFR3ZWVucyBiZXR3ZWVuIGtleWZyYW1lcyAoYSBrZXlmcmFtZSBpcyBhbiBvYmpl
Y3Qgd2l0aCB0aGUgbmV3IHZhbHVlcyBvZgogICAgdGhlIG1lbWJlcnMgb2YgdGhpcywgZS5nLiB7
IHRpbWU6IDAsIHRhcmdldDogeyB4OiAxMCwgeTogMjAgfSwgdHdlZW46ICdzcXVhcmUnfSkKCiAg
ICBLZXlmcmFtZXMgYXJlIHZlcnkgbXVjaCBsaWtlIG11bHRpLXZhcmlhYmxlIGFuaW1hdG9ycywg
dGhlIG1haW4gZGlmZmVyZW5jZQogICAgaXMgdGhhdCB3aXRoIGtleWZyYW1lcyB0aGUgc3RhcnQg
dmFsdWUgYW5kIHRoZSBkdXJhdGlvbiBhcmUgaW1wbGljaXQuCgogICAgV2hpbGUgYW4gYW5pbWF0
aW9uIGZyb20gdmFsdWUgQSB0byBCIHdvdWxkIHRha2UgdHdvIGtleWZyYW1lcyBpbnN0ZWFkIG9m
CiAgICBhIHNpbmdsZSBhbmltYXRvciwgY2hhaW5pbmcgYW5kIHJlb3JkZXJpbmcga2V5ZnJhbWVz
IGlzIHZlcnkgZWFzeS4KICAgICovCiAgdXBkYXRlS2V5ZnJhbWVzIDogZnVuY3Rpb24odCxkdCkg
ewogICAgdGhpcy5hZGRQZW5kaW5nS2V5ZnJhbWVzKHQpCiAgICBpZiAodGhpcy5rZXlmcmFtZXMu
bGVuZ3RoID4gMCkgewogICAgICAvLyBmaW5kIGN1cnJlbnQga2V5ZnJhbWUKICAgICAgdmFyIGN1
cnJlbnRJbmRleCwgcHJldmlvdXNGcmFtZSwgY3VycmVudEZyYW1lCiAgICAgIGZvciAodmFyIGk9
MDsgaTx0aGlzLmtleWZyYW1lcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmtleWZy
YW1lc1tpXS50aW1lID4gdCkgewogICAgICAgICAgY3VycmVudEluZGV4ID0gaQogICAgICAgICAg
YnJlYWsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGN1cnJlbnRJbmRleCAhPSBudWxsKSB7
CiAgICAgICAgcHJldmlvdXNGcmFtZSA9IHRoaXMua2V5ZnJhbWVzW2N1cnJlbnRJbmRleC0xXQog
ICAgICAgIGN1cnJlbnRGcmFtZSA9IHRoaXMua2V5ZnJhbWVzW2N1cnJlbnRJbmRleF0KICAgICAg
fQogICAgICBpZiAoIWN1cnJlbnRGcmFtZSkgewogICAgICAgIGlmICghdGhpcy5rZXlmcmFtZXMu
YXRFbmQpIHsKICAgICAgICAgIHRoaXMua2V5ZnJhbWVzLmF0RW5kID0gdHJ1ZQogICAgICAgICAg
cHJldmlvdXNGcmFtZSA9IHRoaXMua2V5ZnJhbWVzW3RoaXMua2V5ZnJhbWVzLmxlbmd0aCAtIDFd
CiAgICAgICAgICBPYmplY3QuZXh0ZW5kKHRoaXMsIE9iamVjdC5jbG9uZShwcmV2aW91c0ZyYW1l
LnRhcmdldCkpCiAgICAgICAgICB0aGlzLmNoYW5nZWQgPSB0cnVlCiAgICAgICAgfQogICAgICB9
IGVsc2UgaWYgKHByZXZpb3VzRnJhbWUpIHsKICAgICAgICB0aGlzLmtleWZyYW1lcy5hdEVuZCA9
IGZhbHNlCiAgICAgICAgLy8gYW5pbWF0ZSB0b3dhcmRzIGN1cnJlbnQga2V5ZnJhbWUKICAgICAg
ICB2YXIgZWxhcHNlZCA9IHQgLSBwcmV2aW91c0ZyYW1lLnRpbWUKICAgICAgICB2YXIgZHVyYXRp
b24gPSBjdXJyZW50RnJhbWUudGltZSAtIHByZXZpb3VzRnJhbWUudGltZQogICAgICAgIHZhciBw
b3MgPSBlbGFwc2VkIC8gZHVyYXRpb24KICAgICAgICBmb3IgKHZhciBrIGluIGN1cnJlbnRGcmFt
ZS50YXJnZXQpIHsKICAgICAgICAgIGlmIChwcmV2aW91c0ZyYW1lLnRhcmdldFtrXSAhPSBudWxs
KSB7CiAgICAgICAgICAgIHRoaXMudHdlZW5WYXJpYWJsZShrLAogICAgICAgICAgICAgIHByZXZp
b3VzRnJhbWUudGFyZ2V0W2tdLCBjdXJyZW50RnJhbWUudGFyZ2V0W2tdLAogICAgICAgICAgICAg
IHBvcywgY3VycmVudEZyYW1lLnR3ZWVuKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQog
ICAgfQogIH0sCgogIGFkZFBlbmRpbmdLZXlmcmFtZXMgOiBmdW5jdGlvbih0KSB7CiAgICBpZiAo
dGhpcy5wZW5kaW5nS2V5ZnJhbWVzLmxlbmd0aCA+IDApIHsKICAgICAgd2hpbGUgKHRoaXMucGVu
ZGluZ0tleWZyYW1lcy5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIGtmID0gdGhpcy5wZW5kaW5n
S2V5ZnJhbWVzLnNoaWZ0KCkKICAgICAgICBpZiAoa2YudGltZSA9PSBudWxsKQogICAgICAgICAg
a2YudGltZSA9IGtmLnJlbGF0aXZlVGltZSArIHQKICAgICAgICB0aGlzLmtleWZyYW1lcy5wdXNo
KGtmKQogICAgICB9CiAgICAgIHRoaXMua2V5ZnJhbWVzLnN0YWJsZVNvcnQoZnVuY3Rpb24oYSxi
KSB7IHJldHVybiBhLnRpbWUgLSBiLnRpbWUgfSkKICAgIH0KICB9LAoKICAvKioKICAgIFJ1biBh
bmQgcmVtb3ZlIHRpbWVsaW5lRXZlbnRzIHRoYXQgaGF2ZSBzdGFydFRpbWUgPD0gdC4KICAgIFRp
bWVsaW5lRXZlbnRzIGFyZSBydW4gaW4gdGhlIGFzY2VuZGluZyBvcmRlciBvZiB0aGVpciBzdGFy
dFRpbWVzLgogICAgKi8KICB1cGRhdGVUaW1lbGluZSA6IGZ1bmN0aW9uKHQsIGR0KSB7CiAgICB0
aGlzLmFkZFBlbmRpbmdUaW1lbGluZUV2ZW50cyh0KQogICAgd2hpbGUgKHRoaXMudGltZWxpbmVb
MF0gJiYgdGhpcy50aW1lbGluZVswXS5zdGFydFRpbWUgPD0gdCkgewogICAgICB2YXIga2V5ZnJh
bWUgPSB0aGlzLnRpbWVsaW5lLnNoaWZ0KCkKICAgICAgdmFyIHJ2ID0gdHJ1ZQogICAgICBpZiAo
dHlwZW9mKGtleWZyYW1lLmFjdGlvbikgPT0gJ2Z1bmN0aW9uJykKICAgICAgICBydiA9IGtleWZy
YW1lLmFjdGlvbi5jYWxsKHRoaXMsIHQsIGR0LCBrZXlmcmFtZSkKICAgICAgZWxzZQogICAgICAg
IHRoaXMuYW5pbWF0b3JzLnB1c2goa2V5ZnJhbWUuYWN0aW9uKQogICAgICBpZiAoa2V5ZnJhbWUu
cmVwZWF0RXZlcnkgIT0gbnVsbCAmJiBydiAhPSBmYWxzZSkgewogICAgICAgIGlmIChrZXlmcmFt
ZS5yZXBlYXRUaW1lcyAhPSBudWxsKSB7CiAgICAgICAgICBpZiAoa2V5ZnJhbWUucmVwZWF0VGlt
ZXMgPD0gMCkgY29udGludWUKICAgICAgICAgIGtleWZyYW1lLnJlcGVhdFRpbWVzLS0KICAgICAg
ICB9CiAgICAgICAga2V5ZnJhbWUuc3RhcnRUaW1lICs9IGtleWZyYW1lLnJlcGVhdEV2ZXJ5CiAg
ICAgICAgdGhpcy5hZGRUaW1lbGluZUV2ZW50KGtleWZyYW1lKQogICAgICB9CiAgICAgIHRoaXMu
Y2hhbmdlZCA9IHRydWUKICAgIH0KICB9LAoKICBhZGRQZW5kaW5nVGltZWxpbmVFdmVudHMgOiBm
dW5jdGlvbih0KSB7CiAgICBpZiAodGhpcy5wZW5kaW5nVGltZWxpbmVFdmVudHMubGVuZ3RoID4g
MCkgewogICAgICB3aGlsZSAodGhpcy5wZW5kaW5nVGltZWxpbmVFdmVudHMubGVuZ3RoID4gMCkg
ewogICAgICAgIHZhciBrZiA9IHRoaXMucGVuZGluZ1RpbWVsaW5lRXZlbnRzLnNoaWZ0KCkKICAg
ICAgICBpZiAoIWtmLnN0YXJ0VGltZSkKICAgICAgICAgIGtmLnN0YXJ0VGltZSA9IGtmLnJlbGF0
aXZlU3RhcnRUaW1lICsgdAogICAgICAgIHRoaXMudGltZWxpbmUucHVzaChrZikKICAgICAgfQog
ICAgICB0aGlzLnRpbWVsaW5lLnN0YWJsZVNvcnQoZnVuY3Rpb24oYSxiKSB7IHJldHVybiBhLnN0
YXJ0VGltZSAtIGIuc3RhcnRUaW1lIH0pCiAgICB9CiAgfSwKCiAgYWRkVGltZWxpbmVFdmVudCA6
IGZ1bmN0aW9uKGtmKSB7CiAgICB0aGlzLnBlbmRpbmdUaW1lbGluZUV2ZW50cy5wdXNoKGtmKQog
IH0sCgogIC8qKgogICAgUnVuIGVhY2ggYW5pbWF0b3IsIGRlbGV0ZSBvbmVzIHRoYXQgaGF2ZSB0
aGVpciBkdXJhdGlvbnMgZXhjZWVkZWQuCiAgICAqLwogIHVwZGF0ZUFuaW1hdG9ycyA6IGZ1bmN0
aW9uKHQsIGR0KSB7CiAgICBmb3IgKHZhciBpPTA7IGk8dGhpcy5hbmltYXRvcnMubGVuZ3RoOyBp
KyspIHsKICAgICAgdmFyIGFuaSA9IHRoaXMuYW5pbWF0b3JzW2ldCiAgICAgIGlmICghYW5pLnN0
YXJ0VGltZSkgYW5pLnN0YXJ0VGltZSA9IHQKICAgICAgdmFyIGVsYXBzZWQgPSB0IC0gYW5pLnN0
YXJ0VGltZQogICAgICB2YXIgcG9zID0gZWxhcHNlZCAvIGFuaS5kdXJhdGlvbgogICAgICB2YXIg
c2hvdWxkUmVtb3ZlID0gZmFsc2UKICAgICAgaWYgKHBvcyA+PSAxKSB7CiAgICAgICAgaWYgKCFh
bmkucmVwZWF0KSB7CiAgICAgICAgICBwb3MgPSAxCiAgICAgICAgICBzaG91bGRSZW1vdmUgPSB0
cnVlCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChhbmkucmVwZWF0ICE9PSB0cnVlKSBh
bmkucmVwZWF0ID0gTWF0aC5tYXgoMCwgYW5pLnJlcGVhdCAtIDEpCiAgICAgICAgICBpZiAoYW5p
LmFjY3VtdWxhdGUpIHsKICAgICAgICAgICAgYW5pLnN0YXJ0VmFsdWUgPSBPYmplY3QuY2xvbmUo
YW5pLmVuZFZhbHVlKQogICAgICAgICAgICBhbmkuZW5kVmFsdWUgPSBPYmplY3Quc3VtKGFuaS5k
aWZmZXJlbmNlLCBhbmkuZW5kVmFsdWUpCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYW5pLnJl
cGVhdCA9PSAwKSB7CiAgICAgICAgICAgIHNob3VsZFJlbW92ZSA9IHRydWUKICAgICAgICAgICAg
cG9zID0gMQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYW5pLnN0YXJ0VGltZSA9IHQK
ICAgICAgICAgICAgcG9zID0gcG9zICUgMQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBl
bHNlIGlmIChhbmkucmVwZWF0ICYmIGFuaS5yZXBlYXQgIT09IHRydWUgJiYgYW5pLnJlcGVhdCA8
PSBwb3MpIHsKICAgICAgICBzaG91bGRSZW1vdmUgPSB0cnVlCiAgICAgICAgcG9zID0gYW5pLnJl
cGVhdAogICAgICB9CiAgICAgIHRoaXMudHdlZW5WYXJpYWJsZShhbmkudmFyaWFibGUsIGFuaS5z
dGFydFZhbHVlLCBhbmkuZW5kVmFsdWUsIHBvcywgYW5pLnR3ZWVuKQogICAgICBpZiAoc2hvdWxk
UmVtb3ZlKSB7CiAgICAgICAgdGhpcy5hbmltYXRvcnMuc3BsaWNlKGksIDEpCiAgICAgICAgaS0t
CiAgICAgIH0KICAgIH0KICB9LAoKICB0d2VlblZhcmlhYmxlIDogZnVuY3Rpb24odmFyaWFibGUs
IHN0YXJ0LCBlbmQsIHBvcywgdHdlZW5GdW5jdGlvbikgewogICAgaWYgKHR5cGVvZih0d2VlbkZ1
bmN0aW9uKSAhPSAnZnVuY3Rpb24nKSB7CiAgICAgIHR3ZWVuRnVuY3Rpb24gPSB0aGlzLnR3ZWVu
RnVuY3Rpb25zW3R3ZWVuRnVuY3Rpb25dIHx8IHRoaXMudHdlZW5GdW5jdGlvbnMubGluZWFyCiAg
ICB9CiAgICB2YXIgdHdlZW5lZCA9IHR3ZWVuRnVuY3Rpb24ocG9zKQogICAgaWYgKHR5cGVvZih2
YXJpYWJsZSkgIT0gJ2Z1bmN0aW9uJykgewogICAgICBpZiAoc3RhcnQgaW5zdGFuY2VvZiBBcnJh
eSkgewogICAgICAgIGZvciAodmFyIGo9MDsgajxzdGFydC5sZW5ndGg7IGorKykgewogICAgICAg
ICAgdGhpc1t2YXJpYWJsZV1bal0gPSBzdGFydFtqXSArIHR3ZWVuZWQqKGVuZFtqXS1zdGFydFtq
XSkKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpc1t2YXJpYWJsZV0gPSBzdGFy
dCArIHR3ZWVuZWQqKGVuZC1zdGFydCkKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdmFyaWFi
bGUuY2FsbCh0aGlzLCB0d2VlbmVkLCBzdGFydCwgZW5kKQogICAgfQogICAgdGhpcy5jaGFuZ2Vk
ID0gdHJ1ZQogIH0sCgogIGFuaW1hdGUgOiBmdW5jdGlvbih2YXJpYWJsZSwgc3RhcnQsIGVuZCwg
ZHVyYXRpb24sIHR3ZWVuLCBjb25maWcpIHsKICAgIHZhciBzdGFydCA9IE9iamVjdC5jbG9uZShz
dGFydCkKICAgIHZhciBlbmQgPSBPYmplY3QuY2xvbmUoZW5kKQogICAgaWYgKCFjb25maWcpIGNv
bmZpZyA9IHt9CiAgICBpZiAoY29uZmlnLmFkZGl0aXZlKSB7CiAgICAgIHZhciBkaWZmID0gT2Jq
ZWN0LnN1YihlbmQsIHN0YXJ0KQogICAgICBzdGFydCA9IE9iamVjdC5zdW0oc3RhcnQsIHRoaXNb
dmFyaWFibGVdKQogICAgICBlbmQgPSBPYmplY3Quc3VtKGVuZCwgdGhpc1t2YXJpYWJsZV0pCiAg
ICB9CiAgICBpZiAodHlwZW9mKHZhcmlhYmxlKSAhPSAnZnVuY3Rpb24nKQogICAgICB0aGlzW3Zh
cmlhYmxlXSA9IE9iamVjdC5jbG9uZShzdGFydCkKICAgIHZhciBhbmkgPSB7CiAgICAgIGlkIDog
QW5pbWF0YWJsZS51aWQrKywKICAgICAgdmFyaWFibGUgOiB2YXJpYWJsZSwKICAgICAgc3RhcnRW
YWx1ZSA6IHN0YXJ0LAogICAgICBlbmRWYWx1ZSA6IGVuZCwKICAgICAgZGlmZmVyZW5jZSA6IGRp
ZmYsCiAgICAgIGR1cmF0aW9uIDogZHVyYXRpb24sCiAgICAgIHR3ZWVuIDogdHdlZW4sCiAgICAg
IHJlcGVhdCA6IGNvbmZpZy5yZXBlYXQsCiAgICAgIGFkZGl0aXZlIDogY29uZmlnLmFkZGl0aXZl
LAogICAgICBhY2N1bXVsYXRlIDogY29uZmlnLmFjY3VtdWxhdGUsCiAgICAgIHBpbmdwb25nIDog
Y29uZmlnLnBpbmdwb25nCiAgICB9CiAgICB0aGlzLmFuaW1hdG9ycy5wdXNoKGFuaSkKICAgIHJl
dHVybiBhbmkKICB9LAoKICByZW1vdmVBbmltYXRvciA6IGZ1bmN0aW9uKGFuaW1hdG9yKSB7CiAg
ICB0aGlzLmFuaW1hdG9ycy5kZWxldGVGaXJzdChhbmltYXRvcikKICB9LAoKICBhbmltYXRlVG8g
OiBmdW5jdGlvbih2YXJpYWJsZU5hbWUsIGVuZCwgZHVyYXRpb24sIHR3ZWVuLCBjb25maWcpIHsK
ICAgIHJldHVybiB0aGlzLmFuaW1hdGUodmFyaWFibGVOYW1lLCB0aGlzW3ZhcmlhYmxlTmFtZV0s
IGVuZCwgZHVyYXRpb24sIHR3ZWVuLCBjb25maWcpCiAgfSwKCiAgYW5pbWF0ZUZyb20gOiBmdW5j
dGlvbih2YXJpYWJsZU5hbWUsIHN0YXJ0LCBkdXJhdGlvbiwgdHdlZW4sIGNvbmZpZykgewogICAg
cmV0dXJuIHRoaXMuYW5pbWF0ZSh2YXJpYWJsZU5hbWUsIHN0YXJ0LCB0aGlzW3ZhcmlhYmxlTmFt
ZV0sIGR1cmF0aW9uLCB0d2VlbiwgY29uZmlnKQogIH0sCgogIGFuaW1hdGVGYWN0b3IgOiBmdW5j
dGlvbih2YXJpYWJsZU5hbWUsIHN0YXJ0LCBlbmRGYWN0b3IsIGR1cmF0aW9uLCB0d2VlbiwgY29u
ZmlnKSB7CiAgICB2YXIgZW5kCiAgICBpZiAoc3RhcnQgaW5zdGFuY2VvZiBBcnJheSkgewogICAg
ICBlbmQgPSBbXQogICAgICBmb3IgKHZhciBpPTA7IGk8c3RhcnQubGVuZ3RoOyBpKyspIHsKICAg
ICAgICBlbmRbaV0gPSBzdGFydFtpXSAqIGVuZEZhY3RvcgogICAgICB9CiAgICB9IGVsc2Ugewog
ICAgICBlbmQgPSBzdGFydCAqIGVuZEZhY3RvcgogICAgfQogICAgcmV0dXJuIHRoaXMuYW5pbWF0
ZSh2YXJpYWJsZU5hbWUsIHN0YXJ0LCBlbmQsIGR1cmF0aW9uLCB0d2VlbiwgY29uZmlnKQogIH0s
CgogIGFuaW1hdGVUb0ZhY3RvciA6IGZ1bmN0aW9uKHZhcmlhYmxlTmFtZSwgZW5kRmFjdG9yLCBk
dXJhdGlvbiwgdHdlZW4sIGNvbmZpZykgewogICAgdmFyIHN0YXJ0ID0gdGhpc1t2YXJpYWJsZU5h
bWVdCiAgICByZXR1cm4gdGhpcy5hbmltYXRlRmFjdG9yKHZhcmlhYmxlTmFtZSwgc3RhcnQsIGVu
ZEZhY3RvciwgZHVyYXRpb24sIHR3ZWVuLCBjb25maWcpCiAgfSwKCiAgYWRkS2V5ZnJhbWUgOiBm
dW5jdGlvbih0aW1lLCB0YXJnZXQsIHR3ZWVuKSB7CiAgICB2YXIga2YgPSB7CiAgICAgIHJlbGF0
aXZlVGltZTogdGltZSwKICAgICAgdGFyZ2V0OiB0YXJnZXQsCiAgICAgIHR3ZWVuOiB0d2Vlbgog
ICAgfQogICAgdGhpcy5wZW5kaW5nS2V5ZnJhbWVzLnB1c2goa2YpCiAgfSwKCiAgYWRkS2V5ZnJh
bWVBdCA6IGZ1bmN0aW9uKHRpbWUsIHRhcmdldCwgdHdlZW4pIHsKICAgIHZhciBrZiA9IHsKICAg
ICAgdGltZTogdGltZSwKICAgICAgdGFyZ2V0OiB0YXJnZXQsCiAgICAgIHR3ZWVuOiB0d2Vlbgog
ICAgfQogICAgdGhpcy5wZW5kaW5nS2V5ZnJhbWVzLnB1c2goa2YpCiAgfSwKCiAgYXBwZW5kS2V5
ZnJhbWUgOiBmdW5jdGlvbih0aW1lRGVsdGEsIHRhcmdldCwgdHdlZW4pIHsKICAgIHRoaXMubGFz
dEFjdGlvbiArPSB0aW1lRGVsdGEKICAgIHJldHVybiB0aGlzLmFkZEtleWZyYW1lKHRoaXMubGFz
dEFjdGlvbiwgdGFyZ2V0LCB0d2VlbikKICB9LAoKICBldmVyeSA6IGZ1bmN0aW9uKGR1cmF0aW9u
LCBhY3Rpb24sIG5vRmlyc3QpIHsKICAgIHZhciBrZiA9IHsKICAgICAgYWN0aW9uIDogYWN0aW9u
LAogICAgICByZWxhdGl2ZVN0YXJ0VGltZSA6IG5vRmlyc3QgPyBkdXJhdGlvbiA6IDAsCiAgICAg
IHJlcGVhdEV2ZXJ5IDogZHVyYXRpb24KICAgIH0KICAgIHRoaXMuYWRkVGltZWxpbmVFdmVudChr
ZikKICAgIHJldHVybiBrZgogIH0sCgogIGF0IDogZnVuY3Rpb24odGltZSwgYWN0aW9uKSB7CiAg
ICB2YXIga2YgPSB7CiAgICAgIGFjdGlvbiA6IGFjdGlvbiwKICAgICAgc3RhcnRUaW1lIDogdGlt
ZQogICAgfQogICAgdGhpcy5hZGRUaW1lbGluZUV2ZW50KGtmKQogICAgcmV0dXJuIGtmCiAgfSwK
CiAgYWZ0ZXIgOiBmdW5jdGlvbihkdXJhdGlvbiwgYWN0aW9uKSB7CiAgICB2YXIga2YgPSB7CiAg
ICAgIGFjdGlvbiA6IGFjdGlvbiwKICAgICAgcmVsYXRpdmVTdGFydFRpbWUgOiBkdXJhdGlvbgog
ICAgfQogICAgdGhpcy5hZGRUaW1lbGluZUV2ZW50KGtmKQogICAgcmV0dXJuIGtmCiAgfSwKCiAg
YWZ0ZXJGcmFtZSA6IGZ1bmN0aW9uKGR1cmF0aW9uLCBjYWxsYmFjaykgewogICAgdmFyIGVsYXBz
ZWQgPSAwCiAgICB2YXIgYW5pbWF0b3IKICAgIGFuaW1hdG9yID0gZnVuY3Rpb24odCwgZHQpewog
ICAgICBpZiAoZWxhcHNlZCA+PSBkdXJhdGlvbikgewogICAgICAgIGNhbGxiYWNrLmNhbGwodGhp
cykKICAgICAgICB0aGlzLnJlbW92ZUZyYW1lTGlzdGVuZXIoYW5pbWF0b3IpCiAgICAgIH0KICAg
ICAgZWxhcHNlZCsrCiAgICB9CiAgICB0aGlzLmFkZEZyYW1lTGlzdGVuZXIoYW5pbWF0b3IpCiAg
ICByZXR1cm4gYW5pbWF0b3IKICB9LAoKICBldmVyeUZyYW1lIDogZnVuY3Rpb24oZHVyYXRpb24s
IGNhbGxiYWNrLCBub0ZpcnN0KSB7CiAgICB2YXIgZWxhcHNlZCA9IG5vRmlyc3QgPyAwIDogZHVy
YXRpb24KICAgIHZhciBhbmltYXRvcgogICAgYW5pbWF0b3IgPSBmdW5jdGlvbih0LCBkdCl7CiAg
ICAgIGlmIChlbGFwc2VkID49IGR1cmF0aW9uKSB7CiAgICAgICAgaWYgKGNhbGxiYWNrLmNhbGwo
dGhpcykgPT0gZmFsc2UpCiAgICAgICAgICB0aGlzLnJlbW92ZUZyYW1lTGlzdGVuZXIoYW5pbWF0
b3IpCiAgICAgICAgZWxhcHNlZCA9IDAKICAgICAgfQogICAgICBlbGFwc2VkKysKICAgIH0KICAg
IHRoaXMuYWRkRnJhbWVMaXN0ZW5lcihhbmltYXRvcikKICAgIHJldHVybiBhbmltYXRvcgogIH0K
fSkKQW5pbWF0YWJsZS51aWQgPSAwCgoKCi8qKgogIENhbnZhc05vZGUgaXMgdGhlIGJhc2UgQ0FL
RSBzY2VuZWdyYXBoIG5vZGUuIEFsbCB0aGUgb3RoZXIgc2NlbmVncmFwaCBub2RlcwogIGRlcml2
ZSBmcm9tIGl0LiBBIHBsYWluIENhbnZhc05vZGUgZG9lcyBubyBkcmF3aW5nLCBidXQgaXQgY2Fu
IGJlIHVzZWQgZm9yCiAgZ3JvdXBpbmcgb3RoZXIgbm9kZXMgYW5kIHNldHRpbmcgdXAgdGhlIGdy
b3VwJ3MgZHJhd2luZyBzdGF0ZS4KCiAgdmFyIHNjZW5lID0gbmV3IENhbnZhc05vZGUoe3g6IDEw
LCB5OiAxMH0pCgogIFRoZSB1c3VhbCB3YXkgdG8gdXNlIENhbnZhc05vZGVzIGlzIHRvIGFwcGVu
ZCB0aGVtIHRvIGEgQ2FudmFzIG9iamVjdDoKCiAgICB2YXIgc2NlbmUgPSBuZXcgQ2FudmFzTm9k
ZSgpCiAgICBzY2VuZS5hcHBlbmQobmV3IFJlY3RhbmdsZSg0MCwgNDAsIHtmaWxsOiB0cnVlfSkp
CiAgICB2YXIgZWxlbSA9IEUuY2FudmFzKDQwMCwgNDAwKQogICAgdmFyIGNhbnZhcyA9IG5ldyBD
YW52YXMoZWxlbSkKICAgIGNhbnZhcy5hcHBlbmQoc2NlbmUpCgogIFlvdSBjYW4gYWxzbyB1c2Ug
Q2FudmFzTm9kZXMgdG8gZHJhdyBkaXJlY3RseSB0byBhIGNhbnZhcyBlbGVtZW50OgoKICAgIHZh
ciBzY2VuZSA9IG5ldyBDYW52YXNOb2RlKCkKICAgIHNjZW5lLmFwcGVuZChuZXcgQ2lyY2xlKDQw
LCB7eDoyMDAsIHk6MjAwLCBzdHJva2U6IHRydWV9KSkKICAgIHZhciBlbGVtID0gRS5jYW52YXMo
NDAwLCA0MDApCiAgICBzY2VuZS5oYW5kbGVEcmF3KGVsZW0uZ2V0Q29udGV4dCgnMmQnKSkKCiAg
Ki8KQ2FudmFzTm9kZSA9IEtsYXNzKEFuaW1hdGFibGUsIFRyYW5zZm9ybWFibGUsIHsKICBPQkpF
Q1RCT1VORElOR0JPWCA6ICdvYmplY3RCb3VuZGluZ0JveCcsCgogIC8vIHdoZXRoZXIgdG8gZHJh
dyB0aGUgbm9kZSBhbmQgaXRzIGNoaWxkTm9kZXMgb3Igbm90CiAgdmlzaWJsZSA6IHRydWUsCgog
IC8vIHdoZXRoZXIgdG8gZHJhdyB0aGUgbm9kZSAoZG9lc24ndCBhZmZlY3Qgc3VidHJlZSkKICBk
cmF3YWJsZSA6IHRydWUsCgogIC8vIHRoZSBDU1MgZGlzcGxheSBwcm9wZXJ0eSBjYW4gYmUgdXNl
ZCB0byBhZmZlY3QgJ3Zpc2libGUnCiAgLy8gZmFsc2UgICAgID0+IHZpc2libGUgPSB2aXNpYmxl
CiAgLy8gJ25vbmUnICAgID0+IHZpc2libGUgPSBmYWxzZQogIC8vIG90aGVyd2lzZSA9PiB2aXNp
YmxlID0gdHJ1ZQogIGRpc3BsYXkgOiBudWxsLAoKICAvLyB0aGUgQ1NTIHZpc2liaWxpdHkgcHJv
cGVydHkgY2FuIGJlIHVzZWQgdG8gYWZmZWN0ICdkcmF3YWJsZScKICAvLyBmYWxzZSAgICAgPT4g
ZHJhd2FibGUgPSBkcmF3YWJsZQogIC8vICdoaWRkZW4nICA9PiBkcmF3YWJsZSA9IGZhbHNlCiAg
Ly8gb3RoZXJ3aXNlID0+IGRyYXdhYmxlID0gdHJ1ZQogIHZpc2liaWxpdHkgOiBudWxsLAoKICAv
LyB3aGV0aGVyIHRoaXMgYW5kIHRoZSBzdWJ0cmVlIGZyb20gdGhpcyByZWdpc3RlciBtb3VzZSBo
b3ZlcgogIGNhdGNoTW91c2UgOiB0cnVlLAoKICAvLyBXaGV0aGVyIHRoaXMgb2JqZWN0IHJlZ2lz
dGVycyBtb3VzZSBob3Zlci4gT25seSBzZXQgdGhpcyB0byB0cnVlIHdoZW4geW91CiAgLy8gaGF2
ZSBhIGRyYXdhYmxlIG9iamVjdCB0aGF0IGNhbiBiZSBwaWNrZWQuIE90aGVyd2lzZSB0aGUgb2Jq
ZWN0IHJlcXVpcmVzCiAgLy8gYSBtYXRyaXggaW52ZXJzaW9uIG9uIEZpcmVmb3ggMiBhbmQgU2Fm
YXJpLCB3aGljaCBpcyBzbG93LgogIHBpY2thYmxlIDogZmFsc2UsCgogIC8vIHRydWUgaWYgdGhp
cyBub2RlIG9yIG9uZSBvZiBpdHMgZGVzY2VuZGFudHMgaXMgdW5kZXIgdGhlIG1vdXNlCiAgLy8g
Y3Vyc29yIGFuZCBjYXRjaE1vdXNlIGlzIHRydWUKICB1bmRlckN1cnNvciA6IGZhbHNlLAoKICAv
LyB6SW5kZXggaW4gcmVsYXRpb24gdG8gc2libGluZyBub2RlcyAobm90ZTogbm90IGdsb2JhbCkK
ICB6SW5kZXggOiAwLAoKICAvLyB4IHRyYW5zbGF0aW9uIG9mIHRoZSBub2RlCiAgeCA6IDAsCgog
IC8vIHkgdHJhbnNsYXRpb24gb2YgdGhlIG5vZGUKICB5IDogMCwKCiAgLy8gc2NhbGUgZmFjdG9y
OiBudW1iZXIgZm9yIHVuaWZvcm0gc2NhbGluZywgW3gseV0gZm9yIGRpbWVuc2lvbi13aXNlCiAg
c2NhbGUgOiAxLAoKICAvLyBSb3RhdGlvbiBvZiB0aGUgbm9kZSwgaW4gcmFkaWFucy4KICAvLwog
IC8vIFRoZSByb3RhdGlvbiBjYW4gYWxzbyBiZSB0aGUgYXJyYXkgW2FuZ2xlLCBjeCwgY3ldLAog
IC8vIHdoZXJlIGN4IGFuZCBjeSBkZWZpbmUgdGhlIHJvdGF0aW9uIGNlbnRlci4KICAvLwogIC8v
IFRoZSBhcnJheSBmb3JtIGlzIGVxdWl2YWxlbnQgdG8KICAvLyB0cmFuc2xhdGUoY3gsIGN5KTsg
cm90YXRlKGFuZ2xlKTsgdHJhbnNsYXRlKC1jeCwgLWN5KTsKICByb3RhdGlvbiA6IDAsCgogIC8v
IFRyYW5zZm9ybSBtYXRyaXggd2l0aCB3aGljaCB0byBtdWx0aXBseSB0aGUgY3VycmVudCB0cmFu
c2Zvcm0gbWF0cml4LgogIC8vIEFwcGxpZWQgYWZ0ZXIgYWxsIG90aGVyIHRyYW5zZm9ybWF0aW9u
cy4KICBtYXRyaXggOiBudWxsLAoKICAvLyBUcmFuc2Zvcm0gbWF0cml4IHdpdGggd2hpY2ggdG8g
cmVwbGFjZSB0aGUgY3VycmVudCB0cmFuc2Zvcm0gbWF0cml4LgogIC8vIEFwcGxpZWQgYmVmb3Jl
IGFueSBvdGhlciB0cmFuc2Zvcm1hdGlvbi4KICBhYnNvbHV0ZU1hdHJpeCA6IG51bGwsCgogIC8v
IFNWRy1saWtlIGxpc3Qgb2YgdHJhbnNmb3JtYXRpb25zIHRvIGFwcGx5LgogIC8vIFRoZSBkaWZm
ZXJlbnQgdHJhbnNmb3JtYXRpb25zIGFyZToKICAvLyBbJ3RyYW5zbGF0ZScsIFt4LHldXQogIC8v
IFsncm90YXRlJywgW2FuZ2xlLCBjeCwgY3ldXSAtIChvcHRpb25hbCkgY3ggYW5kIGN5IGFyZSB0
aGUgcm90YXRpb24gY2VudGVyCiAgLy8gWydzY2FsZScsIFt4LHldXQogIC8vIFsnbWF0cml4Jywg
W20xMSwgbTEyLCBtMjEsIG0yMiwgZHgsIGR5XV0KICB0cmFuc2Zvcm1MaXN0IDogbnVsbCwKCiAg
Ly8gZmlsbFN0eWxlIGZvciB0aGUgbm9kZSBhbmQgaXRzIGRlc2NlbmRhbnRzCiAgLy8gUG9zc2li
aWxpdGllczoKICAvLyAgIG51bGwgLy8gdXNlIHRoZSBwcmV2aW91cwogIC8vICAgdHJ1ZSAgICAg
IC8vIHVzZSB0aGUgcHJldmlvdXMgYnV0IGRvIGZpbGwKICAvLyAgIGZhbHNlICAgICAvLyB1c2Ug
dGhlIHByZXZpb3VzIGJ1dCBkb24ndCBkbyBmaWxsCiAgLy8gICAnbm9uZScgICAgLy8gdXNlIHRo
ZSBwcmV2aW91cyBidXQgZG9uJ3QgZG8gZmlsbAogIC8vCiAgLy8gICAnd2hpdGUnCiAgLy8gICAn
I2ZmZicKICAvLyAgICcjZmZmZmZmJwogIC8vICAgJ3JnYmEoMjU1LDI1NSwyNTUsIDEuMCknCiAg
Ly8gICBbMjU1LCAyNTUsIDI1NSwgMS4wXQogIC8vICAgbmV3IEdyYWRpZW50KC4uLikKICAvLyAg
IG5ldyBQYXR0ZXJuKG15SW1hZ2UsICduby1yZXBlYXQnKQogIGZpbGwgOiBudWxsLAoKICAvLyBz
dHJva2VTdHlsZSBmb3IgdGhlIG5vZGUgYW5kIGl0cyBkZXNjZW5kYW50cwogIC8vIFBvc3NpYmls
aXRpZXM6CiAgLy8gICBudWxsIC8vIHVzZSB0aGUgcHJldmlvdXMKICAvLyAgIHRydWUgICAgICAv
LyB1c2UgdGhlIHByZXZpb3VzIGJ1dCBkbyBzdHJva2UKICAvLyAgIGZhbHNlICAgICAvLyB1c2Ug
dGhlIHByZXZpb3VzIGJ1dCBkb24ndCBkbyBzdHJva2UKICAvLyAgICdub25lJyAgICAvLyB1c2Ug
dGhlIHByZXZpb3VzIGJ1dCBkb24ndCBkbyBzdHJva2UKICAvLwogIC8vICAgJ3doaXRlJwogIC8v
ICAgJyNmZmYnCiAgLy8gICAnI2ZmZmZmZicKICAvLyAgICdyZ2JhKDI1NSwyNTUsMjU1LCAxLjAp
JwogIC8vICAgWzI1NSwgMjU1LCAyNTUsIDEuMF0KICAvLyAgIG5ldyBHcmFkaWVudCguLi4pCiAg
Ly8gICBuZXcgUGF0dGVybihteUltYWdlLCAnbm8tcmVwZWF0JykKICBzdHJva2UgOiBudWxsLAoK
ICAvLyBzdHJva2UgbGluZSB3aWR0aAogIHN0cm9rZVdpZHRoIDogbnVsbCwKCiAgLy8gc3Ryb2tl
IGxpbmUgY2FwIHN0eWxlICgnYnV0dCcgfCAncm91bmQnIHwgJ3NxdWFyZScpCiAgbGluZUNhcCA6
IG51bGwsCgogIC8vIHN0cm9rZSBsaW5lIGpvaW4gc3R5bGUgKCdiZXZlbCcgfCAncm91bmQnIHwg
J21pdGVyJykKICBsaW5lSm9pbiA6IG51bGwsCgogIC8vIHN0cm9rZSBsaW5lIG1pdGVyIGxpbWl0
CiAgbWl0ZXJMaW1pdCA6IG51bGwsCgogIC8vIHNldCBnbG9iYWxBbHBoYSB0byB0aGlzIHZhbHVl
CiAgYWJzb2x1dGVPcGFjaXR5IDogbnVsbCwKCiAgLy8gbXVsdGlwbHkgZ2xvYmFsQWxwaGEgYnkg
dGhpcyB2YWx1ZQogIG9wYWNpdHkgOiBudWxsLAoKICAvLyBmaWxsIG9wYWNpdHkKICBmaWxsT3Bh
Y2l0eSA6IG51bGwsCgogIC8vIHN0cm9rZSBvcGFjaXR5CiAgc3Ryb2tlT3BhY2l0eSA6IG51bGws
CgogIC8vIHNldCBnbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gdG8gdGhpcyB2YWx1ZQogIC8vIFBv
c3NpYmlsaXRpZXM6CiAgLy8gKCAnc291cmNlLW92ZXInIHwKICAvLyAgICdjb3B5JyB8CiAgLy8g
ICAnbGlnaHRlcicgfAogIC8vICAgJ2RhcmtlcicgfAogIC8vICAgJ3hvcicgfAogIC8vICAgJ3Nv
dXJjZS1pbicgfAogIC8vICAgJ3NvdXJjZS1vdXQnIHwKICAvLyAgICdkZXN0aW5hdGlvbi1vdmVy
JyB8CiAgLy8gICAnZGVzdGluYXRpb24tYXRvcCcgfAogIC8vICAgJ2Rlc3RpbmF0aW9uLWluJyB8
CiAgLy8gICAnZGVzdGluYXRpb24tb3V0JyApCiAgY29tcG9zaXRlT3BlcmF0aW9uIDogbnVsbCwK
CiAgLy8gQ29sb3IgZm9yIHRoZSBkcm9wIHNoYWRvdwogIHNoYWRvd0NvbG9yIDogbnVsbCwKCiAg
Ly8gRHJvcCBzaGFkb3cgYmx1ciByYWRpdXMKICBzaGFkb3dCbHVyIDogbnVsbCwKCiAgLy8gRHJv
cCBzaGFkb3cncyB4LW9mZnNldAogIHNoYWRvd09mZnNldFggOiBudWxsLAoKICAvLyBEcm9wIHNo
YWRvdydzIHktb2Zmc2V0CiAgc2hhZG93T2Zmc2V0WSA6IG51bGwsCgogIC8vIEhUTUw1IHRleHQg
QVBJCiAgZm9udCA6IG51bGwsCiAgLy8gaG9yaXpvbnRhbCBwb3NpdGlvbiBvZiB0aGUgdGV4dCBv
cmlnaW4KICAvLyAnbGVmdCcgfCAnY2VudGVyJyB8ICdyaWdodCcgfCAnc3RhcnQnIHwgJ2VuZCcK
ICB0ZXh0QWxpZ24gOiBudWxsLAogIC8vIHZlcnRpY2FsIHBvc2l0aW9uIG9mIHRoZSB0ZXh0IG9y
aWdpbgogIC8vICd0b3AnIHwgJ2hhbmdpbmcnIHwgJ21pZGRsZScgfCAnYWxwaGFiZXRpYycgfCAn
aWRlb2dyYXBoaWMnIHwgJ2JvdHRvbScKICB0ZXh0QmFzZWxpbmUgOiBudWxsLAoKICBjdXJzb3Ig
OiBudWxsLAoKICBjaGFuZ2VkIDogdHJ1ZSwKCiAgdGFnTmFtZSA6ICdnJywKCiAgZ2V0TmV4dFNp
YmxpbmcgOiBmdW5jdGlvbigpewogICAgaWYgKHRoaXMucGFyZW50Tm9kZSkKICAgICAgcmV0dXJu
IHRoaXMucGFyZW50Tm9kZS5jaGlsZE5vZGVzW3RoaXMucGFyZW50Tm9kZS5jaGlsZE5vZGVzLmlu
ZGV4T2YodGhpcykrMV0KICAgIHJldHVybiBudWxsCiAgfSwKCiAgZ2V0UHJldmlvdXNTaWJsaW5n
IDogZnVuY3Rpb24oKXsKICAgIGlmICh0aGlzLnBhcmVudE5vZGUpCiAgICAgIHJldHVybiB0aGlz
LnBhcmVudE5vZGUuY2hpbGROb2Rlc1t0aGlzLnBhcmVudE5vZGUuY2hpbGROb2Rlcy5pbmRleE9m
KHRoaXMpLTFdCiAgICByZXR1cm4gbnVsbAogIH0sCgogIC8qKgogICAgSW5pdGlhbGl6ZSB0aGUg
Q2FudmFzTm9kZSBhbmQgbWVyZ2UgYW4gb3B0aW9uYWwgY29uZmlnIGhhc2guCiAgICAqLwogIGlu
aXRpYWxpemUgOiBmdW5jdGlvbihjb25maWcpIHsKICAgIHRoaXMucm9vdCA9IHRoaXMKICAgIHRo
aXMuY3VycmVudE1hdHJpeCA9IFsxLDAsMCwxLDAsMF0KICAgIHRoaXMucHJldmlvdXNNYXRyaXgg
PSBbMSwwLDAsMSwwLDBdCiAgICB0aGlzLm5lZWRNYXRyaXhVcGRhdGUgPSB0cnVlCiAgICB0aGlz
LmNoaWxkTm9kZXMgPSBbXQogICAgdGhpcy5mcmFtZUxpc3RlbmVycyA9IFtdCiAgICB0aGlzLmV2
ZW50TGlzdGVuZXJzID0ge30KICAgIEFuaW1hdGFibGUuaW5pdGlhbGl6ZS5jYWxsKHRoaXMpCiAg
ICBpZiAoY29uZmlnKQogICAgICBPYmplY3QuZXh0ZW5kKHRoaXMsIGNvbmZpZykKICB9LAoKICAv
KioKICAgIENyZWF0ZSBhIGNsb25lIG9mIHRoZSBub2RlIGFuZCBpdHMgc3VidHJlZS4KICAgICov
CiAgY2xvbmUgOiBmdW5jdGlvbigpIHsKICAgIHZhciBjID0gT2JqZWN0LmNsb25lKHRoaXMpCiAg
ICBjLnBhcmVudCA9IGMucm9vdCA9IG51bGwKICAgIGZvciAodmFyIGkgaW4gdGhpcykgewogICAg
ICBpZiAodHlwZW9mKHRoaXNbaV0pID09ICdvYmplY3QnKQogICAgICAgIGNbaV0gPSBPYmplY3Qu
Y2xvbmUodGhpc1tpXSkKICAgIH0KICAgIGMucGFyZW50ID0gYy5yb290ID0gbnVsbAogICAgYy5j
aGlsZE5vZGVzID0gW10KICAgIGMuc2V0Um9vdChudWxsKQogICAgZm9yICh2YXIgaT0wOyBpPHRo
aXMuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgY2ggPSB0aGlzLmNoaWxkTm9k
ZXNbaV0uY2xvbmUoKQogICAgICBjLmFwcGVuZChjaCkKICAgIH0KICAgIHJldHVybiBjCiAgfSwK
CiAgY2xvbmVOb2RlIDogZnVuY3Rpb24oKXsgcmV0dXJuIHRoaXMuY2xvbmUoKSB9LAoKICAvKioK
ICAgIEdldHMgbm9kZSBieSBpZC4KICAgICovCiAgZ2V0RWxlbWVudEJ5SWQgOiBmdW5jdGlvbihp
ZCkgewogICAgaWYgKHRoaXMuaWQgPT0gaWQpCiAgICAgIHJldHVybiB0aGlzCiAgICBmb3IgKHZh
ciBpPTA7IGk8dGhpcy5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBuID0gdGhp
cy5jaGlsZE5vZGVzW2ldLmdldEVsZW1lbnRCeUlkKGlkKQogICAgICBpZiAobikgcmV0dXJuIG4K
ICAgIH0KICAgIHJldHVybiBudWxsCiAgfSwKCiAgJCA6IGZ1bmN0aW9uKGlkKSB7CiAgICByZXR1
cm4gdGhpcy5nZXRFbGVtZW50QnlJZChpZCkKICB9LAoKICAvKioKICAgIEFsaWFzIGZvciBhcHBl
bmQoKS4KCiAgICBAcGFyYW0gTm9kZVtzXSB0byBhcHBlbmQKICAgICovCiAgYXBwZW5kQ2hpbGQg
OiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLmFwcGVuZC5hcHBseSh0aGlzLCBhcmd1bWVu
dHMpCiAgfSwKCiAgLyoqCiAgICBBcHBlbmRzIGFyZ3VtZW50cyBhcyBjaGlsZE5vZGVzIHRvIHRo
ZSBub2RlLgoKICAgIEFkZGluZyBhIGNoaWxkIHNldHMgY2hpbGQucGFyZW50IHRvIGJlIHRoZSBu
b2RlIGFuZCBjYWxscwogICAgY2hpbGQuc2V0Um9vdChub2RlLnJvb3QpCgogICAgQHBhcmFtIE5v
ZGVbc10gdG8gYXBwZW5kCiAgICAqLwogIGFwcGVuZCA6IGZ1bmN0aW9uKG9iaikgewogICAgdmFy
IGEgPSAkQShhcmd1bWVudHMpCiAgICBmb3IgKHZhciBpPTA7IGk8YS5sZW5ndGg7IGkrKykgewog
ICAgICBpZiAoYVtpXS5wYXJlbnQpIGFbaV0ucmVtb3ZlU2VsZigpCiAgICAgIHRoaXMuY2hpbGRO
b2Rlcy5wdXNoKGFbaV0pCiAgICAgIGFbaV0ucGFyZW50ID0gYVtpXS5wYXJlbnROb2RlID0gdGhp
cwogICAgICBhW2ldLnNldFJvb3QodGhpcy5yb290KQogICAgfQogICAgdGhpcy5jaGFuZ2VkID0g
dHJ1ZQogIH0sCgogIC8qKgogICAgUmVtb3ZlcyBhbGwgY2hpbGROb2RlcyBmcm9tIHRoZSBub2Rl
LgogICAgKi8KICByZW1vdmVBbGxDaGlsZHJlbiA6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5yZW1v
dmUuYXBwbHkodGhpcywgdGhpcy5jaGlsZE5vZGVzKQogIH0sCgogIC8qKgogICAgQWxpYXMgZm9y
IHJlbW92ZSgpLgoKICAgIEBwYXJhbSBOb2RlW3NdIHRvIHJlbW92ZQogICAgKi8KICByZW1vdmVD
aGlsZCA6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMucmVtb3ZlLmFwcGx5KHRoaXMsIGFy
Z3VtZW50cykKICB9LAoKICAvKioKICAgIFJlbW92ZXMgYXJndW1lbnRzIGZyb20gdGhlIG5vZGUn
cyBjaGlsZE5vZGVzLgoKICAgIFJlbW92aW5nIGEgY2hpbGQgc2V0cyBpdHMgcGFyZW50IHRvIG51
bGwgYW5kIGNhbGxzCiAgICBjaGlsZC5zZXRSb290KG51bGwpCgogICAgQHBhcmFtIENoaWxkIG5v
ZGVbc10gdG8gcmVtb3ZlCiAgICAqLwogIHJlbW92ZSA6IGZ1bmN0aW9uKG9iaikgewogICAgdmFy
IGEgPSBhcmd1bWVudHMKICAgIGZvciAodmFyIGk9MDsgaTxhLmxlbmd0aDsgaSsrKSB7CiAgICAg
IHRoaXMuY2hpbGROb2Rlcy5kZWxldGVGaXJzdChhW2ldKQogICAgICBkZWxldGUgYVtpXS5wYXJl
bnQKICAgICAgZGVsZXRlIGFbaV0ucGFyZW50Tm9kZQogICAgICBhW2ldLnNldFJvb3QobnVsbCkK
ICAgIH0KICAgIHRoaXMuY2hhbmdlZCA9IHRydWUKICB9LAoKICAvKioKICAgIENhbGxzIHRoaXMu
cGFyZW50LnJlbW92ZUNoaWxkKHRoaXMpIGlmIHRoaXMucGFyZW50IGlzIHNldC4KICAgICovCiAg
cmVtb3ZlU2VsZiA6IGZ1bmN0aW9uKCkgewogICAgaWYgKHRoaXMucGFyZW50Tm9kZSkgewogICAg
ICB0aGlzLnBhcmVudE5vZGUucmVtb3ZlKHRoaXMpCiAgICB9CiAgfSwKCiAgLyoqCiAgICBSZXR1
cm5zIHRydWUgaWYgdGhpcyBub2RlJ3Mgc3VidHJlZSBjb250YWlucyBvYmouIChJLmUuIG9iaiBp
cyB0aGlzIG9yCiAgICBvYmoncyBwYXJlbnQgY2hhaW4gaW5jbHVkZXMgdGhpcy4pCgogICAgQHBh
cmFtIG9iaiBOb2RlIHRvIGxvb2sgZm9yCiAgICBAcmV0dXJuIFRydWUgaWYgb2JqIGlzIGluIHRo
aXMgbm9kZSdzIHN1YnRyZWUsIGZhbHNlIGlmIGl0IGlzbid0LgogICAgKi8KICBjb250YWlucyA6
IGZ1bmN0aW9uKG9iaikgewogICAgd2hpbGUgKG9iaikgewogICAgICBpZiAob2JqID09IHRoaXMp
IHJldHVybiB0cnVlCiAgICAgIG9iaiA9IG9iai5wYXJlbnROb2RlCiAgICB9CiAgICByZXR1cm4g
ZmFsc2UKICB9LAoKICAvKioKICAgIFNldCB0aGlzLnJvb3QgdG8gdGhlIGdpdmVuIHZhbHVlIGFu
ZCBwcm9wYWdhdGUgdGhlIHVwZGF0ZSB0byBjaGlsZE5vZGVzLgoKICAgIEBwYXJhbSByb290IFRo
ZSBuZXcgcm9vdCBub2RlCiAgICBAcHJpdmF0ZQogICAgKi8KICBzZXRSb290IDogZnVuY3Rpb24o
cm9vdCkgewogICAgaWYgKCFyb290KSByb290ID0gdGhpcwogICAgdGhpcy5kaXNwYXRjaEV2ZW50
KHt0eXBlOiAncm9vdENoYW5nZWQnLCBjYW52YXNUYXJnZXQ6IHRoaXMsIHJlbGF0ZWRUYXJnZXQ6
IHJvb3R9KQogICAgdGhpcy5yb290ID0gcm9vdAogICAgZm9yICh2YXIgaT0wOyBpPHRoaXMuY2hp
bGROb2Rlcy5sZW5ndGg7IGkrKykKICAgICAgdGhpcy5jaGlsZE5vZGVzW2ldLnNldFJvb3Qocm9v
dCkKICB9LAoKICAvKioKICAgIEFkZHMgYSBjYWxsYmFjayBmdW5jdGlvbiB0byBiZSBjYWxsZWQg
YmVmb3JlIGRyYXdpbmcgZWFjaCBmcmFtZS4KCiAgICBAcGFyYW0gZiBDYWxsYmFjayBmdW5jdGlv
bgogICAgKi8KICBhZGRGcmFtZUxpc3RlbmVyIDogZnVuY3Rpb24oZikgewogICAgdGhpcy5mcmFt
ZUxpc3RlbmVycy5wdXNoKGYpCiAgfSwKCiAgLyoqCiAgICBSZW1vdmVzIGEgY2FsbGJhY2sgZnVu
Y3Rpb24gZnJvbSB1cGRhdGUgY2FsbGJhY2tzLgoKICAgIEBwYXJhbSBmIENhbGxiYWNrIGZ1bmN0
aW9uCiAgICAqLwogIHJlbW92ZUZyYW1lTGlzdGVuZXIgOiBmdW5jdGlvbihmKSB7CiAgICB0aGlz
LmZyYW1lTGlzdGVuZXJzLmRlbGV0ZUZpcnN0KGYpCiAgfSwKCiAgYWRkRXZlbnRMaXN0ZW5lciA6
IGZ1bmN0aW9uKHR5cGUsIGxpc3RlbmVyLCBjYXB0dXJlKSB7CiAgICBpZiAoIXRoaXMuZXZlbnRM
aXN0ZW5lcnNbdHlwZV0pCiAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnNbdHlwZV0gPSB7Y2FwdHVy
ZTpbXSwgYnViYmxlOltdfQogICAgdGhpcy5ldmVudExpc3RlbmVyc1t0eXBlXVtjYXB0dXJlID8g
J2NhcHR1cmUnIDogJ2J1YmJsZSddLnB1c2gobGlzdGVuZXIpCiAgfSwKCiAgLyoqCiAgICBTeW5v
bnltIGZvciBhZGRFdmVudExpc3RlbmVyLgogICovCiAgd2hlbiA6IGZ1bmN0aW9uKHR5cGUsIGxp
c3RlbmVyLCBjYXB0dXJlKSB7CiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVu
ZXIsIGNhcHR1cmUgfHwgZmFsc2UpCiAgfSwKCiAgcmVtb3ZlRXZlbnRMaXN0ZW5lciA6IGZ1bmN0
aW9uKHR5cGUsIGxpc3RlbmVyLCBjYXB0dXJlKSB7CiAgICBpZiAoIXRoaXMuZXZlbnRMaXN0ZW5l
cnNbdHlwZV0pIHJldHVybgogICAgdGhpcy5ldmVudExpc3RlbmVyc1t0eXBlXVtjYXB0dXJlID8g
J2NhcHR1cmUnIDogJ2J1YmJsZSddLmRlbGV0ZUZpcnN0KGxpc3RlbmVyKQogICAgaWYgKHRoaXMu
ZXZlbnRMaXN0ZW5lcnNbdHlwZV0uY2FwdHVyZS5sZW5ndGggPT0gMCAmJgogICAgICAgIHRoaXMu
ZXZlbnRMaXN0ZW5lcnNbdHlwZV0uYnViYmxlLmxlbmd0aCA9PSAwKQogICAgICBkZWxldGUgdGhp
cy5ldmVudExpc3RlbmVyc1t0eXBlXQogIH0sCgogIGRpc3BhdGNoRXZlbnQgOiBmdW5jdGlvbihl
dmVudCkgewogICAgdmFyIHR5cGUgPSBldmVudC50eXBlCiAgICBpZiAoIWV2ZW50LmNhbnZhc1Rh
cmdldCkgewogICAgICBpZiAodHlwZS5zZWFyY2goL14oa2V5fHRleHQpL2kpID09IDApIHsKICAg
ICAgICBldmVudC5jYW52YXNUYXJnZXQgPSB0aGlzLnJvb3QuZm9jdXNlZCB8fCB0aGlzLnJvb3Qu
dGFyZ2V0CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZXZlbnQuY2FudmFzVGFyZ2V0ID0gdGhpcy5y
b290LnRhcmdldAogICAgICB9CiAgICAgIGlmICghZXZlbnQuY2FudmFzVGFyZ2V0KQogICAgICAg
IGV2ZW50LmNhbnZhc1RhcmdldCA9IHRoaXMKICAgIH0KICAgIHZhciBwYXRoID0gW10KICAgIHZh
ciBvYmogPSBldmVudC5jYW52YXNUYXJnZXQKICAgIHdoaWxlIChvYmogJiYgb2JqICE9IHRoaXMp
IHsKICAgICAgcGF0aC5wdXNoKG9iaikKICAgICAgb2JqID0gb2JqLnBhcmVudAogICAgfQogICAg
cGF0aC5wdXNoKHRoaXMpCiAgICBldmVudC5jYW52YXNQaGFzZSA9ICdjYXB0dXJlJwogICAgZm9y
ICh2YXIgaT1wYXRoLmxlbmd0aC0xOyBpPj0wOyBpLS0pCiAgICAgIGlmICghcGF0aFtpXS5oYW5k
bGVFdmVudChldmVudCkpIHJldHVybiBmYWxzZQogICAgZXZlbnQuY2FudmFzUGhhc2UgPSAnYnVi
YmxlJwogICAgZm9yICh2YXIgaT0wOyBpPHBhdGgubGVuZ3RoOyBpKyspCiAgICAgIGlmICghcGF0
aFtpXS5oYW5kbGVFdmVudChldmVudCkpIHJldHVybiBmYWxzZQogICAgcmV0dXJuIHRydWUKICB9
LAoKICBicm9hZGNhc3RFdmVudCA6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICB2YXIgdHlwZSA9IGV2
ZW50LnR5cGUKICAgIGV2ZW50LmNhbnZhc1BoYXNlID0gJ2NhcHR1cmUnCiAgICBpZiAoIXRoaXMu
aGFuZGxlRXZlbnQoZXZlbnQpKSByZXR1cm4gZmFsc2UKICAgIGZvciAodmFyIGk9MDsgaTx0aGlz
LmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspCiAgICAgIGlmICghdGhpcy5jaGlsZE5vZGVzW2ldLmJy
b2FkY2FzdEV2ZW50KGV2ZW50KSkgcmV0dXJuIGZhbHNlCiAgICBldmVudC5jYW52YXNQaGFzZSA9
ICdidWJibGUnCiAgICBpZiAoIXRoaXMuaGFuZGxlRXZlbnQoZXZlbnQpKSByZXR1cm4gZmFsc2UK
ICAgIHJldHVybiB0cnVlCiAgfSwKCiAgaGFuZGxlRXZlbnQgOiBmdW5jdGlvbihldmVudCkgewog
ICAgdmFyIHR5cGUgPSBldmVudC50eXBlCiAgICB2YXIgcGhhc2UgPSBldmVudC5jYW52YXNQaGFz
ZQogICAgaWYgKHRoaXMuY3Vyc29yICYmIHBoYXNlID09ICdjYXB0dXJlJykKICAgICAgZXZlbnQu
Y3Vyc29yID0gdGhpcy5jdXJzb3IKICAgIHZhciBlbHMgPSB0aGlzLmV2ZW50TGlzdGVuZXJzW3R5
cGVdCiAgICBlbHMgPSBlbHMgJiYgZWxzW3BoYXNlXQogICAgaWYgKGVscykgewogICAgICBmb3Ig
KHZhciBpPTA7IGk8ZWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIHJ2ID0gZWxzW2ldLmNh
bGwodGhpcywgZXZlbnQpCiAgICAgICAgaWYgKHJ2ID09IGZhbHNlIHx8IGV2ZW50LnN0b3BwZWQp
IHsKICAgICAgICAgIGlmICghZXZlbnQuc3RvcHBlZCkKICAgICAgICAgICAgZXZlbnQuc3RvcFBy
b3BhZ2F0aW9uKCkKICAgICAgICAgIGV2ZW50LnN0b3BwZWQgPSB0cnVlCiAgICAgICAgICByZXR1
cm4gZmFsc2UKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cnVlCiAgfSwKCiAg
LyoqCiAgICBIYW5kbGUgc2NlbmVncmFwaCB1cGRhdGUuCiAgICBDYWxsZWQgd2l0aCBjdXJyZW50
IHRpbWUgYmVmb3JlIGRyYXdpbmcgZWFjaCBmcmFtZS4KCiAgICBUaGlzIG1ldGhvZCBzaG91bGQg
YmUgdG91Y2hlZCBvbmx5IGlmIHlvdSBrbm93IHdoYXQgeW91J3JlIGRvaW5nLgogICAgSWYgeW91
IG5lZWQgeW91ciBvd24gdXBkYXRlIGhhbmRsZXIsIGVpdGhlciBhZGQgYSBmcmFtZSBsaXN0ZW5l
ciBvcgogICAgb3ZlcndyaXRlIHtAbGluayBDYW52YXNOb2RlI3VwZGF0ZX0uCgogICAgQHBhcmFt
IHRpbWUgQ3VycmVudCBhbmltYXRpb24gdGltZQogICAgQHBhcmFtIHRpbWVEZWx0YSBUaW1lIHNp
bmNlIGxhc3QgZnJhbWUgaW4gbWlsbGlzZWNvbmRzCiAgICAqLwogIGhhbmRsZVVwZGF0ZSA6IGZ1
bmN0aW9uKHRpbWUsIHRpbWVEZWx0YSkgewogICAgdGhpcy51cGRhdGUodGltZSwgdGltZURlbHRh
KQogICAgdGhpcy53aWxsQmVEcmF3biA9ICghdGhpcy5wYXJlbnQgfHwgdGhpcy5wYXJlbnQud2ls
bEJlRHJhd24pICYmICh0aGlzLmRpc3BsYXkgPyB0aGlzLmRpc3BsYXkgIT0gJ25vbmUnIDogdGhp
cy52aXNpYmxlKQogICAgZm9yKHZhciBpPTA7IGk8dGhpcy5jaGlsZE5vZGVzLmxlbmd0aDsgaSsr
KQogICAgICB0aGlzLmNoaWxkTm9kZXNbaV0uaGFuZGxlVXBkYXRlKHRpbWUsIHRpbWVEZWx0YSkK
ICAgIC8vIFRPRE8gcHJvcGFnYXRlIGRpcnR5IGFyZWEgYmJveCB1cCB0aGUgc2NlbmUgZ3JhcGgK
ICAgIGlmICh0aGlzLnBhcmVudCAmJiB0aGlzLmNoYW5nZWQpIHsKICAgICAgdGhpcy5wYXJlbnQu
Y2hhbmdlZCA9IHRoaXMuY2hhbmdlZAogICAgICB0aGlzLmNoYW5nZWQgPSBmYWxzZQogICAgfQog
ICAgdGhpcy5uZWVkTWF0cml4VXBkYXRlID0gdHJ1ZQogIH0sCgogIC8qKgogICAgVXBkYXRlIHRo
aXMgbm9kZS4gQ2FsbHMgYWxsIGZyYW1lIGxpc3RlbmVyIGNhbGxiYWNrcyBpbiB0aGUgb3JkZXIg
dGhleQogICAgd2VyZSBhZGRlZC4KCiAgICBPdmVyd3JpdGUgdGhpcyB3aXRoIHlvdXIgb3duIG1l
dGhvZCBpZiB5b3Ugd2FudCB0byBkbyB0aGluZ3MgZGlmZmVyZW50bHkuCgogICAgQHBhcmFtIHRp
bWUgQ3VycmVudCBhbmltYXRpb24gdGltZQogICAgQHBhcmFtIHRpbWVEZWx0YSBUaW1lIHNpbmNl
IGxhc3QgZnJhbWUgaW4gbWlsbGlzZWNvbmRzCiAgICAqLwogIHVwZGF0ZSA6IGZ1bmN0aW9uKHRp
bWUsIHRpbWVEZWx0YSkgewogICAgLy8gbmVlZCB0byBvcGVyYXRlIG9uIGEgY29weSwgb3RoZXJ3
aXNlIGJhZCBzdHVmZiBoYXBwZW5zCiAgICB2YXIgZmwgPSB0aGlzLmZyYW1lTGlzdGVuZXJzLnNs
aWNlKDApCiAgICBmb3IodmFyIGk9MDsgaTxmbC5sZW5ndGg7IGkrKykgewogICAgICBpZiAodGhp
cy5mcmFtZUxpc3RlbmVycy5pbmNsdWRlcyhmbFtpXSkpCiAgICAgICAgZmxbaV0uYXBwbHkodGhp
cywgYXJndW1lbnRzKQogICAgfQogIH0sCgogIC8qKgogICAgVGVzdHMgaWYgdGhpcyBub2RlIG9y
IGl0cyBzdWJ0cmVlIGlzIHVuZGVyIHRoZSBtb3VzZSBjdXJzb3IgYW5kCiAgICBzZXRzIHRoaXMu
dW5kZXJDdXJzb3IgYWNjb3JkaW5nbHkuCgogICAgSWYgdGhpcyBub2RlIChhbmQgbm90IG9uZSBv
ZiBpdHMgY2hpbGROb2RlcykgaXMgdW5kZXIgdGhlIG1vdXNlIGN1cnNvcgogICAgdGhpcy5yb290
LnRhcmdldCBpcyBzZXQgdG8gdGhpcy4gVGhpcyB3YXksIHRoZSB0b3Btb3N0ICg9PSBkcmF3biBs
YXN0KQogICAgbm9kZSB1bmRlciB0aGUgbW91c2UgY3Vyc29yIGlzIHRoZSByb290IHRhcmdldC4K
CiAgICBUbyBzZWUgd2hldGhlciBhIHN1YnRyZWUgbm9kZSBpcyB0aGUgY3VycmVudCB0YXJnZXQ6
CgogICAgaWYgKHRoaXMudW5kZXJDdXJzb3IgJiYgdGhpcy5jb250YWlucyh0aGlzLnJvb3QudGFy
Z2V0KSkgewogICAgICAvLyB3ZSBhcmUgdGhlIHRhcmdldCwgbGV0J3Mgcm9sbAogICAgfQoKICAg
IFRoaXMgbWV0aG9kIHNob3VsZCBiZSB0b3VjaGVkIG9ubHkgaWYgeW91IGtub3cgd2hhdCB5b3Un
cmUgZG9pbmcuCiAgICBPdmVyd3JpdGUge0BsaW5rIENhbnZhc05vZGUjZHJhd1BpY2tpbmdQYXRo
fSB0byBjaGFuZ2UgdGhlIHdheSB0aGUgbm9kZSdzCiAgICBwaWNraW5nIHBhdGggaXMgY3JlYXRl
ZC4KCiAgICBDYWxsZWQgYWZ0ZXIgaGFuZGxlVXBkYXRlLCBidXQgYmVmb3JlIGhhbmRsZURyYXcu
CgogICAgQHBhcmFtIGN0eCBDYW52YXMgMkQgY29udGV4dAogICAgKi8KICBoYW5kbGVQaWNrIDog
ZnVuY3Rpb24oY3R4KSB7CiAgICAvLyBDU1MgZGlzcGxheSAmIHZpc2liaWxpdHkKICAgIGlmICh0
aGlzLmRpc3BsYXkpCiAgICAgIHRoaXMudmlzaWJsZSA9ICh0aGlzLmRpc3BsYXkgIT0gJ25vbmUn
KQogICAgaWYgKHRoaXMudmlzaWJpbGl0eSkKICAgICAgdGhpcy5kcmF3YWJsZSA9ICh0aGlzLnZp
c2liaWxpdHkgIT0gJ2hpZGRlbicpCiAgICB0aGlzLnVuZGVyQ3Vyc29yID0gZmFsc2UKICAgIGlm
ICh0aGlzLnZpc2libGUgJiYgdGhpcy5jYXRjaE1vdXNlICYmIHRoaXMucm9vdC5hYnNvbHV0ZU1v
dXNlWCAhPSBudWxsKSB7CiAgICAgIGN0eC5zYXZlKCkKICAgICAgdGhpcy50cmFuc2Zvcm0oY3R4
LCB0cnVlKQogICAgICBpZiAodGhpcy5waWNrYWJsZSAmJiB0aGlzLmRyYXdhYmxlKSB7CiAgICAg
ICAgaWYgKGN0eC5pc1BvaW50SW5QYXRoKSB7CiAgICAgICAgICBjdHguYmVnaW5QYXRoKCkKICAg
ICAgICAgIGlmICh0aGlzLmRyYXdQaWNraW5nUGF0aCkKICAgICAgICAgICAgdGhpcy5kcmF3UGlj
a2luZ1BhdGgoY3R4KQogICAgICAgIH0KICAgICAgICB0aGlzLnVuZGVyQ3Vyc29yID0gQ2FudmFz
U3VwcG9ydC5pc1BvaW50SW5QYXRoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlz
LmRyYXdQaWNraW5nUGF0aCA/IGN0eCA6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB0aGlzLnJvb3QubW91c2VYLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlz
LnJvb3QubW91c2VZLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRN
YXRyaXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMpCiAgICAgICAgaWYgKHRo
aXMudW5kZXJDdXJzb3IpCiAgICAgICAgICB0aGlzLnJvb3QudGFyZ2V0ID0gdGhpcwogICAgICB9
IGVsc2UgewogICAgICAgIHRoaXMudW5kZXJDdXJzb3IgPSBmYWxzZQogICAgICB9CiAgICAgIHZh
ciBjID0gdGhpcy5fX2dldENoaWxkcmVuQ29weSgpCiAgICAgIHRoaXMuX196U29ydChjKQogICAg
ICBmb3IodmFyIGk9MDsgaTxjLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY1tpXS5oYW5kbGVQaWNr
KGN0eCkKICAgICAgICBpZiAoIXRoaXMudW5kZXJDdXJzb3IpCiAgICAgICAgICB0aGlzLnVuZGVy
Q3Vyc29yID0gY1tpXS51bmRlckN1cnNvcgogICAgICB9CiAgICAgIGN0eC5yZXN0b3JlKCkKICAg
IH0gZWxzZSB7CiAgICAgIHZhciBjID0gdGhpcy5fX2dldENoaWxkcmVuQ29weSgpCiAgICAgIHdo
aWxlIChjLmxlbmd0aCA+IDApIHsKICAgICAgICB2YXIgYzAgPSBjLnBvcCgpCiAgICAgICAgaWYg
KGMwLnVuZGVyQ3Vyc29yKSB7CiAgICAgICAgICBjMC51bmRlckN1cnNvciA9IGZhbHNlCiAgICAg
ICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShjLCBjMC5jaGlsZE5vZGVzKQogICAgICAg
IH0KICAgICAgfQogICAgfQogIH0sCgogIF9felNvcnQgOiBmdW5jdGlvbihjKSB7CiAgICBjLnN0
YWJsZVNvcnQoZnVuY3Rpb24oYzEsYzIpIHsgcmV0dXJuIGMxLnpJbmRleCAtIGMyLnpJbmRleDsg
fSk7CiAgfSwKCiAgX19nZXRDaGlsZHJlbkNvcHkgOiBmdW5jdGlvbigpIHsKICAgIGlmICh0aGlz
Ll9fY2hpbGROb2Rlc0NvcHkpIHsKICAgICAgd2hpbGUgKHRoaXMuX19jaGlsZE5vZGVzQ29weS5s
ZW5ndGggPiB0aGlzLmNoaWxkTm9kZXMubGVuZ3RoKQogICAgICAgIHRoaXMuX19jaGlsZE5vZGVz
Q29weS5wb3AoKQogICAgICBmb3IgKHZhciBpPTA7IGk8dGhpcy5jaGlsZE5vZGVzLmxlbmd0aDsg
aSsrKQogICAgICAgIHRoaXMuX19jaGlsZE5vZGVzQ29weVtpXSA9IHRoaXMuY2hpbGROb2Rlc1tp
XQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5fX2NoaWxkTm9kZXNDb3B5ID0gdGhpcy5jaGlsZE5v
ZGVzLnNsaWNlKDApCiAgICB9CiAgICByZXR1cm4gdGhpcy5fX2NoaWxkTm9kZXNDb3B5CiAgfSwK
CiAgLyoqCiAgICBSZXR1cm5zIHRydWUgaWYgdGhlIHBvaW50IHgseSBpcyBpbnNpZGUgdGhlIHBh
dGggb2YgYSBkcmF3YWJsZSBub2RlLgoKICAgIFRoZSB4LHkgcG9pbnQgaXMgaW4gdXNlci1zcGFj
ZSBjb29yZGluYXRlcywgbWVhbmluZyB0aGF0IGUuZy4gdGhlIHBvaW50CiAgICA1LDUgd2lsbCBh
bHdheXMgYmUgaW5zaWRlIHRoZSByZWN0YW5nbGUgWzAsIDAsIDEwLCAxMF0sIHJlZ2FyZGxlc3Mg
b2YgdGhlCiAgICB0cmFuc2Zvcm0gb24gdGhlIHJlY3RhbmdsZS4KCiAgICBMZWF2ZSBpc1BvaW50
SW5QYXRoIHRvIGZhbHNlIHRvIGF2b2lkIHVubmVjZXNzYXJ5IG1hdHJpeCBpbnZlcnNpb25zIGZv
cgogICAgbm9uLWRyYXdhYmxlcy4KCiAgICBAcGFyYW0geCBYLWNvb3JkaW5hdGUgb2YgdGhlIHBv
aW50LgogICAgQHBhcmFtIHkgWS1jb29yZGluYXRlIG9mIHRoZSBwb2ludC4KICAgIEByZXR1cm4g
V2hldGhlciB0aGUgcG9pbnQgaXMgaW5zaWRlIHRoZSBwYXRoIG9mIHRoaXMgbm9kZS4KICAgIEB0
eXBlIGJvb2xlYW4KICAgICovCiAgaXNQb2ludEluUGF0aCA6IGZhbHNlLAoKICAvKioKICAgIEhh
bmRsZXMgdHJhbnNmb3JtaW5nIGFuZCBkcmF3aW5nIHRoZSBub2RlIGFuZCBpdHMgY2hpbGROb2Rl
cwogICAgb24gZWFjaCBmcmFtZS4KCiAgICBQdXNoZXMgY29udGV4dCBzdGF0ZSwgYXBwbGllcyBz
dGF0ZSB0cmFuc2Zvcm1zIGFuZCBkcmF3cyB0aGUgbm9kZS4KICAgIFRoZW4gc29ydHMgdGhlIG5v
ZGUncyBjaGlsZE5vZGVzIGJ5IHpJbmRleCwgc21hbGxlc3QgZmlyc3QsIGFuZAogICAgY2FsbHMg
dGhlaXIgaGFuZGxlRHJhd3MgaW4gdGhhdCBvcmRlci4gRmluYWxseSwgcG9wcyB0aGUgY29udGV4
dCBzdGF0ZS4KCiAgICBDYWxsZWQgYWZ0ZXIgaGFuZGxlVXBkYXRlIGFuZCBoYW5kbGVQaWNrLgoK
ICAgIFRoaXMgbWV0aG9kIHNob3VsZCBiZSB0b3VjaGVkIG9ubHkgaWYgeW91IGtub3cgd2hhdCB5
b3UncmUgZG9pbmcuCiAgICBPdmVyd3JpdGUge0BsaW5rIENhbnZhc05vZGUjZHJhd30gd2hlbiB5
b3UgbmVlZCB0byBkcmF3IHRoaW5ncy4KCiAgICBAcGFyYW0gY3R4IENhbnZhcyAyRCBjb250ZXh0
CiAgICAqLwogIGhhbmRsZURyYXcgOiBmdW5jdGlvbihjdHgpIHsKICAgIC8vIENTUyBkaXNwbGF5
ICYgdmlzaWJpbGl0eQogICAgaWYgKHRoaXMuZGlzcGxheSkKICAgICAgdGhpcy52aXNpYmxlID0g
KHRoaXMuZGlzcGxheSAhPSAnbm9uZScpCiAgICBpZiAodGhpcy52aXNpYmlsaXR5KQogICAgICB0
aGlzLmRyYXdhYmxlID0gKHRoaXMudmlzaWJpbGl0eSAhPSAnaGlkZGVuJykKICAgIGlmICghdGhp
cy52aXNpYmxlKSByZXR1cm4KICAgIGN0eC5zYXZlKCkKICAgIHZhciBwZmYgPSBjdHguZm9udEZh
bWlseQogICAgdmFyIHBmcyA9IGN0eC5mb250U2l6ZQogICAgdmFyIHBmbyA9IGN0eC5maWxsT24K
ICAgIHZhciBwc28gPSBjdHguc3Ryb2tlT24KICAgIGlmICh0aGlzLmZvbnRGYW1pbHkpCiAgICAg
IGN0eC5mb250RmFtaWx5ID0gdGhpcy5mb250RmFtaWx5CiAgICBpZiAodGhpcy5mb250U2l6ZSkK
ICAgICAgY3R4LmZvbnRTaXplID0gdGhpcy5mb250U2l6ZQogICAgdGhpcy50cmFuc2Zvcm0oY3R4
KQogICAgaWYgKHRoaXMuY2xpcFBhdGgpIHsKICAgICAgY3R4LmJlZ2luUGF0aCgpCiAgICAgIGlm
ICh0aGlzLmNsaXBQYXRoLnVuaXRzID09IHRoaXMuT0JKRUNUQk9VTkRJTkdCT1gpIHsKICAgICAg
ICB2YXIgYmIgPSB0aGlzLmdldFN1YnRyZWVCb3VuZGluZ0JveCh0cnVlKQogICAgICAgIGN0eC5z
YXZlKCkKICAgICAgICBjdHgudHJhbnNsYXRlKGJiWzBdLCBiYlsxXSkKICAgICAgICBjdHguc2Nh
bGUoYmJbMl0sIGJiWzNdKQogICAgICAgIHRoaXMuY2xpcFBhdGguY3JlYXRlU3VidHJlZVBhdGgo
Y3R4LCB0cnVlKQogICAgICAgIGN0eC5yZXN0b3JlKCkKICAgICAgICBjdHguY2xpcCgpCiAgICAg
IH0gZWxzZSB7CiAgICAgICAgdGhpcy5jbGlwUGF0aC5jcmVhdGVTdWJ0cmVlUGF0aChjdHgsIHRy
dWUpCiAgICAgICAgY3R4LmNsaXAoKQogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5kcmF3YWJs
ZSAmJiB0aGlzLmRyYXcpCiAgICAgIHRoaXMuZHJhdyhjdHgpCiAgICB2YXIgYyA9IHRoaXMuX19n
ZXRDaGlsZHJlbkNvcHkoKQogICAgdGhpcy5fX3pTb3J0KGMpOwogICAgZm9yKHZhciBpPTA7IGk8
Yy5sZW5ndGg7IGkrKykgewogICAgICBjW2ldLmhhbmRsZURyYXcoY3R4KQogICAgfQogICAgY3R4
LmZvbnRGYW1pbHkgPSBwZmYKICAgIGN0eC5mb250U2l6ZSA9IHBmcwogICAgY3R4LmZpbGxPbiA9
IHBmbwogICAgY3R4LnN0cm9rZU9uID0gcHNvCiAgICBjdHgucmVzdG9yZSgpCiAgfSwKCiAgLyoq
CiAgICBUcmFuc2Zvcm1zIHRoZSBjb250ZXh0IHN0YXRlIGFjY29yZGluZyB0byB0aGlzIG5vZGUn
cyBhdHRyaWJ1dGVzLgoKICAgIEBwYXJhbSBjdHggQ2FudmFzIDJEIGNvbnRleHQKICAgIEBwYXJh
bSBvbmx5VHJhbnNmb3JtIElmIHNldCB0byB0cnVlLCBvbmx5IGRvIG1hdHJpeCB0cmFuc2Zvcm1z
LgogICAgKi8KICB0cmFuc2Zvcm0gOiBmdW5jdGlvbihjdHgsIG9ubHlUcmFuc2Zvcm0pIHsKICAg
IFRyYW5zZm9ybWFibGUucHJvdG90eXBlLnRyYW5zZm9ybS5jYWxsKHRoaXMsIGN0eCkKCiAgICBp
ZiAob25seVRyYW5zZm9ybSkgcmV0dXJuCgogICAgLy8gc3Ryb2tlIC8gZmlsbCBtb2RpZmllcnMK
ICAgIGlmICh0aGlzLmZpbGwgIT0gbnVsbCkgewogICAgICBpZiAoIXRoaXMuZmlsbCB8fCB0aGlz
LmZpbGwgPT0gJ25vbmUnKSB7CiAgICAgICAgY3R4LmZpbGxPbiA9IGZhbHNlCiAgICAgIH0gZWxz
ZSB7CiAgICAgICAgY3R4LmZpbGxPbiA9IHRydWUKICAgICAgICBpZiAodGhpcy5maWxsICE9IHRy
dWUpIHsKICAgICAgICAgIHZhciBmaWxsU3R5bGUgPSBDb2xvcnMucGFyc2VDb2xvclN0eWxlKHRo
aXMuZmlsbCwgY3R4KQogICAgICAgICAgY3R4LnNldEZpbGxTdHlsZSggZmlsbFN0eWxlICkKICAg
ICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmICh0aGlzLnN0cm9rZSAhPSBudWxsKSB7CiAgICAg
IGlmICghdGhpcy5zdHJva2UgfHwgdGhpcy5zdHJva2UgPT0gJ25vbmUnKSB7CiAgICAgICAgY3R4
LnN0cm9rZU9uID0gZmFsc2UKICAgICAgfSBlbHNlIHsKICAgICAgICBjdHguc3Ryb2tlT24gPSB0
cnVlCiAgICAgICAgaWYgKHRoaXMuc3Ryb2tlICE9IHRydWUpCiAgICAgICAgICBjdHguc2V0U3Ry
b2tlU3R5bGUoIENvbG9ycy5wYXJzZUNvbG9yU3R5bGUodGhpcy5zdHJva2UsIGN0eCkgKQogICAg
ICB9CiAgICB9CiAgICBpZiAodGhpcy5zdHJva2VXaWR0aCAhPSBudWxsKQogICAgICBjdHguc2V0
TGluZVdpZHRoKCB0aGlzLnN0cm9rZVdpZHRoICkKICAgIGlmICh0aGlzLmxpbmVDYXAgIT0gbnVs
bCkKICAgICAgY3R4LnNldExpbmVDYXAoIHRoaXMubGluZUNhcCApCiAgICBpZiAodGhpcy5saW5l
Sm9pbiAhPSBudWxsKQogICAgICBjdHguc2V0TGluZUpvaW4oIHRoaXMubGluZUpvaW4gKQogICAg
aWYgKHRoaXMubWl0ZXJMaW1pdCAhPSBudWxsKQogICAgICBjdHguc2V0TWl0ZXJMaW1pdCggdGhp
cy5taXRlckxpbWl0ICkKCiAgICAvLyBjb21wb3NpdGluZyBtb2RpZmllcnMKICAgIGlmICh0aGlz
LmFic29sdXRlT3BhY2l0eSAhPSBudWxsKQogICAgICBjdHguc2V0R2xvYmFsQWxwaGEoIHRoaXMu
YWJzb2x1dGVPcGFjaXR5ICkKICAgIGlmICh0aGlzLm9wYWNpdHkgIT0gbnVsbCkKICAgICAgY3R4
LnNldEdsb2JhbEFscGhhKCBjdHguZ2xvYmFsQWxwaGEgKiB0aGlzLm9wYWNpdHkgKQogICAgaWYg
KHRoaXMuY29tcG9zaXRlT3BlcmF0aW9uICE9IG51bGwpCiAgICAgIGN0eC5zZXRHbG9iYWxDb21w
b3NpdGVPcGVyYXRpb24oIHRoaXMuY29tcG9zaXRlT3BlcmF0aW9uICkKCiAgICAvLyBzaGFkb3cg
bW9kaWZpZXJzCiAgICBpZiAodGhpcy5zaGFkb3dDb2xvciAhPSBudWxsKQogICAgICBjdHguc2V0
U2hhZG93Q29sb3IoIENvbG9ycy5wYXJzZUNvbG9yU3R5bGUodGhpcy5zaGFkb3dDb2xvciwgY3R4
KSApCiAgICBpZiAodGhpcy5zaGFkb3dCbHVyICE9IG51bGwpCiAgICAgIGN0eC5zZXRTaGFkb3dC
bHVyKCB0aGlzLnNoYWRvd0JsdXIgKQogICAgaWYgKHRoaXMuc2hhZG93T2Zmc2V0WCAhPSBudWxs
KQogICAgICBjdHguc2V0U2hhZG93T2Zmc2V0WCggdGhpcy5zaGFkb3dPZmZzZXRYICkKICAgIGlm
ICh0aGlzLnNoYWRvd09mZnNldFkgIT0gbnVsbCkKICAgICAgY3R4LnNldFNoYWRvd09mZnNldFko
IHRoaXMuc2hhZG93T2Zmc2V0WSApCgogICAgLy8gdGV4dCBtb2RpZmllcnMKICAgIGlmICh0aGlz
LnRleHRBbGlnbiAhPSBudWxsKQogICAgICBjdHguc2V0VGV4dEFsaWduKCB0aGlzLnRleHRBbGln
biApCiAgICBpZiAodGhpcy50ZXh0QmFzZWxpbmUgIT0gbnVsbCkKICAgICAgY3R4LnNldFRleHRC
YXNlbGluZSggdGhpcy50ZXh0QmFzZWxpbmUgKQogICAgaWYgKHRoaXMuZm9udCAhPSBudWxsKQog
ICAgICBjdHguc2V0Rm9udCggdGhpcy5mb250ICkKICB9LAoKICAvKioKICAgIERyYXdzIHRoZSBw
aWNraW5nIHBhdGggZm9yIHRoZSBub2RlIGZvciB0ZXN0aW5nIGlmIHRoZSBtb3VzZSBjdXJzb3IK
ICAgIGlzIGluc2lkZSB0aGUgbm9kZS4KCiAgICBGYWxzZSBieSBkZWZhdWx0LCBvdmVyd3JpdGUg
aWYgeW91IG5lZWQgc3BlY2lhbCBiZWhhdmlvdXIuCgogICAgQHBhcmFtIGN0eCBDYW52YXMgMkQg
Y29udGV4dAogICAgKi8KICBkcmF3UGlja2luZ1BhdGggOiBmYWxzZSwKCiAgLyoqCiAgICBEcmF3
cyB0aGUgbm9kZS4KCiAgICBGYWxzZSBieSBkZWZhdWx0LCBvdmVyd3JpdGUgdG8gYWN0dWFsbHkg
ZHJhdyBzb21ldGhpbmcuCgogICAgQHBhcmFtIGN0eCBDYW52YXMgMkQgY29udGV4dAogICAgKi8K
ICBkcmF3IDogZmFsc2UsCgogIGNyZWF0ZVN1YnRyZWVQYXRoIDogZnVuY3Rpb24oY3R4LCBza2lw
VHJhbnNmb3JtKSB7CiAgICBjdHguc2F2ZSgpCiAgICBpZiAoIXNraXBUcmFuc2Zvcm0pIHRoaXMu
dHJhbnNmb3JtKGN0eCwgdHJ1ZSkKICAgIGZvciAodmFyIGk9MDsgaTx0aGlzLmNoaWxkTm9kZXMu
bGVuZ3RoOyBpKyspCiAgICAgIHRoaXMuY2hpbGROb2Rlc1tpXS5jcmVhdGVTdWJ0cmVlUGF0aChj
dHgpCiAgICBjdHgucmVzdG9yZSgpCiAgfSwKCiAgZ2V0U3VidHJlZUJvdW5kaW5nQm94IDogZnVu
Y3Rpb24oaWRlbnRpdHkpIHsKICAgIGlmIChpZGVudGl0eSkgewogICAgICB2YXIgcCA9IHRoaXMu
cGFyZW50CiAgICAgIHRoaXMucGFyZW50ID0gbnVsbAogICAgICB0aGlzLm5lZWRNYXRyaXhVcGRh
dGUgPSB0cnVlCiAgICB9CiAgICB2YXIgYmIgPSB0aGlzLmdldEF4aXNBbGlnbmVkQm91bmRpbmdC
b3goKQogICAgZm9yICh2YXIgaT0wOyBpPHRoaXMuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewog
ICAgICB2YXIgY2JiID0gdGhpcy5jaGlsZE5vZGVzW2ldLmdldFN1YnRyZWVCb3VuZGluZ0JveCgp
CiAgICAgIGlmICghYmIpIHsKICAgICAgICBiYiA9IGNiYgogICAgICB9IGVsc2UgaWYgKGNiYikg
ewogICAgICAgIHRoaXMubWVyZ2VCb3VuZGluZ0JveGVzKGJiLCBjYmIpCiAgICAgIH0KICAgIH0K
ICAgIGlmIChpZGVudGl0eSkgewogICAgICB0aGlzLnBhcmVudCA9IHAKICAgICAgdGhpcy5uZWVk
TWF0cml4VXBkYXRlID0gdHJ1ZQogICAgfQogICAgcmV0dXJuIGJiCiAgfSwKCiAgbWVyZ2VCb3Vu
ZGluZ0JveGVzIDogZnVuY3Rpb24oYmIsIGJiMikgewogICAgdmFyIG9ieCA9IGJiWzBdLCBvYnkg
PSBiYlsxXQogICAgaWYgKGJiWzBdID4gYmIyWzBdKSBiYlswXSA9IGJiMlswXQogICAgaWYgKGJi
WzFdID4gYmIyWzFdKSBiYlsxXSA9IGJiMlsxXQogICAgYmJbMl0gPSBiYlsyXSArIG9ieCAtIGJi
WzBdCiAgICBiYlszXSA9IGJiWzNdICsgb2J5IC0gYmJbMV0KICAgIGlmIChiYlsyXStiYlswXSA8
IGJiMlsyXStiYjJbMF0pIGJiWzJdID0gYmIyWzJdK2JiMlswXS1iYlswXQogICAgaWYgKGJiWzNd
K2JiWzFdIDwgYmIyWzNdK2JiMlsxXSkgYmJbM10gPSBiYjJbM10rYmIyWzFdLWJiWzFdCiAgfSwK
CiAgZ2V0QXhpc0FsaWduZWRCb3VuZGluZ0JveCA6IGZ1bmN0aW9uKCkgewogICAgdGhpcy50cmFu
c2Zvcm0obnVsbCwgdHJ1ZSkKICAgIGlmICghdGhpcy5nZXRCb3VuZGluZ0JveCkgcmV0dXJuIG51
bGwKICAgIHZhciBiYm94ID0gdGhpcy5nZXRCb3VuZGluZ0JveCgpCiAgICB2YXIgeHkxID0gQ2Fu
dmFzU3VwcG9ydC50TWF0cml4TXVsdGlwbHlQb2ludCh0aGlzLmN1cnJlbnRNYXRyaXgsCiAgICAg
IGJib3hbMF0sIGJib3hbMV0pCiAgICB2YXIgeHkyID0gQ2FudmFzU3VwcG9ydC50TWF0cml4TXVs
dGlwbHlQb2ludCh0aGlzLmN1cnJlbnRNYXRyaXgsCiAgICAgIGJib3hbMF0rYmJveFsyXSwgYmJv
eFsxXStiYm94WzNdKQogICAgdmFyIHh5MyA9IENhbnZhc1N1cHBvcnQudE1hdHJpeE11bHRpcGx5
UG9pbnQodGhpcy5jdXJyZW50TWF0cml4LAogICAgICBiYm94WzBdLCBiYm94WzFdK2Jib3hbM10p
CiAgICB2YXIgeHk0ID0gQ2FudmFzU3VwcG9ydC50TWF0cml4TXVsdGlwbHlQb2ludCh0aGlzLmN1
cnJlbnRNYXRyaXgsCiAgICAgIGJib3hbMF0rYmJveFsyXSwgYmJveFsxXSkKICAgIHZhciB4MSA9
IE1hdGgubWluKHh5MVswXSwgeHkyWzBdLCB4eTNbMF0sIHh5NFswXSkKICAgIHZhciB4MiA9IE1h
dGgubWF4KHh5MVswXSwgeHkyWzBdLCB4eTNbMF0sIHh5NFswXSkKICAgIHZhciB5MSA9IE1hdGgu
bWluKHh5MVsxXSwgeHkyWzFdLCB4eTNbMV0sIHh5NFsxXSkKICAgIHZhciB5MiA9IE1hdGgubWF4
KHh5MVsxXSwgeHkyWzFdLCB4eTNbMV0sIHh5NFsxXSkKICAgIHJldHVybiBbeDEsIHkxLCB4Mi14
MSwgeTIteTFdCiAgfSwKCiAgbWFrZURyYWdnYWJsZSA6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5h
ZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCBmdW5jdGlvbihldikgewogICAgICB0aGlzLmRy
YWdTdGFydFBvc2l0aW9uID0ge3g6IHRoaXMueCwgeTogdGhpcy55fTsKICAgICAgZXYuc3RvcFBy
b3BhZ2F0aW9uKCk7CiAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHJldHVybiBmYWxz
ZTsKICAgIH0sIGZhbHNlKTsKICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcignZHJhZycsIGZ1bmN0
aW9uKGV2KSB7CiAgICAgIHRoaXMueCA9IHRoaXMuZHJhZ1N0YXJ0UG9zaXRpb24ueCArIHRoaXMu
cm9vdC5kcmFnWCAvIHRoaXMucGFyZW50LmN1cnJlbnRNYXRyaXhbMF07CiAgICAgIHRoaXMueSA9
IHRoaXMuZHJhZ1N0YXJ0UG9zaXRpb24ueSArIHRoaXMucm9vdC5kcmFnWSAvIHRoaXMucGFyZW50
LmN1cnJlbnRNYXRyaXhbM107CiAgICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICBldi5w
cmV2ZW50RGVmYXVsdCgpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LCBmYWxzZSk7CiAgfQp9
KQoKCi8qKgogIENhbnZhcyBpcyB0aGUgY2FudmFzIG1hbmFnZXIgY2xhc3MuCiAgSXQgdGFrZXMg
Y2FyZSBvZiB1cGRhdGluZyBhbmQgZHJhd2luZyBpdHMgY2hpbGROb2RlcyBvbiBhIGNhbnZhcyBl
bGVtZW50LgoKICBBbiBleGFtcGxlIHdpdGggYSByb3RhdGluZyByZWN0YW5nbGU6CgogICAgdmFy
IGMgPSBFLmNhbnZhcyg1MDAsIDUwMCkKICAgIHZhciBjYW52YXMgPSBuZXcgQ2FudmFzKGMpCiAg
ICB2YXIgcmVjdCA9IG5ldyBSZWN0YW5nbGUoMTAwLCAxMDApCiAgICByZWN0LnggPSAyNTAKICAg
IHJlY3QueSA9IDI1MAogICAgcmVjdC5maWxsID0gdHJ1ZQogICAgcmVjdC5maWxsU3R5bGUgPSAn
Z3JlZW4nCiAgICByZWN0LmFkZEZyYW1lTGlzdGVuZXIoZnVuY3Rpb24odCkgewogICAgICB0aGlz
LnJvdGF0aW9uID0gKCh0IC8gMzAwMCkgJSAxKSAqIE1hdGguUEkgKiAyCiAgICB9KQogICAgY2Fu
dmFzLmFwcGVuZChyZWN0KQogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjKQoKCiAgVG8g
dXNlIHRoZSBjYW52YXMgYXMgYSBtYW51YWxseSB1cGRhdGVkIGltYWdlOgoKICAgIHZhciBjYW52
YXMgPSBuZXcgQ2FudmFzKEUuY2FudmFzKDIwMCw0MCksIHsKICAgICAgaXNQbGF5aW5nIDogZmFs
c2UsCiAgICAgIHJlZHJhd09ubHlXaGVuQ2hhbmdlZCA6IHRydWUKICAgIH0pCiAgICB2YXIgYyA9
IG5ldyBDaXJjbGUoMjApCiAgICBjLnggPSAxMDAKICAgIGMueSA9IDIwCiAgICBjLmZpbGwgPSB0
cnVlCiAgICBjLmZpbGxTdHlsZSA9ICdyZWQnCiAgICBjLmFkZEZyYW1lTGlzdGVuZXIoZnVuY3Rp
b24odCkgewogICAgICBpZiAodGhpcy5yb290LmFic29sdXRlTW91c2VYICE9IG51bGwpIHsKICAg
ICAgICB0aGlzLnggPSB0aGlzLnJvb3QubW91c2VYIC8vIHJlbGF0aXZlIHRvIGNhbnZhcyBzdXJm
YWNlCiAgICAgICAgdGhpcy5yb290LmNoYW5nZWQgPSB0cnVlCiAgICAgIH0KICAgIH0pCiAgICBj
YW52YXMuYXBwZW5kKGMpCgoKICBPciBieSB1c2luZyByYXcgb25GcmFtZS1jYWxsczoKCiAgICB2
YXIgY2FudmFzID0gbmV3IENhbnZhcyhFLmNhbnZhcygyMDAsNDApLCB7CiAgICAgIGlzUGxheWlu
ZyA6IGZhbHNlLAogICAgICBmaWxsIDogdHJ1ZSwKICAgICAgZmlsbFN0eWxlIDogJ3doaXRlJwog
ICAgfSkKICAgIHZhciBjID0gbmV3IENpcmNsZSgyMCkKICAgIGMueCA9IDEwMAogICAgYy55ID0g
MjAKICAgIGMuZmlsbCA9IHRydWUKICAgIGMuZmlsbFN0eWxlID0gJ3JlZCcKICAgIGNhbnZhcy5h
cHBlbmQoYykKICAgIGNhbnZhcy5vbkZyYW1lKCkKCgogIFdoaWNoIGlzIGFsc28gdGhlIHJlY29t
bWVuZGVkIHdheSB0byB1c2UgYSBjYW52YXMgaW5zaWRlIGFub3RoZXIgY2FudmFzOgoKICAgIHZh
ciBjYW52YXMgPSBuZXcgQ2FudmFzKEUuY2FudmFzKDIwMCw0MCksIHsKICAgICAgaXNQbGF5aW5n
IDogZmFsc2UKICAgIH0pCiAgICB2YXIgYyA9IG5ldyBDaXJjbGUoMjAsIHsKICAgICAgeDogMTAw
LCB5OiAyMCwKICAgICAgZmlsbDogdHJ1ZSwgZmlsbFN0eWxlOiAncmVkJwogICAgfSkKICAgIGNh
bnZhcy5hcHBlbmQoYykKCiAgICB2YXIgdG9wQ2FudmFzID0gbmV3IENhbnZhcyhFLmNhbnZhcyg1
MDAsIDUwMCkpCiAgICB2YXIgY2FudmFzSW1hZ2UgPSBuZXcgSW1hZ2VOb2RlKGNhbnZhcy5jYW52
YXMsIHt4OiAyNTAsIHk6IDI1MH0pCiAgICB0b3BDYW52YXMuYXBwZW5kKGNhbnZhc0ltYWdlKQog
ICAgY2FudmFzSW1hZ2UuYWRkRnJhbWVMaXN0ZW5lcihmdW5jdGlvbih0KSB7CiAgICAgIHRoaXMu
cm90YXRpb24gPSAodCAvIDMwMDAgJSAxKSAqIE1hdGguUEkgKiAyCiAgICAgIGNhbnZhcy5vbkZy
YW1lKHQpCiAgICB9KQoKICAqLwpDYW52YXMgPSBLbGFzcyhDYW52YXNOb2RlLCB7CgogIGNsZWFy
IDogdHJ1ZSwKICBmcmFtZUxvb3AgOiBmYWxzZSwKICByZWNvcmRpbmcgOiBmYWxzZSwKICBvcGFj
aXR5IDogMSwKICBmcmFtZSA6IDAsCiAgZWxhcHNlZCA6IDAsCiAgZnJhbWVEdXJhdGlvbiA6IDMw
LAogIHNwZWVkIDogMS4wLAogIHRpbWUgOiAwLAogIGZwcyA6IDAsCiAgY3VycmVudFJlYWxGcHMg
OiAwLAogIGN1cnJlbnRGcHMgOiAwLAogIGZwc0ZyYW1lcyA6IDMwLAogIHN0YXJ0VGltZSA6IDAs
CiAgcmVhbEZwcyA6IDAsCiAgZml4ZWRUaW1lc3RlcCA6IGZhbHNlLAogIHBsYXlPbmx5V2hlbkZv
Y3VzZWQgOiB0cnVlLAogIGlzUGxheWluZyA6IHRydWUsCiAgcmVkcmF3T25seVdoZW5DaGFuZ2Vk
IDogZmFsc2UsCiAgY2hhbmdlZCA6IHRydWUsCiAgZHJhd0JvdW5kaW5nQm94ZXMgOiBmYWxzZSwK
ICBjdXJzb3IgOiAnZGVmYXVsdCcsCgogIG1vdXNlRG93biA6IGZhbHNlLAogIG1vdXNlRXZlbnRz
IDogW10sCgogIC8vIGFic29sdXRlIHBpeGVsIGNvb3JkaW5hdGVzIGZyb20gY2FudmFzIHRvcC1s
ZWZ0CiAgYWJzb2x1dGVNb3VzZVggOiBudWxsLAogIGFic29sdXRlTW91c2VZIDogbnVsbCwKCiAg
LyoKICAgIENvb3JkaW5hdGVzIHJlbGF0aXZlIHRvIHRoZSBjYW52YXMncyBzdXJmYWNlIHNjYWxl
LgogICAgRXhhbXBsZToKICAgICAgY2FudmFzLndpZHRoCiAgICAgICM9PiAxMDAKICAgICAgY2Fu
dmFzLnN0eWxlLndpZHRoCiAgICAgICM9PiAnMTAwcHgnCiAgICAgIGNhbnZhcy5hYnNvbHV0ZU1v
dXNlWAogICAgICAjPT4gNTAKICAgICAgY2FudmFzLm1vdXNlWAogICAgICAjPT4gNTAKCiAgICAg
IGNhbnZhcy5zdHlsZS53aWR0aCA9ICcyMDBweCcKICAgICAgY2FudmFzLndpZHRoCiAgICAgICM9
PiAxMDAKICAgICAgY2FudmFzLmFic29sdXRlTW91c2VYCiAgICAgICM9PiAxMDAKICAgICAgY2Fu
dmFzLm1vdXNlWAogICAgICAjPT4gNTAKICAqLwogIG1vdXNlWCA6IG51bGwsCiAgbW91c2VZIDog
bnVsbCwKCiAgZWxlbWVudE5vZGVaSW5kZXhDb3VudGVyIDogMCwKCiAgaW5pdGlhbGl6ZSA6IGZ1
bmN0aW9uKGNhbnZhcywgY29uZmlnKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDIpIHsK
ICAgICAgdmFyIGNvbnRhaW5lciA9IGFyZ3VtZW50c1swXQogICAgICB2YXIgdyA9IGFyZ3VtZW50
c1sxXQogICAgICB2YXIgaCA9IGFyZ3VtZW50c1syXQogICAgICB2YXIgY29uZmlnID0gYXJndW1l
bnRzWzNdCiAgICAgIHZhciBjYW52YXMgPSBFLmNhbnZhcyh3LGgpCiAgICAgIHZhciBjYW52YXND
b250YWluZXIgPSBFKCdkaXYnLCBjYW52YXMsIHtzdHlsZToKICAgICAgICB7b3ZlcmZsb3c6J2hp
ZGRlbicsIHdpZHRoOncrJ3B4JywgaGVpZ2h0OmgrJ3B4JywgcG9zaXRpb246J3JlbGF0aXZlJ30K
ICAgICAgfSkKICAgICAgdGhpcy5jYW52YXNDb250YWluZXIgPSBjYW52YXNDb250YWluZXIKICAg
ICAgaWYgKGNvbnRhaW5lcikKICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2FudmFzQ29u
dGFpbmVyKQogICAgfQogICAgQ2FudmFzTm9kZS5pbml0aWFsaXplLmNhbGwodGhpcywgY29uZmln
KQogICAgdGhpcy5tb3VzZUV2ZW50U3RhY2sgPSBbXQogICAgdGhpcy5jYW52YXMgPSBjYW52YXMK
ICAgIGNhbnZhcy5jYW52YXMgPSB0aGlzCiAgICB0aGlzLndpZHRoID0gdGhpcy5jYW52YXMud2lk
dGgKICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5jYW52YXMuaGVpZ2h0CiAgICB2YXIgdGggPSB0aGlz
CiAgICB0aGlzLmZyYW1lSGFuZGxlciA9IGZ1bmN0aW9uKCkgeyB0aC5vbkZyYW1lKCkgfQogICAg
dGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignRE9NTm9kZUluc2VydGVkJywgZnVuY3Rpb24o
ZXYpIHsKICAgICAgaWYgKGV2LnRhcmdldCA9PSB0aGlzKQogICAgICAgIHRoLmFkZEV2ZW50TGlz
dGVuZXJzKCkKICAgIH0sIGZhbHNlKQogICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcign
RE9NTm9kZVJlbW92ZWQnLCBmdW5jdGlvbihldikgewogICAgICBpZiAoZXYudGFyZ2V0ID09IHRo
aXMpCiAgICAgICAgdGgucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKQogICAgfSwgZmFsc2UpCiAgICBp
ZiAodGhpcy5jYW52YXMucGFyZW50Tm9kZSkgdGhpcy5hZGRFdmVudExpc3RlbmVycygpCiAgICB0
aGlzLnN0YXJ0VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpCiAgICBpZiAodGhpcy5pc1BsYXlp
bmcpCiAgICAgIHRoaXMucGxheSgpCiAgfSwKCiAgLy8gRklYTUUKICByZW1vdmVFdmVudExpc3Rl
bmVycyA6IGZ1bmN0aW9uKCkgewogIH0sCgogIGFkZEV2ZW50TGlzdGVuZXJzIDogZnVuY3Rpb24o
KSB7CiAgICB2YXIgdGggPSB0aGlzCiAgICB0aGlzLmNhbnZhcy5wYXJlbnROb2RlLmFkZE1vdXNl
RXZlbnQgPSBmdW5jdGlvbihlKXsKICAgICAgdmFyIHh5ID0gTW91c2UuZ2V0UmVsYXRpdmVDb29y
ZHModGhpcywgZSkKICAgICAgdGguYWJzb2x1dGVNb3VzZVggPSB4eS54CiAgICAgIHRoLmFic29s
dXRlTW91c2VZID0geHkueQogICAgICB2YXIgc3R5bGUgPSBkb2N1bWVudC5kZWZhdWx0Vmlldy5n
ZXRDb21wdXRlZFN0eWxlKHRoLmNhbnZhcywiIikKICAgICAgdmFyIHcgPSBwYXJzZUZsb2F0KHN0
eWxlLmdldFByb3BlcnR5VmFsdWUoJ3dpZHRoJykpCiAgICAgIHZhciBoID0gcGFyc2VGbG9hdChz
dHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCdoZWlnaHQnKSkKICAgICAgdGgubW91c2VYID0gdGguYWJz
b2x1dGVNb3VzZVggKiAodyAvIHRoLmNhbnZhcy53aWR0aCkKICAgICAgdGgubW91c2VZID0gdGgu
YWJzb2x1dGVNb3VzZVkgKiAoaCAvIHRoLmNhbnZhcy5oZWlnaHQpCiAgICAgIHRoLmFkZE1vdXNl
RXZlbnQodGgubW91c2VYLCB0aC5tb3VzZVksIHRoLm1vdXNlRG93bikKICAgIH0KICAgIHRoaXMu
Y2FudmFzLnBhcmVudE5vZGUuY29udGFpbnMgPSB0aGlzLmNvbnRhaW5zCgogICAgdGhpcy5jYW52
YXMucGFyZW50Tm9kZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jdGlvbihlKSB7
CiAgICAgIHRoLm1vdXNlRG93biA9IHRydWUKICAgICAgaWYgKHRoLmtleVRhcmdldCAhPSB0aC50
YXJnZXQpIHsKICAgICAgICBpZiAodGgua2V5VGFyZ2V0KQogICAgICAgICAgdGguZGlzcGF0Y2hF
dmVudCh7dHlwZTogJ2JsdXInLCBjYW52YXNUYXJnZXQ6IHRoLmtleVRhcmdldH0pCiAgICAgICAg
dGgua2V5VGFyZ2V0ID0gdGgudGFyZ2V0CiAgICAgICAgaWYgKHRoLmtleVRhcmdldCkKICAgICAg
ICAgIHRoLmRpc3BhdGNoRXZlbnQoe3R5cGU6ICdmb2N1cycsIGNhbnZhc1RhcmdldDogdGgua2V5
VGFyZ2V0fSkKICAgICAgfQogICAgICB0aGlzLmFkZE1vdXNlRXZlbnQoZSkKICAgIH0sIHRydWUp
CgogICAgdGhpcy5jYW52YXMucGFyZW50Tm9kZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywg
ZnVuY3Rpb24oZSkgewogICAgICB0aGlzLmFkZE1vdXNlRXZlbnQoZSkKICAgICAgdGgubW91c2VE
b3duID0gZmFsc2UKICAgIH0sIHRydWUpCgogICAgdGhpcy5jYW52YXMucGFyZW50Tm9kZS5hZGRF
dmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBmdW5jdGlvbihlKSB7CiAgICAgIHRoaXMuYWRkTW91
c2VFdmVudChlKQogICAgICBpZiAodGgucHJldkNsaWVudFggPT0gbnVsbCkgewogICAgICAgIHRo
LnByZXZDbGllbnRYID0gZS5jbGllbnRYCiAgICAgICAgdGgucHJldkNsaWVudFkgPSBlLmNsaWVu
dFkKICAgICAgfQogICAgICBpZiAodGguZHJhZ1RhcmdldCkgewogICAgICAgIHZhciBuZXYgPSBk
b2N1bWVudC5jcmVhdGVFdmVudCgnTW91c2VFdmVudHMnKQogICAgICAgIG5ldi5pbml0TW91c2VF
dmVudCgnZHJhZycsIHRydWUsIHRydWUsIHdpbmRvdywgZS5kZXRhaWwsCiAgICAgICAgICBlLnNj
cmVlblgsIGUuc2NyZWVuWSwgZS5jbGllbnRYLCBlLmNsaWVudFksIGUuY3RybEtleSwgZS5hbHRL
ZXksCiAgICAgICAgICBlLnNoaWZ0S2V5LCBlLm1ldGFLZXksIGUuYnV0dG9uLCBlLnJlbGF0ZWRU
YXJnZXQpCiAgICAgICAgbmV2LmNhbnZhc1RhcmdldCA9IHRoLmRyYWdUYXJnZXQKICAgICAgICBu
ZXYuZHggPSBlLmNsaWVudFggLSB0aC5wcmV2Q2xpZW50WAogICAgICAgIG5ldi5keSA9IGUuY2xp
ZW50WSAtIHRoLnByZXZDbGllbnRZCiAgICAgICAgdGguZHJhZ1ggKz0gbmV2LmR4CiAgICAgICAg
dGguZHJhZ1kgKz0gbmV2LmR5CiAgICAgICAgdGguZGlzcGF0Y2hFdmVudChuZXYpCiAgICAgIH0K
ICAgICAgaWYgKCF0aC5tb3VzZURvd24pIHsKICAgICAgICBpZiAodGguZHJhZ1RhcmdldCkgewog
ICAgICAgICAgdmFyIG5ldiA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdNb3VzZUV2ZW50cycpCiAg
ICAgICAgICBuZXYuaW5pdE1vdXNlRXZlbnQoJ2RyYWdlbmQnLCB0cnVlLCB0cnVlLCB3aW5kb3cs
IGUuZGV0YWlsLAogICAgICAgICAgICBlLnNjcmVlblgsIGUuc2NyZWVuWSwgZS5jbGllbnRYLCBl
LmNsaWVudFksIGUuY3RybEtleSwgZS5hbHRLZXksCiAgICAgICAgICAgIGUuc2hpZnRLZXksIGUu
bWV0YUtleSwgZS5idXR0b24sIGUucmVsYXRlZFRhcmdldCkKICAgICAgICAgIG5ldi5jYW52YXNU
YXJnZXQgPSB0aC5kcmFnVGFyZ2V0CiAgICAgICAgICB0aC5kaXNwYXRjaEV2ZW50KG5ldikKICAg
ICAgICAgIHRoLmRyYWdYID0gdGguZHJhZ1kgPSAwCiAgICAgICAgICB0aC5kcmFnVGFyZ2V0ID0g
ZmFsc2UKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoIXRoLmRyYWdUYXJnZXQgJiYgdGgudGFy
Z2V0KSB7CiAgICAgICAgdGguZHJhZ1RhcmdldCA9IHRoLnRhcmdldAogICAgICAgIHZhciBuZXYg
PSBkb2N1bWVudC5jcmVhdGVFdmVudCgnTW91c2VFdmVudHMnKQogICAgICAgIG5ldi5pbml0TW91
c2VFdmVudCgnZHJhZ3N0YXJ0JywgdHJ1ZSwgdHJ1ZSwgd2luZG93LCBlLmRldGFpbCwKICAgICAg
ICAgIGUuc2NyZWVuWCwgZS5zY3JlZW5ZLCBlLmNsaWVudFgsIGUuY2xpZW50WSwgZS5jdHJsS2V5
LCBlLmFsdEtleSwKICAgICAgICAgIGUuc2hpZnRLZXksIGUubWV0YUtleSwgZS5idXR0b24sIGUu
cmVsYXRlZFRhcmdldCkKICAgICAgICBuZXYuY2FudmFzVGFyZ2V0ID0gdGguZHJhZ1RhcmdldAog
ICAgICAgIHRoLmRyYWdTdGFydFggPSBlLmNsaWVudFgKICAgICAgICB0aC5kcmFnU3RhcnRZID0g
ZS5jbGllbnRZCiAgICAgICAgdGguZHJhZ1ggPSB0aC5kcmFnWSA9IDAKICAgICAgICB0aC5kaXNw
YXRjaEV2ZW50KG5ldikKICAgICAgfQogICAgICB0aC5wcmV2Q2xpZW50WCA9IGUuY2xpZW50WAog
ICAgICB0aC5wcmV2Q2xpZW50WSA9IGUuY2xpZW50WQogICAgfSwgdHJ1ZSkKCiAgICB0aGlzLmNh
bnZhcy5wYXJlbnROb2RlLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3V0JywgZnVuY3Rpb24oZSkg
ewogICAgICBpZiAoIUNhbnZhc05vZGUuY29udGFpbnMuY2FsbCh0aGlzLCBlLnJlbGF0ZWRUYXJn
ZXQpKQogICAgICAgIHRoLmFic29sdXRlTW91c2VYID0gdGguYWJzb2x1dGVNb3VzZVkgPSB0aC5t
b3VzZVggPSB0aC5tb3VzZVkgPSBudWxsCiAgICB9LCB0cnVlKQoKICAgIHZhciBkaXNwYXRjaCA9
IHRoaXMuZGlzcGF0Y2hFdmVudC5iaW5kKHRoaXMpCiAgICB2YXIgdHlwZXMgPSBbCiAgICAgICdt
b3VzZW1vdmUnLCAnbW91c2VvdmVyJywgJ21vdXNlb3V0JywKICAgICAgJ2NsaWNrJywgJ2RibGNs
aWNrJywKICAgICAgJ21vdXNlZG93bicsICdtb3VzZXVwJywKICAgICAgJ2tleXByZXNzJywgJ2tl
eWRvd24nLCAna2V5dXAnLAogICAgICAnRE9NTW91c2VTY3JvbGwnLCAnbW91c2V3aGVlbCcsICdt
b3VzZW11bHRpd2hlZWwnLCAndGV4dElucHV0JywKICAgICAgJ2ZvY3VzJywgJ2JsdXInCiAgICBd
CiAgICBmb3IgKHZhciBpPTA7IGk8dHlwZXMubGVuZ3RoOyBpKyspIHsKICAgICAgdGhpcy5jYW52
YXMucGFyZW50Tm9kZS5hZGRFdmVudExpc3RlbmVyKHR5cGVzW2ldLCBkaXNwYXRjaCwgZmFsc2Up
CiAgICB9CiAgICB0aGlzLmtleXMgPSB7fQoKICAgIHRoaXMud2luZG93RXZlbnRMaXN0ZW5lcnMg
PSB7CgogICAgICBrZXlkb3duIDogZnVuY3Rpb24oZXYpIHsKICAgICAgICBpZiAodGgua2V5VGFy
Z2V0KSB7CiAgICAgICAgICB0aC51cGRhdGVLZXlzKGV2KQogICAgICAgICAgZXYuY2FudmFzVGFy
Z2V0ID0gdGgua2V5VGFyZ2V0CiAgICAgICAgICB0aC5kaXNwYXRjaEV2ZW50KGV2KQogICAgICAg
IH0KICAgICAgfSwKCiAgICAgIGtleXVwIDogZnVuY3Rpb24oZXYpIHsKICAgICAgICBpZiAodGgu
a2V5VGFyZ2V0KSB7CiAgICAgICAgICB0aC51cGRhdGVLZXlzKGV2KQogICAgICAgICAgZXYuY2Fu
dmFzVGFyZ2V0ID0gdGgua2V5VGFyZ2V0CiAgICAgICAgICB0aC5kaXNwYXRjaEV2ZW50KGV2KQog
ICAgICAgIH0KICAgICAgfSwKCiAgICAgIC8vIGRvIHdlIGV2ZW4gd2FudCB0byBoYXZlIHRoaXM/
CiAgICAgIGtleXByZXNzIDogZnVuY3Rpb24oZXYpIHsKICAgICAgICBpZiAodGgua2V5VGFyZ2V0
KSB7CiAgICAgICAgICBldi5jYW52YXNUYXJnZXQgPSB0aC5rZXlUYXJnZXQKICAgICAgICAgIHRo
LmRpc3BhdGNoRXZlbnQoZXYpCiAgICAgICAgfQogICAgICB9LAoKICAgICAgYmx1ciA6IGZ1bmN0
aW9uKGV2KSB7CiAgICAgICAgdGguYWJzb2x1dGVNb3VzZVggPSB0aC5hYnNvbHV0ZU1vdXNlWSA9
IG51bGwKICAgICAgICBpZiAodGgucGxheU9ubHlXaGVuRm9jdXNlZCAmJiB0aC5pc1BsYXlpbmcp
IHsKICAgICAgICAgIHRoLnN0b3AoKQogICAgICAgICAgdGguX19ibHVyU3RvcCA9IHRydWUKICAg
ICAgICB9CiAgICAgIH0sCgogICAgICBmb2N1cyA6IGZ1bmN0aW9uKGV2KSB7CiAgICAgICAgaWYg
KHRoLl9fYmx1clN0b3AgJiYgIXRoLmlzUGxheWluZykgdGgucGxheSgpCiAgICAgIH0sCgogICAg
ICBtb3VzZXVwIDogZnVuY3Rpb24oZSkgewogICAgICAgIHRoLm1vdXNlRG93biA9IGZhbHNlCiAg
ICAgICAgaWYgKHRoLmRyYWdUYXJnZXQpIHsKICAgICAgICAgIC8vIFRPRE8KICAgICAgICAgIC8v
IGZpbmQgdGhlIG9iamVjdCB0aGF0IHJlY2VpdmVzIHRoZSBkcmFnIChpLmUuIGRyb3AgdGFyZ2V0
KQogICAgICAgICAgdmFyIG5ldiA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdNb3VzZUV2ZW50cycp
CiAgICAgICAgICBuZXYuaW5pdE1vdXNlRXZlbnQoJ2RyYWdlbmQnLCB0cnVlLCB0cnVlLCB3aW5k
b3csIGUuZGV0YWlsLAogICAgICAgICAgICBlLnNjcmVlblgsIGUuc2NyZWVuWSwgZS5jbGllbnRY
LCBlLmNsaWVudFksIGUuY3RybEtleSwgZS5hbHRLZXksCiAgICAgICAgICAgIGUuc2hpZnRLZXks
IGUubWV0YUtleSwgZS5idXR0b24sIGUucmVsYXRlZFRhcmdldCkKICAgICAgICAgIG5ldi5jYW52
YXNUYXJnZXQgPSB0aC5kcmFnVGFyZ2V0CiAgICAgICAgICB0aC5kaXNwYXRjaEV2ZW50KG5ldikK
ICAgICAgICAgIHRoLmRyYWdUYXJnZXQgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBpZiAoIXRo
LmNhbnZhcy5wYXJlbnROb2RlLmNvbnRhaW5zKGUudGFyZ2V0KSkgewogICAgICAgICAgdmFyIHJ2
ID0gdGguZGlzcGF0Y2hFdmVudChlKQogICAgICAgICAgaWYgKHRoLmtleVRhcmdldCkgewogICAg
ICAgICAgICB0aC5kaXNwYXRjaEV2ZW50KHt0eXBlOiAnYmx1cicsIGNhbnZhc1RhcmdldDogdGgu
a2V5VGFyZ2V0fSkKICAgICAgICAgICAgdGgua2V5VGFyZ2V0ID0gbnVsbAogICAgICAgICAgfQog
ICAgICAgICAgcmV0dXJuIHJ2CiAgICAgICAgfQogICAgICB9LAoKICAgICAgbW91c2Vtb3ZlIDog
ZnVuY3Rpb24oZXYpIHsKICAgICAgICBpZiAodGguX19ibHVyU3RvcCAmJiAhdGguaXNQbGF5aW5n
KSB0aC5wbGF5KCkKICAgICAgICBpZiAoIXRoLmNhbnZhcy5wYXJlbnROb2RlLmNvbnRhaW5zKGV2
LnRhcmdldCkgJiYgdGgubW91c2VEb3duKQogICAgICAgICAgcmV0dXJuIHRoLmRpc3BhdGNoRXZl
bnQoZXYpCiAgICAgIH0KCiAgICB9CgogICAgdGhpcy5jYW52YXMucGFyZW50Tm9kZS5hZGRFdmVu
dExpc3RlbmVyKCdET01Ob2RlUmVtb3ZlZCcsIGZ1bmN0aW9uKGV2KSB7CiAgICAgIGlmIChldi50
YXJnZXQgPT0gdGhpcykKICAgICAgICB0aC5yZW1vdmVXaW5kb3dFdmVudExpc3RlbmVycygpCiAg
ICB9LCBmYWxzZSkKICAgIHRoaXMuY2FudmFzLnBhcmVudE5vZGUuYWRkRXZlbnRMaXN0ZW5lcign
RE9NTm9kZUluc2VydGVkJywgZnVuY3Rpb24oZXYpIHsKICAgICAgaWYgKGV2LnRhcmdldCA9PSB0
aGlzKQogICAgICAgIHRoLmFkZFdpbmRvd0V2ZW50TGlzdGVuZXJzKCkKICAgIH0sIGZhbHNlKQog
ICAgaWYgKHRoaXMuY2FudmFzLnBhcmVudE5vZGUucGFyZW50Tm9kZSkgdGhpcy5hZGRXaW5kb3dF
dmVudExpc3RlbmVycygpCiAgfSwKCiAgdXBkYXRlS2V5cyA6IGZ1bmN0aW9uKGV2KSB7CiAgICB0
aGlzLmtleXMuc2hpZnQgPSBldi5zaGlmdEtleQogICAgdGhpcy5rZXlzLmN0cmwgPSBldi5jdHJs
S2V5CiAgICB0aGlzLmtleXMuYWx0ID0gZXYuYWx0S2V5CiAgICB0aGlzLmtleXMubWV0YSA9IGV2
Lm1ldGFLZXkKICAgIHZhciBzdGF0ZSA9IChldi50eXBlID09ICdrZXlkb3duJykKICAgIHN3aXRj
aCAoZXYua2V5Q29kZSkgewogICAgICBjYXNlIDM3OiB0aGlzLmtleXMubGVmdCA9IHN0YXRlOyBi
cmVhawogICAgICBjYXNlIDM4OiB0aGlzLmtleXMudXAgPSBzdGF0ZTsgYnJlYWsKICAgICAgY2Fz
ZSAzOTogdGhpcy5rZXlzLnJpZ2h0ID0gc3RhdGU7IGJyZWFrCiAgICAgIGNhc2UgNDA6IHRoaXMu
a2V5cy5kb3duID0gc3RhdGU7IGJyZWFrCiAgICAgIGNhc2UgMzI6IHRoaXMua2V5cy5zcGFjZSA9
IHN0YXRlOyBicmVhawogICAgICBjYXNlIDEzOiB0aGlzLmtleXMuZW50ZXIgPSBzdGF0ZTsgYnJl
YWsKICAgICAgY2FzZSA5OiB0aGlzLmtleXMudGFiID0gc3RhdGU7IGJyZWFrCiAgICAgIGNhc2Ug
ODogdGhpcy5rZXlzLmJhY2tzcGFjZSA9IHN0YXRlOyBicmVhawogICAgICBjYXNlIDE2OiB0aGlz
LmtleXMuc2hpZnQgPSBzdGF0ZTsgYnJlYWsKICAgICAgY2FzZSAxNzogdGhpcy5rZXlzLmN0cmwg
PSBzdGF0ZTsgYnJlYWsKICAgICAgY2FzZSAxODogdGhpcy5rZXlzLmFsdCA9IHN0YXRlOyBicmVh
awogICAgfQogICAgdGhpcy5rZXlzW2V2LmtleUNvZGVdID0gc3RhdGUKICB9LAoKICBhZGRXaW5k
b3dFdmVudExpc3RlbmVycyA6IGZ1bmN0aW9uKCkgewogICAgZm9yICh2YXIgaSBpbiB0aGlzLndp
bmRvd0V2ZW50TGlzdGVuZXJzKQogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihpLCB0aGlz
LndpbmRvd0V2ZW50TGlzdGVuZXJzW2ldLCBmYWxzZSkKICB9LAoKICByZW1vdmVXaW5kb3dFdmVu
dExpc3RlbmVycyA6IGZ1bmN0aW9uKCkgewogICAgZm9yICh2YXIgaSBpbiB0aGlzLndpbmRvd0V2
ZW50TGlzdGVuZXJzKQogICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihpLCB0aGlzLndp
bmRvd0V2ZW50TGlzdGVuZXJzW2ldLCBmYWxzZSkKICB9LAoKICBhZGRNb3VzZUV2ZW50IDogZnVu
Y3Rpb24oeCx5LG1vdXNlRG93bikgewogICAgdmFyIGEgPSB0aGlzLmFsbG9jTW91c2VFdmVudCgp
CiAgICBhWzBdID0geAogICAgYVsxXSA9IHkKICAgIGFbMl0gPSBtb3VzZURvd24KICAgIHRoaXMu
bW91c2VFdmVudHMucHVzaChhKQogIH0sCgogIGFsbG9jTW91c2VFdmVudCA6IGZ1bmN0aW9uKCkg
ewogICAgaWYgKHRoaXMubW91c2VFdmVudFN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgcmV0dXJu
IHRoaXMubW91c2VFdmVudFN0YWNrLnBvcCgpCiAgICB9IGVsc2UgewogICAgICByZXR1cm4gW251
bGwsIG51bGwsIG51bGxdCiAgICB9CiAgfSwKCiAgZnJlZU1vdXNlRXZlbnQgOiBmdW5jdGlvbihl
dikgewogICAgdGhpcy5tb3VzZUV2ZW50U3RhY2sucHVzaChldikKICAgIGlmICh0aGlzLm1vdXNl
RXZlbnRTdGFjay5sZW5ndGggPiAxMDApCiAgICAgIHRoaXMubW91c2VFdmVudFN0YWNrLnNwbGlj
ZSgwLHRoaXMubW91c2VFdmVudFN0YWNrLmxlbmd0aCkKICB9LAoKICBjbGVhck1vdXNlRXZlbnRz
IDogZnVuY3Rpb24oKSB7CiAgICB3aGlsZSAodGhpcy5tb3VzZUV2ZW50cy5sZW5ndGggPiAwKQog
ICAgICB0aGlzLmZyZWVNb3VzZUV2ZW50KHRoaXMubW91c2VFdmVudHMucG9wKCkpCiAgfSwKCiAg
Y3JlYXRlRnJhbWVMb29wIDogZnVuY3Rpb24oKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2
YXIgZmwgPSB7CiAgICAgIHJ1bm5pbmcgOiB0cnVlLAogICAgICBzdG9wIDogZnVuY3Rpb24oKSB7
CiAgICAgICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7CiAgICAgIH0sCiAgICAgIHJ1biA6IGZ1bmN0
aW9uKCkgewogICAgICAgIGlmIChmbC5ydW5uaW5nKSB7CiAgICAgICAgICBzZWxmLm9uRnJhbWUo
KTsKICAgICAgICAgIHJlcXVlc3RBbmltRnJhbWUoZmwucnVuLCBzZWxmLmNhbnZhcyk7CiAgICAg
ICAgfQogICAgICB9CiAgICB9OwogICAgcmVxdWVzdEFuaW1GcmFtZShmbC5ydW4sIHRoaXMuY2Fu
dmFzKTsKICAgIHJldHVybiBmbDsKICB9LAoKICAvKioKICAgIFN0YXJ0IGZyYW1lIGxvb3AuCgog
ICAgVGhlIGZyYW1lIGxvb3AgaXMgYW4gaW50ZXJ2YWwsIHdoZXJlICNvbkZyYW1lIGlzIGNhbGxl
ZCBldmVyeQogICAgI2ZyYW1lRHVyYXRpb24gbWlsbGlzZWNvbmRzLgogICAgKi8KICBwbGF5IDog
ZnVuY3Rpb24oKSB7CiAgICB0aGlzLnN0b3AoKTsKICAgIHRoaXMucmVhbFRpbWUgPSBuZXcgRGF0
ZSgpLmdldFRpbWUoKTsKICAgIHRoaXMuZnJhbWVMb29wID0gdGhpcy5jcmVhdGVGcmFtZUxvb3Ao
KTsKICAgIHRoaXMuaXNQbGF5aW5nID0gdHJ1ZTsKICB9LAoKICAvKioKICAgIFN0b3AgZnJhbWUg
bG9vcC4KICAgICovCiAgc3RvcCA6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fX2JsdXJTdG9wID0g
ZmFsc2U7CiAgICBpZiAodGhpcy5mcmFtZUxvb3ApIHsKICAgICAgdGhpcy5mcmFtZUxvb3Auc3Rv
cCgpOwogICAgICB0aGlzLmZyYW1lTG9vcCA9IG51bGw7CiAgICB9CiAgICB0aGlzLmlzUGxheWlu
ZyA9IGZhbHNlOwogIH0sCgogIGRpc3BhdGNoRXZlbnQgOiBmdW5jdGlvbihldikgewogICAgdmFy
IHJ2ID0gQ2FudmFzTm9kZS5wcm90b3R5cGUuZGlzcGF0Y2hFdmVudC5jYWxsKHRoaXMsIGV2KQog
ICAgaWYgKGV2LmN1cnNvcikgewogICAgICBpZiAodGhpcy5jYW52YXMuc3R5bGUuY3Vyc29yICE9
IGV2LmN1cnNvcikKICAgICAgICB0aGlzLmNhbnZhcy5zdHlsZS5jdXJzb3IgPSBldi5jdXJzb3IK
ICAgIH0gZWxzZSB7CiAgICAgIGlmICh0aGlzLmNhbnZhcy5zdHlsZS5jdXJzb3IgIT0gdGhpcy5j
dXJzb3IpCiAgICAgICAgdGhpcy5jYW52YXMuc3R5bGUuY3Vyc29yID0gdGhpcy5jdXJzb3IKICAg
IH0KICAgIHJldHVybiBydgogIH0sCgogIC8qKgogICAgVGhlIGZyYW1lIGxvb3AgZnVuY3Rpb24u
IENhbGxlZCBldmVyeSAjZnJhbWVEdXJhdGlvbiBtaWxsaXNlY29uZHMuCiAgICBUYWtlcyBhbiBv
cHRpb25hbCBleHRlcm5hbCB0aW1lIHBhcmFtZXRlciAoZm9yIHN5bmNpbmcgQ2FudmFzZXMgd2l0
aCBlYWNoCiAgICBvdGhlciwgZS5nLiB3aGVuIHVzaW5nIGEgQ2FudmFzIGFzIGFuIGltYWdlLikK
CiAgICBJZiB0aGUgdGltZSBwYXJhbWV0ZXIgaXMgZ2l2ZW4sIHRoZSBzZWNvbmQgcGFyYW1ldGVy
IGlzIHVzZWQgYXMgdGhlIGZyYW1lCiAgICB0aW1lIGRlbHRhIChpLmUuIHRoZSB0aW1lIGVsYXBz
ZWQgc2luY2UgbGFzdCBmcmFtZS4pCgogICAgSWYgdGltZSBvciB0aW1lRGVsdGEgaXMgbm90IGdp
dmVuLCB0aGUgY2FudmFzIGNvbXB1dGVzIGl0cyBvd24gdGltZURlbHRhLgoKICAgIEBwYXJhbSB0
aW1lIFRoZSBleHRlcm5hbCB0aW1lLiBPcHRpb25hbC4KICAgIEBwYXJhbSB0aW1lRGVsdGEgVGlt
ZSBzaW5jZSBsYXN0IGZyYW1lIGluIG1pbGxpc2Vjb25kcy4gT3B0aW9uYWwuCiAgICAqLwogIG9u
RnJhbWUgOiBmdW5jdGlvbih0aW1lLCB0aW1lRGVsdGEpIHsKICAgIHRoaXMuZWxlbWVudE5vZGVa
SW5kZXhDb3VudGVyID0gMAogICAgdmFyIGN0eCA9IHRoaXMuZ2V0Q29udGV4dCgpCiAgICB0cnkg
ewogICAgICB2YXIgcmVhbFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKQogICAgICB0aGlzLmN1
cnJlbnRSZWFsRWxhcHNlZCA9IChyZWFsVGltZSAtIHRoaXMucmVhbFRpbWUpCiAgICAgIHRoaXMu
Y3VycmVudFJlYWxGcHMgPSAxMDAwIC8gdGhpcy5jdXJyZW50UmVhbEVsYXBzZWQKICAgICAgdmFy
IGR0ID0gdGhpcy5mcmFtZUR1cmF0aW9uICogdGhpcy5zcGVlZAogICAgICBpZiAoIXRoaXMuZml4
ZWRUaW1lc3RlcCkKICAgICAgICBkdCA9IHRoaXMuY3VycmVudFJlYWxFbGFwc2VkICogdGhpcy5z
cGVlZAogICAgICB0aGlzLnJlYWxUaW1lID0gcmVhbFRpbWUKICAgICAgaWYgKHRpbWUgIT0gbnVs
bCkgewogICAgICAgIHRoaXMudGltZSA9IHRpbWUKICAgICAgICBpZiAodGltZURlbHRhKQogICAg
ICAgICAgZHQgPSB0aW1lRGVsdGEKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnRpbWUgKz0g
ZHQKICAgICAgfQogICAgICB0aGlzLnByZXZpb3VzVGFyZ2V0ID0gdGhpcy50YXJnZXQKICAgICAg
dGhpcy50YXJnZXQgPSBudWxsCiAgICAgIGlmICh0aGlzLmNhdGNoTW91c2UpCiAgICAgICAgdGhp
cy5oYW5kbGVQaWNrKGN0eCkKICAgICAgaWYgKHRoaXMucHJldmlvdXNUYXJnZXQgIT0gdGhpcy50
YXJnZXQpIHsKICAgICAgICBpZiAodGhpcy5wcmV2aW91c1RhcmdldCkgewogICAgICAgICAgdmFy
IG5ldiA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdNb3VzZUV2ZW50cycpCiAgICAgICAgICBuZXYu
aW5pdE1vdXNlRXZlbnQoJ21vdXNlb3V0JywgdHJ1ZSwgdHJ1ZSwgd2luZG93LAogICAgICAgICAg
ICAwLCAwLCAwLCAwLCAwLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgMCwgbnVsbCkKICAg
ICAgICAgIG5ldi5jYW52YXNUYXJnZXQgPSB0aGlzLnByZXZpb3VzVGFyZ2V0CiAgICAgICAgICB0
aGlzLmRpc3BhdGNoRXZlbnQobmV2KQogICAgICAgIH0KICAgICAgICBpZiAodGhpcy50YXJnZXQp
IHsKICAgICAgICAgIHZhciBuZXYgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnTW91c2VFdmVudHMn
KQogICAgICAgICAgbmV2LmluaXRNb3VzZUV2ZW50KCdtb3VzZW92ZXInLCB0cnVlLCB0cnVlLCB3
aW5kb3csCiAgICAgICAgICAgIDAsIDAsIDAsIDAsIDAsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZh
bHNlLCAwLCBudWxsKQogICAgICAgICAgbmV2LmNhbnZhc1RhcmdldCA9IHRoaXMudGFyZ2V0CiAg
ICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQobmV2KQogICAgICAgIH0KICAgICAgfQogICAgICB0
aGlzLmhhbmRsZVVwZGF0ZSh0aGlzLnRpbWUsIGR0KQogICAgICB0aGlzLmNsZWFyTW91c2VFdmVu
dHMoKQogICAgICBpZiAoIXRoaXMucmVkcmF3T25seVdoZW5DaGFuZ2VkIHx8IHRoaXMuY2hhbmdl
ZCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICB0aGlzLmhhbmRsZURyYXcoY3R4KQogICAgICAg
IH0gY2F0Y2goZSkgewogICAgICAgICAgY29uc29sZS5sb2coZSkKICAgICAgICAgIHRocm93KGUp
CiAgICAgICAgfQogICAgICAgIHRoaXMuY2hhbmdlZCA9IGZhbHNlCiAgICAgIH0KICAgICAgdGhp
cy5jdXJyZW50RWxhcHNlZCA9IChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMucmVhbFRpbWUp
CiAgICAgIHRoaXMuZWxhcHNlZCArPSB0aGlzLmN1cnJlbnRFbGFwc2VkCiAgICAgIHRoaXMuY3Vy
cmVudEZwcyA9IDEwMDAgLyB0aGlzLmN1cnJlbnRFbGFwc2VkCiAgICAgIHRoaXMuZnJhbWUrKwog
ICAgICBpZiAodGhpcy5mcmFtZSAlIHRoaXMuZnBzRnJhbWVzID09IDApIHsKICAgICAgICB0aGlz
LmZwcyA9IHRoaXMuZnBzRnJhbWVzKjEwMDAgLyAodGhpcy5lbGFwc2VkKQogICAgICAgIHRoaXMu
cmVhbEZwcyA9IHRoaXMuZnBzRnJhbWVzKjEwMDAgLyAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0
aGlzLnN0YXJ0VGltZSkKICAgICAgICB0aGlzLmVsYXBzZWQgPSAwCiAgICAgICAgdGhpcy5zdGFy
dFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKQogICAgICB9CiAgICB9IGNhdGNoKGUpIHsKICAg
ICAgaWYgKGN0eCkgewogICAgICAgIC8vIHNjcmV3ZWQgdXAsIGNvbnRleHQgaXMgYm9ya2VkCiAg
ICAgICAgdHJ5IHsKICAgICAgICAgIC8vIEZJWE1FIGRvbid0IGJlIHN0dXBpZAogICAgICAgICAg
Zm9yICh2YXIgaT0wOyBpPDEwMDA7IGkrKykKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKQogICAg
ICAgIH0gY2F0Y2goZXIpIHt9CiAgICAgIH0KICAgICAgZGVsZXRlIHRoaXMuY29udGV4dAogICAg
ICB0aHJvdyhlKQogICAgfQogIH0sCgogIC8qKgogICAgUmV0dXJucyB0aGUgY2FudmFzIGRyYXdp
bmcgY29udGV4dCBvYmplY3QuCgogICAgQHJldHVybiBDYW52YXMgZHJhd2luZyBjb250ZXh0CiAg
ICAqLwogIGdldENvbnRleHQgOiBmdW5jdGlvbigpIHsKICAgIGlmICh0aGlzLnJlY29yZGluZykK
ICAgICAgcmV0dXJuIHRoaXMuZ2V0UmVjb3JkaW5nQ29udGV4dCgpCiAgICBlbHNlIGlmICh0aGlz
LnVzZU1vY2tDb250ZXh0KQogICAgICByZXR1cm4gdGhpcy5nZXRNb2NrQ29udGV4dCgpCiAgICBl
bHNlCiAgICAgIHJldHVybiB0aGlzLmdldDJEQ29udGV4dCgpCiAgfSwKCiAgLyoqCiAgICBHZXRz
IGFuZCByZXR1cm5zIGFuIGF1Z21lbnRlZCBjYW52YXMgMkQgZHJhd2luZyBjb250ZXh0LgoKICAg
IFRoZSBjYW52YXMgMkQgY29udGV4dCBpcyBhdWdtZW50ZWQgYnkgc2V0dGVyIGZ1bmN0aW9ucyBm
b3IgYWxsCiAgICBpdHMgaW5zdGFuY2UgdmFyaWFibGVzLCBtYWtpbmcgaXQgZWFzaWVyIHRvIHJl
Y29yZCBjYW52YXMgb3BlcmF0aW9ucyBpbgogICAgYSBjcm9zcy1icm93c2VyIGZhc2hpb24uCiAg
ICAqLwogIGdldDJEQ29udGV4dCA6IGZ1bmN0aW9uKCkgewogICAgaWYgKCF0aGlzLmNvbnRleHQp
IHsKICAgICAgdmFyIGN0eCA9IENhbnZhc1N1cHBvcnQuZ2V0Q29udGV4dCh0aGlzLmNhbnZhcywg
JzJkJykKICAgICAgdGhpcy5jb250ZXh0ID0gY3R4CiAgICB9CiAgICByZXR1cm4gdGhpcy5jb250
ZXh0CiAgfSwKCiAgLyoqCiAgICBDcmVhdGVzIGFuZCByZXR1cm5zIGEgbW9jayBkcmF3aW5nIGNv
bnRleHQuCgogICAgQHJldHVybiBNb2NrIGRyYXdpbmcgY29udGV4dAogICAgKi8KICBnZXRNb2Nr
Q29udGV4dCA6IGZ1bmN0aW9uKCkgewogICAgaWYgKCF0aGlzLmZha2VDb250ZXh0KSB7CiAgICAg
IHZhciBjdHggPSB0aGlzLmdldDJEQ29udGV4dCgpCiAgICAgIHRoaXMuZmFrZUNvbnRleHQgPSB7
fQogICAgICB2YXIgZiA9IGZ1bmN0aW9uKCl7IHJldHVybiB0aGlzIH0KICAgICAgZm9yICh2YXIg
aSBpbiBjdHgpIHsKICAgICAgICBpZiAodHlwZW9mKGN0eFtpXSkgPT0gJ2Z1bmN0aW9uJykKICAg
ICAgICAgIHRoaXMuZmFrZUNvbnRleHRbaV0gPSBmCiAgICAgICAgZWxzZQogICAgICAgICAgdGhp
cy5mYWtlQ29udGV4dFtpXSA9IGN0eFtpXQogICAgICB9CiAgICAgIHRoaXMuZmFrZUNvbnRleHQu
aXNNb2NrT2JqZWN0ID0gdHJ1ZQogICAgICB0aGlzLmZha2VDb250ZXh0LmFkZENvbG9yU3RvcCA9
IGYKICAgIH0KICAgIHJldHVybiB0aGlzLmZha2VDb250ZXh0CiAgfSwKCiAgZ2V0UmVjb3JkaW5n
Q29udGV4dCA6IGZ1bmN0aW9uKCkgewogICAgaWYgKCF0aGlzLnJlY29yZGluZ0NvbnRleHQpCiAg
ICAgIHRoaXMucmVjb3JkaW5nQ29udGV4dCA9IG5ldyBSZWNvcmRpbmdDb250ZXh0KCkKICAgIHJl
dHVybiB0aGlzLnJlY29yZGluZ0NvbnRleHQKICB9LAoKICAvKioKICAgIENhbnZhcyBkcmF3UGlj
a2luZ1BhdGggdXNlcyB0aGUgY2FudmFzIHJlY3RhbmdsZSBhcyBpdHMgcGF0aC4KCiAgICBAcGFy
YW0gY3R4IENhbnZhcyBkcmF3aW5nIGNvbnRleHQKICAgICovCiAgZHJhd1BpY2tpbmdQYXRoIDog
ZnVuY3Rpb24oY3R4KSB7CiAgICBjdHgucmVjdCgwLDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlz
LmNhbnZhcy5oZWlnaHQpCiAgfSwKCiAgaXNQb2ludEluUGF0aCA6IGZ1bmN0aW9uKHgseSkgewog
ICAgcmV0dXJuICgoeCA+PSAwKSAmJiAoeCA8PSB0aGlzLmNhbnZhcy53aWR0aCkgJiYgKHkgPj0g
MCkgJiYgKHkgPD0gdGhpcy5jYW52YXMuaGVpZ2h0KSkKICB9LAoKICAvKioKICAgIFNldHMgZ2xv
YmFsQWxwaGEgdG8gdGhpcy5vcGFjaXR5IGFuZCBjbGVhcnMgdGhlIGNhbnZhcyBpZiAjY2xlYXIg
aXMgc2V0IHRvCiAgICB0cnVlLiBJZiAjZmlsbCBpcyBhbHNvIHNldCB0byB0cnVlLCBmaWxscyB0
aGUgY2FudmFzIHJlY3RhbmdsZSBpbnN0ZWFkIG9mCiAgICBjbGVhcmluZyAodXNpbmcgI2ZpbGxT
dHlsZSBhcyB0aGUgY29sb3IuKQoKICAgIEBwYXJhbSBjdHggQ2FudmFzIGRyYXdpbmcgY29udGV4
dAogICAgKi8KICBkcmF3IDogZnVuY3Rpb24oY3R4KSB7CiAgICBjdHguc2V0R2xvYmFsQWxwaGEo
IHRoaXMub3BhY2l0eSApCiAgICBpZiAodGhpcy5jbGVhcikgewogICAgICBpZiAoY3R4LmZpbGxP
bikgewogICAgICAgIGN0eC5iZWdpblBhdGgoKQogICAgICAgIGN0eC5yZWN0KDAsMCwgdGhpcy5j
YW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCkKICAgICAgICBjdHguZmlsbCgpCiAgICAg
IH0gZWxzZSB7CiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLDAsIHRoaXMuY2FudmFzLndpZHRoLCB0
aGlzLmNhbnZhcy5oZWlnaHQpCiAgICAgIH0KICAgIH0KICAgIC8vIHNldCBkZWZhdWx0IGZpbGwg
YW5kIHN0cm9rZSBmb3IgdGhlIGNhbnZhcyBjb250ZW50cwogICAgY3R4LmZpbGxTdHlsZSA9ICdi
bGFjaycKICAgIGN0eC5zdHJva2VTdHlsZSA9ICdibGFjaycKICAgIGN0eC5maWxsT24gPSBmYWxz
ZQogICAgY3R4LnN0cm9rZU9uID0gZmFsc2UKICB9Cn0pCgoKLyoqCiAgSGFja3kgbGluayBjbGFz
cyBmb3IgZW11bGF0aW5nIDxhPi4KCiAgVGhlIGNvcnJlY3Qgd2F5IHdvdWxkIGJlIHRvIGhhdmUg
YSByZWFsIDxhPiB1bmRlciB0aGUgY3Vyc29yIHdoaWxlIGhvdmVyaW5nCiAgdGhpcywgb3IgYW4g
aW1hZ2VtYXAgcG9seWdvbiBidWlsdCBmcm9tIHRoZSBjbGlwcGVkIHN1YnRyZWUgcGF0aC4KCiAg
QHBhcmFtIGhyZWYgTGluayBocmVmLgogIEBwYXJhbSB0YXJnZXQgTGluayB0YXJnZXQsIGRlZmF1
bHRzIHRvIF9zZWxmLgogIEBwYXJhbSBjb25maWcgT3B0aW9uYWwgY29uZmlnIGhhc2guCiAgKi8K
TGlua05vZGUgPSBLbGFzcyhDYW52YXNOb2RlLCB7CiAgaHJlZiA6IG51bGwsCiAgdGFyZ2V0IDog
J19zZWxmJywKICBjdXJzb3IgOiAncG9pbnRlcicsCgogIGluaXRpYWxpemUgOiBmdW5jdGlvbiho
cmVmLCB0YXJnZXQsIGNvbmZpZykgewogICAgdGhpcy5ocmVmID0gaHJlZgogICAgaWYgKHRhcmdl
dCkKICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQKICAgIENhbnZhc05vZGUuaW5pdGlhbGl6ZS5j
YWxsKHRoaXMsIGNvbmZpZykKICAgIHRoaXMuc2V0dXBMaW5rRXZlbnRMaXN0ZW5lcnMoKQogIH0s
CgogIHNldHVwTGlua0V2ZW50TGlzdGVuZXJzIDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLmFkZEV2
ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZXYpIHsKICAgICAgaWYgKGV2LmJ1dHRvbiA9
PSBNb3VzZS5SSUdIVCkgcmV0dXJuCiAgICAgIHZhciB0YXJnZXQgPSB0aGlzLnRhcmdldAogICAg
ICBpZiAoKGV2LmN0cmxLZXkgfHwgZXYuYnV0dG9uID09IE1vdXNlLk1JRERMRSkgJiYgdGFyZ2V0
ID09ICdfc2VsZicpCiAgICAgICAgdGFyZ2V0ID0gJ19ibGFuaycKICAgICAgd2luZG93Lm9wZW4o
dGhpcy5ocmVmLCB0YXJnZXQpCiAgICB9LCBmYWxzZSkKICB9Cn0pCgoKLyoqCiAgQXVkaW9Ob2Rl
IGlzIGEgQ2FudmFzTm9kZSB1c2VkIHRvIHBsYXkgYSBzb3VuZC4KCiAgKi8KQXVkaW9Ob2RlID0g
S2xhc3MoQ2FudmFzTm9kZSwgewogIHJlYWR5IDogZmFsc2UsCiAgYXV0b1BsYXkgOiBmYWxzZSwK
ICBwbGF5aW5nIDogZmFsc2UsCiAgcGF1c2VkIDogZmFsc2UsCiAgcGFuIDogMCwKICB2b2x1bWUg
OiAxLAogIGxvb3AgOiBmYWxzZSwKCiAgdHJhbnNmb3JtU291bmQgOiBmYWxzZSwKCiAgaW5pdGlh
bGl6ZSA6IGZ1bmN0aW9uKGZpbGVuYW1lLCBwYXJhbXMpIHsKICAgIENhbnZhc05vZGUuaW5pdGlh
bGl6ZS5jYWxsKHRoaXMsIHBhcmFtcykKICAgIHRoaXMuZmlsZW5hbWUgPSBmaWxlbmFtZQogICAg
dGhpcy53aGVuKCdsb2FkJywgdGhpcy5fYXV0b1BsYXlTb3VuZCkKICAgIHRoaXMubG9hZFNvdW5k
KCkKICB9LAoKICBsb2FkU291bmQgOiBmdW5jdGlvbigpIHsKICAgIHRoaXMuc291bmQgPSBDYW52
YXNTdXBwb3J0LmdldFNvdW5kT2JqZWN0KCkKICAgIGlmICghdGhpcy5zb3VuZCkgcmV0dXJuCiAg
ICB2YXIgc2VsZiA9IHRoaXMKICAgIHRoaXMuc291bmQub25yZWFkeSA9IGZ1bmN0aW9uKCkgewog
ICAgICBzZWxmLnJlYWR5ID0gdHJ1ZQogICAgICBzZWxmLnJvb3QuZGlzcGF0Y2hFdmVudCh7dHlw
ZTogJ3JlYWR5JywgY2FudmFzVGFyZ2V0OiBzZWxmfSkKICAgIH0KICAgIHRoaXMuc291bmQub25s
b2FkID0gZnVuY3Rpb24oKSB7CiAgICAgIHNlbGYubG9hZGVkID0gdHJ1ZQogICAgICBzZWxmLnJv
b3QuZGlzcGF0Y2hFdmVudCh7dHlwZTogJ2xvYWQnLCBjYW52YXNUYXJnZXQ6IHNlbGZ9KQogICAg
fQogICAgdGhpcy5zb3VuZC5vbmVycm9yID0gZnVuY3Rpb24oKSB7CiAgICAgIHNlbGYucm9vdC5k
aXNwYXRjaEV2ZW50KHt0eXBlOiAnZXJyb3InLCBjYW52YXNUYXJnZXQ6IHNlbGZ9KQogICAgfQog
ICAgdGhpcy5zb3VuZC5vbmZpbmlzaCA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAoc2VsZi5sb29w
KSBzZWxmLnBsYXkoKQogICAgICBlbHNlIHNlbGYuc3RvcCgpCiAgICB9CiAgICB0aGlzLnNvdW5k
LmxvYWQodGhpcy5maWxlbmFtZSkKICB9LAoKICBwbGF5IDogZnVuY3Rpb24oKSB7CiAgICB0aGlz
LnBsYXlpbmcgPSB0cnVlCiAgICB0aGlzLm5lZWRQbGF5VXBkYXRlID0gdHJ1ZQogIH0sCgogIHN0
b3AgOiBmdW5jdGlvbigpIHsKICAgIHRoaXMucGxheWluZyA9IGZhbHNlCiAgICB0aGlzLm5lZWRQ
bGF5VXBkYXRlID0gdHJ1ZQogIH0sCgogIHBhdXNlIDogZnVuY3Rpb24oKSB7CiAgICBpZiAodGhp
cy5uZWVkUGF1c2VVcGRhdGUpIHsKICAgICAgdGhpcy5uZWVkUGF1c2VVcGRhdGUgPSBmYWxzZQog
ICAgICByZXR1cm4KICAgIH0KICAgIHRoaXMucGF1c2VkID0gIXRoaXMucGF1c2VkCiAgICB0aGlz
Lm5lZWRQYXVzZVVwZGF0ZSA9IHRydWUKICB9LAoKICBzZXRWb2x1bWUgOiBmdW5jdGlvbih2KSB7
CiAgICB0aGlzLnZvbHVtZSA9IHYKICAgIHRoaXMubmVlZFN0YXR1c1VwZGF0ZSA9IHRydWUKICB9
LAoKICBzZXRQYW4gOiBmdW5jdGlvbihwKSB7CiAgICB0aGlzLnBhbiA9IHAKICAgIHRoaXMubmVl
ZFN0YXR1c1VwZGF0ZSA9IHRydWUKICB9LAoKICBoYW5kbGVVcGRhdGUgOiBmdW5jdGlvbigpIHsK
ICAgIENhbnZhc05vZGUuaGFuZGxlVXBkYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgIGlm
ICh0aGlzLndpbGxCZURyYXduKSB7CiAgICAgIHRoaXMudHJhbnNmb3JtKG51bGwsIHRydWUpCiAg
ICAgIGlmICghdGhpcy5zb3VuZCkgdGhpcy5sb2FkU291bmQoKQogICAgICBpZiAodGhpcy5yZWFk
eSkgewogICAgICAgIGlmICh0aGlzLnRyYW5zZm9ybVNvdW5kKSB7CiAgICAgICAgICB2YXIgeCA9
IHRoaXMuY3VycmVudE1hdHJpeFs0XQogICAgICAgICAgdmFyIHkgPSB0aGlzLmN1cnJlbnRNYXRy
aXhbNV0KICAgICAgICAgIHZhciBhID0gdGhpcy5jdXJyZW50TWF0cml4WzJdCiAgICAgICAgICB2
YXIgYiA9IHRoaXMuY3VycmVudE1hdHJpeFszXQogICAgICAgICAgdmFyIGMgPSB0aGlzLmN1cnJl
bnRNYXRyaXhbMF0KICAgICAgICAgIHZhciBkID0gdGhpcy5jdXJyZW50TWF0cml4WzFdCiAgICAg
ICAgICB2YXIgaHcgPSB0aGlzLnJvb3Qud2lkdGggKiAwLjUKICAgICAgICAgIHZhciB5cyA9IE1h
dGguc3FydChhKmEgKyBiKmIpCiAgICAgICAgICB2YXIgeHMgPSBNYXRoLnNxcnQoYypjICsgZCpk
KQogICAgICAgICAgdGhpcy5zZXRWb2x1bWUoeXMpCiAgICAgICAgICB0aGlzLnNldFBhbigoeCAt
IGh3KSAvIGh3KQogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5uZWVkUGF1c2VVcGRhdGUpIHsK
ICAgICAgICAgIHRoaXMubmVlZFBhdXNlVXBkYXRlID0gZmFsc2UKICAgICAgICAgIHRoaXMuX3Bh
dXNlU291bmQoKQogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5uZWVkUGxheVVwZGF0ZSkgewog
ICAgICAgICAgdGhpcy5uZWVkUGxheVVwZGF0ZSA9IGZhbHNlCiAgICAgICAgICBpZiAodGhpcy5w
bGF5aW5nKSB0aGlzLl9wbGF5U291bmQoKQogICAgICAgICAgZWxzZSB0aGlzLl9zdG9wU291bmQo
KQogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5uZWVkU3RhdHVzVXBkYXRlKSB7CiAgICAgICAg
ICB0aGlzLl9zZXRTb3VuZFZvbHVtZSgpCiAgICAgICAgICB0aGlzLl9zZXRTb3VuZFBhbigpCiAg
ICAgICAgfQogICAgICB9CiAgICB9CiAgfSwKCiAgX2F1dG9QbGF5U291bmQgOiBmdW5jdGlvbigp
IHsKICAgIGlmICh0aGlzLmF1dG9QbGF5KSB0aGlzLnBsYXkoKQogIH0sCgogIF9zZXRTb3VuZFZv
bHVtZSA6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5zb3VuZC5zZXRWb2x1bWUodGhpcy52b2x1bWUp
CiAgfSwKCiAgX3NldFNvdW5kUGFuIDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLnNvdW5kLnNldFBh
bih0aGlzLnBhbikKICB9LAoKICBfcGxheVNvdW5kIDogZnVuY3Rpb24oKSB7CiAgICBpZiAodGhp
cy5zb3VuZC5wbGF5KCkgPT0gZmFsc2UpCiAgICAgIHJldHVybiB0aGlzLnBsYXlpbmcgPSBmYWxz
ZQogICAgdGhpcy5yb290LmRpc3BhdGNoRXZlbnQoe3R5cGU6ICdwbGF5JywgY2FudmFzVGFyZ2V0
OiB0aGlzfSkKICB9LAoKICBfc3RvcFNvdW5kIDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLnNvdW5k
LnN0b3AoKQogICAgdGhpcy5yb290LmRpc3BhdGNoRXZlbnQoe3R5cGU6ICdzdG9wJywgY2FudmFz
VGFyZ2V0OiB0aGlzfSkKICB9LAoKICBfcGF1c2VTb3VuZCA6IGZ1bmN0aW9uKCkgewogICAgdGhp
cy5zb3VuZC5wYXVzZSgpCiAgICB0aGlzLnJvb3QuZGlzcGF0Y2hFdmVudCh7dHlwZTogdGhpcy5w
YXVzZWQgPyAncGF1c2UnIDogJ3BsYXknLCBjYW52YXNUYXJnZXQ6IHRoaXN9KQogIH0KfSkKCgov
KioKICBFbGVtZW50Tm9kZSBpcyBhIENhbnZhc05vZGUgdGhhdCBoYXMgYW4gSFRNTCBlbGVtZW50
IGFzIGl0cyBjb250ZW50LgoKICBUaGUgY29udGVudCBpcyBhZGRlZCB0byBhbiBhYnNvbHV0ZWx5
IHBvc2l0aW9uZWQgSFRNTCBlbGVtZW50LCB3aGljaCBpcyBhZGRlZAogIHRvIHRoZSByb290IG5v
ZGUncyBjYW52YXNlcyBwYXJlbnROb2RlLiBUaGUgY29udGVudCBlbGVtZW50IGZvbGxvd3MgdGhl
CiAgY3VycmVudCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCgogIFRoZSBvcGFjaXR5IG9mIHRoZSBl
bGVtZW50IGlzIHNldCB0byB0aGUgZ2xvYmFsQWxwaGEgb2YgdGhlIGRyYXdpbmcgY29udGV4dAog
IHVubGVzcyAjbm9BbHBoYSBpcyB0cnVlLgoKICBUaGUgZm9udC1zaXplIG9mIHRoZSBlbGVtZW50
IGlzIHNldCB0byB0aGUgY3VycmVudCB5LXNjYWxlIHVubGVzcyAjbm9TY2FsaW5nCiAgaXMgdHJ1
ZS4KCiAgVXNlIEVsZW1lbnROb2RlIHdoZW4geW91IG5lZWQgYWNjZXNzaWJsZSB3ZWIgY29udGVu
dCBpbiB5b3VyIGFuaW1hdGlvbnMuCgogICAgdmFyIGUgPSBuZXcgRWxlbWVudE5vZGUoCiAgICAg
IEUoJ2gxJywgJ0hFUlpMSUNIIFdJTExLT01NRU4gSU0gQkFITkhPRicpLAogICAgICB7CiAgICAg
ICAgeCA6IDQwLAogICAgICAgIHkgOiAzMAogICAgICB9CiAgICApCiAgICBlLmFkZEZyYW1lTGlz
dGVuZXIoZnVuY3Rpb24odCkgewogICAgICB0aGlzLnNjYWxlID0gMSArIDAuNSpNYXRoLmNvcyh0
LzEwMDApCiAgICB9KQoKICBAcGFyYW0gY29udGVudCBBbiBIVE1MIGVsZW1lbnQgb3Igc3RyaW5n
IG9mIEhUTUwgdG8gdXNlIGFzIHRoZSBjb250ZW50LgogIEBwYXJhbSBjb25maWcgT3B0aW9uYWwg
Y29uZmlnIGhhcy4KICAqLwpFbGVtZW50Tm9kZSA9IEtsYXNzKENhbnZhc05vZGUsIHsKICBub1Nj
YWxpbmcgOiBmYWxzZSwKICBub0FscGhhIDogZmFsc2UsCiAgaW5oZXJpdCA6ICdpbmhlcml0JywK
ICBhbGlnbjogbnVsbCwgLy8gbGVmdCB8IGNlbnRlciB8IHJpZ2h0CiAgdmFsaWduOiBudWxsLCAv
LyB0b3AgfCBjZW50ZXIgfCBib3R0b20KICB4T2Zmc2V0OiAwLAogIHlPZmZzZXQ6IDAsCgogIGlu
aXRpYWxpemUgOiBmdW5jdGlvbihjb250ZW50LCBjb25maWcpIHsKICAgIENhbnZhc05vZGUuaW5p
dGlhbGl6ZS5jYWxsKHRoaXMsIGNvbmZpZykKICAgIHRoaXMuY29udGVudCA9IGNvbnRlbnQKICAg
IHRoaXMuZWxlbWVudCA9IEUoJ2RpdicsIGNvbnRlbnQpCiAgICB0aGlzLmVsZW1lbnQuc3R5bGUu
TW96VHJhbnNmb3JtT3JpZ2luID0KICAgIHRoaXMuZWxlbWVudC5zdHlsZS53ZWJraXRUcmFuc2Zv
cm1PcmlnaW4gPSAnMCAwJwogICAgdGhpcy5lbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29s
dXRlJwogIH0sCgogIGNsb25lIDogZnVuY3Rpb24oKSB7CiAgICB2YXIgYyA9IENhbnZhc05vZGUu
cHJvdG90eXBlLmNsb25lLmNhbGwodGhpcykKICAgIGlmICh0aGlzLmNvbnRlbnQgJiYgdGhpcy5j
b250ZW50LmNsb25lTm9kZSkKICAgICAgYy5jb250ZW50ID0gdGhpcy5jb250ZW50LmNsb25lTm9k
ZSh0cnVlKQogICAgYy5lbGVtZW50ID0gRSgnZGl2JywgYy5jb250ZW50KQogICAgYy5lbGVtZW50
LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJwogICAgYy5lbGVtZW50LnN0eWxlLk1velRyYW5z
Zm9ybU9yaWdpbiA9CiAgICBjLmVsZW1lbnQuc3R5bGUud2Via2l0VHJhbnNmb3JtT3JpZ2luID0g
JzAgMCcKICAgIHJldHVybiBjCiAgfSwKCiAgc2V0Um9vdCA6IGZ1bmN0aW9uKHJvb3QpIHsKICAg
IENhbnZhc05vZGUuc2V0Um9vdC5jYWxsKHRoaXMsIHJvb3QpCiAgICBpZiAodGhpcy5lbGVtZW50
ICYmIHRoaXMuZWxlbWVudC5wYXJlbnROb2RlICYmIHRoaXMuZWxlbWVudC5wYXJlbnROb2RlLnJl
bW92ZUNoaWxkKQogICAgICB0aGlzLmVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlz
LmVsZW1lbnQpCiAgfSwKCiAgaGFuZGxlVXBkYXRlIDogZnVuY3Rpb24odCwgZHQpIHsKICAgIENh
bnZhc05vZGUuaGFuZGxlVXBkYXRlLmNhbGwodGhpcywgdCwgZHQpCiAgICBpZiAoIXRoaXMud2ls
bEJlRHJhd24gfHwgIXRoaXMudmlzaWJsZSB8fCB0aGlzLmRpc3BsYXkgPT0gJ25vbmUnIHx8IHRo
aXMudmlzaWJpbGl0eSA9PSAnaGlkZGVuJyB8fCAhdGhpcy5kcmF3YWJsZSkgewogICAgICBpZiAo
dGhpcy5lbGVtZW50LnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKQogICAgICAgIHRoaXMuZWxlbWVu
dC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnCiAgICB9IGVsc2UgaWYgKHRoaXMuZWxlbWVudC5zdHls
ZS5kaXNwbGF5ID09ICdub25lJykgewogICAgICB0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9
ICdibG9jaycKICAgIH0KICB9LAoKICBhZGRFdmVudExpc3RlbmVyIDogZnVuY3Rpb24oZXZlbnQs
IGNhbGxiYWNrLCBjYXB0dXJlKSB7CiAgICB2YXIgdGggPSB0aGlzCiAgICB2YXIgY2NhbGxiYWNr
ID0gZnVuY3Rpb24oKSB7IGNhbGxiYWNrLmFwcGx5KHRoLCBhcmd1bWVudHMpIH0KICAgIHJldHVy
biB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgY2NhbGxiYWNrLCBjYXB0dXJl
fHxmYWxzZSkKICB9LAoKICByZW1vdmVFdmVudExpc3RlbmVyIDogZnVuY3Rpb24oZXZlbnQsIGNh
bGxiYWNrLCBjYXB0dXJlKSB7CiAgICB2YXIgdGggPSB0aGlzCiAgICB2YXIgY2NhbGxiYWNrID0g
ZnVuY3Rpb24oKSB7IGNhbGxiYWNrLmFwcGx5KHRoLCBhcmd1bWVudHMpIH0KICAgIHJldHVybiB0
aGlzLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudCwgY2NhbGxiYWNrLCBjYXB0dXJl
fHxmYWxzZSkKICB9LAoKICBkcmF3IDogZnVuY3Rpb24oY3R4KSB7CiAgICBpZiAodGhpcy5jdXJz
b3IgJiYgdGhpcy5lbGVtZW50LnN0eWxlLmN1cnNvciAhPSB0aGlzLmN1cnNvcikKICAgICAgdGhp
cy5lbGVtZW50LnN0eWxlLmN1cnNvciA9IHRoaXMuY3Vyc29yCiAgICBpZiAodGhpcy5lbGVtZW50
LnN0eWxlLnpJbmRleCAhPSB0aGlzLnJvb3QuZWxlbWVudE5vZGVaSW5kZXhDb3VudGVyKQogICAg
ICB0aGlzLmVsZW1lbnQuc3R5bGUuekluZGV4ID0gdGhpcy5yb290LmVsZW1lbnROb2RlWkluZGV4
Q291bnRlcgogICAgdGhpcy5yb290LmVsZW1lbnROb2RlWkluZGV4Q291bnRlcisrCiAgICB2YXIg
YmFzZVRyYW5zZm9ybSA9IHRoaXMuY3VycmVudE1hdHJpeAogICAgeG8gPSB0aGlzLnhPZmZzZXQK
ICAgIHlvID0gdGhpcy55T2Zmc2V0CiAgICBpZiAodGhpcy5maWxsQm91bmRpbmdCb3ggJiYgdGhp
cy5wYXJlbnQgJiYgdGhpcy5wYXJlbnQuZ2V0Qm91bmRpbmdCb3gpIHsKICAgICAgdmFyIGJiID0g
dGhpcy5wYXJlbnQuZ2V0Qm91bmRpbmdCb3goKQogICAgICB4byArPSBiYlswXQogICAgICB5byAr
PSBiYlsxXQogICAgfQogICAgdmFyIHh5ID0gQ2FudmFzU3VwcG9ydC50TWF0cml4TXVsdGlwbHlQ
b2ludChiYXNlVHJhbnNmb3JtLnNsaWNlKDAsNCkuY29uY2F0KFswLDBdKSwKICAgICAgeG8sIHlv
KQogICAgdmFyIHggPSB0aGlzLmN1cnJlbnRNYXRyaXhbNF0gKyB4eVswXQogICAgdmFyIHkgPSB0
aGlzLmN1cnJlbnRNYXRyaXhbNV0gKyB4eVsxXQogICAgdmFyIGEgPSB0aGlzLmN1cnJlbnRNYXRy
aXhbMl0KICAgIHZhciBiID0gdGhpcy5jdXJyZW50TWF0cml4WzNdCiAgICB2YXIgYyA9IHRoaXMu
Y3VycmVudE1hdHJpeFswXQogICAgdmFyIGQgPSB0aGlzLmN1cnJlbnRNYXRyaXhbMV0KICAgIHZh
ciB5cyA9IE1hdGguc3FydChhKmEgKyBiKmIpCiAgICB2YXIgeHMgPSBNYXRoLnNxcnQoYypjICsg
ZCpkKQogICAgaWYgKGN0eC5mb250RmFtaWx5ICE9IG51bGwpCiAgICAgIHRoaXMuZWxlbWVudC5z
dHlsZS5mb250RmFtaWx5ID0gY3R4LmZvbnRGYW1pbHkKCiAgICB2YXIgd2t0ID0gQ2FudmFzU3Vw
cG9ydC5pc0NTU1RyYW5zZm9ybVN1cHBvcnRlZCgpCiAgICBpZiAod2t0ICYmICF0aGlzLm5vU2Nh
bGluZykgewogICAgICB0aGlzLmVsZW1lbnQuc3R5bGUuTW96VHJhbnNmb3JtID0KICAgICAgdGhp
cy5lbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICdtYXRyaXgoJytiYXNlVHJhbnNmb3Jt
LmpvaW4oIiwiKSsnKScKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZWxlbWVudC5zdHlsZS5Nb3pU
cmFuc2Zvcm0gPQogICAgICB0aGlzLmVsZW1lbnQuc3R5bGUud2Via2l0VHJhbnNmb3JtID0gJycK
ICAgIH0KICAgIGlmIChjdHguZm9udFNpemUgIT0gbnVsbCkgewogICAgICBpZiAodGhpcy5ub1Nj
YWxpbmcgfHwgd2t0KSB7CiAgICAgICAgdGhpcy5lbGVtZW50LnN0eWxlLmZvbnRTaXplID0gY3R4
LmZvbnRTaXplICsgJ3B4JwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZWxlbWVudC5zdHls
ZS5mb250U2l6ZSA9IGN0eC5mb250U2l6ZSAqIHlzICsgJ3B4JwogICAgICB9CiAgICB9IGVsc2Ug
ewogICAgICBpZiAodGhpcy5ub1NjYWxpbmcgfHwgd2t0KSB7CiAgICAgICAgdGhpcy5lbGVtZW50
LnN0eWxlLmZvbnRTaXplID0gJ2luaGVyaXQnCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5l
bGVtZW50LnN0eWxlLmZvbnRTaXplID0gMTAwICogeXMgKyAnJScKICAgICAgfQogICAgfQogICAg
aWYgKHRoaXMubm9BbHBoYSkKICAgICAgdGhpcy5lbGVtZW50LnN0eWxlLm9wYWNpdHkgPSAxCiAg
ICBlbHNlCiAgICAgIHRoaXMuZWxlbWVudC5zdHlsZS5vcGFjaXR5ID0gY3R4Lmdsb2JhbEFscGhh
CiAgICBpZiAoIXRoaXMuZWxlbWVudC5wYXJlbnROb2RlICYmIHRoaXMucm9vdC5jYW52YXMucGFy
ZW50Tm9kZSkgewogICAgICB0aGlzLmVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4n
CiAgICAgIHRoaXMucm9vdC5jYW52YXMucGFyZW50Tm9kZS5hcHBlbmRDaGlsZCh0aGlzLmVsZW1l
bnQpCiAgICAgIHZhciBoaWRkZW4gPSB0cnVlCiAgICB9CiAgICB2YXIgZnMgPSB0aGlzLmNvbG9y
IHx8IHRoaXMuZmlsbAogICAgaWYgKHRoaXMucGFyZW50KSB7CiAgICAgIGlmICghZnMgfHwgIWZz
Lmxlbmd0aCkKICAgICAgICBmcyA9IHRoaXMucGFyZW50LmNvbG9yCiAgICAgIGlmICghZnMgfHwg
IWZzLmxlbmd0aCkKICAgICAgICBmcyA9IHRoaXMucGFyZW50LmZpbGwKICAgIH0KICAgIGlmICgh
ZnMgfHwgIWZzLmxlbmd0aCkKICAgICAgZnMgPSBjdHguZmlsbFN0eWxlCiAgICBpZiAodHlwZW9m
KGZzKSA9PSAnc3RyaW5nJykgewogICAgICBpZiAoZnMuc2VhcmNoKC9ecmdiYVwoLykgIT0gLTEp
IHsKICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUuY29sb3IgPSAncmdiKCcgKwogICAgICAgICAg
ZnMubWF0Y2goL1xkKy9nKS5zbGljZSgwLDMpLmpvaW4oIiwiKSArCiAgICAgICAgICAnKScKICAg
ICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUuY29sb3IgPSBmcwogICAgICB9
CiAgICB9IGVsc2UgaWYgKGZzLmxlbmd0aCkgewogICAgICB0aGlzLmVsZW1lbnQuc3R5bGUuY29s
b3IgPSAncmdiKCcgKyBmcy5zbGljZSgwLDMpLm1hcChNYXRoLmZsb29yKS5qb2luKCIsIikgKyAn
KScKICAgIH0KICAgIHZhciBkeCA9IDAsIGR5ID0gMAogICAgaWYgKGJiKSB7CiAgICAgIHRoaXMu
ZWxlbWVudC5zdHlsZS53aWR0aCA9IE1hdGguZmxvb3IoeHMgKiBiYlsyXSkgKyAncHgnCiAgICAg
IHRoaXMuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSBNYXRoLmZsb29yKHlzICogYmJbM10pICsgJ3B4
JwogICAgICB0aGlzLmVXaWR0aCA9IHhzCiAgICAgIHRoaXMuZUhlaWdodCA9IHlzCiAgICB9IGVs
c2UgewogICAgICB0aGlzLmVsZW1lbnQuc3R5bGUud2lkdGggPSAnJwogICAgICB0aGlzLmVsZW1l
bnQuc3R5bGUuaGVpZ2h0ID0gJycKICAgICAgdmFyIGFsaWduID0gdGhpcy5hbGlnbiB8fCB0aGlz
LnRleHRBbmNob3IKICAgICAgdmFyIG9yaWdpbiA9IFswLDBdCiAgICAgIGlmIChhbGlnbiA9PSAn
Y2VudGVyJyB8fCBhbGlnbiA9PSAnbWlkZGxlJykgewogICAgICAgIGR4ID0gLXRoaXMuZWxlbWVu
dC5vZmZzZXRXaWR0aCAvIDIKICAgICAgICBvcmlnaW5bMF0gPSAnNTAlJwogICAgICB9IGVsc2Ug
aWYgKGFsaWduID09ICdyaWdodCcpIHsKICAgICAgICBkeCA9IC10aGlzLmVsZW1lbnQub2Zmc2V0
V2lkdGgKICAgICAgICBvcmlnaW5bMF0gPSAnMTAwJScKICAgICAgfQogICAgICB2YXIgdmFsaWdu
ID0gdGhpcy52YWxpZ24KICAgICAgaWYgKHZhbGlnbiA9PSAnY2VudGVyJyB8fCB2YWxpZ24gPT0g
J21pZGRsZScpIHsKICAgICAgICBkeSA9IC10aGlzLmVsZW1lbnQub2Zmc2V0SGVpZ2h0IC8gMgog
ICAgICAgIG9yaWdpblsxXSA9ICc1MCUnCiAgICAgIH0gZWxzZSBpZiAodmFsaWduID09ICdib3R0
b20nKSB7CiAgICAgICAgZHkgPSAtdGhpcy5lbGVtZW50Lm9mZnNldEhlaWdodAogICAgICAgIG9y
aWdpblsxXSA9ICcxMDAlJwogICAgICB9CiAgICAgIHRoaXMuZWxlbWVudC5zdHlsZS53ZWJraXRU
cmFuc2Zvcm1PcmlnaW4gPQogICAgICB0aGlzLmVsZW1lbnQuc3R5bGUuTW96VHJhbnNmb3JtT3Jp
Z2luID0gb3JpZ2luLmpvaW4oIiAiKQogICAgICB0aGlzLmVXaWR0aCA9IHRoaXMuZWxlbWVudC5v
ZmZzZXRXaWR0aCAvIHhzCiAgICAgIHRoaXMuZUhlaWdodCA9IHRoaXMuZWxlbWVudC5vZmZzZXRI
ZWlnaHQgLyB5cwogICAgfQogICAgaWYgKHdrdCAmJiAhdGhpcy5ub1NjYWxpbmcpIHsKICAgICAg
dGhpcy5lbGVtZW50LnN0eWxlLmxlZnQgPSBNYXRoLmZsb29yKGR4KSArICdweCcKICAgICAgdGhp
cy5lbGVtZW50LnN0eWxlLnRvcCA9IE1hdGguZmxvb3IoZHkpICsgJ3B4JwogICAgfSBlbHNlIHsK
ICAgICAgdGhpcy5lbGVtZW50LnN0eWxlLmxlZnQgPSBNYXRoLmZsb29yKHgrZHgpICsgJ3B4Jwog
ICAgICB0aGlzLmVsZW1lbnQuc3R5bGUudG9wID0gTWF0aC5mbG9vcih5K2R5KSArICdweCcKICAg
IH0KICAgIGlmIChoaWRkZW4pCiAgICAgIHRoaXMuZWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0g
J3Zpc2libGUnCiAgfQp9KQoKCi8qKgogIEEgRHJhd2FibGUgaXMgYSBDYW52YXNOb2RlIHdpdGgg
cG9zc2libGUgZmlsbCwgc3Ryb2tlIGFuZCBjbGlwLgoKICBJdCBkcmF3cyB0aGUgcGF0aCBieSBj
YWxsaW5nICNkcmF3R2VvbWV0cnkKICAqLwpEcmF3YWJsZSA9IEtsYXNzKENhbnZhc05vZGUsIHsK
ICBwaWNrYWJsZSA6IHRydWUsCiAgLy8gICAnaW5zaWRlJyAvLyBjbGlwIGJlZm9yZSBkcmF3aW5n
IHRoZSBzdHJva2UKICAvLyB8ICdhYm92ZScgIC8vIGRyYXcgc3Ryb2tlIGFmdGVyIHRoZSBmaWxs
CiAgLy8gfCAnYmVsb3cnICAvLyBkcmF3IHN0cm9rZSBiZWZvcmUgdGhlIGZpbGwKICBzdHJva2VN
b2RlIDogJ2Fib3ZlJywKCiAgQUJPVkUgOiAnYWJvdmUnLCBCRUxPVyA6ICdiZWxvdycsIElOU0lE
RSA6ICdpbnNpZGUnLAoKICBpbml0aWFsaXplIDogZnVuY3Rpb24oY29uZmlnKSB7CiAgICBDYW52
YXNOb2RlLmluaXRpYWxpemUuY2FsbCh0aGlzLCBjb25maWcpCiAgfSwKCiAgLyoqCiAgICBEcmF3
cyB0aGUgcGlja2luZyBwYXRoIGZvciB0aGUgRHJhd2FibGUuCgogICAgVGhlIGRlZmF1bHQgdmVy
c2lvbiBiZWdpbnMgYSBuZXcgcGF0aCBhbmQgY2FsbHMgZHJhd0dlb21ldHJ5LgoKICAgIEBwYXJh
bSBjdHggQ2FudmFzIGRyYXdpbmcgY29udGV4dAogICAgKi8KICBkcmF3UGlja2luZ1BhdGggOiBm
dW5jdGlvbihjdHgpIHsKICAgIGlmICghdGhpcy5kcmF3R2VvbWV0cnkpIHJldHVybgogICAgY3R4
LmJlZ2luUGF0aCgpCiAgICB0aGlzLmRyYXdHZW9tZXRyeShjdHgpCiAgfSwKCiAgLyoqCiAgICBS
ZXR1cm5zIHRydWUgaWYgdGhlIHBvaW50IHgseSBpcyBpbnNpZGUgdGhlIHBhdGggb2YgYSBkcmF3
YWJsZSBub2RlLgoKICAgIFRoZSB4LHkgcG9pbnQgaXMgaW4gdXNlci1zcGFjZSBjb29yZGluYXRl
cywgbWVhbmluZyB0aGF0IGUuZy4gdGhlIHBvaW50CiAgICA1LDUgd2lsbCBhbHdheXMgYmUgaW5z
aWRlIHRoZSByZWN0YW5nbGUgWzAsIDAsIDEwLCAxMF0sIHJlZ2FyZGxlc3Mgb2YgdGhlCiAgICB0
cmFuc2Zvcm0gb24gdGhlIHJlY3RhbmdsZS4KCiAgICBAcGFyYW0geCBYLWNvb3JkaW5hdGUgb2Yg
dGhlIHBvaW50LgogICAgQHBhcmFtIHkgWS1jb29yZGluYXRlIG9mIHRoZSBwb2ludC4KICAgIEBy
ZXR1cm4gV2hldGhlciB0aGUgcG9pbnQgaXMgaW5zaWRlIHRoZSBwYXRoIG9mIHRoaXMgbm9kZS4K
ICAgIEB0eXBlIGJvb2xlYW4KICAgICovCiAgaXNQb2ludEluUGF0aCA6IGZ1bmN0aW9uKHgsIHkp
IHsKICAgIHJldHVybiBmYWxzZQogIH0sCgogIGlzVmlzaWJsZSA6IGZ1bmN0aW9uKGN0eCkgewog
ICAgdmFyIGFiYiA9IHRoaXMuZ2V0QXhpc0FsaWduZWRCb3VuZGluZ0JveCgpCiAgICBpZiAoIWFi
YikgcmV0dXJuIHRydWUKICAgIHZhciB4MSA9IGFiYlswXSwgeDIgPSBhYmJbMF0rYWJiWzJdLCB5
MSA9IGFiYlsxXSwgeTIgPSBhYmJbMV0rYWJiWzNdCiAgICB2YXIgdyA9IHRoaXMucm9vdC53aWR0
aAogICAgdmFyIGggPSB0aGlzLnJvb3QuaGVpZ2h0CiAgICBpZiAodGhpcy5yb290LmRyYXdCb3Vu
ZGluZ0JveGVzKSB7CiAgICAgIGN0eC5zYXZlKCkKICAgICAgICB2YXIgYmJveCA9IHRoaXMuZ2V0
Qm91bmRpbmdCb3goKQogICAgICAgIGN0eC5iZWdpblBhdGgoKQogICAgICAgIGN0eC5yZWN0KGJi
b3hbMF0sIGJib3hbMV0sIGJib3hbMl0sIGJib3hbM10pCiAgICAgICAgY3R4LnN0cm9rZVN0eWxl
ID0gJ2dyZWVuJwogICAgICAgIGN0eC5saW5lV2lkdGggPSAxCiAgICAgICAgY3R4LnN0cm9rZSgp
CiAgICAgIGN0eC5yZXN0b3JlKCkKICAgICAgY3R4LnNhdmUoKQogICAgICAgIENhbnZhc1N1cHBv
cnQuc2V0VHJhbnNmb3JtKGN0eCwgWzEsMCwwLDEsMCwwXSwgdGhpcy5jdXJyZW50TWF0cml4KQog
ICAgICAgIGN0eC5iZWdpblBhdGgoKQogICAgICAgIGN0eC5yZWN0KHgxLCB5MSwgeDIteDEsIHky
LXkxKQogICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICdyZWQnCiAgICAgICAgY3R4LmxpbmVXaWR0
aCA9IDEuNQogICAgICAgIGN0eC5zdHJva2UoKQogICAgICBjdHgucmVzdG9yZSgpCiAgICB9CiAg
ICB2YXIgdmlzaWJsZSA9ICEoeDIgPCAwIHx8IHgxID4gdyB8fCB5MiA8IDAgfHwgeTEgPiBoKQog
ICAgcmV0dXJuIHZpc2libGUKICB9LAoKICBjcmVhdGVTdWJ0cmVlUGF0aCA6IGZ1bmN0aW9uKGN0
eCwgc2tpcFRyYW5zZm9ybSkgewogICAgY3R4LnNhdmUoKQogICAgaWYgKCFza2lwVHJhbnNmb3Jt
KSB0aGlzLnRyYW5zZm9ybShjdHgsIHRydWUpCiAgICBpZiAodGhpcy5kcmF3R2VvbWV0cnkpIHRo
aXMuZHJhd0dlb21ldHJ5KGN0eCkKICAgIGZvciAodmFyIGk9MDsgaTx0aGlzLmNoaWxkTm9kZXMu
bGVuZ3RoOyBpKyspCiAgICAgIHRoaXMuY2hpbGROb2Rlc1tpXS5jcmVhdGVTdWJ0cmVlUGF0aChj
dHgpCiAgICBjdHgucmVzdG9yZSgpCiAgfSwKCiAgLyoqCiAgICBEcmF3cyB0aGUgRHJhd2FibGUu
IEJlZ2lucyBhIHBhdGggYW5kIGNhbGxzIHRoaXMuZHJhd0dlb21ldHJ5LCBmb2xsb3dlZCBieQog
ICAgcG9zc2libHkgZmlsbGluZywgc3Ryb2tpbmcgYW5kIGNsaXBwaW5nIHRoZSBwYXRoLCBkZXBl
bmRpbmcgb24gd2hldGhlcgogICAgI2ZpbGwsICNzdHJva2UgYW5kICNjbGlwIGFyZSBzZXQuCgog
ICAgQHBhcmFtIGN0eCBDYW52YXMgZHJhd2luZyBjb250ZXh0CiAgICAqLwogIGRyYXcgOiBmdW5j
dGlvbihjdHgpIHsKICAgIGlmICghdGhpcy5kcmF3R2VvbWV0cnkpIHJldHVybgogICAgLy8gYmJv
eCBjaGVja2luZyBpcyBzbG93ZXIgdGhhbiBqdXN0IGRyYXdpbmcgaW4gbW9zdCBjYXNlcy4KICAg
IC8vIGFuZCBjYWNoaW5nIHRoZSBiYm94ZXMgaXMgaGFyZCB0byBkbyBjb3JyZWN0bHkuCiAgICAv
LyBwbHVzLCBiYm94ZXMgYXJlbid0IGhpZXJhcmNoaWNhbC4KICAgIC8vIHNvIHdlIGFyZSBiZWlu
ZyBnbGliIDp8CiAgICBpZiAodGhpcy5yb290LmRyYXdCb3VuZGluZ0JveGVzKQogICAgICB0aGlz
LmlzVmlzaWJsZShjdHgpCiAgICB2YXIgZnQgPSAoY3R4LmZpbGxTdHlsZS50cmFuc2Zvcm1MaXN0
IHx8CiAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZS5tYXRyaXggfHwKICAgICAgICAgICAgICBj
dHguZmlsbFN0eWxlLnNjYWxlICE9IG51bGwgfHwKICAgICAgICAgICAgICBjdHguZmlsbFN0eWxl
LnJvdGF0aW9uIHx8CiAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZS54IHx8CiAgICAgICAgICAg
ICAgY3R4LmZpbGxTdHlsZS55ICkKICAgIHZhciBzdCA9IChjdHguc3Ryb2tlU3R5bGUudHJhbnNm
b3JtTGlzdCB8fAogICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZS5tYXRyaXggfHwKICAgICAg
ICAgICAgICBjdHguc3Ryb2tlU3R5bGUuc2NhbGUgIT0gbnVsbCB8fAogICAgICAgICAgICAgIGN0
eC5zdHJva2VTdHlsZS5yb3RhdGlvbiB8fAogICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZS54
IHx8CiAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlLnkgKQogICAgY3R4LmJlZ2luUGF0aCgp
CiAgICB0aGlzLmRyYXdHZW9tZXRyeShjdHgpCiAgICBpZiAoY3R4LnN0cm9rZU9uKSB7CiAgICAg
IHN3aXRjaCAodGhpcy5zdHJva2VNb2RlKSB7CiAgICAgICAgY2FzZSB0aGlzLkFCT1ZFOgogICAg
ICAgICAgaWYgKGN0eC5maWxsT24pIHRoaXMuZG9GaWxsKGN0eCxmdCkKICAgICAgICAgIHRoaXMu
ZG9TdHJva2UoY3R4LCBzdCkKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSB0aGlzLkJFTE9X
OgogICAgICAgICAgdGhpcy5kb1N0cm9rZShjdHgsIHN0KQogICAgICAgICAgaWYgKGN0eC5maWxs
T24pIHRoaXMuZG9GaWxsKGN0eCxmdCkKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSB0aGlz
LklOU0lERToKICAgICAgICAgIGlmIChjdHguZmlsbE9uKSB0aGlzLmRvRmlsbChjdHgsZnQpCiAg
ICAgICAgICBjdHguc2F2ZSgpCiAgICAgICAgICB2YXIgbHcgPSBjdHgubGluZVdpZHRoCiAgICAg
ICAgICBjdHguc2V0TGluZVdpZHRoKDEpCiAgICAgICAgICB0aGlzLmRvU3Ryb2tlKGN0eCwgc3Qp
CiAgICAgICAgICBjdHguc2V0TGluZVdpZHRoKGx3KQogICAgICAgICAgY3R4LmNsaXAoKQogICAg
ICAgICAgdGhpcy5kb1N0cm9rZShjdHgsIHN0KQogICAgICAgICAgY3R4LnJlc3RvcmUoKQogICAg
ICAgICAgYnJlYWsKICAgICAgfQogICAgfSBlbHNlIGlmIChjdHguZmlsbE9uKSB7CiAgICAgIHRo
aXMuZG9GaWxsKGN0eCxmdCkKICAgIH0KICAgIHRoaXMuZHJhd01hcmtlcnMoY3R4KQogICAgaWYg
KHRoaXMuY2xpcCkgY3R4LmNsaXAoKQogIH0sCgogIGRvRmlsbCA6IGZ1bmN0aW9uKGN0eCwgZnQp
IHsKICAgIGlmIChmdCB8fCAodGhpcy5nZXRCb3VuZGluZ0JveCAmJiBjdHguZmlsbFN0eWxlLnVu
aXRzID09IHRoaXMuT0JKRUNUQk9VTkRJTkdCT1gpKSB7CiAgICAgIGN0eC5zYXZlKCkKICAgICAg
aWYgKHRoaXMuZ2V0Qm91bmRpbmdCb3ggJiYgY3R4LmZpbGxTdHlsZS51bml0cyA9PSB0aGlzLk9C
SkVDVEJPVU5ESU5HQk9YKSB7CiAgICAgICAgdmFyIGJiID0gdGhpcy5nZXRCb3VuZGluZ0JveCgp
CiAgICAgICAgdmFyIHN4ID0gYmJbMl0KICAgICAgICB2YXIgc3kgPSBiYlszXQogICAgICAgIGN0
eC50cmFuc2xhdGUoYmJbMF0sYmJbMV0pCiAgICAgICAgY3R4LnNjYWxlKHN4LHN5KQogICAgICB9
CiAgICAgIGN0eC5maWxsU3R5bGUudHJhbnNmb3JtKGN0eCkKICAgIH0KICAgIGlmICh0aGlzLmZp
bGxPcGFjaXR5ICE9IG51bGwpIHsKICAgICAgdmFyIGdvID0gY3R4Lmdsb2JhbEFscGhhCiAgICAg
IGN0eC5zZXRHbG9iYWxBbHBoYShnbyAqIHRoaXMuZmlsbE9wYWNpdHkpCiAgICAgIGN0eC5maWxs
KCkKICAgICAgY3R4Lmdsb2JhbEFscGhhID0gZ28KICAgIH0gZWxzZSB7CiAgICAgIGN0eC5maWxs
KCkKICAgIH0KICAgIGlmIChmdCkgY3R4LnJlc3RvcmUoKQogIH0sCgogIGRvU3Ryb2tlIDogZnVu
Y3Rpb24oY3R4LCBzdCkgewogICAgaWYgKHN0IHx8ICh0aGlzLmdldEJvdW5kaW5nQm94ICYmIGN0
eC5zdHJva2VTdHlsZS51bml0cyA9PSB0aGlzLk9CSkVDVEJPVU5ESU5HQk9YKSkgewogICAgICBj
dHguc2F2ZSgpCiAgICAgIGlmICh0aGlzLmdldEJvdW5kaW5nQm94ICYmIGN0eC5zdHJva2VTdHls
ZS51bml0cyA9PSB0aGlzLk9CSkVDVEJPVU5ESU5HQk9YKSB7CiAgICAgICAgdmFyIGJiID0gdGhp
cy5nZXRCb3VuZGluZ0JveCgpCiAgICAgICAgdmFyIHN4ID0gYmJbMl0KICAgICAgICB2YXIgc3kg
PSBiYlszXQogICAgICAgIGN0eC50cmFuc2xhdGUoYmJbMF0sYmJbMV0pCiAgICAgICAgY3R4LnNj
YWxlKHN4LHN5KQogICAgICB9CiAgICAgIGN0eC5zdHJva2VTdHlsZS5uZWVkTWF0cml4VXBkYXRl
ID0gdHJ1ZQogICAgICBjdHguc3Ryb2tlU3R5bGUudHJhbnNmb3JtKGN0eCkKICAgICAgaWYgKHN4
ICE9IG51bGwpCiAgICAgICAgQ2FudmFzU3VwcG9ydC50U2NhbGUoY3R4LnN0cm9rZVN0eWxlLmN1
cnJlbnRNYXRyaXgsIHN4LCBzeSkKICAgICAgdmFyIGNtID0gY3R4LnN0cm9rZVN0eWxlLmN1cnJl
bnRNYXRyaXgKICAgICAgLy8gZml4IHN0cm9rZSB3aWR0aCBzY2FsZSAobm9uLXVuaWZvcm0gc2Nh
bGVzIHNjcmV3IHVzIHVwIHRob3VnaCkKICAgICAgdmFyIHN3ID0gTWF0aC5zcXJ0KE1hdGgubWF4
KAogICAgICAgIGNtWzBdKmNtWzBdICsgY21bMV0qY21bMV0sCiAgICAgICAgY21bMl0qY21bMl0g
KyBjbVszXSpjbVszXQogICAgICApKQogICAgICBjdHguc2V0TGluZVdpZHRoKCgoY3R4LmxpbmVX
aWR0aCA9PSBudWxsKSA/IDEgOiBjdHgubGluZVdpZHRoKSAvIHN3KQogICAgfQogICAgaWYgKHRo
aXMuc3Ryb2tlT3BhY2l0eSAhPSBudWxsKSB7CiAgICAgIHZhciBnbyA9IGN0eC5nbG9iYWxBbHBo
YQogICAgICBjdHguc2V0R2xvYmFsQWxwaGEoZ28gKiB0aGlzLnN0cm9rZU9wYWNpdHkpCiAgICAg
IGN0eC5zdHJva2UoKQogICAgICBjdHguZ2xvYmFsQWxwaGEgPSBnbwogICAgfSBlbHNlIHsKICAg
ICAgY3R4LnN0cm9rZSgpCiAgICB9CiAgICBpZiAoc3QpIGN0eC5yZXN0b3JlKCkKICB9LAoKICBk
cmF3TWFya2VycyA6IGZ1bmN0aW9uKGN0eCkgewogICAgdmFyIHNtID0gdGhpcy5tYXJrZXJTdGFy
dCB8fCB0aGlzLm1hcmtlcgogICAgdmFyIGVtID0gdGhpcy5tYXJrZXJFbmQgfHwgdGhpcy5tYXJr
ZXIKICAgIHZhciBtbSA9IHRoaXMubWFya2VyTWlkIHx8IHRoaXMubWFya2VyCiAgICBpZiAoc20g
JiYgdGhpcy5nZXRTdGFydFBvaW50KSB7CiAgICAgIHZhciBwYSA9IHRoaXMuZ2V0U3RhcnRQb2lu
dCgpCiAgICAgIGlmIChzbS5vcmllbnQgIT0gbnVsbCAmJiBzbS5vcmllbnQgIT0gJ2F1dG8nKQog
ICAgICAgIHBhLmFuZ2xlID0gc20ub3JpZW50CiAgICAgIHZhciBzY2FsZSA9IChzbS5tYXJrZXJV
bml0cyA9PSAnc3Ryb2tlV2lkdGgnKSA/IGN0eC5saW5lV2lkdGggOiAxCiAgICAgIGN0eC5zYXZl
KCkKICAgICAgICBjdHgudHJhbnNsYXRlKHBhLnBvaW50WzBdLCBwYS5wb2ludFsxXSkKICAgICAg
ICBjdHguc2NhbGUoc2NhbGUsIHNjYWxlKQogICAgICAgIGN0eC5yb3RhdGUocGEuYW5nbGUpCiAg
ICAgICAgdmFyIG1hdCA9IENhbnZhc1N1cHBvcnQudFJvdGF0ZSgKICAgICAgICAgIENhbnZhc1N1
cHBvcnQudFNjYWxlKAogICAgICAgICAgQ2FudmFzU3VwcG9ydC50VHJhbnNsYXRlKAogICAgICAg
ICAgICB0aGlzLmN1cnJlbnRNYXRyaXguc2xpY2UoMCksCiAgICAgICAgICAgIHBhLnBvaW50WzBd
LCBwYS5wb2ludFsxXQogICAgICAgICAgKSwgc2NhbGUsIHNjYWxlKSwgcGEuYW5nbGUpCiAgICAg
ICAgc20uX19jb3B5TWF0cml4KG1hdCkKICAgICAgICBzbS5oYW5kbGVEcmF3KGN0eCkKICAgICAg
Y3R4LnJlc3RvcmUoKQogICAgfQogICAgaWYgKGVtICYmIHRoaXMuZ2V0RW5kUG9pbnQpIHsKICAg
ICAgdmFyIHBhID0gdGhpcy5nZXRFbmRQb2ludCgpCiAgICAgIGlmIChlbS5vcmllbnQgIT0gbnVs
bCAmJiBlbS5vcmllbnQgIT0gJ2F1dG8nKQogICAgICAgIHBhLmFuZ2xlID0gZW0ub3JpZW50CiAg
ICAgIHZhciBzY2FsZSA9IChlbS5tYXJrZXJVbml0cyA9PSAnc3Ryb2tlV2lkdGgnKSA/IGN0eC5s
aW5lV2lkdGggOiAxCiAgICAgIGN0eC5zYXZlKCkKICAgICAgICBjdHgudHJhbnNsYXRlKHBhLnBv
aW50WzBdLCBwYS5wb2ludFsxXSkKICAgICAgICBjdHguc2NhbGUoc2NhbGUsIHNjYWxlKQogICAg
ICAgIGN0eC5yb3RhdGUocGEuYW5nbGUpCiAgICAgICAgdmFyIG1hdCA9IENhbnZhc1N1cHBvcnQu
dFJvdGF0ZSgKICAgICAgICAgIENhbnZhc1N1cHBvcnQudFNjYWxlKAogICAgICAgICAgQ2FudmFz
U3VwcG9ydC50VHJhbnNsYXRlKAogICAgICAgICAgICB0aGlzLmN1cnJlbnRNYXRyaXguc2xpY2Uo
MCksCiAgICAgICAgICAgIHBhLnBvaW50WzBdLCBwYS5wb2ludFsxXQogICAgICAgICAgKSwgc2Nh
bGUsIHNjYWxlKSwgcGEuYW5nbGUpCiAgICAgICAgZW0uX19jb3B5TWF0cml4KG1hdCkKICAgICAg
ICBlbS5oYW5kbGVEcmF3KGN0eCkKICAgICAgY3R4LnJlc3RvcmUoKQogICAgfQogICAgaWYgKG1t
ICYmIHRoaXMuZ2V0TWlkUG9pbnRzKSB7CiAgICAgIHZhciBwYXMgPSB0aGlzLmdldE1pZFBvaW50
cygpCiAgICAgIHZhciBzY2FsZSA9IChtbS5tYXJrZXJVbml0cyA9PSAnc3Ryb2tlV2lkdGgnKSA/
IGN0eC5saW5lV2lkdGggOiAxCiAgICAgIGZvciAodmFyIGk9MDsgaTxwYXMubGVuZ3RoOyBpKysp
IHsKICAgICAgICB2YXIgcGEgPSBwYXNbaV0KICAgICAgICBjdHguc2F2ZSgpCiAgICAgICAgICBj
dHgudHJhbnNsYXRlKHBhLnBvaW50WzBdLCBwYS5wb2ludFsxXSkKICAgICAgICAgIGN0eC5zY2Fs
ZShzY2FsZSwgc2NhbGUpCiAgICAgICAgICBpZiAobW0ub3JpZW50ICE9IG51bGwgJiYgbW0ub3Jp
ZW50ICE9ICdhdXRvJykKICAgICAgICAgICAgcGEuYW5nbGUgPSBlbS5vcmllbnQKICAgICAgICAg
IGN0eC5yb3RhdGUocGEuYW5nbGUpCiAgICAgICAgICB2YXIgbWF0ID0gQ2FudmFzU3VwcG9ydC50
Um90YXRlKAogICAgICAgICAgICBDYW52YXNTdXBwb3J0LnRTY2FsZSgKICAgICAgICAgICAgQ2Fu
dmFzU3VwcG9ydC50VHJhbnNsYXRlKAogICAgICAgICAgICAgIHRoaXMuY3VycmVudE1hdHJpeC5z
bGljZSgwKSwKICAgICAgICAgICAgICBwYS5wb2ludFswXSwgcGEucG9pbnRbMV0KICAgICAgICAg
ICAgKSwgc2NhbGUsIHNjYWxlKSwgcGEuYW5nbGUpCiAgICAgICAgICBtbS5fX2NvcHlNYXRyaXgo
bWF0KQogICAgICAgICAgbW0uaGFuZGxlRHJhdyhjdHgpCiAgICAgICAgY3R4LnJlc3RvcmUoKQog
ICAgICB9CiAgICB9CiAgfSwKCiAgZ2V0U3RhcnRQb2ludCA6IGZhbHNlLAogIGdldEVuZFBvaW50
IDogZmFsc2UsCiAgZ2V0TWlkUG9pbnRzIDogZmFsc2UsCiAgZ2V0Qm91bmRpbmdCb3ggOiBmYWxz
ZQoKfSkKCgovKioKICBBIExpbmUgaXMgYSBsaW5lIGRyYXduIGZyb20geDEseTEgdG8geDIseTIu
IExpbmVzIGFyZSBzdHJva2VkIGJ5IGRlZmF1bHQuCgogIEBwYXJhbSB4MSBYLWNvb3JkaW5hdGUg
b2YgdGhlIGxpbmUncyBmaXJzdCBwb2ludC4KICBAcGFyYW0geTEgWS1jb29yZGluYXRlIG9mIHRo
ZSBsaW5lJ3MgZmlyc3QgcG9pbnQuCiAgQHBhcmFtIHgyIFgtY29vcmRpbmF0ZSBvZiB0aGUgbGlu
ZSdzIHNlY29uZCBwb2ludC4KICBAcGFyYW0geTIgWS1jb29yZGluYXRlIG9mIHRoZSBsaW5lJ3Mg
c2Vjb25kIHBvaW50LgogIEBwYXJhbSBjb25maWcgT3B0aW9uYWwgY29uZmlnIGhhc2guCiAgKi8K
TGluZSA9IEtsYXNzKERyYXdhYmxlLCB7CiAgeDEgOiAwLAogIHkxIDogMCwKICB4MiA6IDAsCiAg
eTIgOiAwLAogIHN0cm9rZSA6IHRydWUsCgogIGluaXRpYWxpemUgOiBmdW5jdGlvbih4MSx5MSwg
eDIseTIsIGNvbmZpZykgewogICAgdGhpcy54MSA9IHgxCiAgICB0aGlzLnkxID0geTEKICAgIHRo
aXMueDIgPSB4MgogICAgdGhpcy55MiA9IHkyCiAgICBEcmF3YWJsZS5pbml0aWFsaXplLmNhbGwo
dGhpcywgY29uZmlnKQogIH0sCgogIGRyYXdHZW9tZXRyeSA6IGZ1bmN0aW9uKGN0eCkgewogICAg
Y3R4Lm1vdmVUbyh0aGlzLngxLCB0aGlzLnkxKQogICAgY3R4LmxpbmVUbyh0aGlzLngyLCB0aGlz
LnkyKQogIH0sCgogIGdldFN0YXJ0UG9pbnQgOiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB7CiAg
ICAgIHBvaW50OiBbdGhpcy54MSwgdGhpcy55MV0sCiAgICAgIGFuZ2xlOiBNYXRoLmF0YW4yKHRo
aXMueTItdGhpcy55MSwgdGhpcy54Mi10aGlzLngxKQogICAgfQogIH0sCgogIGdldEVuZFBvaW50
IDogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gewogICAgICBwb2ludDogW3RoaXMueDIsIHRoaXMu
eTJdLAogICAgICBhbmdsZTogTWF0aC5hdGFuMih0aGlzLnkyLXRoaXMueTEsIHRoaXMueDItdGhp
cy54MSkKICAgIH0KICB9LAoKICBnZXRCb3VuZGluZ0JveCA6IGZ1bmN0aW9uKCkgewogICAgcmV0
dXJuIFt0aGlzLngxLCB0aGlzLnkxLCB0aGlzLngyLXRoaXMueDEsIHRoaXMueTItdGhpcy55MV0K
ICB9LAoKICBnZXRMZW5ndGggOiBmdW5jdGlvbigpIHsKICAgIHJldHVybiBDdXJ2ZXMubGluZUxl
bmd0aChbdGhpcy54MSwgdGhpcy55MV0sIFt0aGlzLngyLCB0aGlzLnkyXSkKICB9Cgp9KQoKCgov
KioKICBDaXJjbGUgaXMgdXNlZCBmb3IgY3JlYXRpbmcgY2lyY3VsYXIgcGF0aHMuCgogIFVzZXMg
Y29udGV4dC5hcmMoLi4uKS4KCiAgQXR0cmlidXRlczoKICAgIGN4LCBjeSwgcmFkaXVzLCBzdGFy
dEFuZ2xlLCBlbmRBbmdsZSwgY2xvY2t3aXNlLCBjbG9zZVBhdGgsIGluY2x1ZGVDZW50ZXIKCiAg
QHBhcmFtIHJhZGl1cyBSYWRpdXMgb2YgdGhlIGNpcmNsZS4KICBAcGFyYW0gY29uZmlnIE9wdGlv
bmFsIGNvbmZpZyBoYXNoLgogICovCkNpcmNsZSA9IEtsYXNzKERyYXdhYmxlLCB7CiAgY3ggOiAw
LAogIGN5IDogMCwKICByYWRpdXMgOiAxMCwKICBzdGFydEFuZ2xlIDogMCwKICBlbmRBbmdsZSA6
IE1hdGguUEkgKiAyLAogIGNsb2Nrd2lzZSA6IGZhbHNlLAogIGNsb3NlUGF0aCA6IHRydWUsCiAg
aW5jbHVkZUNlbnRlciA6IGZhbHNlLAoKICBpbml0aWFsaXplIDogZnVuY3Rpb24ocmFkaXVzLCBj
b25maWcpIHsKICAgIGlmIChyYWRpdXMgIT0gbnVsbCkgdGhpcy5yYWRpdXMgPSByYWRpdXMKICAg
IERyYXdhYmxlLmluaXRpYWxpemUuY2FsbCh0aGlzLCBjb25maWcpCiAgfSwKCiAgLyoqCiAgICBD
cmVhdGVzIGEgY2lyY3VsYXIgcGF0aCB1c2luZyBjdHguYXJjKC4uLikuCgogICAgQHBhcmFtIGN0
eCBDYW52YXMgZHJhd2luZyBjb250ZXh0LgogICAgKi8KICBkcmF3R2VvbWV0cnkgOiBmdW5jdGlv
bihjdHgpIHsKICAgIGlmICh0aGlzLnJhZGl1cyA9PSAwKSByZXR1cm4KICAgIGlmICh0aGlzLmlu
Y2x1ZGVDZW50ZXIpCiAgICAgIGN0eC5tb3ZlVG8odGhpcy5jeCwgdGhpcy5jeSkKICAgIGN0eC5h
cmModGhpcy5jeCwgdGhpcy5jeSwgdGhpcy5yYWRpdXMsIHRoaXMuc3RhcnRBbmdsZSwgdGhpcy5l
bmRBbmdsZSwgdGhpcy5jbG9ja3dpc2UpCiAgICBpZiAodGhpcy5jbG9zZVBhdGgpIHsKICAgICAg
Ly8gZmlyZWZveCAyIGlzIGJ1Z2d5IHdpdGhvdXQgdGhlIGVuZHBvaW50CiAgICAgIHZhciB4MiA9
IE1hdGguY29zKHRoaXMuZW5kQW5nbGUpCiAgICAgIHZhciB5MiA9IE1hdGguc2luKHRoaXMuZW5k
QW5nbGUpCiAgICAgIGN0eC5tb3ZlVG8odGhpcy5jeCArIHgyKnRoaXMucmFkaXVzLCB0aGlzLmN5
ICsgeTIgKiB0aGlzLnJhZGl1cykKICAgICAgY3R4LmNsb3NlUGF0aCgpCiAgICB9CiAgfSwKCiAg
LyoqCiAgICBSZXR1cm5zIHRydWUgaWYgdGhlIHBvaW50IHgseSBpcyBpbnNpZGUgdGhlIHJhZGl1
cyBvZiB0aGUgY2lyY2xlLgoKICAgIFRoZSB4LHkgcG9pbnQgaXMgaW4gdXNlci1zcGFjZSBjb29y
ZGluYXRlcywgbWVhbmluZyB0aGF0IGUuZy4gdGhlIHBvaW50CiAgICA1LDAgd2lsbCBhbHdheXMg
YmUgaW5zaWRlIGEgY2lyY2xlIHdpdGggcmFkaXVzIG9mIDEwIGFuZCBjZW50ZXIgYXQgb3JpZ2lu
LAogICAgcmVnYXJkbGVzcyBvZiB0aGUgdHJhbnNmb3JtIG9uIHRoZSBjaXJjbGUuCgogICAgQHBh
cmFtIHggWC1jb29yZGluYXRlIG9mIHRoZSBwb2ludC4KICAgIEBwYXJhbSB5IFktY29vcmRpbmF0
ZSBvZiB0aGUgcG9pbnQuCiAgICBAcmV0dXJuIFdoZXRoZXIgdGhlIHBvaW50IGlzIGluc2lkZSB0
aGUgcmFkaXVzIG9mIHRoaXMgY2lyY2xlLgogICAgQHR5cGUgYm9vbGVhbgogICAgKi8KICBpc1Bv
aW50SW5QYXRoIDogZnVuY3Rpb24oeCx5KSB7CiAgICB4IC09IHRoaXMuY3gKICAgIHkgLT0gdGhp
cy5jeQogICAgcmV0dXJuICh4KnggKyB5KnkpIDw9ICh0aGlzLnJhZGl1cyp0aGlzLnJhZGl1cykK
ICB9LAoKICBnZXRCb3VuZGluZ0JveCA6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIFt0aGlzLmN4
LXRoaXMucmFkaXVzLCB0aGlzLmN5LXRoaXMucmFkaXVzLAogICAgICAgICAgICAyKnRoaXMucmFk
aXVzLCAyKnRoaXMucmFkaXVzXQogIH0KfSkKCgovKioKICBFbGxpcHNlIGlzIGEgc2NhbGVkIGNp
cmNsZS4gRXhjZXB0IGl0IGlzbid0LiBCZWNhdXNlIHRoYXQgd291bGRuJ3Qgd29yayBpbgogIE9w
ZXJhLgogICovCkVsbGlwc2UgPSBLbGFzcyhDaXJjbGUsIHsKICByYWRpdXNYIDogMCwKICByYWRp
dXNZIDogMCwKCiAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKHJhZGl1c1gsIHJhZGl1c1ksIGNvbmZp
ZykgewogICAgdGhpcy5yYWRpdXNYID0gcmFkaXVzWAogICAgdGhpcy5yYWRpdXNZID0gcmFkaXVz
WQogICAgQ2lyY2xlLmluaXRpYWxpemUuY2FsbCh0aGlzLCAxLCBjb25maWcpCiAgfSwKCiAgZHJh
d0dlb21ldHJ5IDogZnVuY3Rpb24oY3R4KSB7CiAgICBpZiAodGhpcy5yYWRpdXNYID09IDAgfHwg
dGhpcy5yYWRpdXNZID09IDApIHJldHVybgogICAgdmFyIGsgPSAwLjU1MjI4NDc0OTgKICAgIHZh
ciB4ID0gdGhpcy5jeAogICAgdmFyIHkgPSB0aGlzLmN5CiAgICB2YXIga3J4ID0gayp0aGlzLnJh
ZGl1c1gKICAgIHZhciBrcnkgPSBrKnRoaXMucmFkaXVzWQogICAgY3R4Lm1vdmVUbyh4K3RoaXMu
cmFkaXVzWCwgeSkKICAgIGN0eC5iZXppZXJDdXJ2ZVRvKHgrdGhpcy5yYWRpdXNYLCB5LWtyeSwg
eCtrcngsIHktdGhpcy5yYWRpdXNZLCB4LCB5LXRoaXMucmFkaXVzWSkKICAgIGN0eC5iZXppZXJD
dXJ2ZVRvKHgta3J4LCB5LXRoaXMucmFkaXVzWSwgeC10aGlzLnJhZGl1c1gsIHkta3J5LCB4LXRo
aXMucmFkaXVzWCwgeSkKICAgIGN0eC5iZXppZXJDdXJ2ZVRvKHgtdGhpcy5yYWRpdXNYLCB5K2ty
eSwgeC1rcngsIHkrdGhpcy5yYWRpdXNZLCB4LCB5K3RoaXMucmFkaXVzWSkKICAgIGN0eC5iZXpp
ZXJDdXJ2ZVRvKHgra3J4LCB5K3RoaXMucmFkaXVzWSwgeCt0aGlzLnJhZGl1c1gsIHkra3J5LCB4
K3RoaXMucmFkaXVzWCwgeSkKICB9LAoKICBpc1BvaW50SW5QYXRoIDogZnVuY3Rpb24oeCwgeSkg
ewogICAgLy8gZG9lcyB0aGlzIHdvcms/CiAgICB4IC09IHRoaXMuY3gKICAgIHkgLT0gdGhpcy5j
eQogICAgeCAvPSB0aGlzLnJhZGl1c1gKICAgIHkgLz0gdGhpcy5yYWRpdXNZCiAgICByZXR1cm4g
KHgqeCArIHkqeSkgPD0gMQogIH0sCgogIGdldEJvdW5kaW5nQm94IDogZnVuY3Rpb24oKSB7CiAg
ICByZXR1cm4gW3RoaXMuY3gtdGhpcy5yYWRpdXNYLCB0aGlzLmN5LXRoaXMucmFkaXVzWSwKICAg
ICAgICAgICAgdGhpcy5yYWRpdXNYKjIsIHRoaXMucmFkaXVzWSoyXQogIH0KfSkKCgovKioKICBB
IFNwaXJhbCBpcyBhIGZ1bmN0aW9uIGdyYXBoIGRyYXduIGluIHBvbGFyIGNvb3JkaW5hdGVzIGZy
b20gc3RhcnRBbmdsZSB0bwogIGVuZEFuZ2xlLiBBbmQgdGhlIHNvdXJjZSBvZiBhbGwgbGlmZSBl
bmVyZ3ksIGV0Yy4KICAqLwpTcGlyYWwgPSBLbGFzcyhEcmF3YWJsZSwgewogIGN4IDogMCwKICBj
eSA6IDAsCiAgc3RhcnRSYWRpdXMgOiAwLAogIHN0YXJ0QW5nbGUgOiAwLAogIGVuZEFuZ2xlIDog
MCwKCiAgcmFkaXVzRnVuY3Rpb24gOiBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gYQogIH0sCgog
IGluaXRpYWxpemUgOiBmdW5jdGlvbihlbmRBbmdsZSwgY29uZmlnKSB7CiAgICB0aGlzLmVuZEFu
Z2xlID0gZW5kQW5nbGUKICAgIERyYXdhYmxlLmluaXRpYWxpemUuY2FsbCh0aGlzLCBjb25maWcp
CiAgfSwKCiAgZHJhd0dlb21ldHJ5IDogZnVuY3Rpb24oY3R4KSB7CiAgICB2YXIgeCA9IHRoaXMu
Y3gKICAgIHZhciB5ID0gdGhpcy5jeQogICAgdmFyIGEgPSB0aGlzLnN0YXJ0QW5nbGUKICAgIHZh
ciByID0gdGhpcy5zdGFydFJhZGl1cyArIHRoaXMucmFkaXVzRnVuY3Rpb24oYSkKICAgIGN0eC5t
b3ZlVG8oeCtNYXRoLmNvcyhhKSpyLCB5LU1hdGguc2luKGEpKnIpCiAgICBpZiAodGhpcy5zdGFy
dEFuZ2xlIDwgdGhpcy5lbmRBbmdsZSkgewogICAgICBhICs9IDAuMQogICAgICByID0gdGhpcy5z
dGFydFJhZGl1cyArIHRoaXMucmFkaXVzRnVuY3Rpb24oYSkKICAgICAgd2hpbGUgKGEgPCB0aGlz
LmVuZEFuZ2xlKSB7CiAgICAgICAgY3R4LmxpbmVUbyh4K01hdGguY29zKGEpKnIsIHktTWF0aC5z
aW4oYSkqcikKICAgICAgICBhICs9IDAuMQogICAgICAgIHIgPSB0aGlzLnN0YXJ0UmFkaXVzICsg
dGhpcy5yYWRpdXNGdW5jdGlvbihhKQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBhIC09IDAu
MQogICAgICByID0gdGhpcy5zdGFydFJhZGl1cyArIHRoaXMucmFkaXVzRnVuY3Rpb24oYSkKICAg
ICAgd2hpbGUgKGEgPiB0aGlzLmVuZEFuZ2xlKSB7CiAgICAgICAgY3R4LmxpbmVUbyh4K01hdGgu
Y29zKGEpKnIsIHktTWF0aC5zaW4oYSkqcikKICAgICAgICBhIC09IDAuMQogICAgICAgIHIgPSB0
aGlzLnN0YXJ0UmFkaXVzICsgdGhpcy5yYWRpdXNGdW5jdGlvbihhKQogICAgICB9CiAgICB9CiAg
ICBhID0gdGhpcy5lbmRBbmdsZQogICAgciA9IHRoaXMuc3RhcnRSYWRpdXMgKyB0aGlzLnJhZGl1
c0Z1bmN0aW9uKGEpCiAgICBjdHgubGluZVRvKHgrTWF0aC5jb3MoYSkqciwgeS1NYXRoLnNpbihh
KSpyKQogIH0sCgogIGlzUG9pbnRJblBhdGggOiBmdW5jdGlvbih4LCB5KSB7CiAgICByZXR1cm4g
ZmFsc2UKICB9Cn0pCgoKLyoqCiAgUmVjdGFuZ2xlIGlzIHVzZWQgZm9yIGNyZWF0aW5nIHJlY3Rh
bmd1bGFyIHBhdGhzLgoKICBVc2VzIGNvbnRleHQucmVjdCguLi4pLgoKICBBdHRyaWJ1dGVzOgog
ICAgY3gsIGN5LCB3aWR0aCwgaGVpZ2h0LCBjZW50ZXJlZCwgcngsIHJ5CgogIElmIGNlbnRlcmVk
IGlzIHNldCB0byB0cnVlLCBjZW50ZXJzIHRoZSByZWN0YW5nbGUgb24gdGhlIG9yaWdpbi4KICBP
dGhlcndpc2UgdGhlIHRvcC1sZWZ0IGNvcm5lciBvZiB0aGUgcmVjdGFuZ2xlIGlzIG9uIHRoZSBv
cmlnaW4uCgogIEBwYXJhbSB3aWR0aCBXaWR0aCBvZiB0aGUgcmVjdGFuZ2xlLgogIEBwYXJhbSBo
ZWlnaHQgSGVpZ2h0IG9mIHRoZSByZWN0YW5nbGUuCiAgQHBhcmFtIGNvbmZpZyBPcHRpb25hbCBj
b25maWcgaGFzaC4KICAqLwpSZWN0YW5nbGUgPSBLbGFzcyhEcmF3YWJsZSwgewogIGN4IDogMCwK
ICBjeSA6IDAsCiAgeDIgOiAwLAogIHkyIDogMCwKICB3aWR0aCA6IDAsCiAgaGVpZ2h0IDogMCwK
ICByeCA6IDAsCiAgcnkgOiAwLAogIGNlbnRlcmVkIDogZmFsc2UsCgogIGluaXRpYWxpemUgOiBm
dW5jdGlvbih3aWR0aCwgaGVpZ2h0LCBjb25maWcpIHsKICAgIGlmICh3aWR0aCAhPSBudWxsKSB7
CiAgICAgIHRoaXMud2lkdGggPSB3aWR0aAogICAgICB0aGlzLmhlaWdodCA9IHdpZHRoCiAgICB9
CiAgICBpZiAoaGVpZ2h0ICE9IG51bGwpIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0CiAgICBEcmF3YWJs
ZS5pbml0aWFsaXplLmNhbGwodGhpcywgY29uZmlnKQogIH0sCgogIC8qKgogICAgQ3JlYXRlcyBh
IHJlY3Rhbmd1bGFyIHBhdGggdXNpbmcgY3R4LnJlY3QoLi4uKS4KCiAgICBAcGFyYW0gY3R4IENh
bnZhcyBkcmF3aW5nIGNvbnRleHQuCiAgICAqLwogIGRyYXdHZW9tZXRyeSA6IGZ1bmN0aW9uKGN0
eCkgewogICAgdmFyIHggPSB0aGlzLmN4CiAgICB2YXIgeSA9IHRoaXMuY3kKICAgIHZhciB3ID0g
KHRoaXMud2lkdGggfHwgKHRoaXMueDIgLSB4KSkKICAgIHZhciBoID0gKHRoaXMuaGVpZ2h0IHx8
ICh0aGlzLnkyIC0geSkpCiAgICBpZiAodyA9PSAwIHx8IGggPT0gMCkgcmV0dXJuCiAgICBpZiAo
dGhpcy5jZW50ZXJlZCkgewogICAgICB4IC09IDAuNSp3CiAgICAgIHkgLT0gMC41KmgKICAgIH0K
ICAgIGlmICh0aGlzLnJ4IHx8IHRoaXMucnkpIHsKICAgICAgLy8gaGFoYWEsIHdlbGNvbWUgdG8g
dGhlIHVuZG9jdW1lbnRlZCByb3VuZGVkIGNvcm5lcnMgcGF0aAogICAgICAvLyB1c2luZyBiZXpp
ZXIgY3VydmVzIGFwcHJveGltYXRpbmcgZWxsaXBzZSBxdWFkcmFudHMKICAgICAgdmFyIHJ4ID0g
TWF0aC5taW4odyAqIDAuNSwgdGhpcy5yeCB8fCB0aGlzLnJ5KQogICAgICB2YXIgcnkgPSBNYXRo
Lm1pbihoICogMC41LCB0aGlzLnJ5IHx8IHJ4KQogICAgICB2YXIgayA9IDAuNTUyMjg0NzQ5OAog
ICAgICB2YXIga3J4ID0gaypyeAogICAgICB2YXIga3J5ID0gaypyeQogICAgICBjdHgubW92ZVRv
KHgrcngsIHkpCiAgICAgIGN0eC5saW5lVG8oeC1yeCt3LCB5KQogICAgICBjdHguYmV6aWVyQ3Vy
dmVUbyh4LXJ4K3cgKyBrcngsIHksIHgrdywgeStyeS1rcnksIHgrdywgeStyeSkKICAgICAgY3R4
LmxpbmVUbyh4K3csIHkraC1yeSkKICAgICAgY3R4LmJlemllckN1cnZlVG8oeCt3LCB5K2gtcnkr
a3J5LCB4LXJ4K3cra3J4LCB5K2gsIHgtcngrdywgeStoKQogICAgICBjdHgubGluZVRvKHgrcngs
IHkraCkKICAgICAgY3R4LmJlemllckN1cnZlVG8oeCtyeC1rcngsIHkraCwgeCwgeStoLXJ5K2ty
eSwgeCwgeStoLXJ5KQogICAgICBjdHgubGluZVRvKHgsIHkrcnkpCiAgICAgIGN0eC5iZXppZXJD
dXJ2ZVRvKHgsIHkrcnkta3J5LCB4K3J4LWtyeCwgeSwgeCtyeCwgeSkKICAgICAgY3R4LmNsb3Nl
UGF0aCgpCiAgICB9IGVsc2UgewogICAgICBpZiAodyA8IDApIHggKz0gdwogICAgICBpZiAoaCA8
IDApIHkgKz0gaAogICAgICBjdHgucmVjdCh4LCB5LCBNYXRoLmFicyh3KSwgTWF0aC5hYnMoaCkp
CiAgICB9CiAgfSwKCiAgLyoqCiAgICBSZXR1cm5zIHRydWUgaWYgdGhlIHBvaW50IHgseSBpcyBp
bnNpZGUgdGhpcyByZWN0YW5nbGUuCgogICAgVGhlIHgseSBwb2ludCBpcyBpbiB1c2VyLXNwYWNl
IGNvb3JkaW5hdGVzLCBtZWFuaW5nIHRoYXQgZS5nLiB0aGUgcG9pbnQKICAgIDUsNSB3aWxsIGFs
d2F5cyBiZSBpbnNpZGUgdGhlIHJlY3RhbmdsZSBbMCwgMCwgMTAsIDEwXSwgcmVnYXJkbGVzcyBv
ZiB0aGUKICAgIHRyYW5zZm9ybSBvbiB0aGUgcmVjdGFuZ2xlLgoKICAgIEBwYXJhbSB4IFgtY29v
cmRpbmF0ZSBvZiB0aGUgcG9pbnQuCiAgICBAcGFyYW0geSBZLWNvb3JkaW5hdGUgb2YgdGhlIHBv
aW50LgogICAgQHJldHVybiBXaGV0aGVyIHRoZSBwb2ludCBpcyBpbnNpZGUgdGhpcyByZWN0YW5n
bGUuCiAgICBAdHlwZSBib29sZWFuCiAgICAqLwogIGlzUG9pbnRJblBhdGggOiBmdW5jdGlvbih4
LHkpIHsKICAgIHggLT0gdGhpcy5jeAogICAgeSAtPSB0aGlzLmN5CiAgICBpZiAodGhpcy5jZW50
ZXJlZCkgewogICAgICB4ICs9IHRoaXMud2lkdGgvMgogICAgICB5ICs9IHRoaXMuaGVpZ2h0LzIK
ICAgIH0KICAgIHJldHVybiAoeCA+PSAwICYmIHggPD0gdGhpcy53aWR0aCAmJiB5ID49IDAgJiYg
eSA8PSB0aGlzLmhlaWdodCkKICB9LAoKICBnZXRCb3VuZGluZ0JveCA6IGZ1bmN0aW9uKCkgewog
ICAgdmFyIHggPSB0aGlzLmN4CiAgICB2YXIgeSA9IHRoaXMuY3kKICAgIGlmICh0aGlzLmNlbnRl
cmVkKSB7CiAgICAgIHggLT0gdGhpcy53aWR0aC8yCiAgICAgIHkgLT0gdGhpcy5oZWlnaHQvMgog
ICAgfQogICAgcmV0dXJuIFt4LHksdGhpcy53aWR0aCx0aGlzLmhlaWdodF0KICB9Cn0pCgoKLyoq
CiAgUG9seWdvbiBpcyB1c2VkIGZvciBjcmVhdGluZyBwYXRocyBjb25zaXN0aW5nIG9mIHN0cmFp
Z2h0IGxpbmUKICBzZWdtZW50cy4KCiAgQXR0cmlidXRlczoKICAgIHNlZ21lbnRzIC0gVGhlIHZl
cnRpY2VzIG9mIHRoZSBwb2x5Z29uLCBlLmcuIFswLDAsIDEsMSwgMSwyLCAwLDFdCiAgICBjbG9z
ZVBhdGggLSBXaGV0aGVyIHRvIGNsb3NlIHRoZSBwYXRoLCBkZWZhdWx0IGlzIHRydWUuCgogIEBw
YXJhbSBzZWdtZW50cyBUaGUgdmVydGljZXMgb2YgdGhlIHBvbHlnb24uCiAgQHBhcmFtIGNsb3Nl
UGF0aCBXaGV0aGVyIHRvIGNsb3NlIHRoZSBwYXRoLgogIEBwYXJhbSBjb25maWcgT3B0aW9uYWwg
Y29uZmlnIGhhc2guCiAgKi8KUG9seWdvbiA9IEtsYXNzKERyYXdhYmxlLCB7CiAgc2VnbWVudHMg
OiBbXSwKICBjbG9zZVBhdGggOiB0cnVlLAoKICBpbml0aWFsaXplIDogZnVuY3Rpb24oc2VnbWVu
dHMsIGNvbmZpZykgewogICAgdGhpcy5zZWdtZW50cyA9IHNlZ21lbnRzCiAgICBEcmF3YWJsZS5p
bml0aWFsaXplLmNhbGwodGhpcywgY29uZmlnKQogIH0sCgogIGRyYXdHZW9tZXRyeSA6IGZ1bmN0
aW9uKGN0eCkgewogICAgaWYgKCF0aGlzLnNlZ21lbnRzIHx8IHRoaXMuc2VnbWVudHMubGVuZ3Ro
IDwgMikgcmV0dXJuCiAgICB2YXIgcyA9IHRoaXMuc2VnbWVudHMKICAgIGN0eC5tb3ZlVG8oc1sw
XSwgc1sxXSkKICAgIGZvciAodmFyIGk9MjsgaTxzLmxlbmd0aDsgaSs9MikgewogICAgICBjdHgu
bGluZVRvKHNbaV0sIHNbaSsxXSkKICAgIH0KICAgIGlmICh0aGlzLmNsb3NlUGF0aCkKICAgICAg
Y3R4LmNsb3NlUGF0aCgpCiAgfSwKCiAgaXNQb2ludEluUGF0aCA6IGZ1bmN0aW9uKHB4LHB5KSB7
CiAgICBpZiAoIXRoaXMuc2VnbWVudHMgfHwgdGhpcy5zZWdtZW50cy5sZW5ndGggPCAyKSByZXR1
cm4gZmFsc2UKICAgIHZhciBiYm94ID0gdGhpcy5nZXRCb3VuZGluZ0JveCgpCiAgICByZXR1cm4g
KHB4ID49IGJib3hbMF0gJiYgcHggPD0gYmJveFswXStiYm94WzJdICYmCiAgICAgICAgICAgIHB5
ID49IGJib3hbMV0gJiYgcHkgPD0gYmJveFsxXStiYm94WzNdKQogIH0sCgogIGdldFN0YXJ0UG9p
bnQgOiBmdW5jdGlvbigpIHsKICAgIGlmICghdGhpcy5zZWdtZW50cyB8fCB0aGlzLnNlZ21lbnRz
Lmxlbmd0aCA8IDIpCiAgICAgIHJldHVybiB7cG9pbnQ6WzAsMF0sIGFuZ2xlOjB9CiAgICB2YXIg
YSA9IDAKICAgIGlmICh0aGlzLnNlZ21lbnRzLmxlbmd0aCA+IDIpIHsKICAgICAgYSA9IEN1cnZl
cy5saW5lQW5nbGUodGhpcy5zZWdtZW50cy5zbGljZSgwLDIpLCB0aGlzLnNlZ21lbnRzLnNsaWNl
KDIsNCkpCiAgICB9CiAgICByZXR1cm4ge3BvaW50OiB0aGlzLnNlZ21lbnRzLnNsaWNlKDAsMiks
CiAgICAgICAgICAgIGFuZ2xlOiBhfQogIH0sCgogIGdldEVuZFBvaW50IDogZnVuY3Rpb24oKSB7
CiAgICBpZiAoIXRoaXMuc2VnbWVudHMgfHwgdGhpcy5zZWdtZW50cy5sZW5ndGggPCAyKQogICAg
ICByZXR1cm4ge3BvaW50OlswLDBdLCBhbmdsZTowfQogICAgdmFyIGEgPSAwCiAgICBpZiAodGhp
cy5zZWdtZW50cy5sZW5ndGggPiAyKSB7CiAgICAgIGEgPSBDdXJ2ZXMubGluZUFuZ2xlKHRoaXMu
c2VnbWVudHMuc2xpY2UoLTQsLTIpLCB0aGlzLnNlZ21lbnRzLnNsaWNlKC0yKSkKICAgIH0KICAg
IHJldHVybiB7cG9pbnQ6IHRoaXMuc2VnbWVudHMuc2xpY2UoLTIpLAogICAgICAgICAgICBhbmds
ZTogYX0KICB9LAoKICBnZXRNaWRQb2ludHMgOiBmdW5jdGlvbigpIHsKICAgIGlmICghdGhpcy5z
ZWdtZW50cyB8fCB0aGlzLnNlZ21lbnRzLmxlbmd0aCA8IDIpCiAgICAgIHJldHVybiBbXQogICAg
dmFyIHNlZ3MgPSB0aGlzLnNlZ21lbnRzCiAgICB2YXIgdmVydHMgPSBbXQogICAgZm9yICh2YXIg
aT0yOyBpPHNlZ3MubGVuZ3RoLTI7IGkrPTIpIHsKICAgICAgdmFyIGEgPSBzZWdzLnNsaWNlKGkt
MixpKQogICAgICB2YXIgYiA9IHNlZ3Muc2xpY2UoaSwgaSsyKQogICAgICB2YXIgYyA9IHNlZ3Mu
c2xpY2UoaSsyLCBpKzQpCiAgICAgIHZhciB0ID0gMC41ICogKEN1cnZlcy5saW5lQW5nbGUoYSxi
KSArIEN1cnZlcy5saW5lQW5nbGUoYixjKSkKICAgICAgdmVydHMucHVzaCgKICAgICAgICB7cG9p
bnQ6IGIsIGFuZ2xlOiB0fQogICAgICApCiAgICB9CiAgICByZXR1cm4gdmVydHMKICB9LAoKICBn
ZXRCb3VuZGluZ0JveCA6IGZ1bmN0aW9uKCkgewogICAgdmFyIG1pblggPSBJbmZpbml0eSwgbWlu
WSA9IEluZmluaXR5LCBtYXhYID0gLUluZmluaXR5LCBtYXhZID0gLUluZmluaXR5CiAgICB2YXIg
cyA9IHRoaXMuc2VnbWVudHMKICAgIGZvciAodmFyIGk9MDsgaTxzLmxlbmd0aDsgaSs9Mikgewog
ICAgICB2YXIgeCA9IHNbaV0sIHkgPSBzW2krMV0KICAgICAgaWYgKHggPCBtaW5YKSBtaW5YID0g
eAogICAgICBpZiAoeCA+IG1heFgpIG1heFggPSB4CiAgICAgIGlmICh5IDwgbWluWSkgbWluWSA9
IHkKICAgICAgaWYgKHkgPiBtYXhZKSBtYXhZID0geQogICAgfQogICAgcmV0dXJuIFttaW5YLCBt
aW5ZLCBtYXhYLW1pblgsIG1heFktbWluWV0KICB9Cn0pCgoKCi8qKgogIENhdG11bGxSb21TcGxp
bmUgZHJhd3MgYSBDYXRtdWxsLVJvbSBzcGxpbmUsIHdpdGggb3B0aW9uYWwgbG9vcGluZyBhbmQK
ICBwYXRoIGNsb3NpbmcuIEhhbmR5IGZvciBtb3Rpb24gcGF0aHMuCgogIEBwYXJhbSBzZWdtZW50
cyBDb250cm9sIHBvaW50cyBmb3IgdGhlIHNwbGluZSwgYXMgW1t4LHldLCBbeCx5XSwgLi4uXQog
IEBwYXJhbSBjb25maWcgT3B0aW9uYWwgY29uZmlnIGhhc2guCiAgKi8KQ2F0bXVsbFJvbVNwbGlu
ZSA9IEtsYXNzKERyYXdhYmxlLCB7CiAgc2VnbWVudHMgOiBbXSwKICBsb29wIDogZmFsc2UsCiAg
Y2xvc2VQYXRoIDogZmFsc2UsCgogIGluaXRpYWxpemUgOiBmdW5jdGlvbihzZWdtZW50cywgY29u
ZmlnKSB7CiAgICB0aGlzLnNlZ21lbnRzID0gc2VnbWVudHMKICAgIERyYXdhYmxlLmluaXRpYWxp
emUuY2FsbCh0aGlzLCBjb25maWcpCiAgfSwKCiAgZHJhd0dlb21ldHJ5IDogZnVuY3Rpb24oY3R4
KSB7CiAgICB2YXIgeDEgPSB0aGlzLmN1cnJlbnRNYXRyaXhbMF0KICAgIHZhciB4MiA9IHRoaXMu
Y3VycmVudE1hdHJpeFsxXQogICAgdmFyIHkxID0gdGhpcy5jdXJyZW50TWF0cml4WzJdCiAgICB2
YXIgeTIgPSB0aGlzLmN1cnJlbnRNYXRyaXhbM10KICAgIHZhciB4cyA9IHgxKngxICsgeDIqeDIK
ICAgIHZhciB5cyA9IHkxKnkxICsgeTIqeTIKICAgIHZhciBzID0gTWF0aC5mbG9vcihNYXRoLnNx
cnQoTWF0aC5tYXgoeHMsIHlzKSkpCiAgICB2YXIgY21wID0gdGhpcy5jb21waWxlZAogICAgaWYg
KCFjbXAgfHwgY21wLnNjYWxlICE9IHMpIHsKICAgICAgY21wID0gdGhpcy5jb21waWxlKHMpCiAg
ICB9CiAgICBmb3IgKHZhciBpPTA7IGk8Y21wLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBjbWQg
PSBjbXBbaV0KICAgICAgY3R4W2NtZFswXV0uYXBwbHkoY3R4LCBjbWRbMV0pCiAgICB9CiAgICBp
ZiAodGhpcy5jbG9zZVBhdGgpCiAgICAgIGN0eC5jbG9zZVBhdGgoKQogIH0sCgogIGNvbXBpbGUg
OiBmdW5jdGlvbihzY2FsZSkgewogICAgaWYgKCFzY2FsZSkgc2NhbGUgPSAxCiAgICB2YXIgY29t
cGlsZWQgPSBbXQogICAgaWYgKHRoaXMuc2VnbWVudHMgJiYgdGhpcy5zZWdtZW50cy5sZW5ndGgg
Pj0gKHRoaXMubG9vcCA/IDEgOiA0KSkgewogICAgICB2YXIgc2VncyA9IHRoaXMuc2VnbWVudHMK
ICAgICAgaWYgKHRoaXMubG9vcCkgewogICAgICAgIHNlZ3MgPSBzZWdzLnNsaWNlKDApCiAgICAg
ICAgc2Vncy51bnNoaWZ0KHNlZ3Nbc2Vncy5sZW5ndGgtMV0pCiAgICAgICAgc2Vncy5wdXNoKHNl
Z3NbMV0pCiAgICAgICAgc2Vncy5wdXNoKHNlZ3NbMl0pCiAgICAgIH0KICAgICAgLy8gRklYTUUg
ZG9uJ3QgYmUgc3R1cGlkCiAgICAgIHZhciBwb2ludF9zcGFjaW5nID0gMSAvICgxNSAqIChzY2Fs
ZSswLjUpKQogICAgICB2YXIgYSxiLGMsZCxwLHBwCiAgICAgIGNvbXBpbGVkLnB1c2goWydtb3Zl
VG8nLCBzZWdzWzFdLnNsaWNlKDApXSkKICAgICAgcCA9IHNlZ3NbMV0KICAgICAgZm9yICh2YXIg
aj0xOyBqPHNlZ3MubGVuZ3RoLTI7IGorKykgewogICAgICAgIGEgPSBzZWdzW2otMV0KICAgICAg
ICBiID0gc2Vnc1tqXQogICAgICAgIGMgPSBzZWdzW2orMV0KICAgICAgICBkID0gc2Vnc1tqKzJd
CiAgICAgICAgZm9yICh2YXIgaT0wOyBpPDE7IGkrPXBvaW50X3NwYWNpbmcpIHsKICAgICAgICAg
IHBwID0gcAogICAgICAgICAgcCA9IEN1cnZlcy5jYXRtdWxsUm9tUG9pbnQoYSxiLGMsZCxpKQog
ICAgICAgICAgY29tcGlsZWQucHVzaChbJ2xpbmVUbycsIHBdKQogICAgICAgIH0KICAgICAgfQog
ICAgICBwID0gQ3VydmVzLmNhdG11bGxSb21Qb2ludChhLGIsYyxkLDEpCiAgICAgIGNvbXBpbGVk
LnB1c2goWydsaW5lVG8nLCBwXSkKICAgIH0KICAgIGNvbXBpbGVkLnNjYWxlID0gc2NhbGUKICAg
IHRoaXMuY29tcGlsZWQgPSBjb21waWxlZAogICAgcmV0dXJuIGNvbXBpbGVkCiAgfSwKCiAgZ2V0
Qm91bmRpbmdCb3ggOiBmdW5jdGlvbigpIHsKICAgIHZhciBtaW5YID0gSW5maW5pdHksIG1pblkg
PSBJbmZpbml0eSwgbWF4WCA9IC1JbmZpbml0eSwgbWF4WSA9IC1JbmZpbml0eQogICAgdmFyIHNl
Z21lbnRzID0gKHRoaXMuY29tcGlsZWQgPyB0aGlzLmNvbXBpbGVkIDogdGhpcy5jb21waWxlKCkp
CiAgICBmb3IgKHZhciBpPTA7IGk8c2VnbWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHNl
ZyA9IHNlZ21lbnRzW2ldWzFdCiAgICAgIGZvciAodmFyIGo9MDsgajxzZWcubGVuZ3RoOyBqKz0y
KSB7CiAgICAgICAgdmFyIHggPSBzZWdbal0sIHkgPSBzZWdbaisxXQogICAgICAgIGlmICh4IDwg
bWluWCkgbWluWCA9IHgKICAgICAgICBpZiAoeCA+IG1heFgpIG1heFggPSB4CiAgICAgICAgaWYg
KHkgPCBtaW5ZKSBtaW5ZID0geQogICAgICAgIGlmICh5ID4gbWF4WSkgbWF4WSA9IHkKICAgICAg
fQogICAgfQogICAgcmV0dXJuIFttaW5YLCBtaW5ZLCBtYXhYLW1pblgsIG1heFktbWluWV0KICB9
LAoKICBwb2ludEF0IDogZnVuY3Rpb24odCkgewogICAgaWYgKCF0aGlzLnNlZ21lbnRzKSByZXR1
cm4gWzAsMF0KICAgIGlmICh0aGlzLnNlZ21lbnRzLmxlbmd0aCA+PSAodGhpcy5sb29wID8gMSA6
IDQpKSB7CiAgICAgIHZhciBzZWdzID0gdGhpcy5zZWdtZW50cwogICAgICBpZiAodGhpcy5sb29w
KSB7CiAgICAgICAgc2VncyA9IHNlZ3Muc2xpY2UoMCkKICAgICAgICBzZWdzLnVuc2hpZnQoc2Vn
c1tzZWdzLmxlbmd0aC0xXSkKICAgICAgICBzZWdzLnB1c2goc2Vnc1sxXSkKICAgICAgICBzZWdz
LnB1c2goc2Vnc1syXSkKICAgICAgfQogICAgICAvLyB0dXJuIHQgaW50byBzZWdtZW50X2luZGV4
LnNlZ21lbnRfdAogICAgICB2YXIgcnQgPSB0ICogKHNlZ3MubGVuZ3RoIC0gMykKICAgICAgdmFy
IGogPSBNYXRoLmZsb29yKHJ0KQogICAgICB2YXIgc3QgPSBydC1qCiAgICAgIHZhciBhID0gc2Vn
c1tqXSwKICAgICAgICAgIGIgPSBzZWdzW2orMV0sCiAgICAgICAgICBjID0gc2Vnc1tqKzJdLAog
ICAgICAgICAgZCA9IHNlZ3NbaiszXQogICAgICByZXR1cm4gQ3VydmVzLmNhdG11bGxSb21Qb2lu
dChhLGIsYyxkLHN0KQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHRoaXMuc2VnbWVudHNbMF0K
ICAgIH0KICB9LAoKICBwb2ludEFuZ2xlQXQgOiBmdW5jdGlvbih0KSB7CiAgICBpZiAoIXRoaXMu
c2VnbWVudHMpIHJldHVybiB7cG9pbnQ6IFswLDBdLCBhbmdsZTogMH0KICAgIGlmICh0aGlzLnNl
Z21lbnRzLmxlbmd0aCA+PSAodGhpcy5sb29wID8gMSA6IDQpKSB7CiAgICAgIHZhciBzZWdzID0g
dGhpcy5zZWdtZW50cwogICAgICBpZiAodGhpcy5sb29wKSB7CiAgICAgICAgc2VncyA9IHNlZ3Mu
c2xpY2UoMCkKICAgICAgICBzZWdzLnVuc2hpZnQoc2Vnc1tzZWdzLmxlbmd0aC0xXSkKICAgICAg
ICBzZWdzLnB1c2goc2Vnc1sxXSkKICAgICAgICBzZWdzLnB1c2goc2Vnc1syXSkKICAgICAgfQog
ICAgICAvLyB0dXJuIHQgaW50byBzZWdtZW50X2luZGV4LnNlZ21lbnRfdAogICAgICB2YXIgcnQg
PSB0ICogKHNlZ3MubGVuZ3RoIC0gMykKICAgICAgdmFyIGogPSBNYXRoLmZsb29yKHJ0KQogICAg
ICB2YXIgc3QgPSBydC1qCiAgICAgIHZhciBhID0gc2Vnc1tqXSwKICAgICAgICAgIGIgPSBzZWdz
W2orMV0sCiAgICAgICAgICBjID0gc2Vnc1tqKzJdLAogICAgICAgICAgZCA9IHNlZ3NbaiszXQog
ICAgICByZXR1cm4gQ3VydmVzLmNhdG11bGxSb21Qb2ludEFuZ2xlKGEsYixjLGQsc3QpCiAgICB9
IGVsc2UgewogICAgICByZXR1cm4ge3BvaW50OnRoaXMuc2VnbWVudHNbMF0gfHwgWzAsMF0sIGFu
Z2xlOiAwfQogICAgfQogIH0KfSkKCgovKioKICBQYXRoIGlzIHVzZWQgZm9yIGNyZWF0aW5nIGN1
c3RvbSBwYXRocy4KCiAgQXR0cmlidXRlczogc2VnbWVudHMsIGNsb3NlUGF0aC4KCiAgICB2YXIg
cGF0aCA9IG5ldyBQYXRoKFsKICAgICAgWydtb3ZlVG8nLCBbLTUwLCAtNjBdXSwKICAgICAgWyds
aW5lVG8nLCBbMzAsIDUwXSwKICAgICAgWydsaW5lVG8nLCBbLTUwLCA1MF1dLAogICAgICBbJ2Jl
emllckN1cnZlVG8nLCBbLTUwLCAxMDAsIC01MCwgMTAwLCAwLCAxMDBdXSwKICAgICAgWydxdWFk
cmF0aWNDdXJ2ZVRvJywgWzAsIDEyMCwgLTIwLCAxMzBdXSwKICAgICAgWydxdWFkcmF0aWNDdXJ2
ZVRvJywgWzAsIDE0MCwgMCwgMTYwXV0sCiAgICAgIFsnYmV6aWVyQ3VydmVUbycsIFstMTAsIDE2
MCwgLTIwLCAxNzAsIC0zMCwgMTgwXV0sCiAgICAgIFsncXVhZHJhdGljQ3VydmVUbycsIFsxMCwg
MjMwLCAtNTAsIDI2MF1dCiAgICBdKQoKICBUaGUgcGF0aCBzZWdtZW50cyBhcmUgdXNlZCBhcyBb
bWV0aG9kTmFtZSwgYXJndW1lbnRzXSBvbiB0aGUgY2FudmFzCiAgZHJhd2luZyBjb250ZXh0LCBz
byB0aGUgcG9zc2libGUgcGF0aCBzZWdtZW50cyBhcmU6CgogICAgWydtb3ZlVG8nLCBbeCwgeV1d
CiAgICBbJ2xpbmVUbycsIFt4LCB5XV0KICAgIFsncXVhZHJhdGljQ3VydmVUbycsIFtjb250cm9s
X3BvaW50X3gsIGNvbnRyb2xfcG9pbnRfeSwgeCwgeV1dCiAgICBbJ2JlemllckN1cnZlVG8nLCBb
Y3AxeCwgY3AxeSwgY3AyeCwgY3AyeSwgeCwgeV1dCiAgICBbJ2FyYycsIFt4LCB5LCByYWRpdXMs
IHN0YXJ0QW5nbGUsIGVuZEFuZ2xlLCBkcmF3Q2xvY2t3aXNlXV0KICAgIFsnYXJjVG8nLCBbeDEs
IHkxLCB4MiwgeTIsIHJhZGl1c11dCiAgICBbJ3JlY3QnLCBbeCwgeSwgd2lkdGgsIGhlaWdodF1d
CgogIFlvdSBjYW4gYWxzbyBwYXNzIGFuIFNWRyBwYXRoIHN0cmluZyBhcyBzZWdtZW50cy4KCiAg
ICB2YXIgcGF0aCA9IG5ldyBQYXRoKCJNIDEwMCAxMDAgTCAzMDAgMTAwIEwgMjAwIDMwMCB6Iiwg
ewogICAgICBzdHJva2U6IHRydWUsIHN0cm9rZVN0eWxlOiAnYmx1ZScsCiAgICAgIGZpbGw6IHRy
dWUsIGZpbGxTdHlsZTogJ3JlZCcsCiAgICAgIGxpbmVXaWR0aDogMwogICAgfSkKCiAgQHBhcmFt
IHNlZ21lbnRzIFRoZSBwYXRoIHNlZ21lbnRzLgogIEBwYXJhbSBjb25maWcgT3B0aW9uYWwgY29u
ZmlnIGhhc2guCiAgKi8KUGF0aCA9IEtsYXNzKERyYXdhYmxlLCB7CiAgc2VnbWVudHMgOiBbXSwK
ICBjbG9zZVBhdGggOiBmYWxzZSwKCiAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKHNlZ21lbnRzLCBj
b25maWcpIHsKICAgIHRoaXMuc2VnbWVudHMgPSBzZWdtZW50cwogICAgRHJhd2FibGUuaW5pdGlh
bGl6ZS5jYWxsKHRoaXMsIGNvbmZpZykKICB9LAoKICAvKioKICAgIENyZWF0ZXMgYSBwYXRoIG9u
IHRoZSBnaXZlbiBkcmF3aW5nIGNvbnRleHQuCgogICAgRm9yIGVhY2ggcGF0aCBzZWdtZW50LCBj
YWxscyB0aGUgY29udGV4dCBtZXRob2QgbmFtZWQgaW4gdGhlIGZpcnN0IGVsZW1lbnQKICAgIG9m
IHRoZSBzZWdtZW50IHdpdGggdGhlIHJlc3Qgb2YgdGhlIHNlZ21lbnQgZWxlbWVudHMgYXMgYXJn
dW1lbnRzLgoKICAgIFNWRyBwYXRocyBhcmUgcGFyc2VkIGFuZCBleGVjdXRlZC4KCiAgICBDbG9z
ZXMgdGhlIHBhdGggaWYgY2xvc2VQYXRoIGlzIHRydWUuCgogICAgQHBhcmFtIGN0eCBDYW52YXMg
ZHJhd2luZyBjb250ZXh0LgogICAgKi8KICBkcmF3R2VvbWV0cnkgOiBmdW5jdGlvbihjdHgpIHsK
ICAgIHZhciBzZWdtZW50cyA9IHRoaXMuZ2V0U2VnbWVudHMoKQogICAgZm9yICh2YXIgaT0wOyBp
PHNlZ21lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzZWcgPSBzZWdtZW50c1tpXQogICAg
ICBjdHhbc2VnWzBdXS5hcHBseShjdHgsIHNlZ1sxXSkKICAgIH0KICAgIGlmICh0aGlzLmNsb3Nl
UGF0aCkKICAgICAgY3R4LmNsb3NlUGF0aCgpCiAgfSwKCiAgLyoqCiAgICBSZXR1cm5zIHRydWUg
aWYgdGhlIHBvaW50IHgseSBpcyBpbnNpZGUgdGhlIHBhdGgncyBib3VuZGluZyByZWN0YW5nbGUu
CgogICAgVGhlIHgseSBwb2ludCBpcyBpbiB1c2VyLXNwYWNlIGNvb3JkaW5hdGVzLCBtZWFuaW5n
IHRoYXQgZS5nLiB0aGUgcG9pbnQKICAgIDUsNSB3aWxsIGFsd2F5cyBiZSBpbnNpZGUgdGhlIHJl
Y3RhbmdsZSBbMCwgMCwgMTAsIDEwXSwgcmVnYXJkbGVzcyBvZiB0aGUKICAgIHRyYW5zZm9ybSBv
biB0aGUgcmVjdGFuZ2xlLgoKICAgIEBwYXJhbSBweCBYLWNvb3JkaW5hdGUgb2YgdGhlIHBvaW50
LgogICAgQHBhcmFtIHB5IFktY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnQuCiAgICBAcmV0dXJuIFdo
ZXRoZXIgdGhlIHBvaW50IGlzIGluc2lkZSB0aGUgcGF0aCdzIGJvdW5kaW5nIHJlY3RhbmdsZS4K
ICAgIEB0eXBlIGJvb2xlYW4KICAgICovCiAgaXNQb2ludEluUGF0aCA6IGZ1bmN0aW9uKHB4LHB5
KSB7CiAgICB2YXIgYmJveCA9IHRoaXMuZ2V0Qm91bmRpbmdCb3goKQogICAgcmV0dXJuIChweCA+
PSBiYm94WzBdICYmIHB4IDw9IGJib3hbMF0rYmJveFsyXSAmJgogICAgICAgICAgICBweSA+PSBi
Ym94WzFdICYmIHB5IDw9IGJib3hbMV0rYmJveFszXSkKICB9LAoKICBnZXRCb3VuZGluZ0JveCA6
IGZ1bmN0aW9uKCkgewogICAgaWYgKCEodGhpcy5jb21waWxlZCAmJiB0aGlzLmNvbXBpbGVkQm91
bmRpbmdCb3gpKSB7CiAgICAgIHZhciBtaW5YID0gSW5maW5pdHksIG1pblkgPSBJbmZpbml0eSwg
bWF4WCA9IC1JbmZpbml0eSwgbWF4WSA9IC1JbmZpbml0eQogICAgICB2YXIgc2VnbWVudHMgPSB0
aGlzLmdldFNlZ21lbnRzKCkKICAgICAgZm9yICh2YXIgaT0wOyBpPHNlZ21lbnRzLmxlbmd0aDsg
aSsrKSB7CiAgICAgICAgdmFyIHNlZyA9IHNlZ21lbnRzW2ldWzFdCiAgICAgICAgZm9yICh2YXIg
aj0wOyBqPHNlZy5sZW5ndGg7IGorPTIpIHsKICAgICAgICAgIHZhciB4ID0gc2VnW2pdLCB5ID0g
c2VnW2orMV0KICAgICAgICAgIGlmICh4IDwgbWluWCkgbWluWCA9IHgKICAgICAgICAgIGlmICh4
ID4gbWF4WCkgbWF4WCA9IHgKICAgICAgICAgIGlmICh5IDwgbWluWSkgbWluWSA9IHkKICAgICAg
ICAgIGlmICh5ID4gbWF4WSkgbWF4WSA9IHkKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5j
b21waWxlZEJvdW5kaW5nQm94ID0gW21pblgsIG1pblksIG1heFgtbWluWCwgbWF4WS1taW5ZXQog
ICAgfQogICAgcmV0dXJuIHRoaXMuY29tcGlsZWRCb3VuZGluZ0JveAogIH0sCgogIGdldFN0YXJ0
UG9pbnQgOiBmdW5jdGlvbigpIHsKICAgIHZhciBzZWdzID0gdGhpcy5nZXRTZWdtZW50cygpCiAg
ICBpZiAoIXNlZ3MgfHwgIXNlZ3NbMF0pIHJldHVybiB7cG9pbnQ6IFswLDBdLCBhbmdsZTogMH0K
ICAgIHZhciBmcyA9IHNlZ3NbMF0KICAgIHZhciBjID0gZnNbMV0KICAgIHZhciBwb2ludCA9IFtj
W2MubGVuZ3RoLTJdLCBjW2MubGVuZ3RoLTFdXQogICAgdmFyIHNzID0gc2Vnc1sxXQogICAgdmFy
IGFuZ2xlID0gMAogICAgaWYgKHNzKSB7CiAgICAgIGMyID0gc3NbMV0KICAgICAgYW5nbGUgPSBD
dXJ2ZXMubGluZUFuZ2xlKHBvaW50LCBbYzJbYzIubGVuZ3RoLTJdLCBjMltjMi5sZW5ndGgtMV1d
KQogICAgfQogICAgcmV0dXJuIHsKICAgICAgcG9pbnQ6IHBvaW50LAogICAgICBhbmdsZTogYW5n
bGUKICAgIH0KICB9LAoKICBnZXRFbmRQb2ludCA6IGZ1bmN0aW9uKCkgewogICAgdmFyIHNlZ3Mg
PSB0aGlzLmdldFNlZ21lbnRzKCkKICAgIGlmICghc2VncyB8fCAhc2Vnc1swXSkgcmV0dXJuIHtw
b2ludDogWzAsMF0sIGFuZ2xlOiAwfQogICAgdmFyIGZzID0gc2Vnc1tzZWdzLmxlbmd0aC0xXQog
ICAgdmFyIGMgPSBmc1sxXQogICAgdmFyIHBvaW50ID0gW2NbYy5sZW5ndGgtMl0sIGNbYy5sZW5n
dGgtMV1dCiAgICB2YXIgc3MgPSBzZWdzW3NlZ3MubGVuZ3RoLTJdCiAgICB2YXIgYW5nbGUgPSAw
CiAgICBpZiAoc3MpIHsKICAgICAgYzIgPSBzc1sxXQogICAgICBhbmdsZSA9IEN1cnZlcy5saW5l
QW5nbGUoW2MyW2MyLmxlbmd0aC0yXSwgYzJbYzIubGVuZ3RoLTFdXSwgcG9pbnQpCiAgICB9CiAg
ICByZXR1cm4gewogICAgICBwb2ludDogcG9pbnQsCiAgICAgIGFuZ2xlOiBhbmdsZQogICAgfQog
IH0sCgogIGdldE1pZFBvaW50cyA6IGZ1bmN0aW9uKCkgewogICAgdmFyIHNlZ3MgPSB0aGlzLmdl
dFNlZ21lbnRzKCkKICAgIGlmICh0aGlzLnZlcnRpY2VzKQogICAgICByZXR1cm4gdGhpcy52ZXJ0
aWNlcy5zbGljZSgxLC0xKQogICAgdmFyIHZlcnRzID0gW10KICAgIGZvciAodmFyIGk9MTsgaTxz
ZWdzLmxlbmd0aC0xOyBpKyspIHsKICAgICAgdmFyIGIgPSBzZWdzW2ktMV1bMV0uc2xpY2UoLTIp
CiAgICAgIHZhciBjID0gc2Vnc1tpXVsxXS5zbGljZSgwLDIpCiAgICAgIGlmIChzZWdzW2ktMV0u
bGVuZ3RoID4gMikgewogICAgICAgIHZhciBhID0gc2Vnc1tpLTFdWzFdLnNsaWNlKC00LC0yKQog
ICAgICAgIHZhciB0ID0gMC41ICogKEN1cnZlcy5saW5lQW5nbGUoYSxiKSArIEN1cnZlcy5saW5l
QW5nbGUoYixjKSkKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgdCA9IEN1cnZlcy5saW5lQW5n
bGUoYixjKQogICAgICB9CiAgICAgIHZlcnRzLnB1c2goCiAgICAgICAge3BvaW50OiBiLCBhbmds
ZTogdH0KICAgICAgKQogICAgICB2YXIgaWQgPSBzZWdzW2ldWzJdCiAgICAgIGlmIChpZCAhPSBu
dWxsKSB7CiAgICAgICAgaSsrCiAgICAgICAgd2hpbGUgKHNlZ3NbaV0gJiYgc2Vnc1tpXVsyXSA9
PSBpZCkgaSsrCiAgICAgICAgaS0tCiAgICAgIH0KICAgIH0KICAgIHJldHVybiB2ZXJ0cwogIH0s
CgogIGdldFNlZ21lbnRzIDogZnVuY3Rpb24oKSB7CiAgICBpZiAodHlwZW9mKHRoaXMuc2VnbWVu
dHMpID09ICdzdHJpbmcnKSB7CiAgICAgIGlmICghdGhpcy5jb21waWxlZCB8fCB0aGlzLnNlZ21l
bnRzICE9IHRoaXMuY29tcGlsZWRTZWdtZW50cykgewogICAgICAgIHRoaXMuY29tcGlsZWQgPSB0
aGlzLmNvbXBpbGVTVkdQYXRoKHRoaXMuc2VnbWVudHMpCiAgICAgICAgdGhpcy5jb21waWxlZFNl
Z21lbnRzID0gdGhpcy5zZWdtZW50cwogICAgICB9CiAgICB9IGVsc2UgaWYgKCF0aGlzLmNvbXBp
bGVkKSB7CiAgICAgIHRoaXMuY29tcGlsZWQgPSBPYmplY3QuY2xvbmUodGhpcy5zZWdtZW50cykK
ICAgIH0KICAgIHJldHVybiB0aGlzLmNvbXBpbGVkCiAgfSwKCiAgLyoqCiAgICBDb21waWxlcyBh
biBTVkcgcGF0aCBzdHJpbmcgaW50byBhbiBhcnJheSBvZiBjYW52YXMgY29udGV4dCBtZXRob2Qg
Y2FsbHMuCgogICAgUmV0dXJucyBhbiBhcnJheSBvZiBbbWV0aG9kTmFtZSwgW2FyZzEsIGFyZzIs
IC4uLl1dIG1ldGhvZCBjYWxsIGFycmF5cy4KICAgICovCiAgY29tcGlsZVNWR1BhdGggOiBmdW5j
dGlvbihzdmdQYXRoKSB7CiAgICB2YXIgc2VncyA9IHN2Z1BhdGguc3BsaXQoLyg/PVthLXpdKS9p
KQogICAgdmFyIHggPSAwCiAgICB2YXIgeSA9IDAKICAgIHZhciBweCxweQogICAgdmFyIHBjCiAg
ICB2YXIgY29tbWFuZHMgPSBbXQogICAgZm9yICh2YXIgaT0wOyBpPHNlZ3MubGVuZ3RoOyBpKysp
IHsKICAgICAgdmFyIHNlZyA9IHNlZ3NbaV0KICAgICAgdmFyIGNtZCA9IHNlZy5tYXRjaCgvW2Et
el0vaSkKICAgICAgaWYgKCFjbWQpIHJldHVybiBbXTsKICAgICAgY21kID0gY21kWzBdOwogICAg
ICB2YXIgY29vcmRzID0gc2VnLm1hdGNoKC9bKy1dP1xkKyhcLlxkKyhlXGQrKFwuXGQrKT8pPyk/
L2dpKQogICAgICBpZiAoY29vcmRzKSBjb29yZHMgPSBjb29yZHMubWFwKHBhcnNlRmxvYXQpCiAg
ICAgIHN3aXRjaChjbWQpIHsKICAgICAgICBjYXNlICdNJzoKICAgICAgICAgIHggPSBjb29yZHNb
MF0KICAgICAgICAgIHkgPSBjb29yZHNbMV0KICAgICAgICAgIHB4ID0gcHkgPSBudWxsCiAgICAg
ICAgICBjb21tYW5kcy5wdXNoKFsnbW92ZVRvJywgW3gsIHldXSkKICAgICAgICAgIGJyZWFrCiAg
ICAgICAgY2FzZSAnbSc6CiAgICAgICAgICB4ICs9IGNvb3Jkc1swXQogICAgICAgICAgeSArPSBj
b29yZHNbMV0KICAgICAgICAgIHB4ID0gcHkgPSBudWxsCiAgICAgICAgICBjb21tYW5kcy5wdXNo
KFsnbW92ZVRvJywgW3gsIHldXSkKICAgICAgICAgIGJyZWFrCgogICAgICAgIGNhc2UgJ0wnOgog
ICAgICAgICAgeCA9IGNvb3Jkc1swXQogICAgICAgICAgeSA9IGNvb3Jkc1sxXQogICAgICAgICAg
cHggPSBweSA9IG51bGwKICAgICAgICAgIGNvbW1hbmRzLnB1c2goWydsaW5lVG8nLCBbeCwgeV1d
KQogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdsJzoKICAgICAgICAgIHggKz0gY29vcmRz
WzBdCiAgICAgICAgICB5ICs9IGNvb3Jkc1sxXQogICAgICAgICAgcHggPSBweSA9IG51bGwKICAg
ICAgICAgIGNvbW1hbmRzLnB1c2goWydsaW5lVG8nLCBbeCwgeV1dKQogICAgICAgICAgYnJlYWsK
ICAgICAgICBjYXNlICdIJzoKICAgICAgICAgIHggPSBjb29yZHNbMF0KICAgICAgICAgIHB4ID0g
cHkgPSBudWxsCiAgICAgICAgICBjb21tYW5kcy5wdXNoKFsnbGluZVRvJywgW3gsIHldXSkKICAg
ICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAnaCc6CiAgICAgICAgICB4ICs9IGNvb3Jkc1swXQog
ICAgICAgICAgcHggPSBweSA9IG51bGwKICAgICAgICAgIGNvbW1hbmRzLnB1c2goWydsaW5lVG8n
LCBbeCx5XV0pCiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgJ1YnOgogICAgICAgICAgeSA9
IGNvb3Jkc1swXQogICAgICAgICAgcHggPSBweSA9IG51bGwKICAgICAgICAgIGNvbW1hbmRzLnB1
c2goWydsaW5lVG8nLCBbeCx5XV0pCiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgJ3YnOgog
ICAgICAgICAgeSArPSBjb29yZHNbMF0KICAgICAgICAgIHB4ID0gcHkgPSBudWxsCiAgICAgICAg
ICBjb21tYW5kcy5wdXNoKFsnbGluZVRvJywgW3gseV1dKQogICAgICAgICAgYnJlYWsKCiAgICAg
ICAgY2FzZSAnQyc6CiAgICAgICAgICB4ID0gY29vcmRzWzRdCiAgICAgICAgICB5ID0gY29vcmRz
WzVdCiAgICAgICAgICBweCA9IGNvb3Jkc1syXQogICAgICAgICAgcHkgPSBjb29yZHNbM10KICAg
ICAgICAgIGNvbW1hbmRzLnB1c2goWydiZXppZXJDdXJ2ZVRvJywgY29vcmRzXSkKICAgICAgICAg
IGJyZWFrCiAgICAgICAgY2FzZSAnYyc6CiAgICAgICAgICBjb21tYW5kcy5wdXNoKFsnYmV6aWVy
Q3VydmVUbycsWwogICAgICAgICAgICBjb29yZHNbMF0gKyB4LCBjb29yZHNbMV0gKyB5LAogICAg
ICAgICAgICBjb29yZHNbMl0gKyB4LCBjb29yZHNbM10gKyB5LAogICAgICAgICAgICBjb29yZHNb
NF0gKyB4LCBjb29yZHNbNV0gKyB5CiAgICAgICAgICBdXSkKICAgICAgICAgIHB4ID0geCArIGNv
b3Jkc1syXQogICAgICAgICAgcHkgPSB5ICsgY29vcmRzWzNdCiAgICAgICAgICB4ICs9IGNvb3Jk
c1s0XQogICAgICAgICAgeSArPSBjb29yZHNbNV0KICAgICAgICAgIGJyZWFrCgogICAgICAgIGNh
c2UgJ1MnOgogICAgICAgICAgaWYgKHB4ID09IG51bGwgfHwgIXBjLm1hdGNoKC9bc2NdL2kpKSB7
CiAgICAgICAgICAgIHB4ID0geAogICAgICAgICAgICBweSA9IHkKICAgICAgICAgIH0KICAgICAg
ICAgIGNvbW1hbmRzLnB1c2goWydiZXppZXJDdXJ2ZVRvJyxbCiAgICAgICAgICAgIHgtKHB4LXgp
LCB5LShweS15KSwKICAgICAgICAgICAgY29vcmRzWzBdLCBjb29yZHNbMV0sCiAgICAgICAgICAg
IGNvb3Jkc1syXSwgY29vcmRzWzNdCiAgICAgICAgICBdXSkKICAgICAgICAgIHB4ID0gY29vcmRz
WzBdCiAgICAgICAgICBweSA9IGNvb3Jkc1sxXQogICAgICAgICAgeCA9IGNvb3Jkc1syXQogICAg
ICAgICAgeSA9IGNvb3Jkc1szXQogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdzJzoKICAg
ICAgICAgIGlmIChweCA9PSBudWxsIHx8ICFwYy5tYXRjaCgvW3NjXS9pKSkgewogICAgICAgICAg
ICBweCA9IHgKICAgICAgICAgICAgcHkgPSB5CiAgICAgICAgICB9CiAgICAgICAgICBjb21tYW5k
cy5wdXNoKFsnYmV6aWVyQ3VydmVUbycsWwogICAgICAgICAgICB4LShweC14KSwgeS0ocHkteSks
CiAgICAgICAgICAgIHggKyBjb29yZHNbMF0sIHkgKyBjb29yZHNbMV0sCiAgICAgICAgICAgIHgg
KyBjb29yZHNbMl0sIHkgKyBjb29yZHNbM10KICAgICAgICAgIF1dKQogICAgICAgICAgcHggPSB4
ICsgY29vcmRzWzBdCiAgICAgICAgICBweSA9IHkgKyBjb29yZHNbMV0KICAgICAgICAgIHggKz0g
Y29vcmRzWzJdCiAgICAgICAgICB5ICs9IGNvb3Jkc1szXQogICAgICAgICAgYnJlYWsKCiAgICAg
ICAgY2FzZSAnUSc6CiAgICAgICAgICBweCA9IGNvb3Jkc1swXQogICAgICAgICAgcHkgPSBjb29y
ZHNbMV0KICAgICAgICAgIHggPSBjb29yZHNbMl0KICAgICAgICAgIHkgPSBjb29yZHNbM10KICAg
ICAgICAgIGNvbW1hbmRzLnB1c2goWydxdWFkcmF0aWNDdXJ2ZVRvJywgY29vcmRzXSkKICAgICAg
ICAgIGJyZWFrCiAgICAgICAgY2FzZSAncSc6CiAgICAgICAgICBjb21tYW5kcy5wdXNoKFsncXVh
ZHJhdGljQ3VydmVUbycsWwogICAgICAgICAgICBjb29yZHNbMF0gKyB4LCBjb29yZHNbMV0gKyB5
LAogICAgICAgICAgICBjb29yZHNbMl0gKyB4LCBjb29yZHNbM10gKyB5CiAgICAgICAgICBdXSkK
ICAgICAgICAgIHB4ID0geCArIGNvb3Jkc1swXQogICAgICAgICAgcHkgPSB5ICsgY29vcmRzWzFd
CiAgICAgICAgICB4ICs9IGNvb3Jkc1syXQogICAgICAgICAgeSArPSBjb29yZHNbM10KICAgICAg
ICAgIGJyZWFrCgogICAgICAgIGNhc2UgJ1QnOgogICAgICAgICAgaWYgKHB4ID09IG51bGwgfHwg
IXBjLm1hdGNoKC9bcXRdL2kpKSB7CiAgICAgICAgICAgIHB4ID0geAogICAgICAgICAgICBweSA9
IHkKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHB4ID0geC0ocHgteCkKICAgICAgICAg
ICAgcHkgPSB5LShweS15KQogICAgICAgICAgfQogICAgICAgICAgY29tbWFuZHMucHVzaChbJ3F1
YWRyYXRpY0N1cnZlVG8nLFsKICAgICAgICAgICAgcHgsIHB5LAogICAgICAgICAgICBjb29yZHNb
MF0sIGNvb3Jkc1sxXQogICAgICAgICAgXV0pCiAgICAgICAgICBweCA9IHgtKHB4LXgpCiAgICAg
ICAgICBweSA9IHktKHB5LXkpCiAgICAgICAgICB4ID0gY29vcmRzWzBdCiAgICAgICAgICB5ID0g
Y29vcmRzWzFdCiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgJ3QnOgogICAgICAgICAgaWYg
KHB4ID09IG51bGwgfHwgIXBjLm1hdGNoKC9bcXRdL2kpKSB7CiAgICAgICAgICAgIHB4ID0geAog
ICAgICAgICAgICBweSA9IHkKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHB4ID0geC0o
cHgteCkKICAgICAgICAgICAgcHkgPSB5LShweS15KQogICAgICAgICAgfQogICAgICAgICAgY29t
bWFuZHMucHVzaChbJ3F1YWRyYXRpY0N1cnZlVG8nLFsKICAgICAgICAgICAgcHgsIHB5LAogICAg
ICAgICAgICB4ICsgY29vcmRzWzBdLCB5ICsgY29vcmRzWzFdCiAgICAgICAgICBdXSkKICAgICAg
ICAgIHggKz0gY29vcmRzWzBdCiAgICAgICAgICB5ICs9IGNvb3Jkc1sxXQogICAgICAgICAgYnJl
YWsKCiAgICAgICAgY2FzZSAnQSc6CiAgICAgICAgICB2YXIgYXJjX3NlZ3MgPSB0aGlzLnNvbHZl
QXJjKHgseSwgY29vcmRzKQogICAgICAgICAgZm9yICh2YXIgbD0wOyBsPGFyY19zZWdzLmxlbmd0
aDsgbCsrKSBhcmNfc2Vnc1tsXVsyXSA9IGkKICAgICAgICAgIGNvbW1hbmRzLnB1c2guYXBwbHko
Y29tbWFuZHMsIGFyY19zZWdzKQogICAgICAgICAgeCA9IGNvb3Jkc1s1XQogICAgICAgICAgeSA9
IGNvb3Jkc1s2XQogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlICdhJzoKICAgICAgICAgIGNv
b3Jkc1s1XSArPSB4CiAgICAgICAgICBjb29yZHNbNl0gKz0geQogICAgICAgICAgdmFyIGFyY19z
ZWdzID0gdGhpcy5zb2x2ZUFyYyh4LHksIGNvb3JkcykKICAgICAgICAgIGZvciAodmFyIGw9MDsg
bDxhcmNfc2Vncy5sZW5ndGg7IGwrKykgYXJjX3NlZ3NbbF1bMl0gPSBpCiAgICAgICAgICBjb21t
YW5kcy5wdXNoLmFwcGx5KGNvbW1hbmRzLCBhcmNfc2VncykKICAgICAgICAgIHggPSBjb29yZHNb
NV0KICAgICAgICAgIHkgPSBjb29yZHNbNl0KICAgICAgICAgIGJyZWFrCgogICAgICAgIGNhc2Ug
J1onOgogICAgICAgICAgY29tbWFuZHMucHVzaChbJ2Nsb3NlUGF0aCcsIFtdXSkKICAgICAgICAg
IGJyZWFrCiAgICAgICAgY2FzZSAneic6CiAgICAgICAgICBjb21tYW5kcy5wdXNoKFsnY2xvc2VQ
YXRoJywgW11dKQogICAgICAgICAgYnJlYWsKICAgICAgfQogICAgICBwYyA9IGNtZAogICAgfQog
ICAgcmV0dXJuIGNvbW1hbmRzCiAgfSwKCiAgc29sdmVBcmMgOiBmdW5jdGlvbih4LCB5LCBjb29y
ZHMpIHsKICAgIHZhciByeCA9IGNvb3Jkc1swXQogICAgdmFyIHJ5ID0gY29vcmRzWzFdCiAgICB2
YXIgcm90ID0gY29vcmRzWzJdCiAgICB2YXIgbGFyZ2UgPSBjb29yZHNbM10KICAgIHZhciBzd2Vl
cCA9IGNvb3Jkc1s0XQogICAgdmFyIGV4ID0gY29vcmRzWzVdCiAgICB2YXIgZXkgPSBjb29yZHNb
Nl0KICAgIHZhciBzZWdzID0gdGhpcy5hcmNUb1NlZ21lbnRzKGV4LCBleSwgcngsIHJ5LCBsYXJn
ZSwgc3dlZXAsIHJvdCwgeCwgeSkKICAgIHZhciByZXR2YWwgPSBbXQogICAgZm9yICh2YXIgaT0w
OyBpPHNlZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgcmV0dmFsLnB1c2goWydiZXppZXJDdXJ2ZVRv
JywgdGhpcy5zZWdtZW50VG9CZXppZXIuYXBwbHkodGhpcywgc2Vnc1tpXSldKQogICAgfQogICAg
cmV0dXJuIHJldHZhbAogIH0sCgoKICAvLyBDb3BpZWQgZnJvbSBJbmtzY2FwZSBzdmd0b3BkZiwg
dGhhbmtzIQogIGFyY1RvU2VnbWVudHMgOiBmdW5jdGlvbih4LCB5LCByeCwgcnksIGxhcmdlLCBz
d2VlcCwgcm90YXRlWCwgb3gsIG95KSB7CiAgICB2YXIgdGggPSByb3RhdGVYICogKE1hdGguUEkv
MTgwKQogICAgdmFyIHNpbl90aCA9IE1hdGguc2luKHRoKQogICAgdmFyIGNvc190aCA9IE1hdGgu
Y29zKHRoKQogICAgcnggPSBNYXRoLmFicyhyeCkKICAgIHJ5ID0gTWF0aC5hYnMocnkpCiAgICB2
YXIgcHggPSBjb3NfdGggKiAob3ggLSB4KSAqIDAuNSArIHNpbl90aCAqIChveSAtIHkpICogMC41
CiAgICB2YXIgcHkgPSBjb3NfdGggKiAob3kgLSB5KSAqIDAuNSAtIHNpbl90aCAqIChveCAtIHgp
ICogMC41CiAgICB2YXIgcGwgPSAocHgqcHgpIC8gKHJ4KnJ4KSArIChweSpweSkgLyAocnkqcnkp
CiAgICBpZiAocGwgPiAxKSB7CiAgICAgIHBsID0gTWF0aC5zcXJ0KHBsKQogICAgICByeCAqPSBw
bAogICAgICByeSAqPSBwbAogICAgfQoKICAgIHZhciBhMDAgPSBjb3NfdGggLyByeAogICAgdmFy
IGEwMSA9IHNpbl90aCAvIHJ4CiAgICB2YXIgYTEwID0gKC1zaW5fdGgpIC8gcnkKICAgIHZhciBh
MTEgPSAoY29zX3RoKSAvIHJ5CiAgICB2YXIgeDAgPSBhMDAgKiBveCArIGEwMSAqIG95CiAgICB2
YXIgeTAgPSBhMTAgKiBveCArIGExMSAqIG95CiAgICB2YXIgeDEgPSBhMDAgKiB4ICsgYTAxICog
eQogICAgdmFyIHkxID0gYTEwICogeCArIGExMSAqIHkKCiAgICB2YXIgZCA9ICh4MS14MCkgKiAo
eDEteDApICsgKHkxLXkwKSAqICh5MS15MCkKICAgIHZhciBzZmFjdG9yX3NxID0gMSAvIGQgLSAw
LjI1CiAgICBpZiAoc2ZhY3Rvcl9zcSA8IDApIHNmYWN0b3Jfc3EgPSAwCiAgICB2YXIgc2ZhY3Rv
ciA9IE1hdGguc3FydChzZmFjdG9yX3NxKQogICAgaWYgKHN3ZWVwID09IGxhcmdlKSBzZmFjdG9y
ID0gLXNmYWN0b3IKICAgIHZhciB4YyA9IDAuNSAqICh4MCArIHgxKSAtIHNmYWN0b3IgKiAoeTEt
eTApCiAgICB2YXIgeWMgPSAwLjUgKiAoeTAgKyB5MSkgKyBzZmFjdG9yICogKHgxLXgwKQoKICAg
IHZhciB0aDAgPSBNYXRoLmF0YW4yKHkwLXljLCB4MC14YykKICAgIHZhciB0aDEgPSBNYXRoLmF0
YW4yKHkxLXljLCB4MS14YykKCiAgICB2YXIgdGhfYXJjID0gdGgxLXRoMAogICAgaWYgKHRoX2Fy
YyA8IDAgJiYgc3dlZXAgPT0gMSl7CiAgICAgIHRoX2FyYyArPSAyKk1hdGguUEkKICAgIH0gZWxz
ZSBpZiAodGhfYXJjID4gMCAmJiBzd2VlcCA9PSAwKSB7CiAgICAgIHRoX2FyYyAtPSAyICogTWF0
aC5QSQogICAgfQoKICAgIHZhciBzZWdtZW50cyA9IE1hdGguY2VpbChNYXRoLmFicyh0aF9hcmMg
LyAoTWF0aC5QSSAqIDAuNSArIDAuMDAxKSkpCiAgICB2YXIgcmVzdWx0ID0gW10KICAgIGZvciAo
dmFyIGk9MDsgaTxzZWdtZW50czsgaSsrKSB7CiAgICAgIHZhciB0aDIgPSB0aDAgKyBpICogdGhf
YXJjIC8gc2VnbWVudHMKICAgICAgdmFyIHRoMyA9IHRoMCArIChpKzEpICogdGhfYXJjIC8gc2Vn
bWVudHMKICAgICAgcmVzdWx0W2ldID0gW3hjLCB5YywgdGgyLCB0aDMsIHJ4LCByeSwgc2luX3Ro
LCBjb3NfdGhdCiAgICB9CgogICAgcmV0dXJuIHJlc3VsdAogIH0sCgogIHNlZ21lbnRUb0Jlemll
ciA6IGZ1bmN0aW9uKGN4LCBjeSwgdGgwLCB0aDEsIHJ4LCByeSwgc2luX3RoLCBjb3NfdGgpIHsK
ICAgIHZhciBhMDAgPSBjb3NfdGggKiByeAogICAgdmFyIGEwMSA9IC1zaW5fdGggKiByeQogICAg
dmFyIGExMCA9IHNpbl90aCAqIHJ4CiAgICB2YXIgYTExID0gY29zX3RoICogcnkKCiAgICB2YXIg
dGhfaGFsZiA9IDAuNSAqICh0aDEgLSB0aDApCiAgICB2YXIgdCA9ICg4LzMpICogTWF0aC5zaW4o
dGhfaGFsZiAqIDAuNSkgKiBNYXRoLnNpbih0aF9oYWxmICogMC41KSAvIE1hdGguc2luKHRoX2hh
bGYpCiAgICB2YXIgeDEgPSBjeCArIE1hdGguY29zKHRoMCkgLSB0ICogTWF0aC5zaW4odGgwKQog
ICAgdmFyIHkxID0gY3kgKyBNYXRoLnNpbih0aDApICsgdCAqIE1hdGguY29zKHRoMCkKICAgIHZh
ciB4MyA9IGN4ICsgTWF0aC5jb3ModGgxKQogICAgdmFyIHkzID0gY3kgKyBNYXRoLnNpbih0aDEp
CiAgICB2YXIgeDIgPSB4MyArIHQgKiBNYXRoLnNpbih0aDEpCiAgICB2YXIgeTIgPSB5MyAtIHQg
KiBNYXRoLmNvcyh0aDEpCiAgICByZXR1cm4gWwogICAgICBhMDAgKiB4MSArIGEwMSAqIHkxLCAg
ICAgIGExMCAqIHgxICsgYTExICogeTEsCiAgICAgIGEwMCAqIHgyICsgYTAxICogeTIsICAgICAg
YTEwICogeDIgKyBhMTEgKiB5MiwKICAgICAgYTAwICogeDMgKyBhMDEgKiB5MywgICAgICBhMTAg
KiB4MyArIGExMSAqIHkzCiAgICBdCiAgfSwKCiAgZ2V0TGVuZ3RoIDogZnVuY3Rpb24oKSB7CiAg
ICB2YXIgc2VncyA9IHRoaXMuZ2V0U2VnbWVudHMoKQogICAgaWYgKHNlZ3MuYXJjTGVuZ3RoID09
IG51bGwpIHsKICAgICAgc2Vncy5hcmNMZW5ndGggPSAwCiAgICAgIHZhciB4PTAsIHk9MAogICAg
ICBmb3IgKHZhciBpPTA7IGk8c2Vncy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBhcmdzID0g
c2Vnc1tpXVsxXQogICAgICAgIGlmIChhcmdzLmxlbmd0aCA8IDIpIGNvbnRpbnVlCiAgICAgICAg
c3dpdGNoKHNlZ3NbaV1bMF0pIHsKICAgICAgICAgIGNhc2UgJ2JlemllckN1cnZlVG8nOgogICAg
ICAgICAgICBzZWdzW2ldWzNdID0gQ3VydmVzLmN1YmljTGVuZ3RoKAogICAgICAgICAgICAgIFt4
LCB5XSwgW2FyZ3NbMF0sIGFyZ3NbMV1dLCBbYXJnc1syXSwgYXJnc1szXV0sIFthcmdzWzRdLCBh
cmdzWzVdXSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgJ3F1YWRyYXRpY0N1cnZl
VG8nOgogICAgICAgICAgICBzZWdzW2ldWzNdID0gQ3VydmVzLnF1YWRyYXRpY0xlbmd0aCgKICAg
ICAgICAgICAgICBbeCwgeV0sIFthcmdzWzBdLCBhcmdzWzFdXSwgW2FyZ3NbMl0sIGFyZ3NbM11d
KQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSAnbGluZVRvJzoKICAgICAgICAgICAg
c2Vnc1tpXVszXSA9IEN1cnZlcy5saW5lTGVuZ3RoKAogICAgICAgICAgICAgIFt4LCB5XSwgW2Fy
Z3NbMF0sIGFyZ3NbMV1dKQogICAgICAgICAgICBicmVhawogICAgICAgIH0KICAgICAgICBpZiAo
c2Vnc1tpXVszXSkKICAgICAgICAgIHNlZ3MuYXJjTGVuZ3RoICs9IHNlZ3NbaV1bM10KICAgICAg
ICB4ID0gYXJnc1thcmdzLmxlbmd0aC0yXQogICAgICAgIHkgPSBhcmdzW2FyZ3MubGVuZ3RoLTFd
CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzZWdzLmFyY0xlbmd0aAogIH0sCgogIHBvaW50QW5n
bGVBdCA6IGZ1bmN0aW9uKHQsIGNvbmZpZykgewogICAgdmFyIHNlZ21lbnRzID0gW10KICAgIHZh
ciBzZWdzID0gdGhpcy5nZXRTZWdtZW50cygpCiAgICB2YXIgbGVuZ3RoID0gdGhpcy5nZXRMZW5n
dGgoKQogICAgdmFyIHggPSAwLCB5ID0gMAogICAgZm9yICh2YXIgaT0wOyBpPHNlZ3MubGVuZ3Ro
OyBpKyspIHsKICAgICAgdmFyIHNlZyA9IHNlZ3NbaV0KICAgICAgaWYgKHNlZ1sxXS5sZW5ndGgg
PCAyKSBjb250aW51ZQogICAgICBpZiAoc2VnWzBdICE9ICdtb3ZlVG8nKSB7CiAgICAgICAgc2Vn
bWVudHMucHVzaChbeCwgeSwgc2VnXSkKICAgICAgfQogICAgICB4ID0gc2VnWzFdW3NlZ1sxXS5s
ZW5ndGgtMl0KICAgICAgeSA9IHNlZ1sxXVtzZWdbMV0ubGVuZ3RoLTFdCiAgICB9CiAgICBpZiAo
c2VnbWVudHMubGVuZ3RoIDwgMSkKICAgICAgcmV0dXJuIHtwb2ludDogW3gsIHldLCBhbmdsZTog
MCB9CiAgICBpZiAodCA+PSAxKSB7CiAgICAgIHZhciBydCA9IDEKICAgICAgdmFyIHNlZyA9IHNl
Z21lbnRzW3NlZ21lbnRzLmxlbmd0aC0xXQogICAgfSBlbHNlIGlmIChjb25maWcgJiYgY29uZmln
LmRpc2NyZXRlKSB7CiAgICAgIHZhciBpZHggPSBNYXRoLmZsb29yKHQgKiBzZWdtZW50cy5sZW5n
dGgpCiAgICAgIHZhciBzZWcgPSBzZWdtZW50c1tpZHhdCiAgICAgIHZhciBydCA9IDAKICAgIH0g
ZWxzZSBpZiAoY29uZmlnICYmIGNvbmZpZy5saW5lYXIpIHsKICAgICAgdmFyIGlkeCA9IHQgKiBz
ZWdtZW50cy5sZW5ndGgKICAgICAgdmFyIHJ0ID0gaWR4IC0gTWF0aC5mbG9vcihpZHgpCiAgICAg
IHZhciBzZWcgPSBzZWdtZW50c1tNYXRoLmZsb29yKGlkeCldCiAgICB9IGVsc2UgewogICAgICB2
YXIgbGVuID0gdCAqIGxlbmd0aAogICAgICB2YXIgcmxlbiA9IDAsIGlkeCwgcnQKICAgICAgZm9y
ICh2YXIgaT0wOyBpPHNlZ21lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHJsZW4gKyBz
ZWdtZW50c1tpXVsyXVszXSA+IGxlbikgewogICAgICAgICAgaWR4ID0gaQogICAgICAgICAgcnQg
PSAobGVuIC0gcmxlbikgLyBzZWdtZW50c1tpXVsyXVszXQogICAgICAgICAgYnJlYWsKICAgICAg
ICB9CiAgICAgICAgcmxlbiArPSBzZWdtZW50c1tpXVsyXVszXQogICAgICB9CiAgICAgIHZhciBz
ZWcgPSBzZWdtZW50c1tpZHhdCiAgICB9CiAgICB2YXIgYW5nbGUgPSAwCiAgICB2YXIgY21kID0g
c2VnWzJdWzBdCiAgICB2YXIgYXJncyA9IHNlZ1syXVsxXQogICAgc3dpdGNoIChjbWQpIHsKICAg
ICAgY2FzZSAnYmV6aWVyQ3VydmVUbyc6CiAgICAgICAgcmV0dXJuIEN1cnZlcy5jdWJpY0xlbmd0
aFBvaW50QW5nbGUoW3NlZ1swXSwgc2VnWzFdXSwgW2FyZ3NbMF0sIGFyZ3NbMV1dLCBbYXJnc1sy
XSwgYXJnc1szXV0sIFthcmdzWzRdLCBhcmdzWzVdXSwgcnQpCiAgICAgICAgYnJlYWsKICAgICAg
Y2FzZSAncXVhZHJhdGljQ3VydmVUbyc6CiAgICAgICAgcmV0dXJuIEN1cnZlcy5xdWFkcmF0aWNM
ZW5ndGhQb2ludEFuZ2xlKFtzZWdbMF0sIHNlZ1sxXV0sIFthcmdzWzBdLCBhcmdzWzFdXSwgW2Fy
Z3NbMl0sIGFyZ3NbM11dLCBydCkKICAgICAgICBicmVhawogICAgICBjYXNlICdsaW5lVG8nOgog
ICAgICAgIHggPSBDdXJ2ZXMubGluZWFyVmFsdWUoc2VnWzBdLCBhcmdzWzBdLCBydCkKICAgICAg
ICB5ID0gQ3VydmVzLmxpbmVhclZhbHVlKHNlZ1sxXSwgYXJnc1sxXSwgcnQpCiAgICAgICAgYW5n
bGUgPSBDdXJ2ZXMubGluZUFuZ2xlKFtzZWdbMF0sIHNlZ1sxXV0sIFthcmdzWzBdLCBhcmdzWzFd
XSwgcnQpCiAgICAgICAgYnJlYWsKICAgIH0KICAgIHJldHVybiB7cG9pbnQ6IFt4LCB5XSwgYW5n
bGU6IGFuZ2xlIH0KICB9Cgp9KQoKCi8qKgogIEltYWdlTm9kZSBpcyB1c2VkIGZvciBkcmF3aW5n
IGltYWdlcy4gQ3JlYXRlcyBhIHJlY3Rhbmd1bGFyIHBhdGggYXJvdW5kCiAgdGhlIGRyYXduIGlt
YWdlLgoKICBBdHRyaWJ1dGVzOgoKICAgIGNlbnRlcmVkIC0gSWYgdHJ1ZSwgaW1hZ2UgY2VudGVy
IGlzIGF0IHRoZSBvcmlnaW4uCiAgICAgICAgICAgICAgIE90aGVyd2lzZSBpbWFnZSB0b3AtbGVm
dCBpcyBhdCB0aGUgb3JpZ2luLgogICAgdXNlUGF0dGVybiAtIFVzZSBhIHBhdHRlcm4gZmlsbCBm
b3IgZHJhd2luZyB0aGUgaW1hZ2UgKGluc3RlYWQgb2YKICAgICAgICAgICAgICAgICBkcmF3SW1h
Z2UuKSBEb2Vzbid0IGRvIHN1Yi1pbWFnZSBkcmF3aW5nLCBhbmQgU2FmYXJpIGRvZXNuJ3QKICAg
ICAgICAgICAgICAgICBsaWtlIHNjYWxlZCBpbWFnZSBwYXR0ZXJucy4KICAgIHNYLCBzWSwgc1dp
ZHRoLCBzSGVpZ2h0IC0gQXJlYSBvZiBpbWFnZSB0byBkcmF3LiBPcHRpb25hbC4KICAgIGRYLCBk
WSAtIENvb3JkaW5hdGVzIHdoZXJlIHRvIGRyYXcgdGhlIGltYWdlLiBEZWZhdWx0IGlzIDAsIDAu
CiAgICBkV2lkdGgsIGRIZWlnaHQgLSBTaXplIG9mIHRoZSBkcmF3biBpbWFnZS4gT3B0aW9uYWwu
CgogIEV4YW1wbGU6CgogICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpCiAgICBpbWcuc3JjID0gJ2Zv
by5qcGcnCiAgICB2YXIgaW1hZ2VHZW8gPSBuZXcgSW1hZ2VOb2RlKGltZykKCiAgQHBhcmFtIGlt
YWdlIEltYWdlIHRvIGRyYXcuCiAgQHBhcmFtIGNvbmZpZyBPcHRpb25hbCBjb25maWcgaGFzaC4K
ICAqLwpJbWFnZU5vZGUgPSBLbGFzcyhEcmF3YWJsZSwgewogIGNlbnRlcmVkIDogZmFsc2UsCiAg
dXNlUGF0dGVybiA6IGZhbHNlLAoKICBzWCA6IDAsCiAgc1kgOiAwLAogIHNXaWR0aCA6IG51bGws
CiAgc0hlaWdodCA6IG51bGwsCgogIGRYIDogMCwKICBkWSA6IDAsCiAgZFdpZHRoIDogbnVsbCwK
ICBkSGVpZ2h0IDogbnVsbCwKCiAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKGltYWdlLCBjb25maWcp
IHsKICAgIHRoaXMuaW1hZ2UgPSBpbWFnZQogICAgRHJhd2FibGUuaW5pdGlhbGl6ZS5jYWxsKHRo
aXMsIGNvbmZpZykKICB9LAoKICAvKioKICAgIERyYXdzIHRoZSBpbWFnZSBvbiB0aGUgZ2l2ZW4g
ZHJhd2luZyBjb250ZXh0LgoKICAgIENyZWF0ZXMgYSByZWN0YW5ndWxhciBwYXRoIGFyb3VuZCB0
aGUgZHJhd24gaW1hZ2UgKGZvciBwb3NzaWJsZSBzdHJva2UKICAgIGFuZC9vciBmaWxsLikKCiAg
ICBAcGFyYW0gY3R4IENhbnZhcyBkcmF3aW5nIGNvbnRleHQuCiAgICAqLwogIGRyYXdHZW9tZXRy
eSA6IGZ1bmN0aW9uKGN0eCkgewogICAgaWYgKE9iamVjdC5pc0ltYWdlTG9hZGVkKHRoaXMuaW1h
Z2UpKSB7CiAgICAgIHZhciB3ID0gdGhpcy5kV2lkdGggPT0gbnVsbCA/IHRoaXMuaW1hZ2Uud2lk
dGggOiB0aGlzLmRXaWR0aAogICAgICB2YXIgaCA9IHRoaXMuZEhlaWdodCA9PSBudWxsID8gdGhp
cy5pbWFnZS5oZWlnaHQgOiB0aGlzLmRIZWlnaHQKICAgICAgdmFyIHggPSB0aGlzLmRYICsgKHRo
aXMuY2VudGVyZWQgPyAtdyAqIDAuNSA6IDApCiAgICAgIHZhciB5ID0gdGhpcy5kWSArICh0aGlz
LmNlbnRlcmVkID8gLWggKiAwLjUgOiAwKQogICAgICBpZiAodGhpcy5kV2lkdGggIT0gbnVsbCkg
ewogICAgICAgIGlmICh0aGlzLnNXaWR0aCAhPSBudWxsKSB7CiAgICAgICAgICBjdHguZHJhd0lt
YWdlKHRoaXMuaW1hZ2UsCiAgICAgICAgICAgIHRoaXMuc1gsIHRoaXMuc1ksIHRoaXMuc1dpZHRo
LCB0aGlzLnNIZWlnaHQsCiAgICAgICAgICAgIHgsIHksIHcsIGgpCiAgICAgICAgfSBlbHNlIHsK
ICAgICAgICAgIGN0eC5kcmF3SW1hZ2UodGhpcy5pbWFnZSwgeCwgeSwgdywgaCkKICAgICAgICB9
CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdyA9IHRoaXMuaW1hZ2Uud2lkdGgKICAgICAgICBoID0g
dGhpcy5pbWFnZS5oZWlnaHQKICAgICAgICBpZiAodGhpcy51c2VQYXR0ZXJuKSB7CiAgICAgICAg
ICBpZiAoIXRoaXMuaW1hZ2VQYXR0ZXJuKQogICAgICAgICAgICB0aGlzLmltYWdlUGF0dGVybiA9
IG5ldyBQYXR0ZXJuKHRoaXMuaW1hZ2UsICdyZXBlYXQnKQogICAgICAgICAgdmFyIGZzID0gdGhp
cy5pbWFnZVBhdHRlcm4uY29tcGlsZWQKICAgICAgICAgIGlmICghZnMpCiAgICAgICAgICAgIGZz
ID0gdGhpcy5pbWFnZVBhdHRlcm4uY29tcGlsZShjdHgpCiAgICAgICAgICBjdHguc2F2ZSgpCiAg
ICAgICAgICBjdHguYmVnaW5QYXRoKCkKICAgICAgICAgIGN0eC5yZWN0KHgsIHksIHcsIGgpCiAg
ICAgICAgICBjdHguc2V0RmlsbFN0eWxlKGZzKQogICAgICAgICAgY3R4LmZpbGwoKQogICAgICAg
ICAgY3R4LnJlc3RvcmUoKQogICAgICAgICAgY3R4LmJlZ2luUGF0aCgpCiAgICAgICAgfSBlbHNl
IHsKICAgICAgICAgIGN0eC5kcmF3SW1hZ2UodGhpcy5pbWFnZSwgeCwgeSkKICAgICAgICB9CiAg
ICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHZhciB3ID0gdGhpcy5kV2lkdGgKICAgICAgdmFyIGgg
PSB0aGlzLmRIZWlnaHQKICAgICAgaWYgKCEoIHcgJiYgaCApKSByZXR1cm4KICAgICAgdmFyIHgg
PSB0aGlzLmRYICsgKHRoaXMuY2VudGVyZWQgPyAtdyAqIDAuNSA6IDApCiAgICAgIHZhciB5ID0g
dGhpcy5kWSArICh0aGlzLmNlbnRlcmVkID8gLWggKiAwLjUgOiAwKQogICAgfQogICAgY3R4LnJl
Y3QoeCwgeSwgdywgaCkKICB9LAoKICAvKioKICAgIENyZWF0ZXMgYSBib3VuZGluZyByZWN0YW5n
bGUgcGF0aCBmb3IgdGhlIGltYWdlIG9uIHRoZSBnaXZlbiBkcmF3aW5nCiAgICBjb250ZXh0LgoK
ICAgIEBwYXJhbSBjdHggQ2FudmFzIGRyYXdpbmcgY29udGV4dC4KICAgICovCiAgZHJhd1BpY2tp
bmdQYXRoIDogZnVuY3Rpb24oY3R4KSB7CiAgICB2YXIgeCA9IHRoaXMuZFggKyAodGhpcy5jZW50
ZXJlZCA/IC10aGlzLmltYWdlLndpZHRoICogMC41IDogMCkKICAgIHZhciB5ID0gdGhpcy5kWSAr
ICh0aGlzLmNlbnRlcmVkID8gLXRoaXMuaW1hZ2UuaGVpZ2h0ICogMC41IDogMCkKICAgIHZhciB3
ID0gdGhpcy5kV2lkdGgKICAgIHZhciBoID0gdGhpcy5kSGVpZ2h0CiAgICBpZiAodGhpcy5kV2lk
dGggPT0gbnVsbCkgewogICAgICB3ID0gdGhpcy5pbWFnZS53aWR0aAogICAgICBoID0gdGhpcy5p
bWFnZS5oZWlnaHQKICAgIH0KICAgIGN0eC5yZWN0KHgsIHksIHcsIGgpCiAgfSwKCiAgLyoqCiAg
ICBSZXR1cm5zIHRydWUgaWYgdGhlIHBvaW50IHgseSBpcyBpbnNpZGUgdGhlIGltYWdlIHJlY3Rh
bmdsZS4KCiAgICBUaGUgeCx5IHBvaW50IGlzIGluIHVzZXItc3BhY2UgY29vcmRpbmF0ZXMsIG1l
YW5pbmcgdGhhdCBlLmcuIHRoZSBwb2ludAogICAgNSw1IHdpbGwgYWx3YXlzIGJlIGluc2lkZSB0
aGUgcmVjdGFuZ2xlIFswLCAwLCAxMCwgMTBdLCByZWdhcmRsZXNzIG9mIHRoZQogICAgdHJhbnNm
b3JtIG9uIHRoZSByZWN0YW5nbGUuCgogICAgQHBhcmFtIHggWC1jb29yZGluYXRlIG9mIHRoZSBw
b2ludC4KICAgIEBwYXJhbSB5IFktY29vcmRpbmF0ZSBvZiB0aGUgcG9pbnQuCiAgICBAcmV0dXJu
IFdoZXRoZXIgdGhlIHBvaW50IGlzIGluc2lkZSB0aGUgaW1hZ2UgcmVjdGFuZ2xlLgogICAgQHR5
cGUgYm9vbGVhbgogICAgKi8KICBpc1BvaW50SW5QYXRoIDogZnVuY3Rpb24oeCx5KSB7CiAgICB4
IC09IHRoaXMuZFgKICAgIHkgLT0gdGhpcy5kWQogICAgaWYgKHRoaXMuY2VudGVyZWQpIHsKICAg
ICAgeCArPSB0aGlzLmltYWdlLndpZHRoICogMC41CiAgICAgIHkgKz0gdGhpcy5pbWFnZS5oZWln
aHQgKiAwLjUKICAgIH0KICAgIHZhciB3ID0gdGhpcy5kV2lkdGgKICAgIHZhciBoID0gdGhpcy5k
SGVpZ2h0CiAgICBpZiAodGhpcy5kV2lkdGggPT0gbnVsbCkgewogICAgICB3ID0gdGhpcy5pbWFn
ZS53aWR0aAogICAgICBoID0gdGhpcy5pbWFnZS5oZWlnaHQKICAgIH0KICAgIHJldHVybiAoKHgg
Pj0gMCkgJiYgKHggPD0gdykgJiYgKHkgPj0gMCkgJiYgKHkgPD0gaCkpCiAgfSwKCiAgZ2V0Qm91
bmRpbmdCb3ggOiBmdW5jdGlvbigpIHsKICAgIHggPSB0aGlzLmRYCiAgICB5ID0gdGhpcy5kWQog
ICAgaWYgKHRoaXMuY2VudGVyZWQpIHsKICAgICAgeCAtPSB0aGlzLmltYWdlLndpZHRoICogMC41
CiAgICAgIHkgLT0gdGhpcy5pbWFnZS5oZWlnaHQgKiAwLjUKICAgIH0KICAgIHZhciB3ID0gdGhp
cy5kV2lkdGgKICAgIHZhciBoID0gdGhpcy5kSGVpZ2h0CiAgICBpZiAodGhpcy5kV2lkdGggPT0g
bnVsbCkgewogICAgICB3ID0gdGhpcy5pbWFnZS53aWR0aAogICAgICBoID0gdGhpcy5pbWFnZS5o
ZWlnaHQKICAgIH0KICAgIHJldHVybiBbeCwgeSwgdywgaF0KICB9Cn0pCgpJbWFnZU5vZGUubG9h
ZCA9IGZ1bmN0aW9uKHNyYykgewogIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTsKICBpbWcuc3JjID0g
c3JjOwogIHZhciBpbWduID0gbmV3IEltYWdlTm9kZShpbWcpOwogIHJldHVybiBpbWduOwp9CgoK
LyoqCiAgVGV4dE5vZGUgaXMgdXNlZCBmb3IgZHJhd2luZyB0ZXh0IG9uIGEgY2FudmFzLgoKICBB
dHRyaWJ1dGVzOgoKICAgIHRleHQgLSBUaGUgdGV4dCBzdHJpbmcgdG8gZHJhdy4KICAgIGFsaWdu
IC0gSG9yaXpvbnRhbCBhbGlnbm1lbnQgZm9yIHRoZSB0ZXh0LgogICAgICAgICAgICAnbGVmdCcs
ICdyaWdodCcsICdjZW50ZXInLCAnc3RhcnQnIG9yICdlbmQnCiAgICBiYXNlbGluZSAtIEJhc2Vs
aW5lIHVzZWQgZm9yIHRoZSB0ZXh0LgogICAgICAgICAgICAgICAndG9wJywgJ2hhbmdpbmcnLCAn
bWlkZGxlJywgJ2FscGhhYmV0aWMnLCAnaWRlb2dyYXBoaWMnIG9yICdib3R0b20nCiAgICBhc1Bh
dGggLSBJZiB0cnVlLCBjcmVhdGVzIGEgdGV4dCBwYXRoIGluc3RlYWQgb2YgZHJhd2luZyB0aGUg
dGV4dC4KICAgIHBhdGhHZW9tZXRyeSAtIEEgZ2VvbWV0cnkgb2JqZWN0IHRoZSBwYXRoIG9mIHdo
aWNoIHRoZSB0ZXh0IGZvbGxvd3MuCgogIEV4YW1wbGU6CgogICAgdmFyIHRleHQgPSBuZXcgVGV4
dEdlb21ldHJ5KCdUaGUgY2FrZSBpcyBhIGxpZS4nKQoKICBAcGFyYW0gdGV4dCBUaGUgdGV4dCBz
dHJpbmcgdG8gZHJhdy4KICBAcGFyYW0gY29uZmlnIE9wdGlvbmFsIGNvbmZpZyBoYXNoLgogICov
ClRleHROb2RlID0gS2xhc3MoRHJhd2FibGUsIHsKICB0ZXh0IDogJ1RleHQnLAogIGFsaWduIDog
J3N0YXJ0JywgLy8gJ2xlZnQnIHwgJ3JpZ2h0JyB8ICdjZW50ZXInIHwgJ3N0YXJ0JyB8ICdlbmQn
CiAgYmFzZWxpbmUgOiAnYWxwaGFiZXRpYycsIC8vICd0b3AnIHwgJ2hhbmdpbmcnIHwgJ21pZGRs
ZScgfCAnYWxwaGFiZXRpYycgfAogICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAnaWRlb2dy
YXBoaWMnIHwgJ2JvdHRvbScKICBhY2N1cmF0ZVBpY2tpbmcgOiBmYWxzZSwKICBhc1BhdGggOiBm
YWxzZSwKICBwYXRoR2VvbWV0cnkgOiBudWxsLAogIG1heFdpZHRoIDogbnVsbCwKICB3aWR0aCA6
IDAsCiAgaGVpZ2h0IDogMjAsCiAgY3ggOiAwLAogIGN5IDogMCwKCiAgX19kcmF3TWV0aG9kTmFt
ZSA6ICdkcmF3JyArIENhbnZhc1N1cHBvcnQuZ2V0VGV4dEJhY2tlbmQoKSwKICBfX3BpY2tpbmdN
ZXRob2ROYW1lIDogJ2RyYXdQaWNraW5nUGF0aCcgKyBDYW52YXNTdXBwb3J0LmdldFRleHRCYWNr
ZW5kKCksCgogIGluaXRpYWxpemUgOiBmdW5jdGlvbih0ZXh0LCBjb25maWcpIHsKICAgIHRoaXMu
bGFzdFRleHQgPSB0aGlzLnRleHQKICAgIHRoaXMudGV4dCA9IHRleHQKICAgIERyYXdhYmxlLmlu
aXRpYWxpemUuY2FsbCh0aGlzLCBjb25maWcpCiAgfSwKCiAgZHJhd0dlb21ldHJ5IDogZnVuY3Rp
b24oY3R4KSB7CiAgICB0aGlzLmRyYXdVc2luZyhjdHgsIHRoaXMuX19kcmF3TWV0aG9kTmFtZSkK
ICB9LAoKICBkcmF3UGlja2luZ1BhdGggOiBmdW5jdGlvbihjdHgpIHsKICAgIHRoaXMuZHJhd1Vz
aW5nKGN0eCwgdGhpcy5fX3BpY2tpbmdNZXRob2ROYW1lKQogIH0sCgogIGRyYXdVc2luZyA6IGZ1
bmN0aW9uKGN0eCwgbWV0aG9kTmFtZSkgewogICAgaWYgKCF0aGlzLnRleHQgfHwgdGhpcy50ZXh0
Lmxlbmd0aCA9PSAwKQogICAgICByZXR1cm4KICAgIGlmICh0aGlzLmxhc3RUZXh0ICE9IHRoaXMu
dGV4dCB8fCB0aGlzLmxhc3RTdHlsZSAhPSBjdHguZm9udCkgewogICAgICB0aGlzLmRpbWVuc2lv
bnMgPSB0aGlzLm1lYXN1cmVUZXh0KGN0eCkKICAgICAgdGhpcy5sYXN0VGV4dCA9IHRoaXMudGV4
dAogICAgICB0aGlzLmxhc3RTdHlsZSA9IGN0eC5mb250CiAgICB9CiAgICBpZiAodGhpc1ttZXRo
b2ROYW1lXSkKICAgICAgdGhpc1ttZXRob2ROYW1lXShjdHgpCiAgfSwKCiAgbWVhc3VyZVRleHQg
OiBmdW5jdGlvbihjdHgpIHsKICAgIHZhciBtbiA9ICdtZWFzdXJlVGV4dCcgKyBDYW52YXNTdXBw
b3J0LmdldFRleHRCYWNrZW5kKCkuY2FwaXRhbGl6ZSgpCiAgICBpZiAodGhpc1ttbl0pIHsKICAg
ICAgcmV0dXJuIHRoaXNbbW5dKGN0eCkKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB7d2lkdGg6
IDAsIGhlaWdodDogMH0KICAgIH0KICB9LAoKICBjb21wdXRlWEZvckFsaWduIDogZnVuY3Rpb24o
KSB7CiAgICBpZiAodGhpcy5hbGlnbiA9PSAnbGVmdCcpIC8vIG1vc3QgaGl0IGJyYW5jaAogICAg
ICByZXR1cm4gMAogICAgZWxzZSBpZiAodGhpcy5hbGlnbiA9PSAncmlnaHQnKQogICAgICByZXR1
cm4gLXRoaXMuZGltZW5zaW9ucy53aWR0aAogICAgZWxzZSBpZiAodGhpcy5hbGlnbiA9PSAnY2Vu
dGVyJykKICAgICAgcmV0dXJuICAtdGhpcy5kaW1lbnNpb25zLndpZHRoICogMC41CiAgfSwKCiAg
bWVhc3VyZVRleHRIVE1MNSA6IGZ1bmN0aW9uKGN0eCkgewogICAgLy8gRklYTUUgbWVhc3VyZVRl
eHQgaXMgcmV0YXJkZWQKICAgIHJldHVybiB7d2lkdGg6IGN0eC5tZWFzdXJlVGV4dCh0aGlzLnRl
eHQpLndpZHRoLCBoZWlnaHQ6IDIwfQogIH0sCgogIGRyYXdIVE1MNSA6IGZ1bmN0aW9uKGN0eCkg
ewogICAgY3R4LmZpbGxUZXh0KHRoaXMudGV4dCwgdGhpcy5jeCwgdGhpcy5jeSwgdGhpcy5tYXhX
aWR0aCkKICB9LAoKICBkcmF3UGlja2luZ1BhdGhIVE1MNSA6IGZ1bmN0aW9uKGN0eCkgewogICAg
dmFyIGFzY2VuZGVyID0gMTUgLy8gdGhpcy5kaW1lbnNpb25zLmFzY2VuZGVyCiAgICB2YXIgcnkg
PSB0aGlzLmN5IC0gYXNjZW5kZXIKICAgIGN0eC5yZWN0KHRoaXMuY3gsIHJ5LCB0aGlzLmRpbWVu
c2lvbnMud2lkdGgsIHRoaXMuZGltZW5zaW9ucy5oZWlnaHQpCiAgfSwKCiAgbWVhc3VyZVRleHRN
b3pUZXh0IDogZnVuY3Rpb24oY3R4KSB7CiAgICByZXR1cm4ge3dpZHRoOiBjdHgubW96TWVhc3Vy
ZVRleHQodGhpcy50ZXh0KSwgaGVpZ2h0OiAyMH0KICB9LAoKICBkcmF3TW96VGV4dCA6IGZ1bmN0
aW9uKGN0eCkgewogICAgdmFyIHggPSB0aGlzLmN4ICsgdGhpcy5jb21wdXRlWEZvckFsaWduKCkK
ICAgIHZhciB5ID0gdGhpcy5jeSArIDAKICAgIGlmICh0aGlzLnBhdGhHZW9tZXRyeSkgewogICAg
ICB0aGlzLnBhdGhHZW9tZXRyeS5kcmF3KGN0eCkKICAgICAgY3R4Lm1vekRyYXdUZXh0QWxvbmdQ
YXRoKHRoaXMudGV4dCwgdGhpcy5wYXRoKQogICAgfSBlbHNlIHsKICAgICAgY3R4LnNhdmUoKQog
ICAgICBjdHgudHJhbnNsYXRlKHgseSkKICAgICAgaWYgKHRoaXMuYXNQYXRoKSB7CiAgICAgICAg
Y3R4Lm1velBhdGhUZXh0KHRoaXMudGV4dCkKICAgICAgfSBlbHNlIHsKICAgICAgICBjdHgubW96
RHJhd1RleHQodGhpcy50ZXh0KQogICAgICB9CiAgICAgIGN0eC5yZXN0b3JlKCkKICAgIH0KICB9
LAoKICBkcmF3UGlja2luZ1BhdGhNb3pUZXh0IDogZnVuY3Rpb24oY3R4KSB7CiAgICB2YXIgeCA9
IHRoaXMuY3ggKyB0aGlzLmNvbXB1dGVYRm9yQWxpZ24oKQogICAgdmFyIHkgPSB0aGlzLmN5ICsg
MAogICAgaWYgKHRoaXMucGF0aEdlb21ldHJ5KSB7IC8vIEZJWE1FIGhvdyB0byBkcmF3IGEgdGV4
dCBwYXRoIGFsb25nIHBhdGg/CiAgICAgICAgdGhpcy5wYXRoR2VvbWV0cnkuZHJhdyhjdHgpCiAg
ICAgICAgLy8gY3R4Lm1vekRyYXdUZXh0QWxvbmdQYXRoKHRoaXMudGV4dCwgdGhpcy5wYXRoKQog
ICAgfSBlbHNlIGlmICghdGhpcy5hY2N1cmF0ZVBpY2tpbmcpIHsKICAgICAgdmFyIGFzY2VuZGVy
ID0gMTUgLy8gdGhpcy5kaW1lbnNpb25zLmFzY2VuZGVyCiAgICAgIHZhciByeSA9IHkgLSBhc2Nl
bmRlcgogICAgICBjdHgucmVjdCh4LCByeSwgdGhpcy5kaW1lbnNpb25zLndpZHRoLCB0aGlzLmRp
bWVuc2lvbnMuaGVpZ2h0KQogICAgfSBlbHNlIHsKICAgICAgY3R4LnNhdmUoKQogICAgICBjdHgu
dHJhbnNsYXRlKHgseSkKICAgICAgY3R4Lm1velBhdGhUZXh0KHRoaXMudGV4dCkKICAgICAgY3R4
LnJlc3RvcmUoKQogICAgfQogIH0sCgogIGRyYXdEcmF3U3RyaW5nIDogZnVuY3Rpb24oY3R4KSB7
CiAgICB2YXIgeCA9IHRoaXMuY3ggKyB0aGlzLmNvbXB1dGVYRm9yQWxpZ24oKQogICAgdmFyIHkg
PSB0aGlzLmN5ICsgMAogICAgY3R4LmRyYXdTdHJpbmcoeCx5LCB0aGlzLnRleHQpCiAgfSwKCiAg
bWVhc3VyZVRleHRQZXJmZWN0V29ybGQgOiBmdW5jdGlvbihjdHgpIHsKICAgIHJldHVybiBjdHgu
bWVhc3VyZVRleHQodGhpcy50ZXh0KQogIH0sCgogIGRyYXdQZXJmZWN0V29ybGQgOiBmdW5jdGlv
bihjdHgpIHsKICAgIGlmICh0aGlzLnBhdGhHZW9tZXRyeSkgewogICAgICB0aGlzLnBhdGhHZW9t
ZXRyeS5kcmF3KGN0eCkKICAgICAgaWYgKHRoaXMuYXNQYXRoKQogICAgICAgIGN0eC5wYXRoVGV4
dEFsb25nUGF0aCh0aGlzLnRleHQpCiAgICAgIGVsc2UKICAgICAgICBjdHguZHJhd1RleHRBbG9u
Z1BhdGgodGhpcy50ZXh0KQogICAgfSBlbHNlIGlmICh0aGlzLmFzUGF0aCkgewogICAgICBjdHgu
cGF0aFRleHQodGhpcy50ZXh0KQogICAgfSBlbHNlIHsKICAgICAgY3R4LmRyYXdUZXh0KHRoaXMu
dGV4dCkKICAgIH0KICB9LAoKICBkcmF3UGlja2luZ1BhdGhQZXJmZWN0V29ybGQgOiBmdW5jdGlv
bihjdHgpIHsKICAgIGlmICh0aGlzLmFjY3VyYXRlUGlja2luZykgewogICAgICBpZiAodGhpcy5w
YXRoR2VvbWV0cnkpIHsKICAgICAgICBjdHgucGF0aFRleHRBbG9uZ1BhdGgodGhpcy50ZXh0KQog
ICAgICB9IGVsc2UgewogICAgICAgIGN0eC5wYXRoVGV4dCh0aGlzLnRleHQpCiAgICAgIH0KICAg
IH0gZWxzZSB7IC8vIGNyZWF0ZXMgYSBwYXRoIG9mIHRleHQgYm91bmRpbmcgYm94CiAgICAgIGlm
ICh0aGlzLnBhdGhHZW9tZXRyeSkgewogICAgICAgIGN0eC50ZXh0UmVjdEFsb25nUGF0aCh0aGlz
LnRleHQpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgY3R4LnRleHRSZWN0KHRoaXMudGV4dCkKICAg
ICAgfQogICAgfQogIH0KfSkKCgovKioKICBHcmFkaWVudCBpcyBhIGxpbmVhciBvciByYWRpYWwg
Y29sb3IgZ3JhZGllbnQgdGhhdCBjYW4gYmUgdXNlZCBhcyBhCiAgc3Ryb2tlU3R5bGUgb3IgZmls
bFN0eWxlLgoKICBBdHRyaWJ1dGVzOgoKICAgIHR5cGUgLSBUeXBlIG9mIHRoZSBncmFkaWVudC4g
J2xpbmVhcicgb3IgJ3JhZGlhbCcKICAgIHN0YXJ0WCwgc3RhcnRZIC0gQ29vcmRpbmF0ZXMgZm9y
IHRoZSBzdGFydGluZyBwb2ludCBvZiB0aGUgZ3JhZGllbnQuCiAgICAgICAgICAgICAgICAgICAg
IENlbnRlciBvZiB0aGUgc3RhcnRpbmcgY2lyY2xlIG9mIGEgcmFkaWFsIGdyYWRpZW50LgogICAg
ICAgICAgICAgICAgICAgICBEZWZhdWx0IGlzIDAsIDAuCiAgICBlbmRYLCBlbmRZIC0gQ29vcmRp
bmF0ZXMgZm9yIHRoZSBlbmRpbmcgcG9pbnQgb2YgdGhlIGdyYWRpZW50LgogICAgICAgICAgICAg
ICAgIENlbnRlciBvZiB0aGUgZW5kaW5nIGNpcmNsZSBvZiBhIHJhZGlhbCBncmFkaWVudC4KICAg
ICAgICAgICAgICAgICBEZWZhdWx0IGlzIDAsIDAuCiAgICBzdGFydFJhZGl1cyAtIFRoZSByYWRp
dXMgb2YgdGhlIHN0YXJ0aW5nIGNpcmNsZSBvZiBhIHJhZGlhbCBncmFkaWVudC4KICAgICAgICAg
ICAgICAgICAgRGVmYXVsdCBpcyAwLgogICAgZW5kUmFkaXVzIC0gVGhlIHJhZGl1cyBvZiB0aGUg
ZW5kaW5nIGNpcmNsZSBvZiBhIHJhZGlhbCBncmFkaWVudC4KICAgICAgICAgICAgICAgIERlZmF1
bHQgaXMgMTAwLgogICAgY29sb3JTdG9wcyAtIFRoZSBjb2xvciBzdG9wcyBmb3IgdGhlIGdyYWRp
ZW50LiBUaGUgZm9ybWF0IGZvciB0aGUgY29sb3IKICAgICAgICAgICAgICAgICBzdG9wcyBpczog
W1twb3NpdGlvbl8xLCBjb2xvcl8xXSwgW3Bvc2l0aW9uXzIsIGNvbG9yXzJdLCAuLi5dLgogICAg
ICAgICAgICAgICAgIFRoZSBwb3NzaWJsZSBjb2xvciBmb3JtYXRzIGFyZTogJ3JlZCcsICcjMDAw
JywgJyMwMDAwMDAnLAogICAgICAgICAgICAgICAgICdyZ2JhKDAsMCwwLCAwLjIpJywgWzAsMCww
XSBhbmQgWzAsMCwwLCAwLjJdLgogICAgICAgICAgICAgICAgIERlZmF1bHQgY29sb3Igc3RvcHMg
YXJlIFtbMCwgJyMwMDAwMDAnXSwgWzEsICcjRkZGRkZGJ11dLgoKICBFeGFtcGxlOgoKICAgIHZh
ciBnID0gbmV3IEdyYWRpZW50KHsKICAgICAgdHlwZSA6ICdyYWRpYWwnLAogICAgICBlbmRSYWRp
dXMgOiA0MCwKICAgICAgY29sb3JTdG9wcyA6IFsKICAgICAgICBbMCwgJyMwMDAnXSwKICAgICAg
ICBbMC4yLCAnI2ZmZmZmZiddLAogICAgICAgIFswLjUsIFsyNTUsIDAsIDBdXSwKICAgICAgICBb
MC44LCBbMCwgMjU1LCAyNTUsIDAuNV1dLAogICAgICAgIFsxLjAsICdyZ2JhKDI1NSwgMCwgMjU1
LCAwLjgpJ10KICAgICAgXQogICAgfSkKCiAgQHBhcmFtIGNvbmZpZyBPcHRpb25hbCBjb25maWcg
aGFzaC4KICAqLwpHcmFkaWVudCA9IEtsYXNzKHsKICB0eXBlIDogJ2xpbmVhcicsCiAgaXNQYXR0
ZXJuIDogdHJ1ZSwKICBzdGFydFggOiAwLAogIHN0YXJ0WSA6IDAsCiAgZW5kWCA6IDEsCiAgZW5k
WSA6IDAsCiAgc3RhcnRSYWRpdXMgOiAwLAogIGVuZFJhZGl1cyA6IDEsCiAgY29sb3JTdG9wcyA6
IFtdLAoKICBpbml0aWFsaXplIDogZnVuY3Rpb24oY29uZmlnKSB7CiAgICB0aGlzLmNvbG9yU3Rv
cHMgPSBbWzAsICcjMDAwMDAwJ10sIFsxLCAnI0ZGRkZGRiddXQogICAgaWYgKGNvbmZpZykgT2Jq
ZWN0LmV4dGVuZCh0aGlzLCBjb25maWcpCiAgfSwKCiAgLyoqCiAgICBDb21waWxlcyB0aGUgZ3Jh
ZGllbnQgdXNpbmcgdGhlIGdpdmVuIGRyYXdpbmcgY29udGV4dC4KICAgIFJldHVybnMgYSBncmFk
aWVudCBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCBhcyBkcmF3aW5nIGNvbnRleHQKICAgIGZpbGwv
c3Ryb2tlU3R5bGUuCgogICAgQHBhcmFtIGN0eCBEcmF3aW5nIGNvbnRleHQgdG8gY29tcGlsZSBw
YXR0ZXJuIG9uLgogICAgQHJldHVybiBHcmFkaWVudCBvYmplY3QuCiAgICAqLwogIGNvbXBpbGUg
OiBmdW5jdGlvbihjdHgpIHsKICAgIGlmICh0aGlzLnR5cGUgPT0gJ2xpbmVhcicpIHsKICAgICAg
dmFyIGdvID0gY3R4LmNyZWF0ZUxpbmVhckdyYWRpZW50KAogICAgICAgICAgICAgICAgICAgIHRo
aXMuc3RhcnRYLCB0aGlzLnN0YXJ0WSwKICAgICAgICAgICAgICAgICAgICB0aGlzLmVuZFgsIHRo
aXMuZW5kWSkKICAgIH0gZWxzZSB7CiAgICAgIHZhciBnbyA9IGN0eC5jcmVhdGVSYWRpYWxHcmFk
aWVudCgKICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0WCwgdGhpcy5zdGFydFksIHRoaXMu
c3RhcnRSYWRpdXMsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbmRYLCB0aGlzLmVuZFksIHRo
aXMuZW5kUmFkaXVzKQogICAgfQogICAgZm9yKHZhciBpPTA7IGk8dGhpcy5jb2xvclN0b3BzLmxl
bmd0aDsgaSsrKSB7CiAgICAgIHZhciBjcyA9IHRoaXMuY29sb3JTdG9wc1tpXQogICAgICBpZiAo
dHlwZW9mKGNzWzFdKSA9PSAnc3RyaW5nJykgewogICAgICAgIGdvLmFkZENvbG9yU3RvcChjc1sw
XSwgY3NbMV0pCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGNhID0gY3NbMV0KICAgICAgICB2
YXIgYSA9IChjYS5sZW5ndGggPT0gMykgPyAxIDogY2FbM10KICAgICAgICB2YXIgZyA9ICdyZ2Jh
KCcrY2Euc2xpY2UoMCwzKS5tYXAoTWF0aC5yb3VuZCkuam9pbigiLCIpKycsICcrYSsnKScKICAg
ICAgICBnby5hZGRDb2xvclN0b3AoY3NbMF0sIGcpCiAgICAgIH0KICAgIH0KICAgIE9iamVjdC5l
eHRlbmQoZ28sIFRyYW5zZm9ybWFibGUucHJvdG90eXBlKQogICAgZ28udHJhbnNmb3JtTGlzdCA9
IHRoaXMudHJhbnNmb3JtTGlzdAogICAgZ28uc2NhbGUgPSB0aGlzLnNjYWxlCiAgICBnby54ID0g
dGhpcy54CiAgICBnby55ID0gdGhpcy55CiAgICBnby5tYXRyaXggPSB0aGlzLm1hdHJpeAogICAg
Z28ucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uCiAgICBnby51bml0cyA9IHRoaXMudW5pdHMKICAg
IGlmICghZ28uaXNNb2NrT2JqZWN0KQogICAgICB0aGlzLmNvbXBpbGVkID0gZ28KICAgIHJldHVy
biBnbwogIH0KfSkKCgovKioKICBQYXR0ZXJuIGlzIGEgcG9zc2libHkgcmVwZWF0aW5nIGltYWdl
IHRoYXQgY2FuIGJlIHVzZWQgYXMgYSBzdHJva2VTdHlsZSBvcgogIGZpbGxTdHlsZS4KCiAgICB2
YXIgaW1hZ2UgPSBuZXcgSW1hZ2UoKQogICAgaW1hZ2Uuc3JjID0gJ2Zvby5qcGcnCiAgICB2YXIg
cGF0dGVybiA9IG5ldyBQYXR0ZXJuKGltYWdlLCAnbm8tcmVwZWF0JykKICAgIHZhciByZWN0ID0g
bmV3IFJlY3RhbmdsZSgyMDAsIDIwMCwge2ZpbGw6IHRydWUsIGZpbGxTdHlsZTogcGF0dGVybn0p
CgogIEBwYXJhbSBpbWFnZSBUaGUgaW1hZ2Ugb2JqZWN0IGZvciB0aGUgcGF0dGVybi4gSU1HIGFu
ZCBDQU5WQVMgZWxlbWVudHMsIGFuZAogICAgICAgICAgICAgICBJbWFnZSBvYmplY3RzIGFsbCB3
b3JrLgogIEBwYXJhbSByZXBlYXQgVGhlIHJlcGVhdCBtb2RlIG9mIHRoZSBwYXR0ZXJuLiBPbmUg
b2YgJ3JlcGVhdCcsICdyZXBlYXQteScsCiAgICAgICAgICAgICAgICAncmVwZWF0LXgnIGFuZCAn
bm8tcmVwZWF0Jy4gVGhlIGRlZmF1bHQgaXMgJ3JlcGVhdCcuCiAgKi8KUGF0dGVybiA9IEtsYXNz
KHsKICBpc1BhdHRlcm4gOiB0cnVlLAogIHJlcGVhdDogJ3JlcGVhdCcsCgogIGluaXRpYWxpemUg
OiBmdW5jdGlvbihpbWFnZSwgcmVwZWF0KSB7CiAgICB0aGlzLmltYWdlID0gaW1hZ2UKICAgIGlm
IChyZXBlYXQpCiAgICAgIHRoaXMucmVwZWF0ID0gcmVwZWF0CiAgfSwKCiAgLyoqCiAgICBDb21w
aWxlcyB0aGUgcGF0dGVybiB1c2luZyB0aGUgZ2l2ZW4gZHJhd2luZyBjb250ZXh0LgogICAgUmV0
dXJucyBhIHBhdHRlcm4gb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgYXMgZHJhd2luZyBjb250ZXh0
CiAgICBmaWxsL3N0cm9rZVN0eWxlLgoKICAgIEBwYXJhbSBjdHggRHJhd2luZyBjb250ZXh0IHRv
IGNvbXBpbGUgcGF0dGVybiBvbi4KICAgIEByZXR1cm4gUGF0dGVybiBvYmplY3QuCiAgICAqLwog
IGNvbXBpbGUgOiBmdW5jdGlvbihjdHgpIHsKICAgIHZhciBwYXQgPSBjdHguY3JlYXRlUGF0dGVy
bih0aGlzLmltYWdlLCB0aGlzLnJlcGVhdCkKICAgIE9iamVjdC5leHRlbmQocGF0LCBUcmFuc2Zv
cm1hYmxlLnByb3RvdHlwZSkKICAgIHBhdC50cmFuc2Zvcm1MaXN0ID0gdGhpcy50cmFuc2Zvcm1M
aXN0CiAgICBwYXQuc2NhbGUgPSB0aGlzLnNjYWxlCiAgICBwYXQueCA9IHRoaXMueAogICAgcGF0
LnkgPSB0aGlzLnkKICAgIHBhdC5tYXRyaXggPSB0aGlzLm1hdHJpeAogICAgcGF0LnJvdGF0aW9u
ID0gdGhpcy5yb3RhdGlvbgogICAgcGF0LnVuaXRzID0gdGhpcy51bml0cwogICAgaWYgKCFwYXQu
aXNNb2NrT2JqZWN0KQogICAgICB0aGlzLmNvbXBpbGVkID0gcGF0CiAgICByZXR1cm4gcGF0CiAg
fQp9KQoKCgoKCgoKCgoKCgovKioKICBTVkcgcGFyc2VyIGZvciBzaW1wbGUgZG9jdW1lbnRzLiBD
b252ZXJ0cyBTVkcgRE9NIHRvIENBS0Ugc2NlbmVncmFwaC4KICBFbXBoYXNpcyBvbiBncmFwaGlj
YWwgaW1hZ2VzLCBub3Qgb24gdGhlICJIVE1MLWtpbGxlciIgZmVhdHVyZXMgb2YgU1ZHLgoKICB2
YXIgc3ZnTm9kZSA9IFNWR1BhcnNlci5wYXJzZSgKICAgIHN2Z1Jvb3RFbGVtZW50LCBmaWxlbmFt
ZSwgY29udGFpbmVyV2lkdGgsIGNvbnRhaW5lckhlaWdodCwgZm9udFNpemUKICApCgogIEZlYXR1
cmVzOgogICAgKiA8c3ZnPiB3aWR0aCBhbmQgaGVpZ2h0LCB2aWV3Qm94IGNsaXBwaW5nLgogICAg
KiBDbGlwcGluZyAob2JqZWN0Qm91bmRpbmdCb3ggY2xpcHBpbmcgdG9vKQogICAgKiBQYXRocywg
cmVjdGFuZ2xlcywgZWxsaXBzZXMsIGNpcmNsZXMsIGxpbmVzLCBwb2x5bGluZXMgYW5kIHBvbHln
b25zCiAgICAqIFNpbXBsZSB1bnRyYW5zZm9ybWVkIHRleHQgdXNpbmcgSFRNTAogICAgKiBOZXN0
ZWQgdHJhbnNmb3JtcwogICAgKiBUcmFuc2Zvcm0gbGlzdHMgKHRyYW5zZm9ybT0icm90YXRlKDMw
KSB0cmFuc2xhdGUoMiwyKSBzY2FsZSg0KSIpCiAgICAqIEdyYWRpZW50IGFuZCBwYXR0ZXJuIHRy
YW5zZm9ybXMKICAgICogU3Ryb2tlcyB3aXRoIG1pdGVyLCBqb2lucyBhbmQgY2FwcwogICAgKiBG
bGF0IGZpbGxzIGFuZCBncmFkaWVudCBmaWxscywgZGl0dG8gZm9yIHN0cm9rZXMKICAgICogUGFy
c2luZyBzaW1wbGUgc3R5bGVzaGVldHMgKHRhZywgY2xhc3Mgb3IgaWQpCiAgICAqIEltYWdlcwog
ICAgKiBOb24tcGl4ZWwgdW5pdHMgKGNtLCBtbSwgaW4sIHB0LCBwYywgZW0sIGV4LCAlKQogICAg
KiA8dXNlPi10YWdzCiAgICAqIHByZXNlcnZlQXNwZWN0UmF0aW8KICAgICogRHluYW1pYyBncmFk
aWVudCBzaXplcyAob2JqZWN0Qm91bmRpbmdCb3gsIGV0Yy4pCiAgICAqIE1hcmtlcnMgKHRob3Vn
aCBidWdneSkKCiAgU29tZSBvZiB0aGUgc2V2ZXJhbCBtaXNzaW5nIGZlYXR1cmVzOgogICAgKiBN
YXNrcwogICAgKiBQYXR0ZXJucwogICAgKiB2aWV3Qm94IGNsaXBwaW5nIGZvciBlbGVtZW50cyBv
dGhlciB0aGFuIDxtYXJrZXI+IGFuZCA8c3ZnPgogICAgKiBUZXh0IHN0eWxpbmcKICAgICogdHNw
YW4sIHRyZWYsIHRleHRQYXRoLCBtYW55IHRoaW5ncyB0ZXh0CiAgICAqIEZhbmN5IHN0eWxlIHJ1
bGVzICh0YWcgLmNsYXNzICsgI2ZvbyA+IGJvYiNhbGljZSB7IC4uLiB9KQogICAgKiBGaWx0ZXJz
CiAgICAqIEFuaW1hdGlvbgogICAgKiBEYXNoZWQgc3Ryb2tlcwogICovClNWR1BhcnNlciA9IHsK
ICAvKioKICAgIExvYWRzIGFuIFNWRyBkb2N1bWVudCB1c2luZyBYTUxIdHRwUmVxdWVzdCBhbmQg
Y2FsbHMgdGhlIGdpdmVuIG9uU3VjY2VzcwogICAgY2FsbGJhY2sgd2l0aCB0aGUgcGFyc2VkIGRv
Y3VtZW50LiBJZiBsb2FkaW5nIGZhaWxzLCBjYWxscyBvbkZhaWx1cmUKICAgIGluc3RlYWQgaWYg
b25lIGlzIGdpdmVuLiBXaGVuIGxvYWRpbmcgYW5kIGFuIG9uTG9hZGluZyBjYWxsYmFjayBpcyBn
aXZlbiwKICAgIGNhbGxzIG9uTG9hZGluZyBldmVyeSB0aW1lIHhoci5yZWFkeVN0YXRlIGlzIDMu
CgogICAgVGhlIGNhbGxiYWNrcyB3aWxsIGJlIGNhbGxlZCB3aXRoIHRoZSBmb2xsb3dpbmcgcGFy
YW1ldGVyczoKCiAgICBvblN1Y2Nlc3Moc3ZnTm9kZSwgeG1sSHR0cFJlcXVlc3QsCiAgICAgIGZp
bGVuYW1lLCBjb25maWcpCgogICAgb25GYWlsdXJlKHhtbEh0dHBSZXF1ZXN0LCBwb3NzaWJsZUV4
Y2VwdGlvbiwKICAgICAgZmlsZW5hbWUsIGNvbmZpZykKCiAgICBvbkxvYWRpbmcoeG1sSHR0cFJl
cXVlc3QsCiAgICAgIGZpbGVuYW1lLCBjb25maWcpCgogICAgQ29uZmlnIGhhc2ggcGFyYW1ldGVy
czoKICAgICAgZmlsZW5hbWU6IEZpbGVuYW1lIGZvciB0aGUgU1ZHIGRvY3VtZW50LiBVc2VkIGZv
ciBwYXJzaW5nIGltYWdlIHBhdGhzLgogICAgICB3aWR0aDogV2lkdGggb2YgdGhlIGJvdW5kaW5n
IGJveCB0byBmaXQgdGhlIFNWRyBpbi4KICAgICAgaGVpZ2h0OiBIZWlnaHQgb2YgdGhlIGJvdW5k
aW5nIGJveCB0byBmaXQgdGhlIFNWRyBpbi4KICAgICAgZm9udFNpemU6IERlZmF1bHQgZm9udCBz
aXplIGZvciB0aGUgU1ZHIGRvY3VtZW50LgogICAgICBvblN1Y2Nlc3M6IEZ1bmN0aW9uIHRvIGNh
bGwgb24gc3VjY2Vzc2Z1bCBsb2FkLiBSZXF1aXJlZC4KICAgICAgb25GYWlsdXJlOiBGdW5jdGlv
biB0byBjYWxsIG9uIGZhaWxlZCBsb2FkLgogICAgICBvbkxvYWRpbmc6IEZ1bmN0aW9uIHRvIGNh
bGwgd2hpbGUgbG9hZGluZy4KCiAgICBAcGFyYW0gY29uZmlnIFRoZSBjb25maWcgaGFzaC4KICAg
IEBwYXJhbSBmaWxlbmFtZSBUaGUgVVJMIG9mIHRoZSBTVkcgZG9jdW1lbnQgdG8gbG9hZC4gTXVz
dCBjb25mb3JtIHRvIFNPUC4KICAgICovCiAgbG9hZCA6IGZ1bmN0aW9uKGZpbGVuYW1lLCBjb25m
aWcpIHsKICAgIGlmICghY29uZmlnLm9uU3VjY2VzcykgdGhyb3coIk5lZWQgdG8gcHJvdmlkZSBh
biBvblN1Y2Nlc3MgZnVuY3Rpb24uIikKICAgIGlmICghY29uZmlnLmZpbGVuYW1lKQogICAgICBj
b25maWcuZmlsZW5hbWUgPSBmaWxlbmFtZQogICAgdmFyIHhociA9IHdpbmRvdy5YTUxIdHRwUmVx
dWVzdCA/IG5ldyBYTUxIdHRwUmVxdWVzdCgpIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICBuZXcgQWN0aXZlWE9iamVjdCgiTVNYTUwyLlhNTEhUVFAuMy4wIikKICAgIHho
ci5vcGVuKCdHRVQnLCBmaWxlbmFtZSwgdHJ1ZSkKICAgIHhoci5vdmVycmlkZU1pbWVUeXBlKCd0
ZXh0L3htbCcpCiAgICB2YXIgZmFpbHVyZUZpcmVkID0gZmFsc2UKICAgIHhoci5vbnJlYWR5c3Rh
dGVjaGFuZ2UgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09IDQpIHsK
ICAgICAgICBpZiAoeGhyLnN0YXR1cyA9PSAyMDAgfHwgeGhyLnN0YXR1cyA9PSAwKSB7CiAgICAg
ICAgICB0cnkgewogICAgICAgICAgICB2YXIgc3ZnID0geGhyLnJlc3BvbnNlWE1MCiAgICAgICAg
ICAgIHZhciBzdmdOb2RlID0gU1ZHUGFyc2VyLnBhcnNlKHN2ZywgY29uZmlnKQogICAgICAgICAg
ICBzdmdOb2RlLnN2Z1Jvb3RFbGVtZW50ID0gc3ZnCiAgICAgICAgICB9IGNhdGNoKGUpIHsKICAg
ICAgICAgICAgaWYgKGNvbmZpZy5vbkZhaWx1cmUpCiAgICAgICAgICAgICAgY29uZmlnLm9uRmFp
bHVyZSh4aHIsIGUsIGZpbGVuYW1lLCBjb25maWcpCiAgICAgICAgICAgIHJldHVybgogICAgICAg
ICAgfQogICAgICAgICAgY29uZmlnLm9uU3VjY2VzcyhzdmdOb2RlLCB4aHIsIGZpbGVuYW1lLCBj
b25maWcpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChjb25maWcub25GYWlsdXJlICYm
ICFmYWlsdXJlRmlyZWQpCiAgICAgICAgICAgIGNvbmZpZy5vbkZhaWx1cmUoeGhyLCBudWxsLCBm
aWxlbmFtZSwgY29uZmlnKQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh4aHIucmVhZHlTdGF0
ZSA9PSAzKSB7CiAgICAgICAgaWYgKGNvbmZpZy5vbkxvYWRpbmcpCiAgICAgICAgICBjb25maWcu
b25Mb2FkaW5nKHhociwgZmlsZW5hbWUsIGNvbmZpZykKICAgICAgfQogICAgfQogICAgdHJ5IHsK
ICAgICAgeGhyLnNlbmQobnVsbCkKICAgIH0gY2F0Y2goZSkgewogICAgICBpZiAoY29uZmlnLm9u
RmFpbHVyZSkgewogICAgICAgIGNvbmZpZy5vbkZhaWx1cmUoeGhyLCBlLCBmaWxlbmFtZSwgY29u
ZmlnKQogICAgICAgIGZhaWx1cmVGaXJlZCA9IHRydWUKICAgICAgfQogICAgICB4aHIuYWJvcnQo
KQogICAgfQogIH0sCgogIC8qKgogICAgUGFyc2VzIGFuIFNWRyBET00gaW50byBDQUtFIHNjZW5l
Z3JhcGguCgogICAgQ29uZmlnIGhhc2ggcGFyYW1ldGVyczoKICAgICAgZmlsZW5hbWU6IEZpbGVu
YW1lIGZvciB0aGUgU1ZHIGRvY3VtZW50LiBVc2VkIGZvciBwYXJzaW5nIGltYWdlIHBhdGhzLgog
ICAgICB3aWR0aDogV2lkdGggb2YgdGhlIGJvdW5kaW5nIGJveCB0byBmaXQgdGhlIFNWRyBpbi4K
ICAgICAgaGVpZ2h0OiBIZWlnaHQgb2YgdGhlIGJvdW5kaW5nIGJveCB0byBmaXQgdGhlIFNWRyBp
bi4KICAgICAgZm9udFNpemU6IERlZmF1bHQgZm9udCBzaXplIGZvciB0aGUgU1ZHIGRvY3VtZW50
LgogICAgICBjdXJyZW50Q29sb3I6IEhUTUwgdGV4dCBjb2xvciBvZiB0aGUgY29udGFpbmluZyBl
bGVtZW50LgoKICAgIEBwYXJhbSBzdmdSb290RWxlbWVudCBUaGUgcm9vdCBlbGVtZW50IG9mIHRo
ZSBTVkcgRE9NLgogICAgQHBhcmFtIGNvbmZpZyBUaGUgY29uZmlnIGhhc2guCiAgICBAcmV0dXJu
cyBUaGUgcm9vdCBDYW52YXNOb2RlIG9mIHRoZSBzY2VuZWdyYXBoIGNyZWF0ZWQgZnJvbSB0aGUg
U1ZHIGRvY3VtZW50LgogICAgQHR5cGUgQ2FudmFzTm9kZQogICAgKi8KICBwYXJzZSA6IGZ1bmN0
aW9uKHN2Z1Jvb3RFbGVtZW50LCBjb25maWcpIHsKICAgIHZhciBuID0gbmV3IENhbnZhc05vZGUo
KQogICAgdmFyIHcgPSBjb25maWcud2lkdGgsIGggPSBjb25maWcuaGVpZ2h0LCBmcyA9IGNvbmZp
Zy5mb250U2l6ZQogICAgbi5pbm5lcldpZHRoID0gdyB8fCB3aW5kb3cuaW5uZXJXaWR0aAogICAg
bi5pbm5lckhlaWdodCA9IGggfHwgd2luZG93LmlubmVySGVpZ2h0CiAgICBuLmlubmVyU2l6ZSA9
IE1hdGguc3FydCh3KncgKyBoKmgpIC8gTWF0aC5zcXJ0KDIpCiAgICBuLmZvbnRTaXplID0gZnMg
fHwgMTIKICAgIG4uZmlsZW5hbWUgPSBjb25maWcuZmlsZW5hbWUgfHwgJy4nCiAgICB2YXIgZGVm
cyA9IHt9CiAgICB2YXIgc3R5bGUgPSB7IGlkcyA6IHt9LCBjbGFzc2VzIDoge30sIHRhZ3MgOiB7
fSB9CiAgICBuLmNvbG9yID0gY29uZmlnLmN1cnJlbnRDb2xvciB8fCAnYmxhY2snCiAgICB0aGlz
LnBhcnNlQ2hpbGRyZW4oc3ZnUm9vdEVsZW1lbnQsIG4sIGRlZnMsIHN0eWxlKQogICAgbi5kZWZz
ID0gZGVmcwogICAgbi5zdHlsZSA9IHN0eWxlCiAgICByZXR1cm4gbgogIH0sCgogIHBhcnNlUHJl
c2VydmVBc3BlY3RSYXRpbyA6IGZ1bmN0aW9uKGFzcGVjdCwgdywgaCwgdnB3LCB2cGgpIHsKICAg
IHZhciBhc3BlY3QgPSBhc3BlY3QgfHwgIiIKICAgIHZhciBhc3BhID0gYXNwZWN0LnNwbGl0KC9c
cysvKQogICAgdmFyIGRlZmVyID0gKGFzcGFbMF0gPT0gJ2RlZmVyJykKICAgIGlmIChkZWZlcikg
YXNwYS5zaGlmdCgpCiAgICB2YXIgYWxpZ24gPSAoYXNwYVswXSB8fCAneE1pZFlNaWQnKQogICAg
dmFyIG1lZXQgPSAoYXNwYVsxXSB8fCAnbWVldCcpCiAgICB2YXIgd2YgPSB3IC8gdnB3CiAgICB2
YXIgaGYgPSBoIC8gdnBoCiAgICB2YXIgeHl3aCA9IHt4OjAsIHk6MCwgdzp3ZiwgaDpoZn0KICAg
IGlmIChhbGlnbiA9PSAnbm9uZScpIHJldHVybiB4eXdoCiAgICB4eXdoLncgPSB4eXdoLmggPSAo
bWVldCA9PSAnbWVldCcgPyBNYXRoLm1pbiA6IE1hdGgubWF4KSh3ZiwgaGYpCiAgICB2YXIgeGEg
PSBhbGlnbi5zbGljZSgxLCA0KS50b0xvd2VyQ2FzZSgpCiAgICB2YXIgeWEgPSBhbGlnbi5zbGlj
ZSg1LCA4KS50b0xvd2VyQ2FzZSgpCiAgICB2YXIgeGYgPSAodGhpcy5TVkdBbGlnbk1hcFt4YV0g
fHwgMCkKICAgIHZhciB5ZiA9ICh0aGlzLlNWR0FsaWduTWFwW3lhXSB8fCAwKQogICAgeHl3aC54
ID0geGYgKiAody12cHcqeHl3aC53KQogICAgeHl3aC55ID0geWYgKiAoaC12cGgqeHl3aC5oKQog
ICAgcmV0dXJuIHh5d2gKICB9LAoKICBTVkdBbGlnbk1hcCA6IHsKICAgIG1pbiA6IDAsCiAgICBt
aWQgOiAwLjUsCiAgICBtYXggOiAxCiAgfSwKCiAgU1ZHVGFnTWFwcGluZyA6IHsKICAgIHN2ZyA6
IGZ1bmN0aW9uKGMsIGNuLCBkZWZzLCBzdHlsZSkgewogICAgICB2YXIgcCA9IG5ldyBSZWN0YW5n
bGUoKQogICAgICBwLndpZHRoID0gMAogICAgICBwLmhlaWdodCA9IDAKICAgICAgcC5kb0ZpbGwg
PSBmdW5jdGlvbigpe30KICAgICAgcC5kb1N0cm9rZSA9IGZ1bmN0aW9uKCl7fQogICAgICBwLmRy
YXdNYXJrZXJzID0gZnVuY3Rpb24oKXt9CiAgICAgIHAuZmlsbCA9ICdibGFjaycKICAgICAgcC5z
dHJva2UgPSAnbm9uZScKICAgICAgdmFyIHZiID0gYy5nZXRBdHRyaWJ1dGUoJ3ZpZXdCb3gnKQog
ICAgICB2YXIgdyA9IGMuZ2V0QXR0cmlidXRlKCd3aWR0aCcpCiAgICAgIHZhciBoID0gYy5nZXRB
dHRyaWJ1dGUoJ2hlaWdodCcpCiAgICAgIGlmICghdykgdyA9IGgKICAgICAgZWxzZSBpZiAoIWgp
IGggPSB3CiAgICAgIGlmICh3KSB7CiAgICAgICAgdmFyIHdweCA9IHRoaXMucGFyc2VVbml0KHcs
IGNuLCAneCcpCiAgICAgICAgdmFyIGhweCA9IHRoaXMucGFyc2VVbml0KGgsIGNuLCAneScpCiAg
ICAgIH0KICAgICAgaWYgKHZiKSB7CiAgICAgICAgeHl3aCA9IHZiLm1hdGNoKC9bLStdP1xkKy9n
KS5tYXAocGFyc2VGbG9hdCkKICAgICAgICBwLmN4ID0geHl3aFswXQogICAgICAgIHAuY3kgPSB4
eXdoWzFdCiAgICAgICAgcC53aWR0aCA9IHh5d2hbMl0KICAgICAgICBwLmhlaWdodCA9IHh5d2hb
M10KICAgICAgICB2YXIgaXcgPSBjbi5pbm5lcldpZHRoID0gcC53aWR0aAogICAgICAgIHZhciBp
aCA9IGNuLmlubmVySGVpZ2h0ID0gcC5oZWlnaHQKICAgICAgICBjbi5pbm5lclNpemUgPSBNYXRo
LnNxcnQoaXcqaXcgKyBpaCppaCkgLyBNYXRoLnNxcnQoMikKICAgICAgICBpZiAoYy5nZXRBdHRy
aWJ1dGUoJ292ZXJmbG93JykgIT0gJ3Zpc2libGUnKQogICAgICAgICAgcC5jbGlwID0gdHJ1ZQog
ICAgICB9CiAgICAgIGlmICh3KSB7CiAgICAgICAgaWYgKHZiKSB7IC8vIG51dHMsIGxldCdzIHBh
cnNlIHRoZSBhbGlnbm1lbnQgOnwKICAgICAgICAgIHZhciBhc3BlY3QgPSBjLmdldEF0dHJpYnV0
ZSgncHJlc2VydmVBc3BlY3RSYXRpbycpCiAgICAgICAgICB2YXIgYWxpZ24gPSB0aGlzLnBhcnNl
UHJlc2VydmVBc3BlY3RSYXRpbyhhc3BlY3QsCiAgICAgICAgICAgIHdweCwgaHB4LAogICAgICAg
ICAgICBwLndpZHRoLCBwLmhlaWdodCkKICAgICAgICAgIHAuY3ggLT0gYWxpZ24ueCAvIGFsaWdu
LncKICAgICAgICAgIHAuY3kgLT0gYWxpZ24ueSAvIGFsaWduLmgKICAgICAgICAgIHAud2lkdGgg
PSB3cHggLyBhbGlnbi53CiAgICAgICAgICBwLmhlaWdodCA9IGhweCAvIGFsaWduLmgKICAgICAg
ICAgIHAueCArPSBhbGlnbi54CiAgICAgICAgICBwLnkgKz0gYWxpZ24ueQogICAgICAgICAgcC5z
Y2FsZSA9IFthbGlnbi53LCBhbGlnbi5oXQogICAgICAgIH0KICAgICAgICAvLyB3cm9uZyBwbGFj
ZSEKICAgICAgICBjbi5kb2NXaWR0aCA9IHdweAogICAgICAgIGNuLmRvY0hlaWdodCA9IGhweAog
ICAgICB9CiAgICAgIHJldHVybiBwCiAgICB9LAoKICAgIG1hcmtlciA6IGZ1bmN0aW9uKGMsIGNu
KSB7CiAgICAgIHZhciBwID0gbmV3IENhbnZhc05vZGUoKQogICAgICBwLmRyYXcgPSBmdW5jdGlv
bihjdHgpIHsKICAgICAgICBpZiAodGhpcy5vdmVyZmxvdyAhPSAnaGlkZGVuJyAmJiB0aGlzLnZp
ZXdCb3gpIHJldHVybgogICAgICAgIGN0eC5iZWdpblBhdGgoKQogICAgICAgIGN0eC5yZWN0KAog
ICAgICAgICAgdGhpcy52aWV3Qm94WzBdLHRoaXMudmlld0JveFsxXSwKICAgICAgICAgIHRoaXMu
dmlld0JveFsyXSx0aGlzLnZpZXdCb3hbM10KICAgICAgICApCiAgICAgICAgY3R4LmNsaXAoKQog
ICAgICB9CiAgICAgIHZhciB4ID0gLXRoaXMucGFyc2VVbml0KGMuZ2V0QXR0cmlidXRlKCdyZWZY
JyksIGNuLCAneCcpIHx8IDAKICAgICAgdmFyIHkgPSAtdGhpcy5wYXJzZVVuaXQoYy5nZXRBdHRy
aWJ1dGUoJ3JlZlknKSwgY24sICd5JykgfHwgMAogICAgICBwLnRyYW5zZm9ybUxpc3QgPSBbWyd0
cmFuc2xhdGUnLCBbeCx5XV1dCiAgICAgIHAubWFya2VyVW5pdHMgPSBjLmdldEF0dHJpYnV0ZSgn
bWFya2VyVW5pdHMnKSB8fCAnc3Ryb2tlV2lkdGgnCiAgICAgIHAubWFya2VyV2lkdGggPSB0aGlz
LnBhcnNlVW5pdChjLmdldEF0dHJpYnV0ZSgnbWFya2VyV2lkdGgnKSwgY24sICd4JykgfHwgMwog
ICAgICBwLm1hcmtlckhlaWdodCA9IHRoaXMucGFyc2VVbml0KAogICAgICAgICAgICAgICAgICAg
ICAgICAgIGMuZ2V0QXR0cmlidXRlKCdtYXJrZXJIZWlnaHQnKSwgY24sICd5JykgfHwKICAgICAg
ICAgICAgICAgICAgICAgICAgICAzCiAgICAgIHAub3ZlcmZsb3cgPSBjLmdldEF0dHJpYnV0ZSgn
b3ZlcmZsb3cnKSB8fCAnaGlkZGVuJwogICAgICBwLnZpZXdCb3ggPSBjLmdldEF0dHJpYnV0ZSgn
dmlld0JveCcpCiAgICAgIHAub3JpZW50ID0gYy5nZXRBdHRyaWJ1dGUoJ29yaWVudCcpIHx8IDAK
ICAgICAgaWYgKHAub3JpZW50ICYmIHAub3JpZW50ICE9ICdhdXRvJykKICAgICAgICBwLm9yaWVu
dCA9IHBhcnNlRmxvYXQocC5vcmllbnQpKlNWR01hcHBpbmcuREVHX1RPX1JBRF9GQUNUT1IKICAg
ICAgaWYgKHAudmlld0JveCkgewogICAgICAgIHAudmlld0JveCA9IHAudmlld0JveC5zdHJpcCgp
LnNwbGl0KC9bXHMsXSsvZykubWFwKHBhcnNlRmxvYXQpCiAgICAgICAgdmFyIHZidyA9IHAudmll
d0JveFsyXSAtIHAudmlld0JveFswXQogICAgICAgIHZhciB2YmggPSBwLnZpZXdCb3hbM10gLSBw
LnZpZXdCb3hbMV0KICAgICAgICBpZiAocC5tYXJrZXJXaWR0aCkgewogICAgICAgICAgdmFyIHN4
ID0gc3kgPSBNYXRoLm1pbigKICAgICAgICAgICAgcC5tYXJrZXJXaWR0aCAvIHZidywKICAgICAg
ICAgICAgcC5tYXJrZXJIZWlnaHQgLyB2YmgKICAgICAgICAgICkKICAgICAgICAgIHAudHJhbnNm
b3JtTGlzdC51bnNoaWZ0KFsnc2NhbGUnLCBbc3gsc3ldXSkKICAgICAgICB9CiAgICAgIH0KICAg
ICAgcmV0dXJuIHAKICAgIH0sCgogICAgY2xpcFBhdGggOiBmdW5jdGlvbihjLGNuKSB7CiAgICAg
IHZhciBwID0gbmV3IENhbnZhc05vZGUoKQogICAgICBwLnVuaXRzID0gYy5nZXRBdHRyaWJ1dGUo
J2NsaXBQYXRoVW5pdHMnKQogICAgICByZXR1cm4gcAogICAgfSwKCiAgICB0aXRsZSA6IGZ1bmN0
aW9uKGMsIGNhbnZhc05vZGUpIHsKICAgICAgY2FudmFzTm9kZS5yb290LnRpdGxlID0gYy50ZXh0
Q29udGVudAogICAgfSwKCiAgICBkZXNjIDogZnVuY3Rpb24oYyxjbikgewogICAgICBjbi5yb290
LmRlc2NyaXB0aW9uID0gYy50ZXh0Q29udGVudAogICAgfSwKCiAgICBtZXRhZGF0YSA6IGZ1bmN0
aW9uKGMsIGNuKSB7CiAgICAgIGNuLnJvb3QubWV0YWRhdGEgPSBjCiAgICB9LAoKCgoKCgoKCiAg
ICBwYXJzZUFuaW1hdGVUYWcgOiBmdW5jdGlvbihjLCBjbikgewogICAgICB2YXIgYWZ0ZXIgPSBT
VkdQYXJzZXIuU1ZHVGFnTWFwcGluZy5wYXJzZVRpbWUoYy5nZXRBdHRyaWJ1dGUoJ2JlZ2luJykp
CiAgICAgIHZhciBkdXIgPSBTVkdQYXJzZXIuU1ZHVGFnTWFwcGluZy5wYXJzZVRpbWUoYy5nZXRB
dHRyaWJ1dGUoJ2R1cicpKQogICAgICB2YXIgZW5kID0gU1ZHUGFyc2VyLlNWR1RhZ01hcHBpbmcu
cGFyc2VUaW1lKGMuZ2V0QXR0cmlidXRlKCdlbmQnKSkKICAgICAgaWYgKGR1ciA9PSBudWxsKSBk
dXIgPSBlbmQtYWZ0ZXIKICAgICAgZHVyID0gaXNOYU4oZHVyKSA/IDAgOiBkdXIKICAgICAgdmFy
IHZhcmlhYmxlID0gYy5nZXRBdHRyaWJ1dGUoJ2F0dHJpYnV0ZU5hbWUnKQogICAgICB2YXIgZmls
bCA9IGMuZ2V0QXR0cmlidXRlKCdmaWxsJykKICAgICAgaWYgKGNuLnRhZ05hbWUgPT0gJ3JlY3Qn
KSB7CiAgICAgICAgaWYgKHZhcmlhYmxlID09ICd4JykgdmFyaWFibGUgPSAnY3gnCiAgICAgICAg
aWYgKHZhcmlhYmxlID09ICd5JykgdmFyaWFibGUgPSAnY3knCiAgICAgIH0KICAgICAgdmFyIGFj
Y3VtID0gYy5nZXRBdHRyaWJ1dGUoJ2FjY3VtdWxhdGUnKSA9PSAnc3VtJwogICAgICB2YXIgYWRk
aXRpdmUgPSBjLmdldEF0dHJpYnV0ZSgnYWRkaXRpdmUnKQogICAgICBpZiAoYWRkaXRpdmUpIGFk
ZGl0aXZlID0gYWRkaXRpdmUgPT0gJ3N1bScKICAgICAgZWxzZSBhZGRpdGl2ZSA9IGFjY3VtCiAg
ICAgIHZhciByZXBlYXQgPSBjLmdldEF0dHJpYnV0ZSgncmVwZWF0Q291bnQnKQogICAgICBpZiAo
cmVwZWF0ID09ICdpbmRlZmluaXRlJykgcmVwZWF0ID0gdHJ1ZQogICAgICBlbHNlIHJlcGVhdCA9
IHBhcnNlRmxvYXQocmVwZWF0KQogICAgICBpZiAoIXJlcGVhdCAmJiBkdXIgPiAwKSB7CiAgICAg
ICAgdmFyIHJlcGVhdER1ciA9IGMuZ2V0QXR0cmlidXRlKCdyZXBlYXREdXInKQogICAgICAgIGlm
IChyZXBlYXREdXIgPT0gJ2luZGVmaW5pdGUnKSByZXBlYXQgPSB0cnVlCiAgICAgICAgZWxzZSBy
ZXBlYXQgPSBTVkdQYXJzZXIuU1ZHVGFnTWFwcGluZy5wYXJzZVRpbWUocmVwZWF0RHVyKSAvIGR1
cgogICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgYWZ0ZXI6IGlzTmFOKGFmdGVyKSA/IDAg
OiBhZnRlciwKICAgICAgICBkdXJhdGlvbjogZHVyLAogICAgICAgIHJlc3RhcnQ6IGMuZ2V0QXR0
cmlidXRlKCdyZXN0YXJ0JyksCiAgICAgICAgY2FsY01vZGUgOiBjLmdldEF0dHJpYnV0ZSgnY2Fs
Y01vZGUnKSwKICAgICAgICBhZGRpdGl2ZSA6IGFkZGl0aXZlLAogICAgICAgIGFjY3VtdWxhdGUg
OiBhY2N1bSwKICAgICAgICByZXBlYXQgOiByZXBlYXQsCiAgICAgICAgdmFyaWFibGU6IHZhcmlh
YmxlLAogICAgICAgIGZpbGw6IGZpbGwKICAgICAgfQogICAgfSwKCiAgICBwYXJzZVRpbWUgOiBm
dW5jdGlvbih2YWx1ZSkgewogICAgICBpZiAoIXZhbHVlKSByZXR1cm4gbnVsbAogICAgICBpZiAo
dmFsdWUubWF0Y2goL1swLTldJC8pKSB7CiAgICAgICAgdmFyIGhtcyA9IHZhbHVlLnNwbGl0KCI6
IikKICAgICAgICB2YXIgcyA9IGhtc1tobXMubGVuZ3RoLTFdIHx8IDAKICAgICAgICB2YXIgbSA9
IGhtc1tobXMubGVuZ3RoLTJdIHx8IDAKICAgICAgICB2YXIgaCA9IGhtc1tobXMubGVuZ3RoLTNd
IHx8IDAKICAgICAgICByZXR1cm4gKHBhcnNlRmxvYXQoaCkqMzYwMCArIHBhcnNlRmxvYXQobSkq
NjAgKyBwYXJzZUZsb2F0KHMpKSAqIDEwMDAKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgZmFj
ID0gNjAKICAgICAgICBpZiAodmFsdWUubWF0Y2goL3MkL2kpKSBmYWMgPSAxCiAgICAgICAgZWxz
ZSBpZiAodmFsdWUubWF0Y2goL2gkL2kpKSBmYWMgPSAzNjAwCiAgICAgICAgcmV0dXJuIHBhcnNl
RmxvYXQodmFsdWUpICogZmFjICogMTAwMAogICAgICB9CiAgICB9LAoKCgoKCgogICAgYW5pbWF0
ZSA6IGZ1bmN0aW9uKGMsIGNuKSB7CiAgICAgIHZhciBmcm9tID0gdGhpcy5wYXJzZVVuaXQoYy5n
ZXRBdHRyaWJ1dGUoJ2Zyb20nKSwgY24sICd4JykKICAgICAgdmFyIHRvID0gdGhpcy5wYXJzZVVu
aXQoYy5nZXRBdHRyaWJ1dGUoJ3RvJyksIGNuLCAneCcpCiAgICAgIHZhciBieSA9IHRoaXMucGFy
c2VVbml0KGMuZ2V0QXR0cmlidXRlKCdieScpLCBjbiwgJ3gnKQogICAgICB2YXIgbyA9IFNWR1Bh
cnNlci5TVkdUYWdNYXBwaW5nLnBhcnNlQW5pbWF0ZVRhZyhjLCBjbikKICAgICAgaWYgKGMuZ2V0
QXR0cmlidXRlKCd2YWx1ZXMnKSkgewogICAgICAgIHZhciBzZWxmID0gdGhpcwogICAgICAgIHZh
ciB2YWxzID0gYy5nZXRBdHRyaWJ1dGUoJ3ZhbHVlcycpCiAgICAgICAgdmFscyA9IHZhbHMuc3Bs
aXQoIjsiKS5tYXAoZnVuY3Rpb24odikgewogICAgICAgICAgdmFyIHh5ID0gdi5zcGxpdCgvWywg
XSsvKQogICAgICAgICAgaWYgKHh5Lmxlbmd0aCA+IDIpIHsKICAgICAgICAgICAgcmV0dXJuIHh5
Lm1hcChmdW5jdGlvbih4KXsgcmV0dXJuIHNlbGYucGFyc2VVbml0KHgsIGNuLCAneCcpIH0pCiAg
ICAgICAgICB9IGVsc2UgaWYgKHh5Lmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgcmV0dXJuIFsK
ICAgICAgICAgICAgICBzZWxmLnBhcnNlVW5pdCh4eVswXSwgY24sICd4JyksCiAgICAgICAgICAg
ICAgc2VsZi5wYXJzZVVuaXQoeHlbMV0sIGNuLCAneScpCiAgICAgICAgICAgIF0KICAgICAgICAg
IH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmLnBhcnNlVW5pdCh2LCBjbiwgJ3gnKQog
ICAgICAgICAgfQogICAgICAgIH0pCiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRvID09IG51
bGwpIHRvID0gZnJvbSArIGJ5CiAgICAgIH0KICAgICAgY24uYWZ0ZXIoby5hZnRlciwgZnVuY3Rp
b24oKSB7CiAgICAgICAgaWYgKG8uZmlsbCA9PSAncmVtb3ZlJykgewogICAgICAgICAgdmFyIG9y
aWcgPSBPYmplY3QuY2xvbmUodGhpc1tvLnZhcmlhYmxlXSkKICAgICAgICAgIHRoaXMuYWZ0ZXIo
by5kdXJhdGlvbiwgZnVuY3Rpb24oKXsgdGhpc1tvLnZhcmlhYmxlXSA9IG9yaWcgfSkKICAgICAg
ICB9CiAgICAgICAgaWYgKHZhbHMpIHsKICAgICAgICAgIGlmIChvLmFkZGl0aXZlKSB7CiAgICAg
ICAgICAgIHZhciBvdiA9IHRoaXNbby52YXJpYWJsZV0KICAgICAgICAgICAgdmFscyA9IHZhbHMu
bWFwKGZ1bmN0aW9uKHYpewogICAgICAgICAgICAgIHJldHVybiBPYmplY3Quc3VtKHYsIG92KQog
ICAgICAgICAgICB9KQogICAgICAgICAgfQogICAgICAgICAgdmFyIGxlbmd0aCA9IDAKICAgICAg
ICAgIHZhciBsZW5zID0gW10KICAgICAgICAgIGlmICh2YWxzWzBdIGluc3RhbmNlb2YgQXJyYXkp
IHsKICAgICAgICAgICAgZm9yICh2YXIgaT0xOyBpPHZhbHMubGVuZ3RoOyBpKyspIHsKICAgICAg
ICAgICAgICB2YXIgZGlmZiA9IE9iamVjdC5zdWIodmFsc1tpXSAtIHZhbHNbaS0xXSkKICAgICAg
ICAgICAgICB2YXIgc2wgPSBNYXRoLnNxcnQoZGlmZi5yZWR1Y2UoZnVuY3Rpb24ocywgaSkgeyBy
ZXR1cm4gcyArIGkqaSB9LCAwKSkKICAgICAgICAgICAgICBsZW5zLnB1c2goc2wpCiAgICAgICAg
ICAgICAgbGVuZ3RoICs9IHNsCiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAg
ICAgICAgIGZvciAodmFyIGk9MTsgaTx2YWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAg
dmFyIHNsID0gTWF0aC5hYnModmFsc1tpXSAtIHZhbHNbaS0xXSkKICAgICAgICAgICAgICBsZW5z
LnB1c2goc2wpCiAgICAgICAgICAgICAgbGVuZ3RoICs9IHNsCiAgICAgICAgICAgIH0KICAgICAg
ICAgIH0KICAgICAgICAgIHZhciBhbmltYXRvciA9IGZ1bmN0aW9uKHBvcykgewogICAgICAgICAg
ICBpZiAocG9zID09IDEpIHsKICAgICAgICAgICAgICB0aGlzW28udmFyaWFibGVdID0gdmFsc1t2
YWxzLmxlbmd0aC0xXQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmIChvLmNh
bGNNb2RlID09ICdwYWNlZCcpIHsKICAgICAgICAgICAgICAgIHZhciBsZW4gPSBwb3MgKiBsZW5n
dGgKICAgICAgICAgICAgICAgIHZhciBybGVuID0gMCwgaWR4LCBydAogICAgICAgICAgICAgICAg
Zm9yICh2YXIgaT0wOyBpPGxlbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgaWYg
KHJsZW4gKyBsZW5zW2ldID4gbGVuKSB7CiAgICAgICAgICAgICAgICAgICAgaWR4ID0gaQogICAg
ICAgICAgICAgICAgICAgIHJ0ID0gKGxlbiAtIHJsZW4pIC8gbGVuc1tpXQogICAgICAgICAgICAg
ICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmxlbiAr
PSBsZW5zW2ldCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgdjAgPSBpZHgK
ICAgICAgICAgICAgICAgIHZhciB2MSA9IHYwICsgMQogICAgICAgICAgICAgIH0gZWxzZSB7CiAg
ICAgICAgICAgICAgICB2YXIgaWR4ID0gcG9zICogKHZhbHMubGVuZ3RoLTEpCiAgICAgICAgICAg
ICAgICB2YXIgdjAgPSBNYXRoLmZsb29yKGlkeCkKICAgICAgICAgICAgICAgIHZhciBydCA9IGlk
eCAtIHYwCiAgICAgICAgICAgICAgICB2YXIgdjEgPSB2MCArIDEKICAgICAgICAgICAgICB9CiAg
ICAgICAgICAgICAgdGhpcy50d2VlblZhcmlhYmxlKG8udmFyaWFibGUsIHZhbHNbdjBdLCB2YWxz
W3YxXSwgcnQsIG8uY2FsY01vZGUpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAg
IHRoaXMuYW5pbWF0ZShhbmltYXRvciwgZnJvbSwgdG8sIG8uZHVyYXRpb24sICdsaW5lYXInLCB7
CiAgICAgICAgICAgIHJlcGVhdDogby5yZXBlYXQsCiAgICAgICAgICAgIGFkZGl0aXZlOiBvLmFk
ZGl0aXZlLAogICAgICAgICAgICBhY2N1bXVsYXRlOiBvLmFjY3VtdWxhdGUKICAgICAgICAgIH0p
CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChmcm9tID09IG51bGwpIHsKICAgICAgICAg
ICAgZnJvbSA9IHRoaXNbby52YXJpYWJsZV0KICAgICAgICAgICAgaWYgKGJ5ICE9IG51bGwpIHRv
ID0gZnJvbSArIGJ5CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoby5hZGRpdGl2ZSkgewogICAg
ICAgICAgICBmcm9tID0gT2JqZWN0LnN1bShmcm9tLCB0aGlzW28udmFyaWFibGVdKQogICAgICAg
ICAgICB0byA9IE9iamVjdC5zdW0odG8sIHRoaXNbby52YXJpYWJsZV0pCiAgICAgICAgICB9CiAg
ICAgICAgICB0aGlzLmFuaW1hdGUoby52YXJpYWJsZSwgZnJvbSwgdG8sIG8uZHVyYXRpb24sIG8u
Y2FsY01vZGUsIHsKICAgICAgICAgICAgcmVwZWF0OiBvLnJlcGVhdCwKICAgICAgICAgICAgYWRk
aXRpdmU6IG8uYWRkaXRpdmUsCiAgICAgICAgICAgIGFjY3VtdWxhdGU6IG8uYWNjdW11bGF0ZQog
ICAgICAgICAgfSkKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAoKICAgIHNldCA6IGZ1bmN0aW9u
KGMsIGNuKSB7CiAgICAgIHZhciB0byA9IGMuZ2V0QXR0cmlidXRlKCd0bycpCiAgICAgIHZhciBv
ID0gU1ZHUGFyc2VyLlNWR1RhZ01hcHBpbmcucGFyc2VBbmltYXRlVGFnKGMsIGNuKQogICAgICBj
bi5hZnRlcihvLmFmdGVyLCBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoby5maWxsID09ICdyZW1v
dmUnKSB7CiAgICAgICAgICB2YXIgb3JpZyA9IE9iamVjdC5jbG9uZSh0aGlzW28udmFyaWFibGVd
KQogICAgICAgICAgdGhpcy5hZnRlcihvLmR1cmF0aW9uLCBmdW5jdGlvbigpeyB0aGlzW28udmFy
aWFibGVdID0gb3JpZyB9KQogICAgICAgIH0KICAgICAgICB0aGlzW28udmFyaWFibGVdID0gdG8K
ICAgICAgfSkKICAgIH0sCgogICAgYW5pbWF0ZU1vdGlvbiA6IGZ1bmN0aW9uKGMsY24pIHsKICAg
ICAgdmFyIHBhdGgKICAgICAgaWYgKGMuZ2V0QXR0cmlidXRlKCdwYXRoJykpIHsKICAgICAgICBw
YXRoID0gbmV3IFBhdGgoYy5nZXRBdHRyaWJ1dGUoJ3BhdGgnKSkKICAgICAgfSBlbHNlIGlmIChj
LmdldEF0dHJpYnV0ZSgndmFsdWVzJykpIHsKICAgICAgICB2YXIgdmFscyA9IGMuZ2V0QXR0cmli
dXRlKCd2YWx1ZXMnKQogICAgICAgIHBhdGggPSBuZXcgUGF0aCgiTSIgKyB2YWxzLnNwbGl0KCI7
Iikuam9pbigiTCIpKQogICAgICB9IGVsc2UgaWYgKGMuZ2V0QXR0cmlidXRlKCdmcm9tJykgfHwg
Yy5nZXRBdHRyaWJ1dGUoJ3RvJykgfHwgYy5nZXRBdHRyaWJ1dGUoJ2J5JykpIHsKICAgICAgICB2
YXIgZnJvbSA9IGMuZ2V0QXR0cmlidXRlKCdmcm9tJykKICAgICAgICB2YXIgdG8gPSBjLmdldEF0
dHJpYnV0ZSgndG8nKQogICAgICAgIHZhciBieSA9IGMuZ2V0QXR0cmlidXRlKCdieScpCiAgICAg
ICAgaWYgKCFmcm9tKSBmcm9tID0gIjAsMCIKICAgICAgICBpZiAoIXRvKSB0byA9ICJsIiArIGJ5
CiAgICAgICAgZWxzZSB0byA9ICJMIiArIHRvCiAgICAgICAgcGF0aCA9IG5ldyBQYXRoKCJNIiAr
IGZyb20gKyB0bykKICAgICAgfQogICAgICB2YXIgcCA9IG5ldyBDYW52YXNOb2RlKCkKICAgICAg
cC5fX21vdGlvblBhdGggPSBwYXRoCiAgICAgIHZhciByb3RhdGUgPSBjLmdldEF0dHJpYnV0ZSgn
cm90YXRlJykKICAgICAgdmFyIG8gPSBTVkdQYXJzZXIuU1ZHVGFnTWFwcGluZy5wYXJzZUFuaW1h
dGVUYWcoYywgY24pCiAgICAgIGNuLmFmdGVyKG8uYWZ0ZXIsIGZ1bmN0aW9uKCkgewogICAgICAg
IGlmIChvLmZpbGwgPT0gJ3JlbW92ZScpIHsKICAgICAgICAgIHZhciBveCA9IHRoaXMueCwgb3kg
PSB0aGlzLnkKICAgICAgICAgIHRoaXMuYWZ0ZXIoby5kdXJhdGlvbiwgZnVuY3Rpb24oKXsgdGhp
cy54ID0gb3g7IHRoaXMueSA9IG95fSkKICAgICAgICB9CiAgICAgICAgdmFyIG1vdGlvbiA9IGZ1
bmN0aW9uKHBvcykgewogICAgICAgICAgdmFyIHBhID0gcC5fX21vdGlvblBhdGgucG9pbnRBbmds
ZUF0KHBvcywgewogICAgICAgICAgICBkaXNjcmV0ZTogby5jYWxjTW9kZSA9PSAnZGlzY3JldGUn
LAogICAgICAgICAgICBsaW5lYXIgOiBvLmNhbGNNb2RlID09ICdsaW5lYXInCiAgICAgICAgICB9
KQogICAgICAgICAgdGhpcy54ID0gcGEucG9pbnRbMF0KICAgICAgICAgIHRoaXMueSA9IHBhLnBv
aW50WzFdCiAgICAgICAgICBpZiAocm90YXRlID09ICdhdXRvJykgewogICAgICAgICAgICB0aGlz
LnJvdGF0aW9uID0gcGEuYW5nbGUKICAgICAgICAgIH0gZWxzZSBpZiAocm90YXRlID09ICdhdXRv
LXJldmVyc2UnKSB7CiAgICAgICAgICAgIHRoaXMucm90YXRpb24gPSBwYS5hbmdsZSArIE1hdGgu
UEkKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5hbmltYXRlKG1vdGlvbiwgMCwg
MSwgby5kdXJhdGlvbiwgJ2xpbmVhcicsIHsKICAgICAgICAgIHJlcGVhdDogby5yZXBlYXQsCiAg
ICAgICAgICBhZGRpdGl2ZTogby5hZGRpdGl2ZSwKICAgICAgICAgIGFjY3VtdWxhdGU6IG8uYWNj
dW11bGF0ZQogICAgICAgIH0pCiAgICAgIH0pCiAgICAgIHJldHVybiBwCiAgICB9LAoKICAgIG1w
YXRoIDogZnVuY3Rpb24oYyxjbiwgZGVmcykgewogICAgICB2YXIgaHJlZiA9IGMuZ2V0QXR0cmli
dXRlKCd4bGluazpocmVmJykKICAgICAgaHJlZiA9IGhyZWYucmVwbGFjZSgvXiMvLCcnKQogICAg
ICB0aGlzLmdldERlZihkZWZzLCBocmVmLCBmdW5jdGlvbihvYmopIHsKICAgICAgICBjbi5fX21v
dGlvblBhdGggPSBvYmoKICAgICAgfSkKICAgIH0sCgogICAgYW5pbWF0ZUNvbG9yIDogZnVuY3Rp
b24oYywgY24sIGRlZnMpIHsKICAgICAgdmFyIGZyb20gPSBjLmdldEF0dHJpYnV0ZSgnZnJvbScp
CiAgICAgIHZhciB0byA9IGMuZ2V0QXR0cmlidXRlKCd0bycpCiAgICAgIGZyb20gPSBTVkdQYXJz
ZXIuU1ZHTWFwcGluZy5fX3BhcnNlU3R5bGUoZnJvbSwgbnVsbCwgZGVmcykKICAgICAgdG8gPSBT
VkdQYXJzZXIuU1ZHTWFwcGluZy5fX3BhcnNlU3R5bGUodG8sIG51bGwsIGRlZnMpCiAgICAgIHZh
ciBvID0gU1ZHUGFyc2VyLlNWR1RhZ01hcHBpbmcucGFyc2VBbmltYXRlVGFnKGMsIGNuKQogICAg
ICBjbi5hZnRlcihvLmFmdGVyLCBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoby5maWxsID09ICdy
ZW1vdmUnKSB7CiAgICAgICAgICB2YXIgb3JpZyA9IE9iamVjdC5jbG9uZSh0aGlzW28udmFyaWFi
bGVdKQogICAgICAgICAgdGhpcy5hZnRlcihvLmR1cmF0aW9uLCBmdW5jdGlvbigpeyB0aGlzW28u
dmFyaWFibGVdID0gb3JpZyB9KQogICAgICAgIH0KICAgICAgICB0aGlzLmFuaW1hdGUoby52YXJp
YWJsZSwgZnJvbSwgdG8sIG8uZHVyYXRpb24sICdsaW5lYXInLCB7CiAgICAgICAgICByZXBlYXQ6
IG8ucmVwZWF0LAogICAgICAgICAgYWRkaXRpdmU6IG8uYWRkaXRpdmUsCiAgICAgICAgICBhY2N1
bXVsYXRlOiBvLmFjY3VtdWxhdGUKICAgICAgICB9KQogICAgICB9KQogICAgfSwKCiAgICBhbmlt
YXRlVHJhbnNmb3JtIDogZnVuY3Rpb24oYywgY24pIHsKICAgICAgdmFyIGZyb20gPSBjLmdldEF0
dHJpYnV0ZSgnZnJvbScpCiAgICAgIHZhciB0byA9IGMuZ2V0QXR0cmlidXRlKCd0bycpCiAgICAg
IHZhciBieSA9IGMuZ2V0QXR0cmlidXRlKCdieScpCiAgICAgIHZhciBvID0gU1ZHUGFyc2VyLlNW
R1RhZ01hcHBpbmcucGFyc2VBbmltYXRlVGFnKGMsIGNuKQogICAgICBpZiAoZnJvbSkgZnJvbSA9
IGZyb20uc3BsaXQoL1sgLF0rLykubWFwKHBhcnNlRmxvYXQpCiAgICAgIGlmICh0bykgdG8gPSB0
by5zcGxpdCgvWyAsXSsvKS5tYXAocGFyc2VGbG9hdCkKICAgICAgaWYgKGJ5KSBieSA9IGJ5LnNw
bGl0KC9bICxdKy8pLm1hcChwYXJzZUZsb2F0KQogICAgICBvLnZhcmlhYmxlID0gYy5nZXRBdHRy
aWJ1dGUoJ3R5cGUnKQogICAgICBpZiAoby52YXJpYWJsZSA9PSAncm90YXRlJykgewogICAgICAg
IG8udmFyaWFibGUgPSAncm90YXRpb24nCiAgICAgICAgaWYgKGZyb20pIGZyb20gPSBmcm9tLm1h
cChmdW5jdGlvbih2KSB7IHJldHVybiB2ICogTWF0aC5QSS8xODAgfSkKICAgICAgICBpZiAodG8p
IHRvID0gdG8ubWFwKGZ1bmN0aW9uKHYpIHsgcmV0dXJuIHYgKiBNYXRoLlBJLzE4MCB9KQogICAg
ICAgIGlmIChieSkgYnkgPSBieS5tYXAoZnVuY3Rpb24odikgeyByZXR1cm4gdiAqIE1hdGguUEkv
MTgwIH0pCiAgICAgIH0gZWxzZSBpZiAoby52YXJpYWJsZS5tYXRjaCgvXnNrZXcvKSkgewogICAg
ICAgIGlmIChmcm9tKSBmcm9tID0gZnJvbS5tYXAoZnVuY3Rpb24odikgeyByZXR1cm4gdiAqIE1h
dGguUEkvMTgwIH0pCiAgICAgICAgaWYgKHRvKSB0byA9IHRvLm1hcChmdW5jdGlvbih2KSB7IHJl
dHVybiB2ICogTWF0aC5QSS8xODAgfSkKICAgICAgICBpZiAoYnkpIGJ5ID0gYnkubWFwKGZ1bmN0
aW9uKHYpIHsgcmV0dXJuIHYgKiBNYXRoLlBJLzE4MCB9KQogICAgICB9CiAgICAgIGlmICh0byA9
PSBudWxsKSB0byA9IE9iamVjdC5zdW0oZnJvbSwgYnkpCiAgICAgIGNuLmFmdGVyKG8uYWZ0ZXIs
IGZ1bmN0aW9uKCkgewogICAgICAgIGlmIChvLnZhcmlhYmxlID09ICd0cmFuc2xhdGUnKSB7CiAg
ICAgICAgICBpZiAoZnJvbSA9PSBudWxsKSB7CiAgICAgICAgICAgIGZyb20gPSBbdGhpcy54LCB0
aGlzLnldCiAgICAgICAgICAgIGlmIChieSAhPSBudWxsKSB0byA9IE9iamVjdC5zdW0oZnJvbSwg
YnkpCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoby5maWxsID09ICdyZW1vdmUnKSB7CiAgICAg
ICAgICAgIHZhciBveCA9IHRoaXMueAogICAgICAgICAgICB2YXIgb3kgPSB0aGlzLnkKICAgICAg
ICAgICAgdGhpcy5hZnRlcihvLmR1cmF0aW9uLCBmdW5jdGlvbigpeyB0aGlzLnggPSBveDsgdGhp
cy55ID0gb3kgfSkKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuYW5pbWF0ZSgneCcsIGZyb21b
MF0sIHRvWzBdLCBvLmR1cmF0aW9uLCAnbGluZWFyJywgewogICAgICAgICAgICByZXBlYXQ6IG8u
cmVwZWF0LAogICAgICAgICAgICBhZGRpdGl2ZTogby5hZGRpdGl2ZSwKICAgICAgICAgICAgYWNj
dW11bGF0ZTogby5hY2N1bXVsYXRlCiAgICAgICAgICB9KQogICAgICAgICAgaWYgKGZyb21bMV0g
IT0gbnVsbCkgewogICAgICAgICAgICB0aGlzLmFuaW1hdGUoJ3knLCBmcm9tWzFdLCB0b1sxXSwg
by5kdXJhdGlvbiwgJ2xpbmVhcicsIHsKICAgICAgICAgICAgICByZXBlYXQ6IG8ucmVwZWF0LAog
ICAgICAgICAgICAgIGFkZGl0aXZlOiBvLmFkZGl0aXZlLAogICAgICAgICAgICAgIGFjY3VtdWxh
dGU6IG8uYWNjdW11bGF0ZQogICAgICAgICAgICB9KQogICAgICAgICAgfQogICAgICAgIH0gZWxz
ZSB7CiAgICAgICAgICBpZiAoZnJvbSkgewogICAgICAgICAgICBpZiAoZnJvbS5sZW5ndGggPT0g
MSkgZnJvbSA9IGZyb21bMF0KICAgICAgICAgIH0KICAgICAgICAgIGlmICh0bykgewogICAgICAg
ICAgICBpZiAodG8ubGVuZ3RoID09IDEpIHRvID0gdG9bMF0KICAgICAgICAgIH0KICAgICAgICAg
IGlmIChieSkgewogICAgICAgICAgICBpZiAoYnkubGVuZ3RoID09IDEpIGJ5ID0gYnlbMF0KICAg
ICAgICAgIH0KICAgICAgICAgIGlmIChmcm9tID09IG51bGwpIHsKICAgICAgICAgICAgZnJvbSA9
IHRoaXNbby52YXJpYWJsZV0KICAgICAgICAgICAgaWYgKGJ5ICE9IG51bGwpIHRvID0gT2JqZWN0
LnN1bShmcm9tLCBieSkKICAgICAgICAgIH0KICAgICAgICAgIGlmIChvLnZhcmlhYmxlID09ICdz
Y2FsZScgJiYgby5hZGRpdGl2ZSkgewogICAgICAgICAgICAvLyArMSBpbiBTTUlMJ3MgYWRkaXRp
dmUgc2NhbGUgbWVhbnMgKjEsIHdlbGNvbWUgdG8gYnJva2VudmlsbGUKICAgICAgICAgICAgby5h
ZGRpdGl2ZSA9IGZhbHNlCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoby5maWxsID09ICdyZW1v
dmUnKSB7CiAgICAgICAgICAgIHZhciBvcmlnID0gT2JqZWN0LmNsb25lKHRoaXNbby52YXJpYWJs
ZV0pCiAgICAgICAgICAgIHRoaXMuYWZ0ZXIoby5kdXJhdGlvbiwgZnVuY3Rpb24oKXsgdGhpc1tv
LnZhcmlhYmxlXSA9IG9yaWcgfSkKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuYW5pbWF0ZShv
LnZhcmlhYmxlLCBmcm9tLCB0bywgby5kdXJhdGlvbiwgJ2xpbmVhcicsIHsKICAgICAgICAgICAg
cmVwZWF0OiBvLnJlcGVhdCwKICAgICAgICAgICAgYWRkaXRpdmU6IG8uYWRkaXRpdmUsCiAgICAg
ICAgICAgIGFjY3VtdWxhdGU6IG8uYWNjdW11bGF0ZQogICAgICAgICAgfSkKICAgICAgICB9CiAg
ICAgIH0pCiAgICB9LAoKICAgIGEgOiBmdW5jdGlvbihjLCBjbikgewogICAgICB2YXIgaHJlZiA9
IGMuZ2V0QXR0cmlidXRlKCd4bGluazpocmVmJykgfHwKICAgICAgICAgICAgICAgICBjLmdldEF0
dHJpYnV0ZSgnaHJlZicpCiAgICAgIHZhciB0YXJnZXQgPSBjLmdldEF0dHJpYnV0ZSgndGFyZ2V0
JykKICAgICAgdmFyIHAgPSBuZXcgTGlua05vZGUoaHJlZiwgdGFyZ2V0KQogICAgICByZXR1cm4g
cAogICAgfSwKCiAgICB1c2UgOiBmdW5jdGlvbihjLCBjbiwgZGVmcywgc3R5bGUpIHsKICAgICAg
dmFyIGlkID0gYy5nZXRBdHRyaWJ1dGUoJ3hsaW5rOmhyZWYnKSB8fAogICAgICAgICAgICAgICAg
Yy5nZXRBdHRyaWJ1dGUoJ2hyZWYnKQogICAgICB2YXIgcCA9IG5ldyBDYW52YXNOb2RlKCkKICAg
ICAgaWYgKGlkKSB7CiAgICAgICAgaWQgPSBpZC5yZXBsYWNlKC9eIy8sJycpCiAgICAgICAgdGhp
cy5nZXREZWYoZGVmcywgaWQsIGZ1bmN0aW9uKG9iaikgewogICAgICAgICAgdmFyIG9jID0gb2Jq
LmNsb25lKCkKICAgICAgICAgIHZhciBwYXIgPSBwLnBhcmVudAogICAgICAgICAgaWYgKHBhcikg
ewogICAgICAgICAgICBpZiAocC5zdHJva2UpIG9jLnN0cm9rZSA9IHAuc3Ryb2tlCiAgICAgICAg
ICAgIGlmIChwLmZpbGwpIG9jLmZpbGwgPSBwLmZpbGwKICAgICAgICAgICAgcC5hcHBlbmQob2Mp
CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwID0gb2MKICAgICAgICAgIH0KICAgICAg
ICB9KQogICAgICB9CiAgICAgIHJldHVybiBwCiAgICB9LAoKICAgIGltYWdlIDogZnVuY3Rpb24o
YywgY24sIGRlZnMsIHN0eWxlKSB7CiAgICAgIHZhciBzcmMgPSBjLmdldEF0dHJpYnV0ZSgneGxp
bms6aHJlZicpIHx8CiAgICAgICAgICAgICAgICBjLmdldEF0dHJpYnV0ZSgnaHJlZicpCiAgICAg
IGlmIChzcmMgJiYgc3JjLnNlYXJjaCgvXlthLXpdKzovaSkgIT0gMCkgewogICAgICAgIHNyYyA9
IGNuLnJvb3QuZmlsZW5hbWUuc3BsaXQoIi8iKS5zbGljZSgwLC0xKS5qb2luKCIvIikgKyAiLyIg
KyBzcmMKICAgICAgfQogICAgICB2YXIgcCA9IG5ldyBJbWFnZU5vZGUoc3JjID8gT2JqZWN0Lmxv
YWRJbWFnZShzcmMpIDogbnVsbCkKICAgICAgcC5maWxsID0gJ25vbmUnCiAgICAgIHAuZFggPSB0
aGlzLnBhcnNlVW5pdChjLmdldEF0dHJpYnV0ZSgneCcpLCBjbiwgJ3gnKSB8fCAwCiAgICAgIHAu
ZFkgPSB0aGlzLnBhcnNlVW5pdChjLmdldEF0dHJpYnV0ZSgneScpLCBjbiwgJ3knKSB8fCAwCiAg
ICAgIHAuc3JjV2lkdGggPSB0aGlzLnBhcnNlVW5pdChjLmdldEF0dHJpYnV0ZSgnd2lkdGgnKSwg
Y24sICd4JykKICAgICAgcC5zcmNIZWlnaHQgPSB0aGlzLnBhcnNlVW5pdChjLmdldEF0dHJpYnV0
ZSgnaGVpZ2h0JyksIGNuLCAneScpCiAgICAgIHJldHVybiBwCiAgICB9LAoKICAgIHBhdGggOiBm
dW5jdGlvbihjKSB7CiAgICAgIHJldHVybiBuZXcgUGF0aChjLmdldEF0dHJpYnV0ZSgiZCIpKQog
ICAgfSwKCiAgICBwb2x5Z29uIDogZnVuY3Rpb24oYykgewogICAgICByZXR1cm4gbmV3IFBvbHln
b24oYy5nZXRBdHRyaWJ1dGUoInBvaW50cyIpLnRvU3RyaW5nKCkuc3RyaXAoKQogICAgICAgICAg
ICAgICAgICAgICAgICAgIC5zcGxpdCgvW1xzLF0rLykubWFwKHBhcnNlRmxvYXQpKQogICAgfSwK
CiAgICBwb2x5bGluZSA6IGZ1bmN0aW9uKGMpIHsKICAgICAgcmV0dXJuIG5ldyBQb2x5Z29uKGMu
Z2V0QXR0cmlidXRlKCJwb2ludHMiKS50b1N0cmluZygpLnN0cmlwKCkKICAgICAgICAgICAgICAg
ICAgICAgICAgICAuc3BsaXQoL1tccyxdKy8pLm1hcChwYXJzZUZsb2F0KSwge2Nsb3NlUGF0aDpm
YWxzZX0pCiAgICB9LAoKICAgIHJlY3QgOiBmdW5jdGlvbihjLCBjbikgewogICAgICB2YXIgcCA9
IG5ldyBSZWN0YW5nbGUoCiAgICAgICAgdGhpcy5wYXJzZVVuaXQoYy5nZXRBdHRyaWJ1dGUoJ3dp
ZHRoJyksIGNuLCAneCcpLAogICAgICAgIHRoaXMucGFyc2VVbml0KGMuZ2V0QXR0cmlidXRlKCdo
ZWlnaHQnKSwgY24sICd5JykKICAgICAgKQogICAgICBwLmN4ID0gdGhpcy5wYXJzZVVuaXQoYy5n
ZXRBdHRyaWJ1dGUoJ3gnKSwgY24sICd4JykgfHwgMAogICAgICBwLmN5ID0gdGhpcy5wYXJzZVVu
aXQoYy5nZXRBdHRyaWJ1dGUoJ3knKSwgY24sICd5JykgfHwgMAogICAgICBwLnJ4ID0gdGhpcy5w
YXJzZVVuaXQoYy5nZXRBdHRyaWJ1dGUoJ3J4JyksIGNuLCAneCcpIHx8IDAKICAgICAgcC5yeSA9
IHRoaXMucGFyc2VVbml0KGMuZ2V0QXR0cmlidXRlKCdyeScpLCBjbiwgJ3knKSB8fCAwCiAgICAg
IHJldHVybiBwCiAgICB9LAoKICAgIGxpbmUgOiBmdW5jdGlvbihjLCBjbikgewogICAgICB2YXIg
eDEgPSB0aGlzLnBhcnNlVW5pdChjLmdldEF0dHJpYnV0ZSgneDEnKSwgY24sICd4JykgfHwgMAog
ICAgICB2YXIgeTEgPSB0aGlzLnBhcnNlVW5pdChjLmdldEF0dHJpYnV0ZSgneTEnKSwgY24sICd5
JykgfHwgMAogICAgICB2YXIgeDIgPSB0aGlzLnBhcnNlVW5pdChjLmdldEF0dHJpYnV0ZSgneDIn
KSwgY24sICd4JykgfHwgMAogICAgICB2YXIgeTIgPSB0aGlzLnBhcnNlVW5pdChjLmdldEF0dHJp
YnV0ZSgneTInKSwgY24sICd5JykgfHwgMAogICAgICB2YXIgcCA9IG5ldyBMaW5lKHgxLHkxLCB4
Mix5MikKICAgICAgcmV0dXJuIHAKICAgIH0sCgogICAgY2lyY2xlIDogZnVuY3Rpb24oYywgY24p
IHsKICAgICAgdmFyIHAgPSBuZXcgQ2lyY2xlKHRoaXMucGFyc2VVbml0KGMuZ2V0QXR0cmlidXRl
KCdyJyksIGNuKSB8fCAwKQogICAgICBwLmN4ID0gdGhpcy5wYXJzZVVuaXQoYy5nZXRBdHRyaWJ1
dGUoJ2N4JyksIGNuLCAneCcpIHx8IDAKICAgICAgcC5jeSA9IHRoaXMucGFyc2VVbml0KGMuZ2V0
QXR0cmlidXRlKCdjeScpLCBjbiwgJ3knKSB8fCAwCiAgICAgIHJldHVybiBwCiAgICB9LAoKICAg
IGVsbGlwc2UgOiBmdW5jdGlvbihjLCBjbikgewogICAgICB2YXIgcCA9IG5ldyBFbGxpcHNlKAog
ICAgICAgIHRoaXMucGFyc2VVbml0KGMuZ2V0QXR0cmlidXRlKCdyeCcpLCBjbiwgJ3gnKSB8fCAw
LAogICAgICAgIHRoaXMucGFyc2VVbml0KGMuZ2V0QXR0cmlidXRlKCdyeScpLCBjbiwgJ3knKSB8
fCAwCiAgICAgICkKICAgICAgcC5jeCA9IHRoaXMucGFyc2VVbml0KGMuZ2V0QXR0cmlidXRlKCdj
eCcpLCBjbiwgJ3gnKSB8fCAwCiAgICAgIHAuY3kgPSB0aGlzLnBhcnNlVW5pdChjLmdldEF0dHJp
YnV0ZSgnY3knKSwgY24sICd5JykgfHwgMAogICAgICByZXR1cm4gcAogICAgfSwKCiAgICB0ZXh0
IDogZnVuY3Rpb24oYywgY24pIHsKICAgICAgaWYgKGZhbHNlKSB7CiAgICAgICAgdmFyIHAgPSBu
ZXcgVGV4dE5vZGUoYy50ZXh0Q29udGVudC5zdHJpcCgpKQogICAgICAgIHAuc2V0QXNQYXRoKHRy
dWUpCiAgICAgICAgcC5jeCA9IHRoaXMucGFyc2VVbml0KGMuZ2V0QXR0cmlidXRlKCd4JyksY24s
ICd4JykgfHwgMAogICAgICAgIHAuY3kgPSB0aGlzLnBhcnNlVW5pdChjLmdldEF0dHJpYnV0ZSgn
eScpLGNuLCAneScpIHx8IDAKICAgICAgICByZXR1cm4gcAogICAgICB9IGVsc2UgewogICAgICAg
IHZhciBlID0gRSgnZGl2JywgYy50ZXh0Q29udGVudC5zdHJpcCgpKQogICAgICAgIGUuc3R5bGUu
bWFyZ2luVG9wID0gJy0xZW0nCiAgICAgICAgZS5zdHlsZS53aGl0ZVNwYWNlID0gJ25vd3JhcCcK
ICAgICAgICB2YXIgcCA9IG5ldyBFbGVtZW50Tm9kZShlKQogICAgICAgIHAueE9mZnNldCA9IHRo
aXMucGFyc2VVbml0KGMuZ2V0QXR0cmlidXRlKCd4JyksY24sICd4JykgfHwgMAogICAgICAgIHAu
eU9mZnNldCA9IHRoaXMucGFyc2VVbml0KGMuZ2V0QXR0cmlidXRlKCd5JyksY24sICd5JykgfHwg
MAogICAgICAgIHJldHVybiBwCiAgICAgIH0KICAgIH0sCgogICAgc3R5bGUgOiBmdW5jdGlvbihj
LCBjbiwgZGVmcywgc3R5bGUpIHsKICAgICAgdGhpcy5wYXJzZVN0eWxlKGMsIHN0eWxlKQogICAg
fSwKCiAgICBkZWZzIDogZnVuY3Rpb24oYywgY24sIGRlZnMsIHN0eWxlKSB7CiAgICAgIHJldHVy
biBuZXcgQ2FudmFzTm9kZSh7dmlzaWJsZTogZmFsc2V9KQogICAgfSwKCiAgICBsaW5lYXJHcmFk
aWVudCA6IGZ1bmN0aW9uKGMsIGNuLGRlZnMsc3R5bGUpIHsKICAgICAgdmFyIGcgPSBuZXcgR3Jh
ZGllbnQoe3R5cGU6J2xpbmVhcid9KQogICAgICBnLmNvbG9yID0gY24uY29sb3IKICAgICAgaWYg
KGMuZ2V0QXR0cmlidXRlKCdjb2xvcicpKSB7CiAgICAgICAgU1ZHUGFyc2VyLlNWR01hcHBpbmcu
Y29sb3IoZywgYy5nZXRBdHRyaWJ1dGUoJ2NvbG9yJyksIGRlZnMsIHN0eWxlKQogICAgICB9CiAg
ICAgIGcuc3ZnTm9kZSA9IGMKICAgICAgdmFyIHgxID0gYy5nZXRBdHRyaWJ1dGUoJ3gxJykKICAg
ICAgdmFyIHkxID0gYy5nZXRBdHRyaWJ1dGUoJ3kxJykKICAgICAgdmFyIHgyID0gYy5nZXRBdHRy
aWJ1dGUoJ3gyJykKICAgICAgdmFyIHkyID0gYy5nZXRBdHRyaWJ1dGUoJ3kyJykKICAgICAgdmFy
IHRyYW5zZm9ybSA9IGMuZ2V0QXR0cmlidXRlKCdncmFkaWVudFRyYW5zZm9ybScpCiAgICAgIGcu
dW5pdHMgPSBjLmdldEF0dHJpYnV0ZSgnZ3JhZGllbnRVbml0cycpIHx8ICJvYmplY3RCb3VuZGlu
Z0JveCIKICAgICAgaWYgKHgxKSBnLnN0YXJ0WCA9IHBhcnNlRmxvYXQoeDEpICogKHgxLmNoYXJB
dCh4MS5sZW5ndGgtMSkgPT0gJyUnID8gMC4wMSA6IDEpCiAgICAgIGlmICh5MSkgZy5zdGFydFkg
PSBwYXJzZUZsb2F0KHkxKSAqICh5MS5jaGFyQXQoeTEubGVuZ3RoLTEpID09ICclJyA/IDAuMDEg
OiAxKQogICAgICBpZiAoeDIpIGcuZW5kWCA9IHBhcnNlRmxvYXQoeDIpICogKHgyLmNoYXJBdCh4
Mi5sZW5ndGgtMSkgPT0gJyUnID8gMC4wMSA6IDEpCiAgICAgIGlmICh5MikgZy5lbmRZID0gcGFy
c2VGbG9hdCh5MikgKiAoeTIuY2hhckF0KHkyLmxlbmd0aC0xKSA9PSAnJScgPyAwLjAxIDogMSkK
ICAgICAgaWYgKHRyYW5zZm9ybSkgdGhpcy5hcHBseVNWR1RyYW5zZm9ybShnLCB0cmFuc2Zvcm0s
IGRlZnMsIHN0eWxlKQogICAgICB0aGlzLnBhcnNlU3RvcHMoZywgYywgZGVmcywgc3R5bGUpCiAg
ICAgIHJldHVybiBnCiAgICB9LAoKICAgIHJhZGlhbEdyYWRpZW50IDogZnVuY3Rpb24oYywgY24s
IGRlZnMsIHN0eWxlKSB7CiAgICAgIHZhciBnID0gbmV3IEdyYWRpZW50KHt0eXBlOidyYWRpYWwn
fSkKICAgICAgZy5jb2xvciA9IGNuLmNvbG9yCiAgICAgIGlmIChjLmdldEF0dHJpYnV0ZSgnY29s
b3InKSkgewogICAgICAgIFNWR1BhcnNlci5TVkdNYXBwaW5nLmNvbG9yKGcsIGMuZ2V0QXR0cmli
dXRlKCdjb2xvcicpLCBkZWZzLCBzdHlsZSkKICAgICAgfQogICAgICBnLnN2Z05vZGUgPSBjCiAg
ICAgIHZhciByID0gYy5nZXRBdHRyaWJ1dGUoJ3InKQogICAgICB2YXIgZnggPSBjLmdldEF0dHJp
YnV0ZSgnZngnKQogICAgICB2YXIgZnkgPSBjLmdldEF0dHJpYnV0ZSgnZnknKQogICAgICB2YXIg
Y3ggPSBjLmdldEF0dHJpYnV0ZSgnY3gnKQogICAgICB2YXIgY3kgPSBjLmdldEF0dHJpYnV0ZSgn
Y3knKQogICAgICB2YXIgdHJhbnNmb3JtID0gYy5nZXRBdHRyaWJ1dGUoJ2dyYWRpZW50VHJhbnNm
b3JtJykKICAgICAgZy51bml0cyA9IGMuZ2V0QXR0cmlidXRlKCdncmFkaWVudFVuaXRzJykgfHwg
Im9iamVjdEJvdW5kaW5nQm94IgogICAgICBpZiAocikgZy5lbmRSYWRpdXMgPSBwYXJzZUZsb2F0
KHIpICogKHIuY2hhckF0KHIubGVuZ3RoLTEpID09ICclJyA/IDAuMDEgOiAxKQogICAgICBpZiAo
ZngpIGcuc3RhcnRYID0gcGFyc2VGbG9hdChmeCkgKiAoZnguY2hhckF0KGZ4Lmxlbmd0aC0xKSA9
PSAnJScgPyAwLjAxIDogMSkKICAgICAgaWYgKGZ5KSBnLnN0YXJ0WSA9IHBhcnNlRmxvYXQoZnkp
ICogKGZ5LmNoYXJBdChmeS5sZW5ndGgtMSkgPT0gJyUnID8gMC4wMSA6IDEpCiAgICAgIGlmIChj
eCkgZy5lbmRYID0gcGFyc2VGbG9hdChjeCkgKiAoY3guY2hhckF0KGN4Lmxlbmd0aC0xKSA9PSAn
JScgPyAwLjAxIDogMSkKICAgICAgaWYgKGN5KSBnLmVuZFkgPSBwYXJzZUZsb2F0KGN5KSAqIChj
eS5jaGFyQXQoY3kubGVuZ3RoLTEpID09ICclJyA/IDAuMDEgOiAxKQogICAgICBpZiAodHJhbnNm
b3JtKSB0aGlzLmFwcGx5U1ZHVHJhbnNmb3JtKGcsIHRyYW5zZm9ybSwgZGVmcywgc3R5bGUpCiAg
ICAgIHRoaXMucGFyc2VTdG9wcyhnLCBjLCBkZWZzLCBzdHlsZSkKICAgICAgcmV0dXJuIGcKICAg
IH0KICB9LAoKICBwYXJzZUNoaWxkcmVuIDogZnVuY3Rpb24obm9kZSwgY2FudmFzTm9kZSwgZGVm
cywgc3R5bGUpIHsKICAgIHZhciBjaGlsZE5vZGVzID0gW10KICAgIHZhciBjbiA9IGNhbnZhc05v
ZGUKICAgIGZvciAodmFyIGk9MDsgaTxub2RlLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAg
ICAgdmFyIGMgPSBub2RlLmNoaWxkTm9kZXNbaV0KICAgICAgdmFyIHAgPSBmYWxzZSAvLyBhcmdo
LCByZW1lbWJlciB0byBpbml0aWFsaXplIHZhcnMgaW5zaWRlIGxvb3BzCiAgICAgIGlmIChjLmNo
aWxkTm9kZXMpIHsKICAgICAgICBpZiAoYy50YWdOYW1lKSB7CiAgICAgICAgICBpZiAodGhpcy5T
VkdUYWdNYXBwaW5nW2MudGFnTmFtZV0pIHsKICAgICAgICAgICAgcCA9IHRoaXMuU1ZHVGFnTWFw
cGluZ1tjLnRhZ05hbWVdLmNhbGwoCiAgICAgICAgICAgICAgICAgIHRoaXMsIGMsIGNhbnZhc05v
ZGUsIGRlZnMsIHN0eWxlKQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcCA9IG5ldyBD
YW52YXNOb2RlKCkKICAgICAgICAgIH0KICAgICAgICAgIGlmIChwKSB7CiAgICAgICAgICAgIHAu
cm9vdCA9IGNhbnZhc05vZGUucm9vdAogICAgICAgICAgICBwLmZvbnRTaXplID0gY24uZm9udFNp
emUKICAgICAgICAgICAgcC5zdHJva2VXaWR0aCA9IGNuLnN0cm9rZVdpZHRoCiAgICAgICAgICAg
IGlmIChjLmF0dHJpYnV0ZXMpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBqPTA7IGo8Yy5hdHRy
aWJ1dGVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICB2YXIgYXR0ciA9IGMuYXR0cmli
dXRlc1tqXQogICAgICAgICAgICAgICAgaWYgKHRoaXMuU1ZHTWFwcGluZ1thdHRyLm5vZGVOYW1l
XSkKICAgICAgICAgICAgICAgICAgdGhpcy5TVkdNYXBwaW5nW2F0dHIubm9kZU5hbWVdKHAsIGF0
dHIubm9kZVZhbHVlLCBkZWZzLCBzdHlsZSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K
ICAgICAgICAgICAgaWYgKHAuaWQpIHsKICAgICAgICAgICAgICB0aGlzLnNldERlZihkZWZzLCBw
LmlkLCBwKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHAudGFnTmFtZSA9IGMudGFnTmFtZQog
ICAgICAgICAgICB0aGlzLmFwcGx5U1ZHVHJhbnNmb3JtKHAsIGMuZ2V0QXR0cmlidXRlKCJ0cmFu
c2Zvcm0iKSwgZGVmcywgc3R5bGUpCiAgICAgICAgICAgIHRoaXMuYXBwbHlTVkdTdHlsZShwLCBj
LmdldEF0dHJpYnV0ZSgic3R5bGUiKSwgZGVmcywgc3R5bGUpCiAgICAgICAgICAgIGlmIChwLnRh
Z05hbWUgJiYgc3R5bGUudGFnc1twLnRhZ05hbWVdKQogICAgICAgICAgICAgIHRoaXMuYXBwbHlT
VkdTdHlsZShwLCBzdHlsZS50YWdzW3AudGFnTmFtZV0sIGRlZnMsIHN0eWxlKQogICAgICAgICAg
ICBpZiAocC5jbGFzc05hbWUgJiYgc3R5bGUuY2xhc3Nlc1twLmNsYXNzTmFtZV0pCiAgICAgICAg
ICAgICAgdGhpcy5hcHBseVNWR1N0eWxlKHAsIHN0eWxlLmNsYXNzZXNbcC5jbGFzc05hbWVdLCBk
ZWZzLCBzdHlsZSkKICAgICAgICAgICAgaWYgKHAuaWQgJiYgc3R5bGUuaWRzW3AuaWRdKQogICAg
ICAgICAgICAgIHRoaXMuYXBwbHlTVkdTdHlsZShwLCBzdHlsZS5pZHNbcC5pZF0sIGRlZnMsIHN0
eWxlKQogICAgICAgICAgICBpZiAoIXAubWFya2VyKSBwLm1hcmtlciA9IGNuLm1hcmtlcgogICAg
ICAgICAgICBpZiAoIXAubWFya2VyU3RhcnQpIHAubWFya2VyU3RhcnQgPSBjbi5tYXJrZXJTdGFy
dAogICAgICAgICAgICBpZiAoIXAubWFya2VyRW5kKSBwLm1hcmtlckVuZCA9IGNuLm1hcmtlckVu
ZAogICAgICAgICAgICBpZiAoIXAubWFya2VyTWlkKSBwLm1hcmtlck1pZCA9IGNuLm1hcmtlck1p
ZAogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAocCAmJiBwLnNldFJvb3QpIHsKICAg
ICAgICAgIHAuekluZGV4ID0gaQogICAgICAgICAgY2FudmFzTm9kZS5hcHBlbmQocCkKICAgICAg
ICAgIHRoaXMucGFyc2VDaGlsZHJlbihjLCBwLCBkZWZzLCBzdHlsZSkKICAgICAgICB9CiAgICAg
IH0KICAgIH0KICB9LAoKICBwYXJzZVN0eWxlIDogZnVuY3Rpb24obm9kZSwgc3R5bGUpIHsKICAg
IHZhciB0ZXh0ID0gbm9kZS50ZXh0Q29udGVudAogICAgdmFyIHNlZ3MgPSB0ZXh0LnNwbGl0KC9c
fS9tKQogICAgZm9yICh2YXIgaT0wOyBpPHNlZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHNl
ZyA9IHNlZ3NbaV0KICAgICAgdmFyIGt2ID0gc2VnLnNwbGl0KC9cey9tKQogICAgICBpZiAoa3Yu
bGVuZ3RoIDwgMikgY29udGludWUKICAgICAgdmFyIGtleSA9IGt2WzBdLnN0cmlwKCkKICAgICAg
dmFyIHZhbHVlID0ga3ZbMV0uc3RyaXAoKQogICAgICBzd2l0Y2ggKGtleS5jaGFyQXQoMCkpIHsK
ICAgICAgICBjYXNlICcuJzoKICAgICAgICAgIHN0eWxlLmNsYXNzZXNba2V5LnNsaWNlKDEpXSA9
IHZhbHVlCiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICcjJzoKICAgICAgICAgIHN0eWxl
Lmlkc1trZXkuc2xpY2UoMSldID0gdmFsdWUKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1
bHQ6CiAgICAgICAgICBzdHlsZS50YWdzW2tleV0gPSB2YWx1ZQogICAgICAgICAgYnJlYWs7CiAg
ICAgIH0KICAgIH0KICB9LAoKICBwYXJzZVN0b3BzIDogZnVuY3Rpb24oZywgbm9kZSwgZGVmcywg
c3R5bGUpIHsKICAgIHZhciBocmVmID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ3hsaW5rOmhyZWYnKQog
ICAgZy5jb2xvclN0b3BzID0gW10KICAgIGlmIChocmVmKSB7CiAgICAgIGhyZWYgPSBocmVmLnJl
cGxhY2UoL14jLywnJykKICAgICAgdGhpcy5nZXREZWYoZGVmcywgaHJlZiwgZnVuY3Rpb24oZzIp
IHsKICAgICAgICBpZiAoZy5jb2xvclN0b3BzLmxlbmd0aCA9PSAwKQogICAgICAgICAgZy5jb2xv
clN0b3BzID0gZzIuY29sb3JTdG9wcwogICAgICB9KQogICAgfQogICAgdmFyIHN0b3BzID0gW10K
ICAgIGZvciAodmFyIGk9MDsgaTxub2RlLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAg
dmFyIGMgPSBub2RlLmNoaWxkTm9kZXNbaV0KICAgICAgaWYgKGMudGFnTmFtZSA9PSAnc3RvcCcp
IHsKICAgICAgICB2YXIgb2Zmc2V0ID0gcGFyc2VGbG9hdChjLmdldEF0dHJpYnV0ZSgnb2Zmc2V0
JykpCiAgICAgICAgaWYgKGMuZ2V0QXR0cmlidXRlKCdvZmZzZXQnKS5zZWFyY2goLyUvKSAhPSAt
MSkKICAgICAgICAgIG9mZnNldCAqPSAwLjAxCiAgICAgICAgdmFyIHN0b3AgPSBbb2Zmc2V0XQog
ICAgICAgIHN0b3AuY29sb3IgPSBnLmNvbG9yCiAgICAgICAgZm9yICh2YXIgaj0wOyBqPGMuYXR0
cmlidXRlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgdmFyIGF0dHIgPSBjLmF0dHJpYnV0ZXNb
al0KICAgICAgICAgIGlmICh0aGlzLlNWR01hcHBpbmdbYXR0ci5ub2RlTmFtZV0pCiAgICAgICAg
ICAgIHRoaXMuU1ZHTWFwcGluZ1thdHRyLm5vZGVOYW1lXShzdG9wLCBhdHRyLm5vZGVWYWx1ZSwg
ZGVmcywgc3R5bGUpCiAgICAgICAgfQogICAgICAgIHRoaXMuYXBwbHlTVkdTdHlsZShzdG9wLCBj
LmdldEF0dHJpYnV0ZSgnc3R5bGUnKSwgZGVmcywgc3R5bGUpCiAgICAgICAgdmFyIGlkID0gYy5n
ZXRBdHRyaWJ1dGUoJ2lkJykKICAgICAgICBpZiAoaWQpIHRoaXMuc2V0RGVmKGRlZnMsIGlkLCBz
dG9wKQogICAgICAgIHN0b3BzLnB1c2goc3RvcCkKICAgICAgfQogICAgfQogICAgaWYgKHN0b3Bz
Lmxlbmd0aCA+IDApCiAgICAgIGcuY29sb3JTdG9wcyA9IHN0b3BzCiAgfSwKCiAgYXBwbHlTVkdU
cmFuc2Zvcm0gOiBmdW5jdGlvbihub2RlLCB0cmFuc2Zvcm0sIGRlZnMsIHN0eWxlKSB7CiAgICBp
ZiAoIXRyYW5zZm9ybSkgcmV0dXJuCiAgICBub2RlLnRyYW5zZm9ybUxpc3QgPSBbXQogICAgdmFy
IHNlZ3MgPSB0cmFuc2Zvcm0ubWF0Y2goL1thLXpdK1xzKlwoW14pXSpcKS9pZykKICAgIGZvciAo
dmFyIGk9MDsgaTxzZWdzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBrdiA9IHNlZ3NbaV0uc3Bs
aXQoIigiKQogICAgICB2YXIgayA9IGt2WzBdLnN0cmlwKCkKICAgICAgaWYgKHRoaXMuU1ZHTWFw
cGluZ1trXSkgewogICAgICAgIHZhciB2ID0ga3ZbMV0uc3RyaXAoKS5zbGljZSgwLC0xKQogICAg
ICAgIHRoaXMuU1ZHTWFwcGluZ1trXShub2RlLCB2LCBkZWZzLCBzdHlsZSkKICAgICAgfQogICAg
fQogICAgdGhpcy5icmVha0Rvd25UcmFuc2Zvcm1MaXN0KG5vZGUpCiAgfSwKCiAgYnJlYWtEb3du
VHJhbnNmb3JtTGlzdCA6IGZ1bmN0aW9uKG5vZGUpIHsKICAgIHZhciB0bCA9IG5vZGUudHJhbnNm
b3JtTGlzdAogICAgaWYgKG5vZGUudHJhbnNmb3JtTGlzdC5sZW5ndGggPT0gMSkgewogICAgICB2
YXIgdHIgPSB0bFswXQogICAgICBpZiAodHJbMF0gPT0gJ3RyYW5zbGF0ZScpIHsKICAgICAgICBu
b2RlLnggPSB0clsxXVswXQogICAgICAgIG5vZGUueSA9IHRyWzFdWzFdCiAgICAgIH0gZWxzZSBp
ZiAodHJbMF0gPT0gJ3NjYWxlJykgewogICAgICAgIG5vZGUuc2NhbGUgPSB0clsxXQogICAgICB9
IGVsc2UgaWYgKHRyWzBdID09ICdyb3RhdGUnKSB7CiAgICAgICAgbm9kZS5yb3RhdGlvbiA9IHRy
WzFdCiAgICAgIH0gZWxzZSBpZiAodHJbMF0gPT0gJ21hdHJpeCcpIHsKICAgICAgICBub2RlLm1h
dHJpeCA9IHRyWzFdCiAgICAgIH0gZWxzZSBpZiAodHJbMF0gPT0gJ3NrZXdYJykgewogICAgICAg
IG5vZGUuc2tld1ggPSB0clsxXVswXQogICAgICB9IGVsc2UgaWYgKHRyWzBdID09ICdza2V3WScp
IHsKICAgICAgICBub2RlLnNrZXdZID0gdHJbMV1bMF0KICAgICAgfSBlbHNlIHsKICAgICAgICBy
ZXR1cm4KICAgICAgfQogICAgICBub2RlLnRyYW5zZm9ybUxpc3QgPSBudWxsCiAgICB9CiAgfSwK
CiAgYXBwbHlTVkdTdHlsZSA6IGZ1bmN0aW9uKG5vZGUsIHN0eWxlLCBkZWZzLCBzdCkgewogICAg
aWYgKCFzdHlsZSkgcmV0dXJuCiAgICB2YXIgc2VncyA9IHN0eWxlLnNwbGl0KCI7IikKICAgIGZv
ciAodmFyIGk9MDsgaTxzZWdzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBrdiA9IHNlZ3NbaV0u
c3BsaXQoIjoiKQogICAgICB2YXIgayA9IGt2WzBdLnN0cmlwKCkKICAgICAgaWYgKHRoaXMuU1ZH
TWFwcGluZ1trXSkgewogICAgICAgIHZhciB2ID0ga3ZbMV0uc3RyaXAoKQogICAgICAgIHRoaXMu
U1ZHTWFwcGluZ1trXShub2RlLCB2LCBkZWZzLCBzdCkKICAgICAgfQogICAgfQogIH0sCgogIGdl
dERlZiA6IGZ1bmN0aW9uKGRlZnMsIGlkLCBmKSB7CiAgICBpZiAoZGVmc1tpZF0gJiYgZGVmc1tp
ZF0gaW5zdGFuY2VvZiBBcnJheSkgewogICAgICBkZWZzW2lkXS5wdXNoKGYpCiAgICB9IGVsc2Ug
aWYgKGRlZnNbaWRdKSB7CiAgICAgIGYoZGVmc1tpZF0pCiAgICB9IGVsc2UgewogICAgICBkZWZz
W2lkXSA9IFtmXQogICAgfQogIH0sCgogIHNldERlZiA6IGZ1bmN0aW9uKGRlZnMsIGlkLCBvYmop
IHsKICAgIGlmIChkZWZzW2lkXSAmJiBkZWZzW2lkXSBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICAg
IGZvciAodmFyIGk9MDsgaTxkZWZzW2lkXS5sZW5ndGg7IGkrKykgewogICAgICAgIGRlZnNbaWRd
W2ldKG9iaikKICAgICAgfQogICAgfQogICAgZGVmc1tpZF0gPSBvYmoKICB9LAoKICBwYXJzZVVu
aXQgOiBmdW5jdGlvbih2LCBwYXJlbnQsIGRpcikgewogICAgaWYgKHYgPT0gbnVsbCkgewogICAg
ICByZXR1cm4gbnVsbAogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHRoaXMucGFyc2VVbml0TXVs
dGlwbGllcih2LCBwYXJlbnQsIGRpcikgKiBwYXJzZUZsb2F0KHYuc3RyaXAoKSkKICAgIH0KICB9
LAoKICBwYXJzZVVuaXRNdWx0aXBsaWVyIDogZnVuY3Rpb24oc3RyLCBwYXJlbnQsIGRpcikgewog
ICAgdmFyIGNtID0gdGhpcy5nZXRDbUluUGl4ZWxzKCkKICAgIGlmIChzdHIuc2VhcmNoKC9jbSQv
aSkgIT0gLTEpCiAgICAgIHJldHVybiBjbQogICAgZWxzZSBpZiAoc3RyLnNlYXJjaCgvbW0kL2kp
ICE9IC0xKQogICAgICByZXR1cm4gMC4xICogY20KICAgIGVsc2UgaWYgKHN0ci5zZWFyY2goL3B0
JC9pKSAhPSAtMSkKICAgICAgcmV0dXJuIDAuMDM1Mjc3Nzc3OCAqIGNtCiAgICBlbHNlIGlmIChz
dHIuc2VhcmNoKC9wYyQvaSkgIT0gLTEpCiAgICAgIHJldHVybiAwLjQyMzMzMzMzMzMgKiBjbQog
ICAgZWxzZSBpZiAoc3RyLnNlYXJjaCgvaW4kL2kpICE9IC0xKQogICAgICByZXR1cm4gMi41NCAq
IGNtCiAgICBlbHNlIGlmIChzdHIuc2VhcmNoKC9lbSQvaSkgIT0gLTEpCiAgICAgIHJldHVybiBw
YXJlbnQuZm9udFNpemUKICAgIGVsc2UgaWYgKHN0ci5zZWFyY2goL2V4JC9pKSAhPSAtMSkKICAg
ICAgcmV0dXJuIHBhcmVudC5mb250U2l6ZSAvIDIKICAgIGVsc2UgaWYgKHN0ci5zZWFyY2goLyUk
L2kpICE9IC0xKQogICAgICBpZiAoZGlyID09ICd4JykKICAgICAgICByZXR1cm4gcGFyZW50LnJv
b3QuaW5uZXJXaWR0aCAqIDAuMDEKICAgICAgZWxzZSBpZiAoZGlyID09ICd5JykKICAgICAgICBy
ZXR1cm4gcGFyZW50LnJvb3QuaW5uZXJIZWlnaHQgKiAwLjAxCiAgICAgIGVsc2UKICAgICAgICBy
ZXR1cm4gcGFyZW50LnJvb3QuaW5uZXJTaXplICogMC4wMQogICAgZWxzZQogICAgICByZXR1cm4g
MQogIH0sCgogIGdldENtSW5QaXhlbHMgOiBmdW5jdGlvbigpIHsKICAgIGlmICghdGhpcy5jbUlu
UGl4ZWxzKSB7CiAgICAgIHZhciBlID0gRSgnZGl2Jyx7IHN0eWxlOiB7CiAgICAgICAgbWFyZ2lu
OiAnMHB4JywKICAgICAgICBwYWRkaW5nOiAnMHB4JywKICAgICAgICB3aWR0aDogJzFjbScsCiAg
ICAgICAgaGVpZ2h0OiAnMWNtJywKICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAg
ICB2aXNpYmlsaXR5OiAnaGlkZGVuJwogICAgICB9fSkKICAgICAgZG9jdW1lbnQuYm9keS5hcHBl
bmRDaGlsZChlKQogICAgICB2YXIgY20gPSBlLm9mZnNldFdpZHRoCiAgICAgIGRvY3VtZW50LmJv
ZHkucmVtb3ZlQ2hpbGQoZSkKICAgICAgdGhpcy5jbUluUGl4ZWxzID0gY20gfHwgMzgKICAgIH0K
ICAgIHJldHVybiB0aGlzLmNtSW5QaXhlbHMKICB9LAoKICBnZXRFbUluUGl4ZWxzIDogZnVuY3Rp
b24oKSB7CiAgICBpZiAoIXRoaXMuZW1JblBpeGVscykgewogICAgICB2YXIgZSA9IEUoJ2Rpdics
eyBzdHlsZTogewogICAgICAgIG1hcmdpbjogJzBweCcsCiAgICAgICAgcGFkZGluZzogJzBweCcs
CiAgICAgICAgd2lkdGg6ICcxZW0nLAogICAgICAgIGhlaWdodDogJzFlbScsCiAgICAgICAgcG9z
aXRpb246ICdhYnNvbHV0ZScsCiAgICAgICAgdmlzaWJpbGl0eTogJ2hpZGRlbicKICAgICAgfX0p
CiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZSkKICAgICAgdmFyIGVtID0gZS5vZmZz
ZXRXaWR0aAogICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGUpCiAgICAgIHRoaXMuZW1J
blBpeGVscyA9IGVtIHx8IDEyCiAgICB9CiAgICByZXR1cm4gdGhpcy5lbUluUGl4ZWxzCiAgfSwK
CiAgZ2V0RXhJblBpeGVscyA6IGZ1bmN0aW9uKCkgewogICAgaWYgKCF0aGlzLmV4SW5QaXhlbHMp
IHsKICAgICAgdmFyIGUgPSBFKCdkaXYnLHsgc3R5bGU6IHsKICAgICAgICBtYXJnaW46ICcwcHgn
LAogICAgICAgIHBhZGRpbmc6ICcwcHgnLAogICAgICAgIHdpZHRoOiAnMWV4JywKICAgICAgICBo
ZWlnaHQ6ICcxZXgnLAogICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgIHZpc2li
aWxpdHk6ICdoaWRkZW4nCiAgICAgIH19KQogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxk
KGUpCiAgICAgIHZhciBleCA9IGUub2Zmc2V0V2lkdGgKICAgICAgZG9jdW1lbnQuYm9keS5yZW1v
dmVDaGlsZChlKQogICAgICB0aGlzLmV4SW5QaXhlbHMgPSBleCB8fCA2CiAgICB9CiAgICByZXR1
cm4gdGhpcy5leEluUGl4ZWxzCiAgfSwKCiAgU1ZHTWFwcGluZyA6IHsKICAgIERFR19UT19SQURf
RkFDVE9SIDogTWF0aC5QSSAvIDE4MCwKICAgIFJBRF9UT19ERUdfRkFDVE9SIDogMTgwIC8gTWF0
aC5QSSwKCiAgICBwYXJzZVVuaXQgOiBmdW5jdGlvbih2LCBjbiwgZGlyKSB7CiAgICAgIHJldHVy
biBTVkdQYXJzZXIucGFyc2VVbml0KHYsIGNuLCBkaXIpCiAgICB9LAoKICAgICJjbGFzcyIgOiBm
dW5jdGlvbihub2RlLCB2KSB7CiAgICAgIG5vZGUuY2xhc3NOYW1lID0gdgogICAgfSwKCiAgICBt
YXJrZXIgOiBmdW5jdGlvbihub2RlLCB2LCBkZWZzKSB7CiAgICAgIFNWR1BhcnNlci5nZXREZWYo
ZGVmcywgdi5yZXBsYWNlKC9edXJsXCgjfFwpJC9nLCAnJyksIGZ1bmN0aW9uKGcpIHsKICAgICAg
ICBub2RlLm1hcmtlciA9IGcKICAgICAgfSkKICAgIH0sCgogICAgIm1hcmtlci1zdGFydCIgOiBm
dW5jdGlvbihub2RlLCB2LCBkZWZzKSB7CiAgICAgIFNWR1BhcnNlci5nZXREZWYoZGVmcywgdi5y
ZXBsYWNlKC9edXJsXCgjfFwpJC9nLCAnJyksIGZ1bmN0aW9uKGcpIHsKICAgICAgICBub2RlLm1h
cmtlclN0YXJ0ID0gZwogICAgICB9KQogICAgfSwKCiAgICAibWFya2VyLWVuZCIgOiBmdW5jdGlv
bihub2RlLCB2LCBkZWZzKSB7CiAgICAgIFNWR1BhcnNlci5nZXREZWYoZGVmcywgdi5yZXBsYWNl
KC9edXJsXCgjfFwpJC9nLCAnJyksIGZ1bmN0aW9uKGcpIHsKICAgICAgICBub2RlLm1hcmtlckVu
ZCA9IGcKICAgICAgfSkKICAgIH0sCgogICAgIm1hcmtlci1taWQiIDogZnVuY3Rpb24obm9kZSwg
diwgZGVmcykgewogICAgICBTVkdQYXJzZXIuZ2V0RGVmKGRlZnMsIHYucmVwbGFjZSgvXnVybFwo
I3xcKSQvZywgJycpLCBmdW5jdGlvbihnKSB7CiAgICAgICAgbm9kZS5tYXJrZXJNaWQgPSBnCiAg
ICAgIH0pCiAgICB9LAoKICAgICJjbGlwLXBhdGgiIDogZnVuY3Rpb24obm9kZSwgdiwgZGVmcykg
ewogICAgICBTVkdQYXJzZXIuZ2V0RGVmKGRlZnMsIHYucmVwbGFjZSgvXnVybFwoI3xcKSQvZywg
JycpLCBmdW5jdGlvbihnKSB7CiAgICAgICAgbm9kZS5jbGlwUGF0aCA9IGcKICAgICAgfSkKICAg
IH0sCgogICAgaWQgOiBmdW5jdGlvbihub2RlLCB2KSB7CiAgICAgIG5vZGUuaWQgPSB2CiAgICB9
LAoKICAgIHRyYW5zbGF0ZSA6IGZ1bmN0aW9uKG5vZGUsIHYpIHsKICAgICAgdmFyIHh5ID0gdi5z
cGxpdCgvW1xzLF0rLykubWFwKHBhcnNlRmxvYXQpCiAgICAgIG5vZGUudHJhbnNmb3JtTGlzdC5w
dXNoKFsndHJhbnNsYXRlJywgW3h5WzBdLCB4eVsxXSB8fCAwXV0pCiAgICB9LAoKICAgIHJvdGF0
ZSA6IGZ1bmN0aW9uKG5vZGUsIHYpIHsKICAgICAgaWYgKHYgPT0gJ2F1dG8nIHx8IHYgPT0gJ2F1
dG8tcmV2ZXJzZScpIHJldHVybgogICAgICB2YXIgcm90ID0gdi5zcGxpdCgvW1xzLF0rLykubWFw
KHBhcnNlRmxvYXQpCiAgICAgIHZhciBhbmdsZSA9IHJvdFswXSAqIHRoaXMuREVHX1RPX1JBRF9G
QUNUT1IKICAgICAgaWYgKHJvdC5sZW5ndGggPiAxKQogICAgICAgIG5vZGUudHJhbnNmb3JtTGlz
dC5wdXNoKFsncm90YXRlJywgW2FuZ2xlLCByb3RbMV0sIHJvdFsyXSB8fCAwXV0pCiAgICAgIGVs
c2UKICAgICAgICBub2RlLnRyYW5zZm9ybUxpc3QucHVzaChbJ3JvdGF0ZScsIFthbmdsZV1dKQog
ICAgfSwKCiAgICBzY2FsZSA6IGZ1bmN0aW9uKG5vZGUsIHYpIHsKICAgICAgdmFyIHh5ID0gdi5z
cGxpdCgvW1xzLF0rLykubWFwKHBhcnNlRmxvYXQpCiAgICAgIHZhciB0cmFucyA9IFsnc2NhbGUn
XQogICAgICBpZiAoeHkubGVuZ3RoID4gMSkKICAgICAgICB0cmFuc1sxXSA9IFt4eVswXSwgeHlb
MV1dCiAgICAgIGVsc2UKICAgICAgICB0cmFuc1sxXSA9IFt4eVswXSwgeHlbMF1dCiAgICAgIG5v
ZGUudHJhbnNmb3JtTGlzdC5wdXNoKHRyYW5zKQogICAgfSwKCiAgICBtYXRyaXggOiBmdW5jdGlv
bihub2RlLCB2KSB7CiAgICAgIHZhciBtYXQgPSB2LnNwbGl0KC9bXHMsXSsvKS5tYXAocGFyc2VG
bG9hdCkKICAgICAgbm9kZS50cmFuc2Zvcm1MaXN0LnB1c2goWydtYXRyaXgnLCBtYXRdKQogICAg
fSwKCiAgICBza2V3WCA6IGZ1bmN0aW9uKG5vZGUsIHYpIHsKICAgICAgdmFyIGFuZ2xlID0gcGFy
c2VGbG9hdCh2KSp0aGlzLkRFR19UT19SQURfRkFDVE9SCiAgICAgIG5vZGUudHJhbnNmb3JtTGlz
dC5wdXNoKFsnc2tld1gnLCBbYW5nbGVdXSkKICAgIH0sCgogICAgc2tld1kgOiBmdW5jdGlvbihu
b2RlLCB2KSB7CiAgICAgIHZhciBhbmdsZSA9IHBhcnNlRmxvYXQodikqdGhpcy5ERUdfVE9fUkFE
X0ZBQ1RPUgogICAgICBub2RlLnRyYW5zZm9ybUxpc3QucHVzaChbJ3NrZXdZJywgW2FuZ2xlXV0p
CiAgICB9LAoKICAgIG9wYWNpdHkgOiBmdW5jdGlvbihub2RlLCB2KSB7CiAgICAgIG5vZGUub3Bh
Y2l0eSA9IHBhcnNlRmxvYXQodikKICAgIH0sCgogICAgZGlzcGxheSA6IGZ1bmN0aW9uIChub2Rl
LCB2KSB7CiAgICAgIG5vZGUuZGlzcGxheSA9IHYKICAgIH0sCgogICAgdmlzaWJpbGl0eSA6IGZ1
bmN0aW9uIChub2RlLCB2KSB7CiAgICAgIG5vZGUudmlzaWJpbGl0eSA9IHYKICAgIH0sCgogICAg
J3N0cm9rZS1taXRlcmxpbWl0JyA6IGZ1bmN0aW9uKG5vZGUsIHYpIHsKICAgICAgbm9kZS5taXRl
ckxpbWl0ID0gcGFyc2VGbG9hdCh2KQogICAgfSwKCiAgICAnc3Ryb2tlLWxpbmVjYXAnIDogZnVu
Y3Rpb24obm9kZSwgdikgewogICAgICBub2RlLmxpbmVDYXAgPSB2CiAgICB9LAoKICAgICdzdHJv
a2UtbGluZWpvaW4nIDogZnVuY3Rpb24obm9kZSwgdikgewogICAgICBub2RlLmxpbmVKb2luID0g
dgogICAgfSwKCiAgICAnc3Ryb2tlLXdpZHRoJyA6IGZ1bmN0aW9uKG5vZGUsIHYpIHsKICAgICAg
bm9kZS5zdHJva2VXaWR0aCA9IHRoaXMucGFyc2VVbml0KHYsIG5vZGUpCiAgICB9LAoKICAgIGZp
bGwgOiBmdW5jdGlvbihub2RlLCB2LCBkZWZzLCBzdHlsZSkgewogICAgICBub2RlLmZpbGwgPSB0
aGlzLl9fcGFyc2VTdHlsZSh2LCBub2RlLmZpbGwsIGRlZnMsIG5vZGUuY29sb3IpCiAgICB9LAoK
ICAgIHN0cm9rZSA6IGZ1bmN0aW9uKG5vZGUsIHYsIGRlZnMsIHN0eWxlKSB7CiAgICAgIG5vZGUu
c3Ryb2tlID0gdGhpcy5fX3BhcnNlU3R5bGUodiwgbm9kZS5zdHJva2UsIGRlZnMsIG5vZGUuY29s
b3IpCiAgICB9LAoKICAgIGNvbG9yIDogZnVuY3Rpb24obm9kZSwgdiwgZGVmcywgc3R5bGUpIHsK
ICAgICAgaWYgKHYgPT0gJ2luaGVyaXQnKSByZXR1cm4KICAgICAgbm9kZS5jb2xvciA9IHRoaXMu
X19wYXJzZVN0eWxlKHYsIGZhbHNlLCBkZWZzLCBub2RlLmNvbG9yKQogICAgfSwKCiAgICAnc3Rv
cC1jb2xvcicgOiBmdW5jdGlvbihub2RlLCB2LCBkZWZzLCBzdHlsZSkgewogICAgICBpZiAodiA9
PSAnbm9uZScpIHsKICAgICAgICBub2RlWzFdID0gWzAsMCwwLDBdCiAgICAgIH0gZWxzZSB7CiAg
ICAgICAgbm9kZVsxXSA9IHRoaXMuX19wYXJzZVN0eWxlKHYsIG5vZGVbMV0sIGRlZnMsIG5vZGUu
Y29sb3IpCiAgICAgIH0KICAgIH0sCgogICAgJ2ZpbGwtb3BhY2l0eScgOiBmdW5jdGlvbihub2Rl
LCB2KSB7CiAgICAgIG5vZGUuZmlsbE9wYWNpdHkgPSBNYXRoLm1pbigxLE1hdGgubWF4KDAscGFy
c2VGbG9hdCh2KSkpCiAgICB9LAoKICAgICdzdHJva2Utb3BhY2l0eScgOiBmdW5jdGlvbihub2Rl
LCB2KSB7CiAgICAgIG5vZGUuc3Ryb2tlT3BhY2l0eSA9IE1hdGgubWluKDEsTWF0aC5tYXgoMCxw
YXJzZUZsb2F0KHYpKSkKICAgIH0sCgogICAgJ3N0b3Atb3BhY2l0eScgOiBmdW5jdGlvbihub2Rl
LCB2KSB7CiAgICAgIG5vZGVbMV0gPSBub2RlWzFdIHx8IFswLDAsMF0KICAgICAgbm9kZVsxXVsz
XSA9IE1hdGgubWluKDEsTWF0aC5tYXgoMCxwYXJzZUZsb2F0KHYpKSkKICAgIH0sCgogICAgJ3Rl
eHQtYW5jaG9yJyA6IGZ1bmN0aW9uKG5vZGUsIHYpIHsKICAgICAgbm9kZS50ZXh0QW5jaG9yID0g
dgogICAgICBpZiAobm9kZS5zZXRBbGlnbikgewogICAgICAgIGlmICh2ID09ICdtaWRkbGUnKQog
ICAgICAgICAgbm9kZS5zZXRBbGlnbignY2VudGVyJykKICAgICAgICBlbHNlCiAgICAgICAgICBu
b2RlLnNldEFsaWduKHYpCiAgICAgIH0KICAgIH0sCgogICAgJ2ZvbnQtZmFtaWx5JyA6IGZ1bmN0
aW9uKG5vZGUsIHYpIHsKICAgICAgbm9kZS5mb250RmFtaWx5ID0gdgogICAgfSwKCiAgICAnZm9u
dC1zaXplJyA6IGZ1bmN0aW9uKG5vZGUsIHYpIHsKICAgICAgbm9kZS5mb250U2l6ZSA9IHRoaXMu
cGFyc2VVbml0KHYsIG5vZGUpCiAgICB9LAoKICAgIF9fcGFyc2VTdHlsZSA6IGZ1bmN0aW9uKHYs
IGN1cnJlbnRTdHlsZSwgZGVmcywgY3VycmVudENvbG9yKSB7CgogICAgICBpZiAodi5jaGFyQXQo
MCkgPT0gJyMnKSB7CiAgICAgICAgaWYgKHYubGVuZ3RoID09IDQpCiAgICAgICAgICB2ID0gdi5y
ZXBsYWNlKC8oW14jXSkvZywgJyQxJDEnKQogICAgICAgIHZhciBhID0gdi5zbGljZSgxKS5tYXRj
aCgvLi4vZykubWFwKAogICAgICAgICAgZnVuY3Rpb24oaSkgeyByZXR1cm4gcGFyc2VJbnQoaSwg
MTYpIH0pCiAgICAgICAgcmV0dXJuIGEKCiAgICAgIH0gZWxzZSBpZiAodi5zZWFyY2goL15yZ2Jc
KC8pICE9IC0xKSB7CiAgICAgICAgdmFyIGEgPSB2LnNsaWNlKDQsLTEpLnNwbGl0KCIsIikKICAg
ICAgICBmb3IgKHZhciBpPTA7IGk8YS5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIGMgPSBh
W2ldLnN0cmlwKCkKICAgICAgICAgIGlmIChjLmNoYXJBdChjLmxlbmd0aC0xKSA9PSAnJScpCiAg
ICAgICAgICAgIGFbaV0gPSBNYXRoLnJvdW5kKHBhcnNlRmxvYXQoYy5zbGljZSgwLC0xKSkgKiAy
LjU1KQogICAgICAgICAgZWxzZQogICAgICAgICAgICBhW2ldID0gcGFyc2VJbnQoYykKICAgICAg
ICB9CiAgICAgICAgcmV0dXJuIGEKCiAgICAgIH0gZWxzZSBpZiAodi5zZWFyY2goL15yZ2JhXCgv
KSAhPSAtMSkgewogICAgICAgIHZhciBhID0gdi5zbGljZSg1LC0xKS5zcGxpdCgiLCIpCiAgICAg
ICAgZm9yICh2YXIgaT0wOyBpPDM7IGkrKykgewogICAgICAgICAgdmFyIGMgPSBhW2ldLnN0cmlw
KCkKICAgICAgICAgIGlmIChjLmNoYXJBdChjLmxlbmd0aC0xKSA9PSAnJScpCiAgICAgICAgICAg
IGFbaV0gPSBNYXRoLnJvdW5kKHBhcnNlRmxvYXQoYy5zbGljZSgwLC0xKSkgKiAyLjU1KQogICAg
ICAgICAgZWxzZQogICAgICAgICAgICBhW2ldID0gcGFyc2VJbnQoYykKICAgICAgICB9CiAgICAg
ICAgdmFyIGMgPSBhWzNdLnN0cmlwKCkKICAgICAgICBpZiAoYy5jaGFyQXQoYy5sZW5ndGgtMSkg
PT0gJyUnKQogICAgICAgICAgYVszXSA9IE1hdGgucm91bmQocGFyc2VGbG9hdChjLnNsaWNlKDAs
LTEpKSAqIDAuMDEpCiAgICAgICAgZWxzZQogICAgICAgICAgYVszXSA9IE1hdGgubWF4KDAsIE1h
dGgubWluKDEsIHBhcnNlRmxvYXQoYykpKQogICAgICAgIHJldHVybiBhCgogICAgICB9IGVsc2Ug
aWYgKHYuc2VhcmNoKC9edXJsXCgvKSAhPSAtMSkgewogICAgICAgIHZhciBpZCA9IHYubWF0Y2go
L1woW14pXStcKS8pWzBdLnNsaWNlKDEsLTEpLnJlcGxhY2UoL14jLywgJycpCiAgICAgICAgaWYg
KGRlZnNbaWRdKSB7CiAgICAgICAgICByZXR1cm4gZGVmc1tpZF0KICAgICAgICB9IGVsc2UgeyAv
LyBtaXNzaW5nIGRlZnMsIGxldCdzIG1ha2UgaXQga25vd24gdGhhdCB3ZSdyZSBzY3Jld2VkCiAg
ICAgICAgICByZXR1cm4gJ3JnYmEoMjU1LDAsMjU1LDEpJwogICAgICAgIH0KCiAgICAgIH0gZWxz
ZSBpZiAodiA9PSAnY3VycmVudENvbG9yJykgewogICAgICAgIHJldHVybiBjdXJyZW50Q29sb3IK
CiAgICAgIH0gZWxzZSBpZiAodiA9PSAnbm9uZScpIHsKICAgICAgICByZXR1cm4gJ25vbmUnCgog
ICAgICB9IGVsc2UgaWYgKHYgPT0gJ2ZyZWV6ZScpIHsgLy8gU01JTCBpcyBldmlsLCBidXQgc28g
YXJlIHdlCiAgICAgICAgcmV0dXJuIG51bGwKCiAgICAgIH0gZWxzZSBpZiAodiA9PSAncmVtb3Zl
JykgewogICAgICAgIHJldHVybiBudWxsCgogICAgICB9IGVsc2UgeyAvLyB1bmtub3duIHZhbHVl
LCBtYXliZSBpdCdzIGFuIElDQyBjb2xvcgogICAgICAgIHJldHVybiB2CiAgICAgIH0KICAgIH0K
ICB9Cn0K"></script>
<script type="text/javascript"><!-- /* --><![CDATA[ /* */
(function () {
    var c = document.getElementById("lissajous_canvas", {fill: "white"});
    c.style.background = "#00000";
    var canvas = new Canvas(c);
    canvas.getContext().fillRect(0, 0, canvas.width, canvas.height);
    canvas.fill = [0, 0, 0, 0.01];

    var rect = new Rectangle(20, 20, {centered: true});
    var g = new Gradient({
        type: "radial",
        endRadius: rect.width / 2,
        colorStops: [[0, "rgba(240,240,240,100)"], [0.1, "rgba(0,240,100,50)"], [1, "rgba(0,240,100,0)"]]
    });
    rect.fill = g;
    var phase = Math.PI * 0.5;
    rect.addFrameListener(function(t, dt) {
        var cx = canvas.width  * 0.5;
        var cy = canvas.height * 0.5;
        var a = Math.min(cx, cy) - rect.width * 0.5;

        rect.x = cx + a * Math.sin((5) * t * 0.0005);
        rect.y = cy + a * Math.sin((6) * t * 0.0005 + phase);
    });

    canvas.append(rect);

    var pause = document.createElement("input");
    pause.type = "button";
    pause.value = "Pause";
    pause.onclick = function () {
      if (canvas.isPlaying) {
          canvas.stop();
      } else {
          canvas.play();
      }
    };
    c.parentNode.insertBefore(pause, c);
    c.parentNode.insertBefore(document.createElement("br"), c);

})();
// ]]><!-- --></script>
</div>
<p>
This program use <a href="http://code.google.com/p/cakejs/">cakejs</a> (2D scene graph library.)
<ins datetime="2017-06-10T19:06:25+09:00">Note: cakejs seems to be no longer maintained as of 2017.</ins>
</p>
<p>
Source code is straightforward. A object with radial gradient moves along the curve. Frequency ratio is 5:6.
</p>
{% highlight javascript %}
    var rect = new Rectangle(20, 20, {centered: true});
    var g = new Gradient({
        type: "radial",
        endRadius: rect.width / 2,
        colorStops: [[0, "rgba(240,240,240,100)"], [0.1, "rgba(0,240,100,50)"], [1, "rgba(0,240,100,0)"]]
    });
    rect.fill = g;
    var phase = Math.PI * 0.5;
    rect.addFrameListener(function(t, dt) {
        var cx = canvas.width  * 0.5;
        var cy = canvas.height * 0.5;
        var a = Math.min(cx, cy) - rect.width * 0.5;

        rect.x = cx + a * Math.sin((5) * t * 0.0005);
        rect.y = cy + a * Math.sin((6) * t * 0.0005 + phase);
    });
{% endhighlight %}
<p>
Cakejs's demo is very very cool. I like <a href="http://glimr.rubyforge.org/cake/missile_fleet.html">Missile Fleet</a> game demo.
</p>

<h4>See also</h4>
<ul>
<li><a href="http://code.google.com/p/cakejs/">cakejs project page</a></li>
<li><a href="http://en.wikipedia.org/wiki/Lissajous_curve">Lissajous curve</a> - wikipedia</li>
<li>Japanese:<a href="http://www.ip.uec.ac.jp/ipo/archive/logo.html">()</a></li>
</ul>
